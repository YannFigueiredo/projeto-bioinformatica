(this["webpackJsonp@jbrowse/web"]=this["webpackJsonp@jbrowse/web"]||[]).push([[4],{1002:function(e,t,n){"use strict";n.d(t,"c",(function(){return O})),n.d(t,"f",(function(){return j})),n.d(t,"a",(function(){return k})),n.d(t,"d",(function(){return C})),n.d(t,"e",(function(){return E})),n.d(t,"b",(function(){return x}));var a=n(89),r=n(82),o=n(2502),i=n(2503),c=n(2501),s=n(51),l=n(2479),u=n(1),d=n.n(u),f=n(1619),p=n.n(f),m=n(1620),g=n.n(m),h=n(1621),b=n.n(h),v=Object(s.a)((function(e){return{card:{width:200,height:150,cursor:"pointer"},name:{marginTop:e.spacing(),textAlign:"center",maxWidth:200},media:{height:150}}}));function y(e){var t=e.name,n=e.onClick,a=e.image,s=v(),f=Object(u.useState)(!1),p=Object(r.a)(f,2),m=p[0],g=p[1];return d.a.createElement(c.a,null,d.a.createElement(o.a,{className:s.card,onMouseOver:function(){return g(!0)},onMouseOut:function(){return g(!1)},onClick:n,raised:Boolean(m)},d.a.createElement(i.a,{className:s.media,image:a})),d.a.createElement(l.a,{variant:"subtitle2",className:s.name},t))}y.defaultProps={onClick:function(){},style:{}};var w={name:"New session ".concat((new Date).toLocaleString()),connections:{}};function O(e){var t=e.root;return d.a.createElement(y,{name:"Empty",onClick:function(){t.activateSession(w)},image:p.a})}function j(e){var t=e.root;return d.a.createElement(y,{name:"Empty",onClick:function(){var e=Object(a.a)(Object(a.a)({},w),{},{name:"New session ".concat((new Date).toLocaleString()),views:[]});t.setSession(e)},image:p.a})}function k(e){var t=e.root;return d.a.createElement(y,{name:"Linear Genome View",onClick:function(){var e=Object(a.a)(Object(a.a)({},w),{},{name:"New session ".concat((new Date).toLocaleString()),views:[{type:"LinearGenomeView"}]});t.setSession(e)},image:g.a})}function C(e){var t=e.root;return d.a.createElement(y,{name:"Linear Genome View",onClick:function(){var e=Object(a.a)(Object(a.a)({},w),{},{name:"New session ".concat((new Date).toLocaleString()),views:[{type:"LinearGenomeView"}]});t.activateSession(e)},image:g.a})}function E(e){var t=e.root;return d.a.createElement(y,{name:"Structural Variant Inspector",onClick:function(){var e=Object(a.a)(Object(a.a)({},w),{},{name:"New session ".concat((new Date).toLocaleString()),views:[{type:"SvInspectorView"}]});t.activateSession(e)},style:{padding:0},image:b.a})}function x(e){var t=e.root;return d.a.createElement(y,{name:"Structural Variant Inspector",onClick:function(){var e=Object(a.a)(Object(a.a)({},w),{},{name:"New session ".concat((new Date).toLocaleString()),views:[{type:"SvInspectorView"}]});t.setSession(e)},style:{padding:0},image:b.a})}},1005:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(84),r=n(94),o=n(95),i=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return n}(n(312).a)},1012:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(82),r=n(104),o=n(84),i=n(88),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,e),this.subLayouts=new Map,this.SubLayoutClass=void 0,this.subLayoutConstructorArgs={},this.subLayouts=new Map,this.SubLayoutClass=t,this.subLayoutConstructorArgs=n}return Object(i.a)(e,[{key:"getSublayout",value:function(e){var t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}},{key:"addRect",value:function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,a,r,o)}},{key:"discardRange",value:function(e,t,n){var a=this.subLayouts.get(e);return a&&a.discardRange(t,n)}},{key:"toJSON",value:function(){var e,t={},n=Object(r.a)(this.subLayouts.entries());try{for(n.s();!(e=n.n()).done;){var o=Object(a.a)(e.value,2),i=o[0],c=o[1];t[i]=c.toJSON()}}catch(s){n.e(s)}finally{n.f()}return t}}]),e}()},1013:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n(91),r=n.n(a),o=n(93),i=n(84),c=n(88),s=("undefined"!==typeof window?window:{}).electron,l=function(){function t(e){var n;if(Object(i.a)(this,t),this.filename=void 0,this.fd=void 0,this.ipcRenderer=void 0,s&&(n=s.ipcRenderer),!n)throw new Error("Cannot use ElectronLocalFile without ipcRenderer from electron");this.ipcRenderer=n,this.filename=e}return Object(c.a)(t,[{key:"getFd",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.filename){e.next=2;break}throw new Error("no file path specified");case 2:return this.fd||(this.fd=this.ipcRenderer.invoke("open",this.filename,"r")),e.abrupt("return",this.fd);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var t=Object(o.a)(r.a.mark((function t(n){var a,o,i,c,s,l,u=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=u.length>1&&void 0!==u[1]?u[1]:0,o=u.length>2?u[2]:void 0,i=u.length>3&&void 0!==u[3]?u[3]:0,c=Math.min(n.length-a,o),t.next=6,this.getFd();case 6:return s=t.sent,t.next=9,this.ipcRenderer.invoke("read",s,n,a,c,i);case 9:return(l=t.sent).buffer=e.from(l.buffer),l.buffer.copy(n),t.abrupt("return",l);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"readFile",value:function(){var t=Object(o.a)(r.a.mark((function t(){var n,a=arguments;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.length>0&&void 0!==a[0]?a[0]:{},this.filename){t.next=3;break}throw new Error("no file path specified");case 3:return t.next=5,this.ipcRenderer.invoke("readFile",this.filename);case 5:return n=t.sent,t.abrupt("return",void 0!==n.byteLength?e.from(n):n);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stat",value:function(){var e=Object(o.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.ipcRenderer,e.next=3,this.getFd();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.invoke.call(e.t0,"stat",e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}()}).call(this,n(105).Buffer)},114:function(e,t,n){"use strict";n.r(t),n.d(t,"ElementId",(function(){return u})),n.d(t,"PropTypes",(function(){return d})),n.d(t,"NoAssemblyRegion",(function(){return f})),n.d(t,"Region",(function(){return p})),n.d(t,"LocalPathLocation",(function(){return m})),n.d(t,"UriLocationRaw",(function(){return g})),n.d(t,"UriLocation",(function(){return h})),n.d(t,"FileLocation",(function(){return b}));var a=n(160),r=n(415),o=n.n(r),i=n(87),c=n(11),s=n.n(c),l=n(86),u=i.types.optional(i.types.identifier,o.a.generate),d={Region:s.a.shape({refName:s.a.string.isRequired,start:s.a.number.isRequired,end:s.a.number.isRequired}),ConfigSchema:l.PropTypes.objectOrObservableObject,Feature:s.a.shape({get:s.a.func.isRequired,id:s.a.func.isRequired})},f=i.types.model("NoAssemblyRegion",{refName:i.types.string,start:i.types.number,end:i.types.number,reversed:i.types.optional(i.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}})),p=i.types.compose("Region",f,i.types.model({assemblyName:i.types.string})),m=i.types.model("LocalPathLocation",{localPath:i.types.string}),g=i.types.model("UriLocation",{uri:i.types.string,baseUri:i.types.maybe(i.types.string)}),h=i.types.snapshotProcessor(g,{postProcessor:function(e){var t=e.baseUri,n=Object(a.a)(e,["baseUri"]);return t?e:n}}),b=i.types.union(m,h)},126:function(e,t,n){"use strict";n.r(t),n.d(t,"jbrowseDefaultPalette",(function(){return f})),n.d(t,"createJBrowseDefaultProps",(function(){return p})),n.d(t,"createJBrowseDefaultOverrides",(function(){return m})),n.d(t,"jbrowseBaseTheme",(function(){return g})),n.d(t,"createJBrowseTheme",(function(){return h})),n.d(t,"LogoFull",(function(){return O})),n.d(t,"Logomark",(function(){return w})),n.d(t,"App",(function(){return je})),n.d(t,"FileSelector",(function(){return ke.a})),n.d(t,"PrerenderedCanvas",(function(){return Se})),n.d(t,"ResizeHandle",(function(){return Y})),n.d(t,"StartScreen",(function(){return ut})),n.d(t,"EditableTypography",(function(){return de})),n.d(t,"FactoryResetDialog",(function(){return ot})),n.d(t,"Tooltip",(function(){return mt})),n.d(t,"FatalErrorDialog",(function(){return bt})),n.d(t,"Menu",(function(){return oe.a})),n.d(t,"SanitizedHTML",(function(){return vt.a}));var a=n(89),r=n(25),o=n(24),i=n(998),c=n(22),s=n(36),l=n(968),u=n.n(l),d=Object(s.a)(),f={primary:{main:"#0D233F"},secondary:{main:"#721E63"},tertiary:d.palette.augmentColor({main:"#135560"}),quaternary:d.palette.augmentColor({main:"#FFB11D"}),stopCodon:"#e22",startCodon:"#3e3",bases:{A:d.palette.augmentColor(r.a),C:d.palette.augmentColor(o.a),G:d.palette.augmentColor(i.a),T:d.palette.augmentColor(c.a)}};function p(){return{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}}}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=u()(f,e);return{MuiIconButton:{colorSecondary:{color:t.tertiary.main}},MuiButton:{textSecondary:{color:t.tertiary.main}},MuiFab:{secondary:{backgroundColor:t.quaternary.main}},MuiLink:{root:{color:t.tertiary.main}},MuiAccordionSummary:{root:{background:t.tertiary.main,"&$expanded":{minHeight:0,margin:0,color:t.tertiary.contrastText},margin:0,minHeight:0,padding:"0px 24px"},content:{"&$expanded":{margin:"8px 0px"},margin:"8px 0px",color:t.tertiary.contrastText},expanded:{}},MuiMenuItem:{root:{paddingTop:3,paddingBottom:3}},MuiListItemIcon:{root:{minWidth:32}},MuiListItemText:{inset:{paddingLeft:32}}}}var g={palette:f,typography:{fontSize:12},spacing:4,props:{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},overrides:m()};function h(e){var t,n;return e?((null===(t=e.palette)||void 0===t?void 0:t.tertiary)&&(e=Object(a.a)(Object(a.a)({},e),{},{palette:Object(a.a)(Object(a.a)({},e.palette),{},{tertiary:d.palette.augmentColor(e.palette.tertiary)})})),(null===(n=e.palette)||void 0===n?void 0:n.quaternary)&&(e=Object(a.a)(Object(a.a)({},e),{},{palette:Object(a.a)(Object(a.a)({},e.palette),{},{quaternary:d.palette.augmentColor(e.palette.quaternary)})})),e=Object(a.a)(Object(a.a)({},e),{},{props:u()({MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},e.props||{}),overrides:u()(m(e.palette),e.overrides||{})}),Object(s.a)(u()(g,e))):Object(s.a)(g)}var b=n(1),v=n.n(b);function y(e){return"black"===e?{midnight:"#808080",forrest:"#666666",grape:"#4d4d4d",mandarin:"#333333",gray:"#1a1a1a"}:"white"===e?{midnight:"#ffffff",forrest:"#e6e6e6",grape:"#cccccc",mandarin:"#b3b3b3",gray:"#999999"}:{midnight:"#0d233f",forrest:"#135560",grape:"#721e63",mandarin:"#ffb11d",gray:"#dadada"}}function w(e){var t=e.variant;return v.a.createElement("svg",{viewBox:"0 0 175 175"},v.a.createElement(j,{variant:t}))}function O(e){var t=e.variant;return v.a.createElement("svg",{viewBox:"0 0 641 175"},v.a.createElement(k,{variant:t}),v.a.createElement(j,{variant:t}))}function j(e){var t=y(e.variant);return v.a.createElement(v.a.Fragment,null,v.a.createElement("path",{style:{fill:t.midnight},d:"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z"}),v.a.createElement("path",{style:{fill:t.forrest},d:"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z"}),v.a.createElement("path",{style:{fill:t.grape},d:"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z"}),v.a.createElement("path",{style:{fill:t.mandarin},d:"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z"}),v.a.createElement("path",{style:{fill:t.gray},d:"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z"}))}function k(e){var t=y(e.variant);return v.a.createElement("g",{"aria-label":"JBrowse",transform:"translate(213.084 144.241)",style:{fill:t.midnight}},v.a.createElement("path",{d:"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z"}),v.a.createElement("path",{d:"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z"}),v.a.createElement("path",{d:"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z"}),v.a.createElement("path",{d:"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z"}),v.a.createElement("path",{d:"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z"}),v.a.createElement("path",{d:"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z"}),v.a.createElement("path",{d:"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z"}))}var C=n(2492),E=n(51),x=n(2498),S=n(1616),T=n.n(S),N=n(2484),A=n(2473),R=n(86),M=n(87),P=n(2479),F=n(2471),I=n(2549),B=n(2475),L=n(313),D=n.n(L),V=n(171),W=n.n(V),q=n(1609),z=n.n(q),H=n(2493),_=n(209),U=n(2467),G=n(82),J=n(160),Q=n(26),X=Object(E.a)({horizontalHandle:{cursor:"row-resize",width:"100%"},verticalHandle:{cursor:"col-resize",height:"100%"},flexbox_verticalHandle:{cursor:"col-resize",alignSelf:"stretch"},flexbox_horizontalHandle:{cursor:"row-resize",alignSelf:"stretch"}});var Y=function(e){var t,n=e.onDrag,a=e.vertical,r=void 0!==a&&a,o=e.flexbox,i=void 0!==o&&o,c=e.className,s=Object(J.a)(e,["onDrag","vertical","flexbox","className"]),l=Object(b.useState)(!1),u=Object(G.a)(l,2),d=u[0],f=u[1],p=Object(b.useRef)(0),m=X();return Object(b.useEffect)((function(){function e(e){e.preventDefault();var t=e[r?"clientX":"clientY"]-p.current;if(t){var a=n(t);p.current+=a}}function t(){f(!1)}return d?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0)}):function(){}}),[d,n,r]),t=i?r?m.flexbox_verticalHandle:m.flexbox_horizontalHandle:r?m.verticalHandle:m.horizontalHandle,v.a.createElement("div",Object.assign({"data-resizer":"true",onMouseDown:function(e){e.preventDefault();var t=e[r?"clientX":"clientY"];p.current=t,f(!0)},role:"presentation",className:Object(Q.a)(t,c)},s))},K=Object(E.a)((function(e){return{paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}}));function Z(e){var t=e.children,n=e.session,a=K();return v.a.createElement(U.a,{className:a.paper,elevation:16,square:!0},v.a.createElement(Y,{onDrag:n.resizeDrawer,className:a.resizeHandle,vertical:!0}),t)}Z.defaultProps={children:null};var $=Object(R.observer)(Z),ee=Object(E.a)((function(e){return{defaultDrawer:{},components:{display:"block"},drawerActions:{float:"right","&:hover":{backgroundColor:Object(_.fade)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},drawerToolbar:{paddingLeft:e.spacing(2)},spacer:{flexGrow:1},drawerSelect:{color:e.palette.secondary.contrastText},drawerLoading:{margin:e.spacing(2)},dropDownIcon:{color:e.palette.secondary.contrastText}}})),te=Object(R.observer)((function(e){var t=e.session,n=t.visibleWidget,a=t.activeWidgets,r=Object(M.getEnv)(t).pluginManager.getWidgetType(n.type).ReactComponent,o=ee();return v.a.createElement($,{session:t,open:Boolean(a.size)},v.a.createElement("div",{className:o.defaultDrawer},v.a.createElement(C.a,{position:"static",color:"secondary"},v.a.createElement(N.a,{disableGutters:!0,className:o.drawerToolbar},v.a.createElement(I.a,{value:n||"","data-testid":"widget-drawer-selects",className:o.drawerSelect,classes:{icon:o.dropDownIcon},renderValue:function(e){var n=Object(M.getEnv)(t).pluginManager.getWidgetType(e.type),a=n.HeadingComponent,r=n.heading;return v.a.createElement(P.a,{variant:"h6",color:"inherit"},a?v.a.createElement(a,{model:e}):r||void 0)},onChange:function(e,n){var a;a=n,t.showWidget(a.props.value)}},Array.from(a.values()).map((function(e,n){var a=Object(M.getEnv)(t).pluginManager.getWidgetType(e.type),r=a.HeadingComponent,i=a.heading;return v.a.createElement(B.a,{"data-testid":"widget-drawer-selects-item-".concat(e.type),key:"".concat(e.id,"-").concat(n),value:e},v.a.createElement(P.a,{variant:"h6",color:"inherit"},r?v.a.createElement(r,{model:e}):i||void 0),v.a.createElement(H.a,null,v.a.createElement(F.a,{className:o.drawerCloseButton,"data-testid":"".concat(e.type,"-drawer-delete"),color:"inherit","aria-label":"Delete",onClick:function(){t.hideWidget(e)}},v.a.createElement(D.a,null))))}))),v.a.createElement("div",{className:o.spacer}),v.a.createElement("div",{className:o.drawerCloseButton},v.a.createElement(F.a,{className:o.drawerCloseButton,"data-testid":"drawer-minimize",color:"inherit",onClick:function(){t.minimizeWidgetDrawer()}},v.a.createElement(z.a,null)),v.a.createElement(F.a,{"data-testid":"drawer-close",color:"inherit",onClick:function(){t.hideWidget(n)}},v.a.createElement(W.a,null))))),v.a.createElement(r,{model:n,session:t})))})),ne=n(2481),ae=n(1e3),re=n.n(ae),oe=n(314),ie=Object(E.a)((function(e){return{root:{display:"flex"},buttonRoot:{"&:hover":{backgroundColor:Object(_.fade)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}}));var ce=Object(R.observer)((function(e){var t=e.menuTitle,n=e.session,a=e.menuItems,r=Object(b.useState)(!1),o=Object(G.a)(r,2),i=o[0],c=o[1],s=Object(b.useRef)(null),l=ie();function u(){c(!1)}return v.a.createElement("div",{className:l.root},v.a.createElement(ne.a,{ref:s,onClick:function(){c(!i)},color:"inherit","data-testid":"dropDownMenuButton",classes:{root:l.buttonRoot}},t,v.a.createElement(re.a,null)),v.a.createElement(oe.a,{anchorEl:s.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:function(e,t){t(n),u()},open:i,onClose:u,menuItems:a}))})),se=n(2458),le=n(154),ue=Object(E.a)((function(e){return{input:{},inputBase:{},typography:{top:6,left:2,position:"absolute",whiteSpace:"nowrap",visibility:"hidden"},inputRoot:{padding:e.spacing(.5)},inputFocused:{borderStyle:"solid",borderRadius:e.shape.borderRadius,borderWidth:2}}})),de=v.a.forwardRef((function(e,t){var n=e.value,r=e.setValue,o=e.variant,i=Object(J.a)(e,["value","setValue","variant"]),c=Object(b.useState)(),s=Object(G.a)(c,2),l=s[0],u=s[1],d=Object(b.useState)(0),f=Object(G.a)(d,2),p=f[0],m=f[1],g=Object(b.useState)(null),h=Object(G.a)(g,2),y=h[0],w=h[1],O=Object(b.useState)(null),j=Object(G.a)(O,2),k=j[0],C=j[1],E=Object(b.useState)(!1),x=Object(G.a)(E,2),S=x[0],T=x[1];Object(b.useEffect)((function(){S&&(k&&k.blur(),T(!1))}),[S,k]);var N=ue(e),A=Object(le.a)(),R=y&&y.clientWidth;R&&R!==p&&m(R);return v.a.createElement("div",Object.assign({},i,{ref:t}),v.a.createElement("div",{style:{position:"relative"}},v.a.createElement(P.a,{ref:function(e){w(e)},component:"span",variant:o,className:N.typography},void 0===l?n:l)),v.a.createElement(se.a,{inputRef:function(e){C(e)},className:N.inputBase,inputProps:{style:Object(a.a)({width:p},o&&"inherit"!==o&&"srOnly"!==o?A.typography[o]:{})},classes:{input:N.input,root:N.inputRoot,focused:N.inputFocused},value:void 0===l?n:l,onChange:function(e){u(e.target.value)},onKeyDown:function(e){"Enter"===e.key?k&&k.blur():"Escape"===e.key&&(u(void 0),T(!0))},onBlur:function(){l&&l!==n&&r(l),u(void 0)}}))})),fe=n(2496),pe=n(2539);var me=Object(R.observer)((function(e){var t=e.session,n=Object(b.useState)(!1),a=Object(G.a)(n,2),r=a[0],o=a[1],i=Object(b.useState)(),c=Object(G.a)(i,2),s=c[0],l=c[1],u=t.popSnackbarMessage,d=t.snackbarMessages,f=d.length?d[d.length-1]:null;Object(b.useEffect)((function(){var e;return s?f?s[0]!==f[0]&&(o(!1),e=setTimeout((function(){l(f),o(!0)}),100)):l(void 0):f&&(l(f),o(!0)),function(){clearTimeout(e)}}),[f,s]);var p=function(e,t){"clickaway"!==t&&(u(),o(!1))},m=s||[],g=Object(G.a)(m,2),h=g[0],y=g[1];return v.a.createElement(fe.a,{open:r&&!!h,onClose:p,action:v.a.createElement(F.a,{"aria-label":"close",color:"inherit",onClick:p},v.a.createElement(W.a,null))},v.a.createElement(pe.a,{onClose:p,severity:y||"warning"},h))})),ge=n(2448),he=n(1615),be=n.n(he),ve=Object(E.a)((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:Object(_.fade)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},listItemIconRoot:{minWidth:28},listItemInset:{paddingLeft:28},menuItemDense:{paddingLeft:e.spacing(1),paddingRight:26,paddingTop:0,paddingBottom:0},secondaryActionRoot:{right:e.spacing(1)},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),ye=Object(R.observer)((function(e){var t=e.model,n=e.IconButtonProps,a=e.IconProps,r=Object(b.useState)(),o=Object(G.a)(r,2),i=o[0],c=o[1];return t.menuItems&&t.menuItems.length?v.a.createElement(v.a.Fragment,null,v.a.createElement(F.a,Object.assign({},n,{"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},"data-testid":"view_menu_icon"}),v.a.createElement(be.a,a)),v.a.createElement(oe.a,{anchorEl:i,open:Boolean(i),onMenuItemClick:function(e,t){t(),c(void 0)},onClose:function(){c(void 0)},menuItems:t.menuItems})):null})),we=Object(ge.a)("bounds")(Object(R.observer)((function(e){var t=e.view,n=e.onClose,r=e.style,o=e.children,i=e.contentRect,c=e.measureRef,s=ve(),l=Object(le.a)().spacing(1),u=0;i.bounds&&(u=i.bounds.width),Object(b.useEffect)((function(){u&&Object(M.isAlive)(t)&&t.setWidth(u-2*l)}),[l,t,u]);var d=Object(b.useRef)(null);return Object(b.useEffect)((function(){d&&d.current&&d.current.scrollIntoView&&d.current.scrollIntoView({block:"center"})}),[]),v.a.createElement(U.a,{elevation:12,ref:c,className:s.viewContainer,style:Object(a.a)(Object(a.a)({},r),{},{padding:"0px ".concat(l,"px ").concat(l,"px")})},v.a.createElement("div",{ref:d,style:{display:"flex"}},v.a.createElement(ye,{model:t,IconButtonProps:{classes:{root:s.iconRoot},edge:"start"},IconProps:{className:s.icon}}),v.a.createElement("div",{className:s.grow}),v.a.createElement(A.a,{title:"Rename view",arrow:!0},v.a.createElement(de,{value:t.displayName||(t.assemblyNames?t.assemblyNames.join(","):"Untitled view"),setValue:function(e){t.setDisplayName(e)},variant:"body2",classes:{input:s.input,inputBase:s.inputBase,inputRoot:s.inputRoot,inputFocused:s.inputFocused}})),v.a.createElement("div",{className:s.grow}),v.a.createElement(F.a,{"data-testid":"close_view",classes:{root:s.iconRoot},edge:"end",onClick:n},v.a.createElement(W.a,{className:s.icon}))),v.a.createElement(U.a,null,o))}))),Oe=Object(E.a)((function(e){return{"@global":{html:{"font-family":"Roboto"},"*":{"scrollbar-width":"auto","scrollbar-color":"rgba(0,0,0,.5) rgba(128,128,128)"},"*::-webkit-scrollbar":{"-webkit-appearance":"none",width:"12px"},"*::-webkit-scrollbar-thumb":{"background-color":"rgba(0,0,0,.5)","-webkit-box-shadow":"0 0 1px rgba(255,255,255,.5)"}},root:{display:"grid",height:"100vh",width:"100%"},fab:{float:"right",position:"sticky",marginTop:e.spacing(2),bottom:e.spacing(2),right:e.spacing(2)},menuBarAndComponents:{gridColumn:"main",display:"grid",gridTemplateRows:"[menubar] min-content [components] auto",height:"100vh"},menuBar:{gridRow:"menubar"},components:{overflowY:"auto",gridRow:"components"},appBar:{flexGrow:1},grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light}}}));var je=Object(R.observer)((function(e){var t=e.session,n=e.HeaderButtons,a=Oe(),r=Object(M.getEnv)(t).pluginManager,o=t.visibleWidget,i=t.drawerWidth,c=t.minimized,s=t.activeWidgets;return v.a.createElement("div",{className:a.root,style:{gridTemplateColumns:"[main] 1fr".concat(o&&!c?" [drawer] ".concat(i,"px"):"")}},v.a.createElement("div",{className:a.menuBarAndComponents},v.a.createElement("div",{className:a.menuBar},v.a.createElement(C.a,{className:a.appBar,position:"static"},v.a.createElement(N.a,null,t.menus.map((function(e){return v.a.createElement(ce,{key:e.label,menuTitle:e.label,menuItems:e.menuItems,session:t})})),v.a.createElement("div",{className:a.grow}),v.a.createElement(A.a,{title:"Rename Session",arrow:!0},v.a.createElement(de,{value:t.name,setValue:function(e){t.savedSessionNames&&t.savedSessionNames.includes(e)?t.notify('Cannot rename session to "'.concat(e,'", a saved session with that name already exists'),"warning"):t.renameCurrentSession(e)},variant:"body1",classes:{inputBase:a.inputBase,inputRoot:a.inputRoot,inputFocused:a.inputFocused}})),n,v.a.createElement("div",{className:a.grow}),v.a.createElement("div",{style:{width:150,maxHeight:48}},v.a.createElement(O,{variant:"white"}))))),v.a.createElement("div",{className:a.components},t.views.map((function(e){var n=r.getViewType(e.type);if(!n)throw new Error("unknown view type ".concat(e.type));var a=n.ReactComponent;return v.a.createElement(we,{key:"view-".concat(e.id),view:e,onClose:function(){return t.removeView(e)}},v.a.createElement(a,{model:e,session:t,getTrackType:r.getTrackType}))})),v.a.createElement("div",{style:{height:300}}))),s.size>0&&c?v.a.createElement("div",{className:a.fab},v.a.createElement(x.a,{color:"primary",size:"small","aria-label":"show","data-testid":"drawer-maximize",style:{float:"right"},onClick:function(){t.showWidgetDrawer()}},v.a.createElement(T.a,null))):null,o&&!c?v.a.createElement(te,{session:t}):null,v.a.createElement(me,{session:t}))})),ke=n(694),Ce=n(102),Ee=n(432);function xe(e){var t=e.width,n=e.height,r=e.highResolutionScaling,o=e.style,i=e.imageData,c=e.showSoftClip,s=Object(b.useRef)(null);Object(b.useEffect)((function(){if(i){var e=s.current;if(e){var t=e.getContext("2d");if(t)if(i.commands)i.commands.forEach((function(e){"strokeStyle"===e.type?t.strokeStyle=e.style:"fillStyle"===e.type?t.fillStyle=e.style:"font"===e.type?t.font=e.style:t[e.type].apply(t,Object(Ce.a)(e.args))}));else if(i instanceof Ee.a)t.drawImage(i,0,0);else if(i.dataURL){var n=new Image;n.onload=function(){return t.drawImage(n,0,0)},n.src=i.dataURL}}}}),[i]);var l=c?"_softclipped":"";return v.a.createElement("canvas",{"data-testid":"prerendered_canvas".concat(l),ref:s,width:t*r,height:n*r,style:Object(a.a)({width:t,height:n},o)})}xe.defaultProps={imageData:void 0,highResolutionScaling:1,style:{}};var Se=xe,Te=n(91),Ne=n.n(Te),Ae=n(93),Re=n(63),Me=n(2501),Pe=n(2505),Fe=n(2511),Ie=n(2509),Be=n(2510),Le=n(2508),De=n(2499),Ve=n(533),We=n.n(Ve),qe=n(433),ze=n.n(qe),He=n(2457),_e=n(2482),Ue=n(2494),Ge=n(1604),Je=n(85),Qe=n(1002),Xe=n(2502),Ye=n(2504),Ke=n(2503),Ze=n(695),$e=n.n(Ze),et=n(1622),tt=n.n(et),nt=Object(E.a)({card:{width:250,cursor:"pointer"},cardHeader:{width:200},media:{height:0,paddingTop:"56.25%"}});function at(e){var t=e.sessionName,n=e.sessionStats,a=e.sessionScreenshot,r=e.onClick,o=e.onDelete,i=e.onRename,c=nt(),s=Object(b.useState)(!1),l=Object(G.a)(s,2),u=l[0],d=l[1],f=Object(b.useState)(null),p=Object(G.a)(f,2),m=p[0],g=p[1];var h=function(e){return g(null),"delete"===e?o(t):"rename"===e?i(t):void 0};return v.a.createElement(v.a.Fragment,null,v.a.createElement(Xe.a,{className:c.card,onMouseOver:function(){return d(!0)},onMouseOut:function(){return d(!1)},onClick:function(){return r(t)},raised:Boolean(u)},v.a.createElement(Ke.a,{className:c.media,image:a}),v.a.createElement(Ye.a,{action:v.a.createElement(F.a,{onClick:function(e){e.stopPropagation(),g(e.currentTarget)}},v.a.createElement($e.a,{color:"secondary"})),disableTypography:!0,title:v.a.createElement(A.a,{title:t,enterDelay:300},v.a.createElement(P.a,{variant:"body2",noWrap:!0,style:{width:178}},t)),subheader:v.a.createElement(P.a,{variant:"body2",color:"textSecondary",noWrap:!0,style:{width:178}},"Last modified"," ",new Date(n.mtimeMs).toLocaleDateString(void 0,{dateStyle:"medium"}))})),v.a.createElement(Ge.a,{id:"simple-menu",anchorEl:m,keepMounted:!0,open:Boolean(m),onClose:h},v.a.createElement(B.a,{onClick:function(){return h("rename")}},v.a.createElement(_e.a,null,v.a.createElement(tt.a,{color:"secondary"})),v.a.createElement(P.a,{variant:"inherit"},"Rename")),v.a.createElement(B.a,{onClick:function(){return h("delete")}},v.a.createElement(_e.a,null,v.a.createElement(D.a,{color:"secondary"})),v.a.createElement(P.a,{variant:"inherit"},"Delete"))))}at.defaultProps={sessionScreenshot:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcgAAAEeCAIAAACBpBKPAAAAA3NCSVQICAjb4U/gAAAAGXRFWHRTb2Z0d2FyZQBnbm9tZS1zY3JlZW5zaG907wO/PgAAIABJREFUeJzt3XlAVOXeB/DnOWeGYQfZxQUUNBX31EQ2BQS03FPcwATvzW5W1q2sq15vi7b4ZlZeb2mobKIIppimoIKKuGtuaFpm4o6oiKwzc877By4IAwzMM5xh+H7+KjznOT/g+PWZ3znPOVQURQIAAOxwUhcAAGBsEKwAAIwhWAEAGEOwAgAwhmAFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACMIVgBABhDsAIAMIZgBQBgDMEKAMAYghUAgDEEKwAAYwhWAADGEKwAAIzJpC4AdHL//v3ffvstLy/v/v37giBIXQ5Up1AobG1tPTw8OnXqpFAopC4HmgiCtVk6evTo2rVr09PTc3NzRVGUuhyon0KhGDhw4PDhwydPnty2bVupywH9ovhr2YwIgpCSkrJo0aKTJ09KXQs0Esdxo0ePnjt3bt++faWuBfQFwdpsnDhxYubMmYcPH5a6EGCAUjp9+vQvv/zS3t5e6lqAPQRrMyCK4tKlS+fMmaNUKqWuBVhq06ZNUlKSn5+f1IUAYwhWQ6dWq2fMmLFmzRqpCwG9kMvlMTExERERUhcCLCFYDZparZ44cWJKSorUhYAeUUr/97//vfrqq1IXAswgWA3arFmz/vvf/0pdBegdz/M//fTTiBEjpC4E2ECwGq6EhAR8Qmw5bG1tjx8/3qFDB6kLAQYQrAbq2rVr3bp1e/DggdSFQNMJCAjIzMyklEpdCOgKS1oN1HvvvYdUbWn27NmTlJQkdRXAAGashujs2bM9e/bEEtUWqFOnTufOneN5XupCQCeYsRqiJUuWIFVbposXL27atEnqKkBXCFaDU1xcvGHDBqmrAMnExsZKXQLoCsFqcNLT04uKiqSuAiSzY8eO4uJiqasAnSBYDU5mZqbUJYCUKioq9u7dK3UVoBMEq8E5fvy41CWAxHAONHcIVoNz7tw5qUsAiZ0/f17qEkAnCFbDIori3bt3pa4CJJafny91CaATBKthwaIAIITg4lVzh2AFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACMIVgBABhDsAIAMIZgBQBgDMEKAMAYghUAgDEEKwAAYwhWAADGEKwAAIwhWAEAGEOwAgAwhmAFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACMIVgBABhDsAIAMIZgBQBgDMEKAMAYghUAgDEEKwAAYwhWAADGEKwAAIwhWAEAGEOwAgAwhmAFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACMIVgBABhDsAIAMIZgBQBgDMEKAMAYghUAgDEEKxin1q1bx8bGchzOcJAATjswQnK5PDk5OTIy8sMPP5S6FmiJEKxghL744gtfX19CyEcffRQQECB1OdDiIFjB2IwfP/7tt9+u/G+e59euXevk5CRtSdDSIFjBqHTp0iUmJqbqV1xdXePj49FshaaEsw2Mh6Wl5caNG62srKp9PSQkBM1WaEoIVjAeMTExXbt21fhHaLZCU0KwgpGYPXv2hAkTavtTNFuhKSFYwRj4+vp+8cUXdW+DZis0GZxk0Ow5OzuvX7/exMSk3i3RbIWmgWCF5o3n+fXr17u6umq5PZqt0AQQrNC8ffbZZw0KSjRboQkgWKEZGzdu3LvvvtvQvdBsBX3DuQXNVefOnWNiYiiljdgXzVbQKwQrNICfn5+ZmZnUVRBCiLm5+caNG21sbBo9ApqtoD8IVtBW586dt2zZsnLlysZNEtlasWKFl5eXLiOg2Qr6g2AFrZibm6ekpNjY2EyZMuWDDz6QtphZs2ZNmTJF93HQbAU9wSkFWlmxYkWPHj0q/3vhwoWjRo2SqhJvb++vvvqK1WhotoI+IFihftVmiJTStWvXPsnZpuTo6JicnKzNWgDtodkKzCFYoR6DBg2qOUM0NzffunWro6NjU1bC83xSUlLbtm2ZD4tmK7CFYIW6ODk51bZatF27dps3b2Y7eazbJ598EhQUpI+R0WwFtnAmQa3qnSF6e3uvXLmyaYoZOXKkXi+aodkKDCFYoVYLFy4MDAyse5vIyMj3339f35V4eHjExcXp+zYvNFuBFQQraDZmzBgtE3PRokUjR47UXyXm5uapqam6rAXQEpqtwAqCFTTo3Lnz6tWrtZwh8jwfFxenv5sEli9f3qtXLz0NXg2arcAETiCo7slaAO13sbGx2bRpkz5uEpg5c+a0adOYD1uHkJAQyVdAQHOHYIXqqq4F0F7Hjh1TUlLY3iTQr1+/b775huGAWvr444/9/f2b/rhgNBCs8AxdVov6+/svX76cVSUODg6pqalNeTvXE5W3Q6DZCo2GYIWnNK4FaJDo6Oi3335b90p4nk9ISGjfvr3uQzWOq6trXFwcmq3QODhv4JE61gI0yOLFi4cNG6bjIAsWLAgNDdVxEB2Fhoai2QqNg2AFQpiuFq0cqlu3bo0eYfjw4fPmzdO9Et2h2QqNg2AFQrRbC6A9GxubzZs3Ozg4NGLfDh06JCQkGMIjXwmardBYCFZowFoA7Xl6ejaisWBmZpaamtqqVSu2xegCzVZoBJwuLV2D1gI0SGBgYENvllq2bFmfPn2YV6IjNFuhoRCsLZq+V4vOnDlz1qxZWm4cHR0dFRWlp0p0hGYrNAiCtUVbsWJF9+7d9XqIpUuXBgcH17tZ3759ly1bptdKdIFmKzQIgrXlYvXmqLrxPJ+SktKpU6c6trGzs0tNTTU1NdV3MbpAsxW0h7OkhdJ9LYD2bGxstm3bVlvDgeO4hIQEd3f3pilGF2i2gpYQrC0Rq7UA2vP09ExNTeV5vuYfzZ8/X/cFBU0GzVbQBoK1xeF5ft26dczfHFWvoKCgmjcJhIaGzp8/v4kr0QWaraANBGuLs3DhwiFDhkhy6Ndff/2111578r9ubm6JiYkap7GGDM1WqBdOjpZFH2sBGmTp0qWVS7wUCkVKSoq9vb2ExTQamq1QNwRrC6K/tQDaMzExSU5O9vT0/Pbbb/v16ydhJTpCsxXqIJO6AGgiTfbmqHrZ29vn5OTo43UDTamy2dqnT5/bt29LXQsYHMxYW4omWAugveaeqpXQbIXa4JxoEZpmLUALhGYraIRgNX5NuRagBUKzFWpCsBq5pl8L0NLgzlaoCcFqzKRaC9DSoNkK1eBUMGYSrgVoadBshaoQrEZL8rUALQ2arfAEgtU4GcJagJYGzVZ4AsFqhAxnLUBLg2YrVMIZYIRWrlxpOGsBWho0W4EgWI3PrFmzJk+eLHUVLRqarYBgNSpYC2AI0GwFBKvxwFoAw4FmawuHp1sZj/Hjxx84cEDqKuCpQYMGZWdnS10FSICKoih1DfBUYWGhra2t1FWAxHx9ffft2yd1FdB4+KgCAMAYghUAgDEEKwAAYwhWAADGEKwAAIwhWAEAGEOwAgAwhmAFAGAMwQoAwBiC1bBYW1tLXQJIz8LCQuoSQCcIVsNCKbWzs5O6CpCYg4OD1CWAThCsBqdLly5SlwAS69q1q9QlgE4QrAanT58+UpcAEuvbt6/UJYBOEKwGJygoSOoSQEpyudzPz0/qKkAnCFaDExISYmlpKXUVIJnQ0FCcAM0dgtXgWFhYvPzyy1JXAZKJjIyUugTQFR50bYhOnz7dq1cv/GpaIA8Pj/Pnz8tkeLVH84YZqyHq0aPHhAkTpK4CJLBgwQKkqhHAjNVAXbt2rUuXLg8fPpS6EGg6fn5+e/bsoZRKXQjoCjNWA9WmTZtly5ZJXQU0HRsbm9WrVyNVjQOC1XBNmzbttddek7oKaAo8z8fFxXl4eEhdCLCBYDVo33333ejRo6WuAvSLUvrdd9+NHDlS6kKAGQSrQeN5Pjk5OSIiQupCQF9kMtmPP/6IjyZGBsFq6ORyeWxs7Oeff46LxcbHxcUlPT09KipK6kKAMQRrM0ApnTNnTk5OzvPPPy91LcAGpTQyMvLkyZNDhgyRuhZgD8HabPTv3//w4cOJiYleXl5S1wKNRykdOXLkoUOHYmNjnZycpC4H9AL3sTY/oigePHgwMTExIyPjwoULUpcDWpHJZAMGDBg+fPjUqVPd3NykLgf0C8HavN25cyc3NzcvL6+oqKiwsFDqcuAZPM9bW1vb2dl17Njxueeew3sBWg4EKwAAY+ixAgAwhmAFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIJVOsKlJb4KWhPH8SbmrVyfe+HFqH+vybleod1ej3a0sGvXzWfUzIVJx/JVWh9Rw1DWUzaVE7Fg3Xg7nlK+ddTWel8X+3BrVGueUq7VmIT8R8+fUB2f311OKTUbt6640TXcWBlqzlEq8/xnjlLjgSuy3nCTUcop/L+5LGjaQLwTN9KSo1Tm9kZWhaYNatTGWfkvOV/z5/dI+ZZIW45ydtN+Lte8geru6bTv5kx70btbewcrU7nMxNzGyb2n76gZ83/YceFB9RrF/Jhhplr9RCilVNb5/YOafw5gQBCshkcUBWXp/RsXDm9b/UmUn9egN9OuqrXeseTe1XM5aT/Mm/KC15C5u/J1e8IOtR8RPa41R4Tbm9b8fLfOscS7W2M33xYI5zw6epQjwzeNUufgsOfllKiv7N55XtPPQXVm5+7rakJE5bGMrAJNRRZnZ+wvFQlnHxg2wESrg4oP93/69irNMV3PnncPL4vo69F79Jtfxm07eC6v4GG5Sq0sfZD/1+n9aTGfzhzm1XHAjJXH7+PRR8YNb/uQnsngJb8mR1QJI6HiYcHVcwe3xX69dMPp+8eWTZnY7mDWe16yuvcihKjLi/L/Op298fvFy7dfys/+fEKk29Gtf+9Q419PE79F+2MnOdQRf5SzdFQQQiwCoyd7rll84f722I03wme41raLePOn2F/uCYT3mBQ91Eqr71rrGtqHhHrJsk+ocnfuzpvXw73ad6P+c9euiypKKSGlORnZxa+Msaw2TvnhjKxCgVCbgGG+5tqURnmeE+6lz39v3Yj1k1s3YO4h3Nz6Zkj48tPFIuXteoycHjUhxLt7R2crmfLBzUunc7avj1n987mCYzGvDj6Wu2HHklAnSggh1D489regkmeitnTLa33e3F4u6zp7y5a3uvBVi5PbuMi1LwkkIoJU1H985WNCCFGE/HBT0LSBUJj9fk8FJYRz/Xt6ibZ7iaKovpUW3VFGCeE7vXugogFH1EB1duHzckqownfJ7+pav5VLS/1NKaHy3h+dUj39svLYPC8ZIcR0bNJDHWpQHprznIwQaj581a3quwjXvx9qSqlNQPAAE8K1mbmzrMbeRz7sWrl3TI29q38blbUpBr8S4SGjhG/3yuY7GnYpS4uwoYS2itzyzMGUv30XZMsRQnmnIR9l3lRqOEDF1e0fDLLjCCGc/bAVf6g0bFLpYdJYU0KIrNd/TmoaBwwdWgEGjFp7v/nqIDkhwu2D+y/U2vKriXMa/k50Lxkh6r8OHrjaiA+0VfBdpkb7m1Gx/FBc4tlaWhLqc2vjDpSL1NQnKtKL17yNDmS9w4Jb80QsPZC+r3qrt3BPxqFyYtJ3zKu+7XnhVubOU9V+TupLu3f/riLUpH9YcF3z46pMBs5ZPLkNr76a8M//ZD7Qbh/xVvK/Psq8L1CF1+wNm+YPdtb0YVDeJnRR2tq/d5JRoWDH/H9vrru9As0XgtWgcQ5t25hSQsTC+w8a9HeQd23bmieEiEVFD3X8y8u1Gx89zJYS5ZnE+CMar/0ojycknFKK1DokKtxNH2eUyYBhQfYcEQv3Zhwse+ZPSnPS9z0UeQ9vn2Cf/lZUdWnXrt+fSX/xdtaukypCZD3DhrbRsjaxvMJ6xGefjXKkqj9WzP7sUKkW+wiXk77fWiAQznXK5//2t649wal9yKeLxjtyRLj90/cbrun2rx4YKgSrQRMLrt0oFwnh7B3sGvSrUl25dEVFCOWcXBx1/R1ThxHRY1tzRPVHUuzekpp/XpYdm3RRVXnZyonhZasqzH2HBVhRItzanfFr1UviymMZWQUC5+AT0N16oH8/BVWd3pl5s2pYPdibcahcJLJOISGeWs+llcoKznXS4o+CbGnFmW/f/PpUnfcSEEKImL9r+5FykfDtxkUGW9e9LbV/cfpoF46IpTnbMu9hzmqUEKyGrOT4ilX7Kwjh2/oFdGrAR2zh1pav1pxVEWrSOziAwSV6y6CoSR48UV9PXbOjxnu1ijJiU/LUhHcPjw6pJ1Iaz3pwmI8ZJerLu3ZdeDojVeXu3J2nppY+gQNMOeeAwO4ysfxwxp7Cp2FVemBndpFI+LZDQ7trf6FWFAkhfMcZX3840IKUHPn8re8v1nNfhir317NKkVCz/j7PK+od36y/X39TSsSyM7/+1oAODzQfCFYDJKpK7/51YtvyWSHDPz1WJnKtgt5/00eb+4REZfHti9nrPhrvHxH/l5rK3CPmR3fWEMjl6a+6cHXcKynvPv/4M3/hTV6YHtlLToU7W2LTbj8zxxILfo5Nuy0QmVfEdO/6I6WxNVCH4LD+JpSozmbsfvLxWcjL3HVeTRX9g/2sCeE9hwxx58Xi7IycJ5/dlb/uzMoXCOcYHNZPuxutqpJ7vbn07Z4KUrT343dir9T5ob3i1o07AiGcs1tbbX4IFu3dHDlChFvXb2p3Jx00MwhW6dWIGE5ubu/e98XX/7v/tsA5DHp/fdzfO9b4RWkKJs7E0rmz36T/bLxQTMw9X162+ZsX7dl8Nue7RkT5mlGxKH1NSl6ViBFubIzdfl+kpoOipvXQ5717XJuhYT1lRKw4mpH16JKPWJCVcVwpyroHBbhwhBB578AAR064m5Vx7FG7QH1hd+ZfakJthoT5mDXmqKb953wzs5NMLNg2b07qrTo+tVeUV4giIVRhaqrND5yamplSQkR1WRlu9jdKCFbDRHlzl67+E+es2HMy67Ohzg35NfHOAyP+9b8dp39NfrVHLbdtmgQsPnX9Ru2u7pnTs1pKcu3Do0NtqFiWHZf09HOx8Of6uKwSkVqFRE+sfoNpPRpaA+8ZEtJJRsTS/enZlcu4irN3HigVebfBQx51T00HBvlYUvXV3TtzVYQQIlzP2nVWRaiFX1hA9ZtbtWXp/+8lke144caG9+b9UntD1NTCnKeEiCUPi7VpmoolxSUiIVRubt7wiTQ0AwhW6ZkMWXrh7r2n7t9/UFyuLL6Ruyfp8xk+rrXcDa4I/PaPB0VV5Wf+s5ucEqFE3ntq9NCOdbzDniqsnVzq4GxvWWP2SR1GRo9x4cSKY/HxJx99Rlfnro0/VCFyTqOjRzs3cGrc4Bpk3UOHtuWJcH9P+qFyQkjF4Z17H4ic4+Cg3o9/RDb+wQMUVPXbrt1XBELEwr07j1SIVPFCWJBdoyfu1G74wi/GOXPqK7HvfFzjbq8nxbVp78oRIty6dFmLuzDEoit/3REI4du6tWV/dxoYAASr9KjczNq2ChsbK3N5/UEgU1hYPsMhYN6SKHdeLMr++I0ffmffu7MKjp7UkSeq82vjcsoJIaTiaHziaaXIu4VH6e+y1VMm/cKCHTki3NyTeVZFVGcy99xUU0vf4IGmj7egzgGB3WVE+WvW/nsiKTuwK6dEJLLeocEuupzn1GXCl5+EtqLKC/9768ujZYQQQqv/euRdn+9lQYlYfjgzR8ONE9WUHd53tFwk1Kp3v+ew9tEoIViNCLUN+fiL8S6cWJi54M1GrXSvm2Lg9Miecqr+Kzk+q4SQ8pyE9b+riKxbxHQf0/r31p2ZT9gQG0pUv+/Lvqa6lr33oooqBgT72TzdgvccMtiNF0sP7TlSrjyZua9AILKuoSEddJwWcm7Tl8zzsSTlJ5e89e1ZJZXLZdWT1WbIS/6WlAj5m2N+qqsZSwgR726LS7slEM42aGSjWxRg2BCsRoU6jfv8k7BWnHB3x9zZ8Xmso5XvFhnlY0qFW1tT9pWU5aSmXVVTU++oadUbsvpiGRDmZ0GJ8sS+AzcP7f9VSWQ9ggY/04OQ9w4a7MgJBQf2nfrzwMErasK7Dw3tpnt5si6vf/NuX1NSfGDR2z9eMjE3rx6s1HnsP8Lb8kS4lzZ/Tlod0Sre271gbkq+QGUdImaNZHRtEQwNgtXIcG6vfDXPx5IK+Vs++GfyDcbRyrUPjw61psKtbak7MzduuaamVsFRE2s+5UVPqF1Q2AsKKpYc3Re/90ixKOsYGOjx7Gz00QWsPw7s/jn7pJJwLsFhfZg8s0TR592lr3eRk8JdC97bXGhWMxCtQxcsGuXMierL8ZEvvZ12WdMjBVU3di0YPXH5b0oiaz/1q3n+Wj0TBpohdHiMjqzLP75+J8HnkxM3N777/qbAuLE1V0OJpQV5ly+X1jlboia2rV1tq1+zpo6josc4p625uWnu+7Kras5x1IwxLo2adTWqBs4lOLS3bNfBvLQfNt9Qc06Dg3pVP4Ot/YL7KzZmHvl+mVmJyLUKDBvIqk1h4TPv6+kbX1zx59bv18s1tLC5tlNWrjubN/rLI4VHvx3T85ewV/42+UW/Xh4uNnLVg1uXTh/YkRyzKu3MPTXhHAd/uuE7pk9XBAMj9VNgWrDGPGtKy72KsmZ3llFCeLeoLVWez/R4X23Ius8/ofHBSmX7Zj+eJfLub2SW1lFrXU+3amQNyl///fh+WWobvqGw5kFVuYv6PZqjUqsxiQXa/2gf12bi/X+1PMhLuLXhyXMEazzdqnKLwhM/znjejq8tM6mJa8A7G34r0TB4VXi6VTOHVoBRsvSf/39T2/JEfSXurXkZbJ+qrPCOiuwhp4QQWdeI6b5NctnqKVm3sBB3nhBCqOkLwX4aHv1aeQGrcgvvYUNasZwWUqexny980b6OvzXUunf0ysN/nt26/F9RLw3yam9vaSrjZaZWju49/Ue/+tGq3b9dzPrq5c6NWq4AzQcVRTwFAgCAJcxYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACMIVgBABhDsAIAMIZgBQBgDMFqfMqz3/GUUUopZzs6Pr/qoyDEgnXj7XhK+dZRW2t7e9MTD7dGteYp5VqNSXhmkDrGr051fH53OaXUbNy64sdfEy4t8VVQSk1DV9TzpH3NtDv646M8+xJbjpebWTu59/AdOWPBqr15ZbXtpVVtGg+hEWc9ZZOmp7OC8UKwGp2inavW/SlYuLq2og/SVydfqfKsa2o/Inpca44Itzet+flundEh3t0au/m2QDjn0dHPPji0jvGbgC5HF0VBVVaU/9eZ/VtiPo4e7PXCPzZfa9rqoaVAsBoZMX/zjz/dFK2GLvhspAMty16deL7qM5ktAqMne8qIcH977MYbdSSrePOn2F/uCYTvMCl6aNVn89Uzvp41+Ogmg5fk3s5/7PbNq5fO5GxZ8cFLnmZULDr1Q9Q/4q/rGq0mfouOXPqzTme+CVHoeBRoXhCsxkW4sj5mRyGxChw3dmz4CCeqPBkXe1RZZQOT/q9M6yWnYnFm7PpLtWaKcDk5LrNYpPIekdO9q2ZCvePrVcOPTk0s7ByecHRu08HL+6W/fbY5c9mLrTgi3MtI3lGg43MzqZl9O/c6ubV3wDtYWhgEq1FR58at2l9GbEMmDre3HBw+qjWn+n3t6qyqL2Tmu0yN9jejYvmhuMSztUz31OfWxh0oF6mpT1SkV9V3Smkxvh6xOzrXZvhL/eSEiKqb1/PRDQDmEKzGpPzg6rhTSuo4ImK4HSVm/lPHu/Pq66mrf6n6DgGu3fjoYbaUKM8kxh+p0DSM8nhCwimlSK1DosLdqp4hWo2vNyyPLlZUVIiEUM7Bqa73AQA0Dk4qI1K0MybpkppvMzaisi2qGBgxqYtMKPh59TOvuqcOI6LHtuaI6o+k2L0apntl2bFJF1WVl62cnr1spdX4esLy6MrfN6YeVRJq7v1SMF7pB+whWI1G5YUdge8YHun/6JVKsl5Tp/QxIQ93rVr3Z9UPvJZBUZM8eKK+nrpmR2H1cYoyYlPy1IR3D48OsW7c+HrQ2KMLgqqKipJ7V89kxs0dHfrB3hLqGLTw27812bu7oSXBWWUshCvrV+0oFGXdJk3t/+QtqHznSRHeClJ2cE38GVWVjU1emB7ZS06FO1ti024/M90TC36OTbstEJlXRI3LVtqPz1xjj16+87W2JvInFBZ27XoETvssSxwYvXj7kZ/f6qH7uxDL01914eq4i1Xeff5xvf5swAAhWI2EOjduVXYZMXl+6pTusqdf5tzGRwZaUNWZ+DWHqt6jzneNiPI1o2JR+pqUvCrTPeHGxtjt90VqOihqWo8q4zR0fMYYH10svXJg48rPP/3vzjyNTWYAHSFYjUPlhR1i6hs50bPqZXxCnUdHDrPl1H+uW7Wr6mIrrn14dKgNFcuy45IuPrk5QPhzfVxWiUitQqInute8bNWA8Zlq/NEVIT/cFKq87l1dUVxw5XRm4qcT2t/O+vHdYS+MWZ6r4z8IJgGLT12/Ubure+b0lNU/DBgXEYzAg5+nt67n30iu1ctJdwQNO8m85h5TVn5FdfrjPnJKOOfIzYW6jy+KymPzvGSEENOxSQ8ff039x1c+JqRm5LH97uo/StHBuX1NKaHm/l9fVDWmtkZ8I9BiYMZqBMT8tJifbtZz9Ui4/8vqlGeWGVkFR0/qyBPV+bVxOeWEEFJxND7xtFLk3cKjql22atT4jOjp6JYDXv+brwkRSw6mbGniZblg/BCszZ9wJTnSB71aAAACqklEQVRme6HIOUduvFOqUeGuNzrwYknWmsTfqy4JUAycHtlTTtV/JcdnlRBSnpOw/ncVkXWLmO5jymJ8ab+7+lA7VxcFJUR9Pe9aE67KhRYBwdrsqXPjY7LLRK71qCmh9qYaWftNfrkjL1YcjYv7teoKUL5bZJSPKRVubU3ZV1KWk5p2VU1NvaOm9ZSxGV/a764ews3LV8pEQqiVtRVuZQW2EKzNXfnB1bGnlCLfbswk/1pXpMv7hY9/TkZU5xPX7K/6sDyufXh0qDUVbm1L3Zm5ccs1NbUKjprYodplq8aPrzO9HV0szP5mxQElIbyLj99zuLgEbOGMauYe7lqVdElNeM+XJw2q455MWa/wCV5f/ufkleTVOxYOHvWkg0odR0WPcU5bc3PT3PdlV9Wc46gZY1yqzt90HL92YmlB3uXLpRrnitTUro2LtYzB0cWK4rt37vBPjyJUPCy4eu7gtjVLvk45qxQ528FzZg+uPrRWtWmz8ZOdTGxbu9qa1LUJGBepr56BLoT8xLG2lBBZ1w+PKOveVJW7qJ+cEmozKu7WMxexy/bN9nh0DxPv/kZmKcPx67oroC7ygYsvqnQ6ujZHoTKXIQt239ZwL4EWtWm38WOy7vNP1PMdgFFBK6A5E66sj9leKBJZtwnhvev58MF3Hh/eT07FB+mrNzxzFVzhHRXZQ04JIbKuEdN9n71sxWD8RtPH0SnlTSwd3XsOHv/m4tQTuTv/MwSPCgA9oKLYFA8mAgBoOTBjBQBgDMEKAMAYghUAgDEEKwAAYwhWAADGEKwAAIwhWAEAGEOwAgAwhmAFAGAMwQoAwBiCFQCAMQQrAABjCFYAAMYQrAAAjCFYAQAYQ7ACADCGYAUAYAzBCgDAGIIVAIAxBCsAAGMIVgAAxhCsAACM/T+JhEytAWSKNgAAAABJRU5ErkJggg=="};var rt=at,ot=function(e){var t=e.onClose,n=e.open,a=e.onFactoryReset;function r(e){"reset"===e&&a(),t()}return v.a.createElement(Pe.a,{open:n,onClose:function(){return r()}},v.a.createElement(Le.a,{id:"alert-dialog-title"},"Reset"),v.a.createElement(Ie.a,null,v.a.createElement(Be.a,{id:"alert-dialog-description"},"Are you sure you want to reset? This will restore the default configuration.")),v.a.createElement(Fe.a,null,v.a.createElement(ne.a,{onClick:function(){return r()},color:"primary"},"Cancel"),v.a.createElement(ne.a,{onClick:function(){return r("reset")},color:"primary",variant:"contained"},"OK")))},it={invoke:function(){}},ct=Object(E.a)((function(e){return{newSession:{backgroundColor:e.palette.grey[300],padding:e.spacing(2),marginTop:e.spacing(6)},header:{margin:e.spacing(2)},settings:{float:"right"}}})),st=function(e){var t=e.sessionToDelete,n=e.onClose,a=window.electronBetterIpc.ipcRenderer||it,r=Object(b.useState)(!1),o=Object(G.a)(r,2),i=o[0],c=o[1];return Object(b.useEffect)((function(){Object(Ae.a)(Ne.a.mark((function e(){return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!i){e.next=6;break}return c(!1),e.next=5,a.invoke("deleteSession",t);case 5:n(!0);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),c((function(){throw e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[i,a,n,t]),v.a.createElement(Pe.a,{open:!!t,onClose:function(){return n(!1)}},v.a.createElement(Le.a,{id:"alert-dialog-title"},'Delete session "'.concat(t,'"?')),v.a.createElement(Ie.a,null,v.a.createElement(Be.a,{id:"alert-dialog-description"},"This action cannot be undone")),v.a.createElement(Fe.a,null,v.a.createElement(ne.a,{onClick:function(){return n(!1)},color:"primary"},"Cancel"),v.a.createElement(ne.a,{onClick:function(){c(!0)},color:"primary",variant:"contained",autoFocus:!0},"Delete")))},lt=function(e){var t=e.sessionNames,n=e.sessionToRename,a=e.onClose,r=window.electronBetterIpc.ipcRenderer||it,o=Object(b.useState)(""),i=Object(G.a)(o,2),c=i[0],s=i[1],l=Object(b.useState)(!1),u=Object(G.a)(l,2),d=u[0],f=u[1];return Object(b.useEffect)((function(){Object(Ae.a)(Ne.a.mark((function e(){return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!d){e.next=6;break}return f(!1),e.next=5,r.invoke("renameSession",n,c);case 5:a(!0);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),f((function(){throw e.t0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[r,c,a,d,n]),v.a.createElement(Pe.a,{open:!!n,onClose:function(){return a(!1)}},v.a.createElement(Le.a,{id:"alert-dialog-title"},"Rename"),v.a.createElement(Ie.a,null,v.a.createElement(Be.a,{id:"alert-dialog-description"},"Please enter a new name for the session:"),t.includes(c)?v.a.createElement(Be.a,{color:"error"},'There is already a session named "',c,'"'):null,v.a.createElement(He.a,{autoFocus:!0,defaultValue:n,onChange:function(e){s(e.target.value)}})),v.a.createElement(Fe.a,null,v.a.createElement(ne.a,{onClick:function(){return a(!1)},color:"primary"},"Cancel"),v.a.createElement(ne.a,{onClick:function(){f(!0)},color:"primary",variant:"contained",disabled:!c||t.includes(c)},"OK")))};function ut(e){var t=e.root,n=e.bypass,a=e.onFactoryReset,r=window.electronBetterIpc.ipcRenderer||it,o=Object(b.useState)(),i=Object(G.a)(o,2),c=i[0],s=i[1],l=Object(b.useState)(),u=Object(G.a)(l,2),d=u[0],f=u[1],p=Object(b.useState)(),m=Object(G.a)(p,2),g=m[0],h=m[1],y=Object(b.useState)(),w=Object(G.a)(y,2),j=w[0],k=w[1],C=Object(b.useState)(!0),E=Object(G.a)(C,2),x=E[0],S=E[1],T=Object(b.useState)(null),N=Object(G.a)(T,2),A=N[0],R=N[1],M=Object(b.useState)(!1),I=Object(G.a)(M,2),L=I[0],D=I[1],V=ct(),W=void 0!==c?Object.keys(c):[];t.setSavedSessionNames(W);var q=c?Object.entries(c).filter((function(e){return Object(G.a)(e,2)[1].stats})).sort((function(e,t){return t[1].stats.mtimeMs-e[1].stats.mtimeMs})):[];return Object(b.useEffect)((function(){Object(Ae.a)(Ne.a.mark((function e(){var a;return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(a=n&&Je.inDevelopment&&q.length?q[0][0]:j)){e.next=10;break}return e.t0=t,e.t1=JSON,e.next=7,r.invoke("loadSession",a);case 7:e.t2=e.sent,e.t3=e.t1.parse.call(e.t1,e.t2),e.t0.activateSession.call(e.t0,e.t3);case 10:e.next=15;break;case 12:e.prev=12,e.t4=e.catch(0),s((function(){throw e.t4}));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))()}),[n,r,t,j,q]),Object(b.useEffect)((function(){Object(Ae.a)(Ne.a.mark((function e(){return Ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!x){e.next=8;break}return S(!1),e.t0=s,e.next=6,r.invoke("listSessions");case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),s((function(){throw e.t2}));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()}),[r,x]),c?v.a.createElement(v.a.Fragment,null,v.a.createElement(ot,{open:L,onFactoryReset:a,onClose:function(){D(!1)}}),v.a.createElement(lt,{sessionToRename:g,sessionNames:W,onClose:function(e){h(void 0),S(e)}}),v.a.createElement(st,{sessionToDelete:d,onClose:function(e){f(void 0),S(e)}}),v.a.createElement(F.a,{className:V.settings,onClick:function(e){e.stopPropagation(),R(e.currentTarget)}},v.a.createElement(ze.a,null)),v.a.createElement(Me.a,{maxWidth:"md"},v.a.createElement(O,null),v.a.createElement("div",{className:V.newSession},v.a.createElement(P.a,{variant:"h5",className:V.header},"Start a new session"),v.a.createElement(De.a,{container:!0,spacing:4},v.a.createElement(De.a,{item:!0},v.a.createElement(Qe.c,{root:t})),v.a.createElement(De.a,{item:!0},v.a.createElement(Qe.d,{root:t})),v.a.createElement(De.a,{item:!0},v.a.createElement(Qe.e,{root:t})))),v.a.createElement(P.a,{variant:"h5",className:V.header},"Recent sessions"),v.a.createElement(De.a,{container:!0,spacing:4},q?q.map((function(e){var t=Object(G.a)(e,2),n=t[0],a=t[1];return v.a.createElement(De.a,{item:!0,key:n},v.a.createElement(rt,{sessionName:n,sessionStats:a.stats,sessionScreenshot:a.screenshot,onClick:function(){k(n)},onDelete:function(){f(n)},onRename:function(){h(n)}}))})):null)),v.a.createElement(Ge.a,{id:"simple-menu",anchorEl:A,keepMounted:!0,open:Boolean(A),onClose:function(){R(null)}},v.a.createElement(Ue.a,null,"Advanced Settings"),v.a.createElement(B.a,{onClick:function(){D(!0),R(null)}},v.a.createElement(_e.a,null,v.a.createElement(We.a,null)),v.a.createElement(P.a,{variant:"inherit"},"Factory Reset")))):v.a.createElement(Re.a,{style:{position:"fixed",top:"50%",left:"50%",marginTop:-25,marginLeft:-25},size:50})}var dt=n(81),ft=Object(E.a)({hoverLabel:{border:"1px solid black",position:"absolute",background:"#fffa",pointerEvents:"none",zIndex:1e4}}),pt=function(e){var t=e.offsetX,n=e.offsetY,a=e.configuration,r=e.feature,o=e.timeout,i=void 0===o?300:o,c=ft(),s=Object(b.useState)(!1),l=Object(G.a)(s,2),u=l[0],d=l[1];if(Object(b.useEffect)((function(){var e=setTimeout((function(){return d(!0)}),i);return function(){return clearTimeout(e)}})),r&&u){var f=Object(dt.readConfObject)(a,"mouseover",{feature:r});return v.a.createElement("div",{className:c.hoverLabel,style:{left:t,top:n}},f)}return null};pt.defaultProps={feature:void 0};var mt=Object(R.observer)(pt),gt=function(e){var t=e.onFactoryReset,n=e.resetButtonText,a=Object(b.useState)(!1),r=Object(G.a)(a,2),o=r[0],i=r[1];return v.a.createElement(v.a.Fragment,null,v.a.createElement(ne.a,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:function(){return i(!0)}},n),v.a.createElement(ot,{onClose:function(){return i(!1)},open:o,onFactoryReset:t}))},ht=function(e){var t=e.componentStack,n=e.error,a=e.onFactoryReset,r=e.resetButtonText;return v.a.createElement(Pe.a,{open:!0},v.a.createElement(Le.a,{style:{backgroundColor:"#e88"}},"Fatal error"),v.a.createElement(Ie.a,null,v.a.createElement("pre",null,n.toString(),t)),v.a.createElement(Fe.a,null,v.a.createElement(ne.a,{color:"secondary",variant:"contained",onClick:function(){return window.location.reload()}},"Refresh"),v.a.createElement(gt,{onFactoryReset:a,resetButtonText:r})))};ht.defaultProps={error:{message:"No error message provided"},componentStack:"",resetButtonText:"Factory Reset"};var bt=ht,vt=n(429)},128:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(84),r=n(88),o=function(){function e(){Object(a.a)(this,e),this.name=void 0,this.configurationSchema=void 0}return Object(r.a)(e,[{key:"install",value:function(e){}},{key:"configure",value:function(e){}}]),e}()},130:function(e,t,n){"use strict";n.r(t),n.d(t,"getTrackAssemblyNames",(function(){return c})),n.d(t,"getRpcSessionId",(function(){return s})),n.d(t,"getParentRenderProps",(function(){return l})),n.d(t,"UNKNOWN",(function(){return u})),n.d(t,"UNSUPPORTED",(function(){return d})),n.d(t,"guessAdapter",(function(){return f})),n.d(t,"guessTrackType",(function(){return p})),n.d(t,"generateUnsupportedTrackConf",(function(){return m})),n.d(t,"generateUnknownTrackConf",(function(){return g}));var a=n(87),r=n(431),o=n.n(r),i=n(81);function c(e){var t=e.configuration,n=Object(i.readConfObject)(t,"assemblyNames");if(!n){var r=Object(a.getParent)(e.configuration);if("sequence"in r)return[Object(i.readConfObject)(r,"name")]}return n}function s(e){for(var t,n=e;!Object(a.isRoot)(n);n=Object(a.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function l(e){for(var t=Object(a.getParent)(e);!Object(a.isRoot)(t);t=Object(a.getParent)(t))if("renderProps"in t)return t.renderProps;return{}}var u="UNKNOWN",d="UNSUPPORTED";function f(e,t,n){function a(e){if("uri"===t)return{uri:e};if("localPath"===t)return{localPath:e};throw new Error("invalid protocol ".concat(t))}return/\.bam$/i.test(e)?{type:"BamAdapter",bamLocation:a(e),index:{location:a(n||"".concat(e,".bai")),indexType:n&&n.toUpperCase().endsWith("CSI")?"CSI":"BAI"}}:/\.cram$/i.test(e)?{type:"CramAdapter",cramLocation:a(e),craiLocation:a("".concat(e,".crai"))}:/\.gff3?$/i.test(e)?{type:"UNSUPPORTED"}:/\.gff3?\.b?gz$/i.test(e)?{type:"Gff3TabixAdapter",gffGzLocation:a(e),index:{location:a(n||"".concat(e,".tbi")),indexType:n&&n.toUpperCase().endsWith("CSI")?"CSI":"TBI"}}:/\.gtf?$/i.test(e)||/\.vcf$/i.test(e)?{type:"UNSUPPORTED"}:/\.vcf\.b?gz$/i.test(e)?{type:"VcfTabixAdapter",vcfGzLocation:a(e),index:{location:a("".concat(e,".tbi")),indexType:n&&n.toUpperCase().endsWith("CSI")?"CSI":"TBI"}}:/\.vcf\.idx$/i.test(e)||/\.bed$/i.test(e)?{type:"UNSUPPORTED"}:/\.bed\.b?gz$/i.test(e)?{type:"BedTabixAdapter",bedGzLocation:a(e),index:{location:a("".concat(e,".tbi")),indexType:n&&n.toUpperCase().endsWith("CSI")?"CSI":"TBI"}}:/\.(bb|bigbed)$/i.test(e)?{type:"BigBedAdapter",bigBedLocation:a(e)}:/\.(bw|bigwig)$/i.test(e)?{type:"BigWigAdapter",bigWigLocation:a(e)}:/\.(fa|fasta|fas|fna|mfa)$/i.test(e)?{type:"IndexedFastaAdapter",fastaLocation:a(e),faiLocation:a(n||"".concat(e,".fai"))}:/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(e)?{type:"BgzipFastaAdapter",fastaLocation:a(e),faiLocation:a("".concat(e,".fai")),gziLocation:a("".concat(e,".gzi"))}:/\.2bit$/i.test(e)?{type:"TwoBitAdapter",twoBitLocation:a(e)}:/\.sizes$/i.test(e)?{type:"UNSUPPORTED"}:/\/trackData.jsonz?$/i.test(e)?{type:"NCListAdapter",rootUrlTemplate:a(e)}:/\/sparql$/i.test(e)?{type:"SPARQLAdapter",endpoint:e}:/\.hic/i.test(e)?{type:"HicAdapter",hicLocation:a(e)}:/\.paf/i.test(e)?{type:"PAFAdapter",pafLocation:a(e)}:{type:u}}function p(e){return{BamAdapter:"AlignmentsTrack",CramAdapter:"AlignmentsTrack",BgzipFastaAdapter:"ReferenceSequenceTrack",BigWigAdapter:"QuantitativeTrack",IndexedFastaAdapter:"ReferenceSequenceTrack",TwoBitAdapter:"ReferenceSequenceTrack",VcfTabixAdapter:"VariantTrack",HicAdapter:"HicTrack",PAFAdapter:"SyntenyTrack"}[e]||"FeatureTrack"}function m(e,t,n){var a={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return a.trackId=o()(a),a}function g(e,t,n){var a={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return a.trackId=o()(a),a}},1315:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"f",(function(){return isTrack})),__webpack_require__.d(__webpack_exports__,"e",(function(){return isSource})),__webpack_require__.d(__webpack_exports__,"b",(function(){return deepUpdate})),__webpack_require__.d(__webpack_exports__,"g",(function(){return objectFingerprint})),__webpack_require__.d(__webpack_exports__,"d",(function(){return fillTemplate})),__webpack_require__.d(__webpack_exports__,"a",(function(){return clone})),__webpack_require__.d(__webpack_exports__,"c",(function(){return evalHooks}));var get_value__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1313),get_value__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(get_value__WEBPACK_IMPORTED_MODULE_0__),object_hash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(431),object_hash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(object_hash__WEBPACK_IMPORTED_MODULE_1__);function isTrack(e){return e&&e.label&&"string"===typeof e.label}function isSource(e){return e&&e.url&&"string"===typeof e.url}function deepUpdate(e,t){for(var n=0,a=Object.keys(t);n<a.length;n++){var r=a[n];r in e&&"object"===typeof t[r]&&"object"===typeof e[r]?deepUpdate(e[r],t[r]):"undefined"!==typeof e[r]&&"undefined"===typeof t[r]||(e[r]=t[r])}return e}function objectFingerprint(e){return object_hash__WEBPACK_IMPORTED_MODULE_1___default()(e)}function fillTemplate(e,t){var n=this;return e.replace(/\{([\w\s.]+)\}/g,(function(e,a){a=a.replace(/\s+/g,"");var r=get_value__WEBPACK_IMPORTED_MODULE_0___default()(t,a);if(void 0!==r)return"function"===typeof r?r(a):r;if(t.callback){var o=t.callback.call(n,a);if(void 0!==o)return o}return e}))}function clone(e){if(!e||"object"!==typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,a;if(Array.isArray(e))for(t=[],n=0,a=e.length;n<a;++n)n in e&&(t[n]=clone(e[n]));else t=e.constructor?new e.constructor:{};return mixin(t,e,clone)}function mixin(e,t,n){var a,r,o={};for(a in t)r=t[a],a in e&&(e[a]===r||a in o&&o[a]===r)||(e[a]=n?n(r):r);return e}function evalHooks(e){if(e)for(var t=0,n=Object.keys(e);t<n.length;t++){var a=n[t];if("object"===typeof e[a])e[a]=evalHooks(e[a]);else if("string"===typeof e[a]){var r=e[a];/^\s*function\s*\(/.test(r)&&(e[a]=evalHook(r))}}return e}function evalHook(){if("string"!==typeof(arguments.length<=0?void 0:arguments[0]))return arguments.length<=0?void 0:arguments[0];try{eval("arguments[0]=".concat(arguments.length<=0?void 0:arguments[0],";"))}catch(e){console.error("".concat(e," parsing config callback '").concat(arguments.length<=0?void 0:arguments[0],"'"))}return arguments.length<=0?void 0:arguments[0]}},132:function(e,t,n){"use strict";n.r(t),n.d(t,"BaseAdapter",(function(){return v})),n.d(t,"BaseFeatureDataAdapter",(function(){return y})),n.d(t,"isSequenceAdapter",(function(){return w})),n.d(t,"isRegionsAdapter",(function(){return O})),n.d(t,"isFeatureAdapter",(function(){return j})),n.d(t,"isRefNameAliasAdapter",(function(){return k}));var a=n(102),r=n(91),o=n.n(r),i=n(93),c=n(88),s=n(94),l=n(95),u=n(84),d=n(685),f=n(974),p=n(87),m=n(147),g=n(85),h=n(684);function b(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];if(t.length>100)break;"object"===typeof e[r]?t+=b(e[r],t):t+="".concat(r,"-").concat(e[r],";")}return t.slice(0,100)}var v=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(u.a)(this,e),this.id=void 0,"undefined"===typeof jest){var n=Object(p.isStateTreeNode)(t)?Object(p.getSnapshot)(t):t;this.id=b(n)}else this.id="test"};v.capabilities=[];var y=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getHeader",value:function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeaturesInRegion",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.ObservableCreate)(function(){var a=Object(i.a)(o.a.mark((function a(r){var i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.hasDataForRefName(e.refName,n);case 2:i=a.sent,Object(g.checkAbortSignal)(n.signal),i?t.getFeatures(e,n).pipe(Object(f.a)(Object(g.observeAbortSignal)(n.signal))).subscribe(r):r.complete();case 5:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d.a.apply(void 0,Object(a.a)(e.map((function(e){return Object(m.ObservableCreate)(function(){var a=Object(i.a)(o.a.mark((function a(r){var i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.hasDataForRefName(e.refName,n);case 2:i=a.sent,Object(g.checkAbortSignal)(n.signal),i?t.getFeatures(e,n).subscribe(r):r.complete();case 5:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}))));return n.signal?r.pipe(Object(f.a)(Object(g.observeAbortSignal)(n.signal))):r}},{key:"hasDataForRefName",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,a,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.getRefNames(n);case 3:return a=e.sent,e.abrupt("return",a.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegionStats",value:function(e,t){var n=this.getFeatures(e,t);return Object(h.c)(e,n)}},{key:"getMultiRegionStats",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t,n,a,r,i,c,s,l,u,d=this,f=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:[],n=f.length>1?f[1]:void 0,t.length){e.next=4;break}return e.abrupt("return",Object(h.a)());case 4:return e.next=6,Promise.all(t.map((function(e){return d.getRegionStats(e,n)})));case 6:return a=e.sent,r=a.map((function(e){return e.scoreMax})).reduce((function(e,t){return Math.max(e,t)})),i=a.map((function(e){return e.scoreMin})).reduce((function(e,t){return Math.min(e,t)})),c=a.map((function(e){return e.scoreSum})).reduce((function(e,t){return e+t}),0),s=a.map((function(e){return e.scoreSumSquares})).reduce((function(e,t){return e+t}),0),l=a.map((function(e){return e.featureCount})).reduce((function(e,t){return e+t}),0),u=a.map((function(e){return e.basesCovered})).reduce((function(e,t){return e+t}),0),e.abrupt("return",Object(h.b)({scoreMin:i,scoreMax:r,featureCount:l,basesCovered:u,scoreSumSquares:s,scoreSum:c}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(v);function w(e){return"getRegions"in e&&"getFeatures"in e}function O(e){return"getRegions"in e}function j(e){return"getFeatures"in e}function k(e){return"getRefNameAliases"in e}},1325:function(e,t,n){"use strict";var a={};n.r(a),n.d(a,"red",(function(){return he.a})),n.d(a,"pink",(function(){return ve.a})),n.d(a,"purple",(function(){return we.a})),n.d(a,"deepPurple",(function(){return je.a})),n.d(a,"indigo",(function(){return Ce.a})),n.d(a,"blue",(function(){return xe.a})),n.d(a,"lightBlue",(function(){return Te.a})),n.d(a,"cyan",(function(){return Ae.a})),n.d(a,"teal",(function(){return Me.a})),n.d(a,"green",(function(){return Fe.a})),n.d(a,"lightGreen",(function(){return Be.a})),n.d(a,"lime",(function(){return De.a})),n.d(a,"yellow",(function(){return We.a})),n.d(a,"amber",(function(){return ze.a})),n.d(a,"orange",(function(){return _e.a})),n.d(a,"deepOrange",(function(){return Ge.a})),n.d(a,"brown",(function(){return Qe.a})),n.d(a,"grey",(function(){return Ye.a})),n.d(a,"blueGrey",(function(){return Ze.a}));var r=n(1),o=n.n(r),i=n(31),c=n(115),s=n(87),l=n(86),u=n(11),d=n.n(u),f=n(65),p=n(125),m=n(108),g=n(981),h=n(2445),b=n(845),v=n(2481),y=n(2512),w=n(2502),O=n(2514),j=n(2543),k=n(2501),C=n(2505),E=n(2462),x=n(982),S=n(2478),T=n(2516),N=n(2499),A=n(2517),R=n(2471),M=n(2518),P=n(2519),F=n(2482),I=n(2495),B=n(1604),L=n(2475),D=n(2544),V=n(1039),W=n(2549),q=n(2496),z=n(2497),H=n(2456),_=n(2473),U=n(2479),G=n(2500),J=n(2551),Q=n(132),X=n(385),Y=n(430),K=n(518),Z=n(184),$=n(217),ee=n(249),te=n(250),ne=n(150),ae=n(312),re=n(1005),oe=n(479),ie=n(81),ce=n(128),se=n(126),le=n(85),ue=n(386),de=n(130),fe=n(134),pe=n(342),me=n(147),ge=n(1019),he=n.n(ge),be=n(1020),ve=n.n(be),ye=n(1021),we=n.n(ye),Oe=n(1022),je=n.n(Oe),ke=n(1023),Ce=n.n(ke),Ee=n(1024),xe=n.n(Ee),Se=n(1025),Te=n.n(Se),Ne=n(1026),Ae=n.n(Ne),Re=n(1027),Me=n.n(Re),Pe=n(1028),Fe=n.n(Pe),Ie=n(1029),Be=n.n(Ie),Le=n(1030),De=n.n(Le),Ve=n(1031),We=n.n(Ve),qe=n(1032),ze=n.n(qe),He=n(1033),_e=n.n(He),Ue=n(1034),Ge=n.n(Ue),Je=n(1035),Qe=n.n(Je),Xe=n(1036),Ye=n.n(Xe),Ke=n(1037),Ze=n.n(Ke),$e=n(114),et={mobx:c,"mobx-state-tree":s,react:o.a,"react-dom":i,"mobx-react":l,"prop-types":d.a,"@material-ui/core":p,"@material-ui/core/SvgIcon":g.a,"@material-ui/core/utils":m,"@material-ui/lab":h,"@material-ui/core/colors":a,"@material-ui/core/styles":f,"@material-ui/core/Box":b.a,"@material-ui/core/Button":v.a,"@material-ui/core/ButtonGroup":y.a,"@material-ui/core/Card":w.a,"@material-ui/core/CardContent":O.a,"@material-ui/core/Container":k.a,"@material-ui/core/Checkbox":j.a,"@material-ui/core/Dialog":C.a,"@material-ui/core/FormGroup":T.a,"@material-ui/core/FormLabel":E.a,"@material-ui/core/FormControl":x.a,"@material-ui/core/FormControlLabel":S.a,"@material-ui/core/Grid":N.a,"@material-ui/core/Icon":A.a,"@material-ui/core/IconButton":R.a,"@material-ui/core/InputAdornment":M.a,"@material-ui/core/LinearProgress":P.a,"@material-ui/core/ListItemIcon":F.a,"@material-ui/core/ListItemText":I.a,"@material-ui/core/Menu":B.a,"@material-ui/core/MenuItem":L.a,"@material-ui/core/RadioGroup":V.a,"@material-ui/core/Radio":D.a,"@material-ui/core/Select":W.a,"@material-ui/core/Snackbar":q.a,"@material-ui/core/SnackbarContent":z.a,"@material-ui/core/TextField":H.a,"@material-ui/core/Tooltip":_.a,"@material-ui/core/Typography":U.a,"@material-ui/lab/ToggleButton":G.a,"@material-ui/lab/ToggleButtonGroup":J.a,"@jbrowse/core/Plugin":ce.a,"@jbrowse/core/pluggableElementTypes/ViewType":K.a,"@jbrowse/core/pluggableElementTypes/AdapterType":Z.a,"@jbrowse/core/pluggableElementTypes/DisplayType":$.a,"@jbrowse/core/pluggableElementTypes/TrackType":ee.a,"@jbrowse/core/pluggableElementTypes/WidgetType":te.a,"@jbrowse/core/pluggableElementTypes/models":ne,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":ae.a,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":re.a,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":oe.b,"@jbrowse/core/configuration":ie,"@jbrowse/core/util/types/mst":$e,"@jbrowse/core/ui":se,"@jbrowse/core/util":le,"@jbrowse/core/util/color":ue,"@jbrowse/core/util/tracks":de,"@jbrowse/core/util/Base1DViewModel":Y.a,"@jbrowse/core/util/io":fe,"@jbrowse/core/util/mst-reflection":pe,"@jbrowse/core/util/rxjs":me,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":X,"@jbrowse/core/data_adapters/BaseAdapter":Q};["mobx","mobx-state-tree","react","react-dom","mobx-react","prop-types","@material-ui/core","@material-ui/core/SvgIcon","@material-ui/core/utils","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"].forEach((function(e){if(!(e in et))throw new Error("ReExports/modules is missing ".concat(e))}));var tt=et;t.a=tt},134:function(e,t,n){"use strict";n.r(t),n.d(t,"openUrl",(function(){return w})),n.d(t,"openLocation",(function(){return k}));var a=n(355),r=n(1013),o=n(1632),i=n(91),c=n.n(i),s=n(82),l=n(104),u=n(93),d=n(89),f=(n(1634),n(1635)),p=n(105);function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,Object(d.a)({method:"GET",credentials:"same-origin"},t))}function g(){return(g=Object(u.a)(c.a.mark((function e(t,n,a){var r,o,i,u,f,g,h,b,v,y,w,O,j=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=j.length>3&&void 0!==j[3]?j[3]:{},o=new Date,i=Object(d.a)(Object(d.a)({},r.headers),{},{range:"bytes=".concat(n,"-").concat(a)}),e.next=5,m(t,Object(d.a)(Object(d.a)({},r),{},{headers:i}));case 5:if(u=e.sent,f=new Date,206===u.status||200===u.status){e.next=9;break}throw new Error("HTTP ".concat(u.status," when fetching ").concat(t," bytes ").concat(n,"-").concat(a));case 9:g={},h=Object(l.a)(u.headers.entries());try{for(h.s();!(b=h.n()).done;)v=Object(s.a)(b.value,2),y=v[0],w=v[1],g[y]=w}catch(c){h.e(c)}finally{h.f()}if(200!==u.status){e.next=14;break}throw new Error("HTTP ".concat(u.status," when fetching ").concat(t," bytes ").concat(n,"-").concat(a));case 14:return e.next=16,u.arrayBuffer();case 16:return O=e.sent,e.abrupt("return",{headers:g,requestDate:o,responseDate:f,buffer:p.Buffer.from(O)});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=new f.HttpRangeFetcher({fetch:function(e,t,n){return g.apply(this,arguments)},size:524288e3,chunkSize:Math.pow(2,17),maxFetchSize:104857600,minimumTTL:3e8});function b(e,t){return v.apply(this,arguments)}function v(){return(v=Object(u.a)(c.a.mark((function e(t,n){var a,r,o,i,l,u,d,f,p,g,b,v;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=n&&n.headers)&&(a instanceof Headers?r=a.get("range"):Array.isArray(a)?(o=a.find((function(e){return"range"===Object(s.a)(e,1)[0]}))||[void 0,void 0],i=Object(s.a)(o,2),r=i[1]):r=a.range),!r){e.next=13;break}if(!(l=/bytes=(\d+)-(\d+)/.exec(r))){e.next=13;break}return u=Object(s.a)(l,3),d=u[1],f=u[2],p=parseInt(d,10),g=parseInt(f,10),e.next=10,h.getRange(t,p,g-p+1,{signal:n&&n.signal});case 10:return b=e.sent,v=b.headers,e.abrupt("return",new Response(b.buffer,{status:206,headers:v}));case 13:return e.abrupt("return",m(t,n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=/electron/i.test(navigator.userAgent),w=function(e){return y?new o.a(e):(t=e,new a.RemoteFile(String(t),{fetch:b}));var t};function O(e){return"uri"in e}function j(e){return"localPath"in e}function k(e){if(!e)throw new Error("must provide a location to openLocation");if(y){if(O(e))return new o.a(e.uri);if(j(e))return new r.a(e.localPath)}else{if(O(e))return w(e.baseUri?new URL(e.uri,e.baseUri).href:e.uri);if(j(e))return new a.LocalFile(e.localPath)}if(function(e){return"blob"in e}(e))return new a.BlobFile(e.blob);throw new Error("invalid fileLocation")}},139:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var a=n(89),r=n(84),o=n(88);function i(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function c(e){return"uniqueId"in e&&"object"!==typeof e.data}var s=function(){function e(t){Object(r.a)(this,e),this.data=void 0,this.parentHandle=void 0,this.uniqueId=void 0,c(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);var n=c(t)?t.uniqueId:t.id;if(void 0===n||null===n)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(n),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));var a=this.data.subfeatures;if(a)for(var o=0;o<a.length;o+=1)"function"!==typeof a[o].get&&(a[o].strand=a[o].strand||this.data.strand,a[o]=new e({id:a[o].uniqueId||"".concat(n,"-").concat(o),data:a[o],parent:this}))}return Object(o.a)(e,[{key:"get",value:function(e){return this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=Object(a.a)(Object(a.a)({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e(Object(a.a)({},t))}}]),e}()},147:function(e,t,n){"use strict";n.r(t),n.d(t,"ObservableCreate",(function(){return i}));var a=n(112),r=n(974),o=n(85);function i(e,t){return a.a.create((function(t){try{var n=e(t);n&&n.catch&&n.catch((function(e){return t.error(e)}))}catch(a){t.error(a)}})).pipe(Object(r.a)(Object(o.observeAbortSignal)(t)))}},150:function(e,t,n){"use strict";n.r(t),n.d(t,"baseConnectionConfig",(function(){return r})),n.d(t,"BaseConnectionModelFactory",(function(){return i})),n.d(t,"BaseViewModel",(function(){return c.a})),n.d(t,"BaseDisplay",(function(){return d})),n.d(t,"createBaseTrackModel",(function(){return y})),n.d(t,"createBaseTrackConfig",(function(){return w}));var a=n(81),r=Object(a.ConfigurationSchema)("JBrowse1Connection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyName:{description:"name of the assembly the connection belongs to",type:"string",defaultValue:"assemblyName"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"}),o=n(87),i=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{afterAttach:function(){e.tracks.length||e.connect(e.configuration)},addTrackConf:function(t){var n=e.tracks.push(t);return e.tracks[n-1]},setTrackConfs:function(t){return e.tracks=t,e.track},clear:function(){}}}))},c=n(532),s=n(89),l=n(130),u=n(114),d=o.types.model("BaseDisplay",{id:u.ElementId,type:o.types.string}).volatile((function(){return{rendererTypeName:"",error:void 0}})).views((function(e){return{get RenderingComponent(){return Object(o.getEnv)(e).pluginManager.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return Object(a.getConf)(this.parentTrack,"adapter")},get parentTrack(){for(var t=Object(o.getParent)(e);!t.configuration||!Object(a.getConf)(t,"trackId");){if(Object(o.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=Object(o.getParent)(t)}return t},get renderProps(){return Object(s.a)(Object(s.a)({},Object(l.getParentRenderProps)(e)),{},{displayModel:e})},get rendererType(){var t=Object(o.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!t)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return t},get DisplayMessageComponent(){},get trackMenuItems(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered:function(){}}})).actions((function(e){return{setError:function(t){e.error=t},reload:function(){}}})),f=n(102),p=n(995),m=n.n(p),g=n(115),h=n(387),b=n(85),v=n(419);function y(e,t,n){return o.types.model(t,{id:u.ElementId,type:o.types.literal(t),configuration:Object(h.a)(n),displays:o.types.array(e.pluggableMstType("display","stateModel"))}).volatile((function(){return{showAbout:!1,DialogComponent:void 0,DialogDisplay:void 0}})).actions((function(e){return{setShowAbout:function(t){e.showAbout=t},setDialogComponent:function(t,n){e.DialogComponent=t,e.DialogDisplay=n}}})).views((function(e){return{get rpcSessionId(){return e.configuration.trackId},get name(){return Object(a.getConf)(e,"name")},get adapterType(){var t=Object(a.getConf)(e,"adapter"),n=Object(o.getEnv)(e).pluginManager;if(!t)throw new Error("no adapter configuration provided for ".concat(e.type));var r=n.getAdapterType(t.type);if(!r)throw new Error("unknown adapter type ".concat(t.type));return r},get viewMenuActions(){var t=[];return e.displays.forEach((function(e){t.push.apply(t,Object(f.a)(e.viewMenuActions))})),t},get canConfigure(){var t=Object(b.getSession)(e);return Object(v.isSessionModelWithConfigEditing)(t)&&(t.adminMode||t.sessionTracks.find((function(t){return t.trackId===e.configuration.trackId})))},get composedTrackMenuItems(){return[]}}})).actions((function(t){return{activateConfigurationUI:function(){var e=Object(b.getSession)(t),n=Object(b.getContainingView)(t);if(Object(v.isSessionModelWithConfigEditing)(e)){var a=e.editTrackConfiguration(t.configuration);a&&a!==t.configuration&&(n.hideTrack(t.configuration),n.showTrack(a))}},showDisplay:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.pluggableConfigSchemaType("display"),i=Object(o.resolveIdentifier)(r,Object(o.getRoot)(t),n),c=e.getDisplayType(i.type);if(!c)throw new Error("unknown display type ".concat(i.type));var l=c.stateModel.create(Object(s.a)(Object(s.a)({},a),{},{type:i.type,configuration:i}));t.displays.push(l)},hideDisplay:function(n){var a=e.pluggableConfigSchemaType("display"),r=Object(o.resolveIdentifier)(a,Object(o.getRoot)(t),n),i=t.displays.filter((function(e){return e.configuration===r}));return Object(g.transaction)((function(){return i.forEach((function(e){return t.displays.remove(e)}))})),i.length},replaceDisplay:function(n,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.displays.findIndex((function(e){return e.configuration.displayId===n}));if(-1===i)throw new Error("could not find display id ".concat(n," to replace"));var c=e.pluggableConfigSchemaType("display"),l=Object(o.resolveIdentifier)(c,Object(o.getRoot)(t),a),u=e.getDisplayType(l.type);if(!u)throw new Error("unknown display type ".concat(l.type));t.displays.splice(i,1,Object(s.a)(Object(s.a)({},r),{},{type:l.type,configuration:l}))}}})).views((function(t){return{get trackMenuItems(){var n=[];t.displays.forEach((function(e){n.push.apply(n,Object(f.a)(e.trackMenuItems))}));var a=[],r=Object(b.getContainingView)(t),o=e.getViewType(r.type).displayTypes.map((function(e){return e.name})),i=t.configuration.displays.filter((function(e){return o.includes(e.type)})),c=t.displays[0].configuration.displayId;return i.length>1&&(a.push({type:"divider"},{type:"subHeader",label:"Display types"}),i.forEach((function(e){a.push({type:"radio",label:"".concat(e.type),onClick:function(){t.replaceDisplay(c,e.displayId)},checked:e.displayId===c})}))),[{label:"About this track",icon:m.a,priority:10,onClick:function(){t.setShowAbout(!0)}}].concat(n,a)}}}))}function w(e){return Object(a.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),displays:o.types.array(e.pluggableConfigSchemaType("display"))},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),a=new Set,r=n.displays,o=void 0===r?[]:r;"placeholderId"!==n.trackId&&(o.forEach((function(e){return e&&a.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){a.has(e.name)||o.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return Object(s.a)(Object(s.a)({},n),{},{displays:o})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var a=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(a)return a;var r=e.displays.push(t);return e.displays[r-1]}}}})}},1568:function(e,t){},1619:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAACWCAYAAACb3McZAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAB7CAAAewgBeCQdoQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMUSURBVHic7dsxixRnAMbxd3anCZhGU4okkCOKhfU27uUTxAi3bYpY5Duk1cbGLyApUnog+A20kK2SxkawiWIKuayVVplz0mQhiD57566+c9nfr9tiXp7mzw4zTCkAAAAAAAAAAAAAAACcJE3tAdvk9NVrZ8uom6x1yJt2/vLu7ecbmsQKbe0BW2XUTZqm3FnniH7UzUop+xtaxAqj2gNgyAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQNDWHnAUn329e3Zc+kntHevqF692mi9OrXXG5I/Rzjfnftzb0KRq2sNmfvPP289r71jlRAQyLv2k6cud2jvW1T07KG1THozOnJp+yPWXn4zvf/Wy3Nj0rhq6cT8rpezX3rGKW6xPrHt6MH2zePXguNf9G8fuR5hEIJAKjhuJOOoRSCVHjUQcdQmkolWRiKM+gVT2vkjEMQwCGYC3IxHHcJyIx7zboHt6MG1HzcNv//q8+1Icg+EfZEB+ufzo7+uz32vP4D8EMhC//vDi/pVLr3cvXFxMr/3027Hfk/BxCGQAlnEsf4tkOARS2dtxLIlkGARS0fviWBJJfQKpZFUcSyKpSyAVHDWOJZHUI5BP7LhxLImkjhPxovCwNPNx089q71jXre8XO1cuvf7g7zkuXFxMr+49/vnu/vknm9xVQ3vYzGtvOIqm9oBt0t87t1dKv+aHX82s+e7Z4D80+r9wiwWBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAI2toDtkp3OC/teLb2GQAAAAAAAAAAAAAAAMA7/QMEwsCcxccm/QAAAABJRU5ErkJggg=="},1620:function(e,t,n){e.exports=n.p+"static/media/linearGenomeViewIcon.74c99836.png"},1621:function(e,t,n){e.exports=n.p+"static/media/svInspectorIcon.06d28298.png"},1632:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var a=n(89),r=n(91),o=n.n(r),i=n(93),c=n(88),s=n(84),l=n(94),u=n(95),d=n(1326),f=n(1633),p=n.n(f),m=n(1013),g=n(85),h=("undefined"!==typeof window?window:{}).electron,b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).status=void 0,e}return n}(Object(d.a)(Error)),v=function(){function t(e){var n,a=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(s.a)(this,t),this.url=void 0,this._stat=void 0,this.fetch=void 0,this.baseOverrides={},this.nodeFetchFallback=!1,this.ipcRenderer=void 0,this.nodeFetch=function(){var e=Object(i.a)(o.a.mark((function e(t,n){var r,i,c,s,l,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n&&(n.signal=void 0),e.next=3,a.ipcRenderer.invoke("fetch",t,n);case 3:return r=e.sent,i=r.buffer,c=r.headers,s=r.status,l=r.statusText,u=new Response(i,{status:s,statusText:l,headers:c}),e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h&&(n=h.ipcRenderer),!n)throw new Error("Cannot use ElectronLocalFile without ipcRenderer from electron");if(this.ipcRenderer=n,this.url=e,e.startsWith("file://")){var c=p()(e);if(!c)throw new TypeError("invalid file url");var l=new m.a(c);return this.read=l.read.bind(l),this.readFile=l.readFile.bind(l),void(this.stat=l.stat.bind(l))}var u=r.fetch||window.fetch;if(!fetch)throw new TypeError("no fetch function supplied, and none found in global environment");this.fetch=u,r.overrides&&(this.baseOverrides=r.overrides)}return Object(c.a)(t,[{key:"getBufferFromResponse",value:function(){var t=Object(i.a)(o.a.mark((function t(n){var a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!==typeof n.buffer){t.next=2;break}return t.abrupt("return",n.buffer());case 2:if("function"!==typeof n.arrayBuffer){t.next=7;break}return t.next=5,n.arrayBuffer();case 5:return a=t.sent,t.abrupt("return",e.from(a));case 7:throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getFetch",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r,i,c,s,l,u,d,f,p,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.fetch){e.next=2;break}throw new Error("a fetch function must be available unless using a file:// url");case 2:if(this.url){e.next=4;break}throw new Error("no URL specified");case 4:return n=this.nodeFetchFallback?this.nodeFetch:this.fetch,r=t.headers,i=void 0===r?{}:r,c=t.signal,s=t.overrides,l=void 0===s?{}:s,u=Object(a.a)(Object(a.a)({headers:i,method:"GET",redirect:"follow",mode:"cors",signal:c},this.baseOverrides),l),e.prev=7,e.next=10,n(this.url,u);case 10:d=e.sent,e.next=22;break;case 13:if(e.prev=13,e.t0=e.catch(7),Object(g.isAbortException)(e.t0)){e.next=21;break}if(!this.nodeFetchFallback){e.next=18;break}throw e.t0;case 18:return console.warn("received error, falling back to node-fetch",e.t0),this.nodeFetchFallback=!0,e.abrupt("return",this.getFetch(t));case 21:throw e.t0;case 22:return this._stat||(u.headers&&u.headers.range?(f=d.headers.get("content-range"),(p=/\/(\d+)$/.exec(f||""))&&p[1]&&(this._stat={size:parseInt(p[1],10)})):(m=d.headers.get("content-length"))&&(this._stat={size:parseInt(m,10)})),e.abrupt("return",d);case 24:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"headFetch",value:function(){var e=Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getFetch({overrides:{method:"HEAD"}}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,a,r,i,c,s,l,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:0,a=u.length>2?u[2]:void 0,r=u.length>3&&void 0!==u[3]?u[3]:0,(i=u.length>4&&void 0!==u[4]?u[4]:{}).headers=i.headers||{},a<1/0?i.headers.range="bytes=".concat(r,"-").concat(r+a):a===1/0&&0!==r&&(i.headers.range="bytes=".concat(r,"-")),e.next=8,this.getFetch(i);case 8:if((200!==(c=e.sent).status||0!==r)&&206!==c.status){e.next=15;break}return e.next=12,this.getBufferFromResponse(c);case 12:return s=e.sent,l=s.copy(t,n,0,Math.min(a,s.length)),e.abrupt("return",{bytesRead:l,buffer:t});case 15:throw new Error("HTTP ".concat(c.status," fetching ").concat(this.url));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readFile",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t,n,a,r,i,c=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"===typeof(t=c.length>0&&void 0!==c[0]?c[0]:{})?(n=t,a={}):(n=t.encoding,delete(a=t).encoding),e.next=4,this.getFetch(a);case 4:if(200===(r=e.sent).status){e.next=9;break}throw(i=new b("HTTP ".concat(r.status," fetching ").concat(this.url))).status=r.status,i;case 9:if("utf8"!==n){e.next=11;break}return e.abrupt("return",r.text());case 11:if(!n){e.next=13;break}throw new Error("unsupported encoding: ".concat(n));case 13:return e.abrupt("return",this.getBufferFromResponse(r));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var t=Object(i.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._stat){t.next=3;break}return t.next=3,this.headFetch();case 3:if(this._stat){t.next=6;break}return t.next=6,this.read(e.allocUnsafe(10),0,10,0);case 6:if(this._stat){t.next=8;break}throw new Error("unable to determine size of file at ".concat(this.url));case 8:return t.abrupt("return",this._stat);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(105).Buffer)},1656:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var a=n(82),r=n(91),o=n.n(r),i=n(93),c=n(84),s=n(88),l=n(438),u=n.n(l),d=n(1662),f=n.n(d),p=n(81),m=n(1325),g=(Object(p.ConfigurationSchema)("PluginSource",{name:{type:"string",defaultValue:""},url:{type:"string",defaultValue:""}}),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(c.a)(this,t),this.definitions=[],this.definitions=JSON.parse(JSON.stringify(e))}return Object(s.a)(t,[{key:"loadScript",value:function(e){if(document&&document.getElementsByTagName)return f()(e);if(self&&self.importScripts)return new Promise((function(t,n){try{self.importScripts(e)}catch(a){return void n(a||new Error("failed to load ".concat(e)))}t()}));throw new Error("cannot figure out how to load external JS scripts in this environment")}},{key:"loadPlugin",value:function(){var t=Object(i.a)(o.a.mark((function t(n){var a,r,i,c,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=u.a.parse(n.url)).protocol&&"http:"!==a.protocol&&"https:"!==a.protocol){t.next=11;break}return t.next=4,this.loadScript(n.url);case 4:if(r=n.name,i="JBrowsePlugin".concat(r),c="object"===typeof self&&self.self===self&&self||"object"===typeof e&&e.global===e&&e||this,s=c[i]){t.next=10;break}throw new Error("plugin ".concat(r," failed to load, ").concat(c.constructor.name,".").concat(i," is undefined"));case 10:return t.abrupt("return",s.default);case 11:throw new Error('cannot load plugins using protocol "'.concat(a.protocol,'"'));case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"installGlobalReExports",value:function(e){e.JBrowseExports={},Object.entries(m.a).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],o=n[1];e.JBrowseExports[r]=o}))}},{key:"load",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(this.definitions.map((function(e){return t.loadPlugin(e)}))));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}())}).call(this,n(123))},1700:function(e,t){},1702:function(e,t){},184:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(84),r=n(94),o=n(95),i=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).AdapterClass=void 0,r.configSchema=void 0,r.AdapterClass=e.AdapterClass,r.configSchema=e.configSchema,!r.AdapterClass)throw new Error("no AdapterClass defined for adapter type ".concat(r.name));return r}return n}(n(272).a)},217:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(84),r=n(94),o=n(95),i=n(272),c=n(342),s=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.ReactComponent=void 0,r.trackType=void 0,r.viewType=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.ReactComponent=e.ReactComponent,r.trackType=e.trackType,r.viewType=e.viewType,!r.stateModel)throw new Error("no stateModel defined for display ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for display ".concat(r.name));if(!r.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(r.name));if(!r.trackType)throw new Error("no trackType provided for display ".concat(r.name));if(!r.viewType)throw new Error("no viewType provided for display ".concat(r.name));if(!Object(c.getDefaultValue)(r.configSchema).type){var o=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(o," is not explicitlyTyped"))}return r}return n}(i.a)},2432:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var a=n(94),r=n(95),o=n(91),i=n.n(o),c=n(93),s=n(84),l=n(88),u=n(132),d=n(147),f=n(134),p=n(81),m=n(2433),g=function(){function t(e){Object(s.a)(this,t),this.filehandle=void 0,this.filehandle=e}return Object(l.a)(t,[{key:"read",value:function(){var t=Object(c.a)(i.a.mark((function t(n,a){var r,o,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.filehandle.read(e.allocUnsafe(a),0,a,n);case 2:return r=t.sent,o=r.buffer,c=r.bytesRead,t.abrupt("return",o.buffer.slice(0,c));case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}();var h=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var a;Object(s.a)(this,n),(a=t.call(this,e)).hic=void 0;var r,o=Object(p.readConfObject)(e,"hicLocation");return a.hic=new m.a({file:(r=o,new g(Object(f.openLocation)(r)))}),a}return Object(l.a)(n,[{key:"getRefNames",value:function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hic.getMetaData();case 2:return t=e.sent,e.abrupt("return",t.chromosomes.map((function(e){return e.name})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getResolution",value:function(){var e=Object(c.a)(i.a.mark((function e(t){var n,a,r,o,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hic.getMetaData();case 2:for(n=e.sent,a=n.resolutions,r=a[a.length-1],o=a.length-1;o>=0;o-=1)(c=a[o])<=2*t&&(r=c);return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(d.ObservableCreate)(function(){var a=Object(c.a)(i.a.mark((function a(r){var o,c,s,l,u;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=e.refName,c=e.start,s=e.end,l=n.bpPerPx,a.next=4,t.getResolution(l||1e3);case 4:return u=a.sent,a.next=7,t.hic.getContactRecords("KR",{start:c,chr:o,end:s},{start:c,chr:o,end:s},"BP",u);case 7:a.sent.forEach((function(e){r.next(e)})),r.complete();case 10:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"freeResources",value:function(){}}]),n}(u.BaseFeatureDataAdapter)}).call(this,n(105).Buffer)},2441:function(e,t,n){e.exports=function(){return new Worker(n.p+"c75286d596e961e71f6f.worker.js")}},2444:function(e){e.exports=JSON.parse('{"name":"@jbrowse/web","version":"1.1.0","license":"Apache-2.0","homepage":".","main":"build","dir":"src","scripts":{"start":"rescripts --max-http-header-size=100000 start","build":"cross-env NODE_OPTIONS=\'--max-old-space-size=7000\' rescripts build","test":"rescripts test","eject":"rescripts eject","checktypes":"tsc --noEmit","jtest":"jest --config ../../jest.config.js --roots products/jbrowse-web/","lint":"eslint --ext .js,.ts,.jsx,.tsx src"},"dependencies":{"@jbrowse/core":"^1.1.0","@jbrowse/plugin-alignments":"^1.1.0","@jbrowse/plugin-bed":"^1.1.0","@jbrowse/plugin-breakpoint-split-view":"^1.1.0","@jbrowse/plugin-circular-view":"^1.1.0","@jbrowse/plugin-config":"^1.1.0","@jbrowse/plugin-data-management":"^1.1.0","@jbrowse/plugin-dotplot-view":"^1.1.0","@jbrowse/plugin-filtering":"^1.1.0","@jbrowse/plugin-gff3":"^1.0.4","@jbrowse/plugin-hic":"^1.1.0","@jbrowse/plugin-legacy-jbrowse":"^1.0.4","@jbrowse/plugin-linear-comparative-view":"^1.1.0","@jbrowse/plugin-linear-genome-view":"^1.1.0","@jbrowse/plugin-lollipop":"^1.1.0","@jbrowse/plugin-menus":"^1.1.0","@jbrowse/plugin-rdf":"^1.0.2","@jbrowse/plugin-sequence":"^1.1.0","@jbrowse/plugin-spreadsheet-view":"^1.1.0","@jbrowse/plugin-sv-inspector":"^1.1.0","@jbrowse/plugin-svg":"^1.1.0","@jbrowse/plugin-trackhub-registry":"^1.0.3","@jbrowse/plugin-variants":"^1.1.0","@jbrowse/plugin-wiggle":"^1.1.0","@librpc/web":"rbuels/librpc-web#737bb9706762a52a87169a12c9b59fb241febab0","@material-ui/core":"^4.9.5","@material-ui/data-grid":"^4.0.0-alpha.20","@material-ui/icons":"^4.0.0","@material-ui/lab":"^4.0.0-alpha.56","clsx":"^1.0.4","copy-to-clipboard":"^3.3.1","core-js":"^3.2.1","crypto-js":"^3.0.0","fastestsmallesttextencoderdecoder":"^1.0.14","fontsource-roboto":"3.0.3","json-stable-stringify":"^1.0.1","merge-deep":"^3.0.2","mobx":"^5.10.1","mobx-react":"^6.0.0","mobx-state-tree":"3.14.1","mst-middlewares":"^3.10.2","prop-types":"^15.7.2","query-string":"^6.9.0","raf":"^3.4.1","react":"^16.8.0","react-dom":"^16.8.0","react-error-boundary":"^1.2.5","react-sizeme":"^2.6.7","requestidlecallback-polyfill":"^1.0.2","rxjs":"^6.5.2","shortid":"^2.2.15","use-query-params":"1.1.3"},"devDependencies":{"jest":"24.9.0"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"license":"Apache-2.0","development":["last 1 chrome version"]},"private":true}')},249:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(84),r=n(88),o=n(94),i=n(95),c=n(272),s=n(342),l=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.displayTypes=[],r.stateModel=e.stateModel,r.configSchema=e.configSchema,!r.stateModel)throw new Error("no stateModel defined for track ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for track ".concat(r.name));if(!Object(s.getDefaultValue)(r.configSchema).type){var o=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(o," is not explicitlyTyped"))}return r}return Object(r.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(c.a)},250:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(84),r=n(94),o=n(95),i=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).heading=void 0,r.configSchema=void 0,r.HeadingComponent=void 0,r.ReactComponent=void 0,r.stateModel=void 0,r.heading=e.heading,r.HeadingComponent=e.HeadingComponent,r.configSchema=e.configSchema,r.stateModel=e.stateModel,r.ReactComponent=e.ReactComponent,!r.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for widget ".concat(r.name));return r}return n}(n(272).a)},2536:function(e,t,n){"use strict";n.r(t),n.d(t,"Loader",(function(){return zy}));var a={};n.r(a),n.d(a,"CoreGetRefNames",(function(){return G})),n.d(a,"CoreGetFileInfo",(function(){return J})),n.d(a,"CoreGetFeatures",(function(){return Q})),n.d(a,"CoreFreeResources",(function(){return X})),n.d(a,"CoreRender",(function(){return Y}));var r={};n.r(r),n.d(r,"getScale",(function(){return yr})),n.d(r,"getOrigin",(function(){return wr})),n.d(r,"getNiceDomain",(function(){return Or}));var o={};n.r(o),n.d(o,"parseCigar",(function(){return ao})),n.d(o,"cigarToMismatches",(function(){return ro})),n.d(o,"mdToMismatches",(function(){return oo})),n.d(o,"getTemplateCoord",(function(){return io})),n.d(o,"getMismatches",(function(){return co})),n.d(o,"generateMD",(function(){return so}));n(1334),n(1335),n(1336),n(1337),n(1338),n(1339),n(1340),n(1341),n(1342),n(1343),n(1344),n(1345),n(1346),n(1347),n(1348),n(1349),n(1350),n(1351),n(1352),n(1353),n(1354),n(1355),n(1356),n(1357),n(1358),n(1359),n(1360),n(506),n(1361),n(1362),n(1363),n(1364),n(1365),n(1366),n(1367),n(1368),n(1369),n(1370),n(1371),n(1372),n(1373),n(1374),n(1375),n(1377),n(1378),n(1380),n(1381),n(1382),n(1383),n(1384),n(1385),n(1386),n(1387),n(1388),n(1389),n(1390),n(1391),n(1393),n(1394),n(1395),n(1396),n(1397),n(1398),n(1399),n(1400),n(1401),n(1402),n(1403),n(1404),n(1406),n(1407),n(1408),n(1409),n(1410),n(1411),n(1413),n(1415),n(1417),n(1418),n(1419),n(1420),n(1421),n(1422),n(1423),n(1424),n(1425),n(1426),n(1427),n(1428),n(1429),n(1430),n(1431),n(1432),n(1433),n(1434),n(1435),n(1436),n(1438),n(1439),n(1442),n(1443),n(1444),n(1446),n(1447),n(1448),n(1449),n(1450),n(1451),n(1452),n(1453),n(1454),n(1455),n(1456),n(929),n(1457),n(1458),n(1459),n(1460),n(1461),n(1462),n(1463),n(932),n(1464),n(1465),n(1466),n(1467),n(1468),n(1469),n(1470),n(1471),n(1472),n(1473),n(1474),n(1475),n(1476),n(1477),n(1478),n(1479),n(1480),n(1481),n(1482),n(1483),n(1484),n(1485),n(1486),n(1487),n(1488),n(1489),n(1491),n(1492),n(1493),n(1494),n(1495),n(1496),n(1497),n(1498),n(1499),n(1500),n(1501),n(1502),n(1503),n(1504),n(1505),n(1506),n(1507),n(1508),n(1509),n(1510),n(1511),n(1512),n(1513),n(1514),n(1515),n(1516),n(1517),n(1518),n(1519),n(1520),n(1521),n(1522),n(1523),n(1524),n(1525),n(1526),n(1527),n(1528),n(1529),n(1530),n(1533),n(940);var i=n(91),c=n.n(i),s=n(102),l=n(93),u=n(89),d=n(160),f=n(82),p=n(1),m=n.n(p),g=n(84),h=n(88),b=n(87),v=n(666),y=n(184),w=n(249),O=n(217),j=n(518),k=n(250),C=n(94),E=n(95),x=n(272),S=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;if(Object(g.a)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.displayName=void 0,a.description=void 0,a.url=void 0,a.configEditorComponent=void 0,a.stateModel=e.stateModel,a.configSchema=e.configSchema,a.displayName=e.displayName,a.description=e.description,a.url=e.url,a.configEditorComponent=e.configEditorComponent,!a.stateModel)throw new Error("no stateModel defined for connection ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema defined for connection ".concat(a.name));return a}return n}(x.a),T=0,N=new WeakMap;var A=new Map;function R(e){var t=e.abortSignalId,n=A.get(t);return n||(n=new AbortController,A.set(t,n)),n.signal}var M=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,{name:""})).pluginManager=void 0,a.name="UNKNOWN",a.pluginManager=e,a}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deserializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.signal)||("object"!==typeof(a=n)||null===a||!("abortSignalId"in a)||"number"!==typeof a.abortSignalId)){e.next=3;break}return e.abrupt("return",Object(u.a)(Object(u.a)({},t),{},{signal:R(n)}));case 3:return e.abrupt("return",Object(u.a)(Object(u.a)({},t),{},{signal:void 0}));case 4:case"end":return e.stop()}var a}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("execute method is abstract");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeReturn",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(x.a),P=n(81),F=n(128),I=n(1325),B=n(1041),L=n(1040),D=n.n(L);var V={};function W(e,t,n){var a=function(e){return"".concat(D()(e))}(n);if(!V[a]){var r=(n||{}).type;if(!r)throw new Error("could not determine adapter type from adapter config snapshot");var o=e.getAdapterType(r);if(!o)throw new Error("unknown data adapter type ".concat(r));var i=o.configSchema.create(n),c=W.bind(null,e,t),s=new o.AdapterClass(i,c);V[a]={dataAdapter:s,sessionIds:new Set([t])}}var l=V[a];return l.sessionIds.add(t),l}function q(e){var t=0,n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){var a=e.sessionId;Object.entries(V).forEach((function(e){var n=Object(f.a)(e,2),r=n[0],o=n[1];o.sessionIds.delete(a),0===o.sessionIds.size&&(t+=1,delete V[r])}))}else Object.values(V).forEach((function(t){t.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach((function(e){void 0!==e.refName&&t.dataAdapter.freeResources(e)})):console.warn(t.dataAdapter,"does not implement freeResources")}));return t}var z=n(312),H=n(132),_=n(85),U=n(139),G=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CoreGetRefNames",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.sessionId,r=n.adapterConfig,o=W(this.pluginManager,a,r),!((i=o.dataAdapter)instanceof H.BaseFeatureDataAdapter)){e.next=7;break}return e.abrupt("return",i.getRefNames(n));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),J=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CoreGetInfo",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:return n=e.sent,a=n.sessionId,r=n.adapterConfig,o=W(this.pluginManager,a,r),i=o.dataAdapter,e.abrupt("return",Object(H.isFeatureAdapter)(i)?i.getHeader(n):null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),Q=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CoreGetFeatures",e}return Object(h.a)(n,[{key:"deserializeReturn",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return new U.a(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.sessionId,r=n.adapterConfig,o=n.region,i=W(this.pluginManager,a,r),s=i.dataAdapter,!Object(H.isFeatureAdapter)(s)){e.next=11;break}return l=s.getFeatures(o),e.next=9,l.pipe(Object(B.a)()).toPromise();case 9:return u=e.sent,e.abrupt("return",u.map((function(e){return e.toJSON()})));case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),X=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CoreFreeResources",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,n+=q(t),this.pluginManager.getRendererTypes().forEach((function(e){var t=e.freeResources();t&&(n+=t)})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),Y=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CoreRender",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.pluginManager.rootModel)||void 0===n||null===(a=n.session)||void 0===a?void 0:a.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",Object(_.renameRegionsIfNeeded)(r,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,d,f,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.sessionId,r=n.adapterConfig,o=n.rendererType,i=n.renderProps,s=n.signal,a){e.next=6;break}throw new Error("must pass a unique session id");case 6:if(Object(_.checkAbortSignal)(s),l=W(this.pluginManager,a,r),(d=l.dataAdapter)instanceof H.BaseFeatureDataAdapter){e.next=10;break}throw new Error("CoreRender cannot handle this type of data adapter ".concat(d));case 10:return f=K(o,this.pluginManager.getRendererType(o)),delete(p=Object(u.a)(Object(u.a)(Object(u.a)({},n),i),{},{dataAdapter:d})).renderProps,e.next=15,f.renderInWorker(p);case 15:return m=e.sent,Object(_.checkAbortSignal)(s),e.abrupt("return",m);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M);function K(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof z.a))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var Z=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CorePlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){Object.values(a).forEach((function(t){e.addRpcMethod((function(){return new t(e)}))}))}}]),n}(F.a),$=n(948),ee=function(){function e(){Object(g.a)(this,e),this.phaseCallbacks=new Map,this.phaseOrder=[];for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];this.phaseOrder=n}return Object(h.a)(e,[{key:"add",value:function(e,t){if(!this.phaseOrder.includes(e))throw new Error("unknown phase ".concat(e));var n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}},{key:"run",value:function(){var e=this;this.phaseOrder.forEach((function(t){var n=e.phaseCallbacks.get(t);n&&n.forEach((function(e){return e()}))}))}}]),e}(),te=function(){function e(t,n){Object(g.a)(this,e),this.registeredTypes={},this.baseClass=void 0,this.typeName=void 0,this.typeName=t,this.baseClass=n}return Object(h.a)(e,[{key:"add",value:function(e,t){this.registeredTypes[e]=t}},{key:"has",value:function(e){return e in this.registeredTypes}},{key:"get",value:function(e){if(!this.has(e))throw new Error("".concat(this.typeName," '").concat(e,"' not found, perhaps its plugin is not loaded or its plugin has not added it."));return this.registeredTypes[e]}},{key:"all",value:function(){return Object.values(this.registeredTypes)}}]),e}(),ne=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(g.a)(this,e),this.plugins=[],this.jexl=Object($.a)(),this.pluginMetaData={},this.elementCreationSchedule=new ee("renderer","adapter","display","track","connection","view","widget","rpc method"),this.rendererTypes=new te("RendererType",v.a),this.adapterTypes=new te("AdapterType",y.a),this.trackTypes=new te("TrackType",w.a),this.displayTypes=new te("DisplayType",O.a),this.connectionTypes=new te("ConnectionType",S),this.viewTypes=new te("ViewType",j.a),this.widgetTypes=new te("WidgetType",k.a),this.rpcMethods=new te("RpcMethodType",M),this.configured=!1,this.rootModel=void 0,this.jbrequireCache=new Map,this.lib=I.a,this.load=function(e){return t.jbrequireCache.has(e)||t.jbrequireCache.set(e,e(t)),t.jbrequireCache.get(e)},this.jbrequire=function(e){if("string"===typeof e){var n=t.lib[e];if(!n)throw new TypeError("No jbrequire re-export defined for package '".concat(e,"'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally."));return n}if("function"===typeof e)return t.load(e);if(e.default)return t.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")},this.addPlugin({plugin:new Z,metadata:{isCore:!0}}),n.forEach((function(e){t.addPlugin(e)}))}return Object(h.a)(e,[{key:"pluginConfigurationSchemas",value:function(){var e={};return this.plugins.forEach((function(t){t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}},{key:"addPlugin",value:function(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");var t=e instanceof F.a?[e,{}]:[e.plugin,e.metadata],n=Object(f.a)(t,2),a=n[0],r=n[1];if(this.plugins.includes(a))throw new Error("plugin already installed");return this.pluginMetaData[a.name]=r,a.install(this),this.plugins.push(a),this}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"hasPlugin",value:function(e){return void 0!==this.getPlugin(e)}},{key:"createPluggableElements",value:function(){return this.elementCreationSchedule.run(),delete this.elementCreationSchedule,this}},{key:"setRootModel",value:function(e){this.rootModel=e}},{key:"configure",value:function(){var e=this;if(this.configured)throw new Error("already configured");return this.plugins.forEach((function(t){return t.configure(e)})),this.configured=!0,this}},{key:"getElementTypeRecord",value:function(e){switch(e){case"adapter":return this.adapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;default:throw new Error("invalid element type '".concat(e,"'"))}}},{key:"addElementType",value:function(e,t){var n=this;if("function"!==typeof t)throw new Error("must provide a callback function that returns the new type object");var a=this.getElementTypeRecord(e);return this.elementCreationSchedule.add(e,(function(){var r=t(n);if(!r.name)throw new Error("cannot add a ".concat(e," with no name"));if(a.has(r.name))throw new Error("".concat(e," ").concat(r.name," already registered, cannot register it again"));a.add(r.name,r)})),this}},{key:"getElementType",value:function(e,t){return this.getElementTypeRecord(e).get(t)}},{key:"getElementTypesInGroup",value:function(e){return this.getElementTypeRecord(e).all()}},{key:"pluggableMstType",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.types.maybe(b.types.null),a=[];return this.getElementTypeRecord(e).all().forEach((function(e){var n=e[t];Object(b.isType)(n)&&Object(b.isModelType)(n)&&a.push(n)})),0===a.length?(console.warn("No JBrowse pluggable types found matching ('".concat(e,"','").concat(t,"')")),n):b.types.union.apply(b.types,a)}},{key:"pluggableConfigSchemaType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"configSchema",n=[];return this.getElementTypeRecord(e).all().forEach((function(e){var a=e[t];Object(P.isBareConfigurationSchemaType)(a)&&n.push(a)})),0===n.length&&n.push(Object(P.ConfigurationSchema)("Null",{})),b.types.union.apply(b.types,n)}},{key:"getRendererType",value:function(e){return this.rendererTypes.get(e)}},{key:"getRendererTypes",value:function(){return this.rendererTypes.all()}},{key:"getAdapterType",value:function(e){return this.adapterTypes.get(e)}},{key:"getTrackType",value:function(e){return this.trackTypes.get(e)}},{key:"getDisplayType",value:function(e){return this.displayTypes.get(e)}},{key:"getViewType",value:function(e){return this.viewTypes.get(e)}},{key:"getWidgetType",value:function(e){return this.widgetTypes.get(e)}},{key:"getConnectionType",value:function(e){return this.connectionTypes.get(e)}},{key:"getRpcMethodType",value:function(e){return this.rpcMethods.get(e)}},{key:"addRendererType",value:function(e){return this.addElementType("renderer",e)}},{key:"addAdapterType",value:function(e){return this.addElementType("adapter",e)}},{key:"addTrackType",value:function(e){var t=this;return this.addElementType("track",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.trackType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addDisplayType",value:function(e){return this.addElementType("display",e)}},{key:"addViewType",value:function(e){var t=this;return this.addElementType("view",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.viewType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addWidgetType",value:function(e){return this.addElementType("widget",e)}},{key:"addConnectionType",value:function(e){return this.addElementType("connection",e)}},{key:"addRpcMethod",value:function(e){return this.addElementType("rpc method",e)}}]),e}(),ae=n(1656),re=n(86),oe=n(134),ie=n(978),ce=n.n(ie),se=n(1324),le=n(115),ue=n(126),de=(n(1669),n(1670),n(544)),fe=n.n(de),pe=n(415),me=n.n(pe);function ge(){return(ge=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l,u,d,f,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://mdvkjocq3e.execute-api.us-east-1.amazonaws.com/default/jbrowse-analytics",r=t.jbrowse.tracks.filter((function(e){return(Object(P.readConfObject)(e,"assemblyNames")||[]).length>1})).length,o=Object.keys(localStorage).filter((function(e){return e.includes("localSaved-")})).length,i=t.jbrowse,s=t.session,l=t.version,u=i.tracks,d=i.assemblies,f=i.plugins,p={ver:l,"plugins-count":(null===f||void 0===f?void 0:f.length)||0,"plugin-names":null===f||void 0===f?void 0:f.map((function(e){return e.name})).join(","),"assemblies-count":d.length,"tracks-count":u.length,"session-tracks-count":(null===s||void 0===s?void 0:s.sessionTracks.length)||0,"open-views":(null===s||void 0===s?void 0:s.views.length)||0,"synteny-tracks-count":r,"saved-sessions-count":o,"existing-session-param-type":(null===a||void 0===a?void 0:a.split("-")[0])||"none","scn-h":window.screen.height,"scn-w":window.screen.width,"win-h":window.innerHeight,"win-w":window.innerWidth,electron:"undefined"!==typeof window&&Boolean(window.electron),loadTime:(Date.now()-n)/1e3,jb2:!0},u.forEach((function(e){p["track-types-".concat(e.type)]=p["track-types-".concat(e.type)]+1||1})),null===s||void 0===s||s.sessionTracks.forEach((function(e){p["sessionTrack-types-".concat(e.type)]=p["sessionTrack-types-".concat(e.type)]+1||1})),m=Object.keys(p).map((function(e){return"".concat(e,"=").concat(p[e])})).join("&"),e.abrupt("return",fetch("".concat("https://mdvkjocq3e.execute-api.us-east-1.amazonaws.com/default/jbrowse-analytics","?").concat(m)));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return(he=Object(l.a)(c.a.mark((function e(t,n){var a,r,o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"UA-7115575-5",r={"tracks-count":t.jbrowse.tracks.length,ver:t.version,electron:"undefined"!==typeof window&&Boolean(window.electron),loadTime:Date.now()-n,pluginNames:(null===(a=t.jbrowse.plugins)||void 0===a?void 0:a.map((function(e){return e.name})))||""},o="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){",o+="(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),",o+="m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)",o+="})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');",o+="ga('create', '".concat("UA-7115575-5","', 'auto', 'jbrowseTracker');"),i={},"tracks-count ver electron loadTime pluginNames","tracks-count ver electron loadTime pluginNames".split(/\s+/).forEach((function(e,t){i["dimension".concat(t+1)]=r[e]})),i.metric1=Math.round(r.loadTime),o+="ga('jbrowseTracker.send', 'pageview',".concat(JSON.stringify(i),");"),(s=document.createElement("script")).innerHTML=o,document.getElementsByTagName("head")[0].appendChild(s);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var be=n(1671),ve=n.n(be),ye=n(1677),we=n.n(ye),Oe=n(706),je=(n(970),/^\s*function\s*\w*\s*\(([^)]*)\)\s*{([\w\W]*)/);function ke(e){return window.btoa(Array.from(window.crypto.getRandomValues(new Uint8Array(2*e))).map((function(e){return String.fromCharCode(e)})).join("")).replace(/[+/]/g,"").substring(0,e)}var Ce=function(e,t){return ve.a.encrypt(e,t).toString()},Ee=function(e,t){return ve.a.decrypt(e,t).toString(we.a)};function xe(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RegExp(je.toString().slice(2)),a=JSON.stringify(t),e.abrupt("return",n.test(a));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){try{return JSON.parse(e).message}catch(t){return e}}function Ne(e,t,n){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(Object(_.toUrlSafeB64)(JSON.stringify(t))),o=ke(5),i=Ce(r,o),(s=new FormData).append("session",i),s.append("dateShared","".concat(Date.now())),s.append("referer",a),e.next=9,fetch("".concat(n,"share"),{method:"POST",mode:"cors",body:s});case 9:if((l=e.sent).ok){e.next=15;break}return e.next=13,l.text();case 13:throw u=e.sent,new Error(Te(u));case 15:return e.next=17,l.json();case 17:return d=e.sent,e.abrupt("return",{json:d,encryptedSession:i,password:o});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e,t,n,a){return Me.apply(this,arguments)}function Me(){return(Me=Object(l.a)(c.a.mark((function e(t,n,a,r){var o,i,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.split("share-")[1],i="".concat(t,"?sessionId=").concat(o),e.next=4,fetch(i,{signal:r});case 4:if((s=e.sent).ok){e.next=10;break}return e.next=8,s.text();case 8:throw l=e.sent,new Error(Te(l));case 10:return e.next=12,s.json();case 12:return u=e.sent,e.abrupt("return",Ee(u.session,a));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pe=n(37),Fe=n(150),Ie=n(114),Be=n(385),Le=Object(P.ConfigurationSchema)("BaseFeatureWidget",{});function De(e){return b.types.model("BaseFeatureWidget",{id:Ie.ElementId,type:b.types.literal("BaseFeatureWidget"),featureData:b.types.frozen(),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var Ve,We=n(1692),qe=n.n(We),ze=Object(P.ConfigurationSchema)("BaseLinearDisplay",{maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:Number.MAX_VALUE}},{explicitIdentifier:"displayId"}),He=n(104);Ve=Symbol.iterator;var _e=function(){function e(t){Object(g.a)(this,e),this.submaps=void 0,this.submaps=t}return Object(h.a)(e,[{key:"has",value:function(e){var t,n=Object(He.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){if(t.value.has(e))return!0}}catch(a){n.e(a)}finally{n.f()}return!1}},{key:"get",value:function(e){var t,n=Object(He.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.has(e))return a.get(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"values",value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,this.get(a);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"keys",value:c.a.mark((function(){var e,t,n,a,r,o,i,s,l,u;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:e=new Set,t=Object(He.a)(this.submaps.values());try{for(t.s();!(n=t.n()).done;){a=n.value,r=Object(He.a)(a.keys());try{for(r.s();!(o=r.n()).done;)i=o.value,e.add(i)}catch(d){r.e(d)}finally{r.f()}}}catch(d){t.e(d)}finally{t.f()}s=Object(He.a)(e),c.prev=4,s.s();case 6:if((l=s.n()).done){c.next=12;break}return u=l.value,c.next=10,u;case 10:c.next=6;break;case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),s.e(c.t0);case 17:return c.prev=17,s.f(),c.finish(17);case 20:case"end":return c.stop()}}),e,this,[[4,14,17,20]])}))},{key:"find",value:function(e){var t,n=Object(He.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var a,r=t.value,o=Object(He.a)(r.values());try{for(o.s();!(a=o.n()).done;){var i=a.value;if(e(i))return i}}catch(c){o.e(c)}finally{o.f()}}}catch(c){n.e(c)}finally{n.f()}}},{key:Ve,value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,[a,this.get(a)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"entries",value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,[a,this.get(a)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))}]),e}(),Ue=n(130),Ge=n(2481),Je=n(2479),Qe=n(707),Xe=n.n(Qe),Ye=n(1678),Ke=n.n(Ye),Ze=n(51),$e=n(154),et=n(2473),tt=n(354),nt=Object(Ze.a)((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),at=Object(re.observer)((function(e){var t=e.block,n=e.children,a=nt();return m.a.createElement("div",{style:{width:"".concat(t.widthPx,"px")},className:a.contentBlock},n)}));function rt(e){var t=e.width,n=nt();return m.a.createElement("div",{className:n.elidedBlock,style:{width:"".concat(t,"px")}})}function ot(e){var t=e.boundary,n=e.width,a=e.style,r=void 0===a?{}:a,o=nt();return m.a.createElement("div",{style:Object(u.a)(Object(u.a)({},r),{},{width:"".concat(n,"px")}),className:t?o.boundaryPaddingBlock:o.interRegionPaddingBlock})}var it=Object(Ze.a)({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),ct=Object(re.observer)((function(e){var t=e.model,n=it(),a=t.blockDefinitions,r=t.blockState;return m.a.createElement(m.a.Fragment,null,a.map((function(e){if(e instanceof tt.b){var a=r.get(e.key);return m.a.createElement(at,{block:e,key:"".concat(t.id,"-").concat(e.key)},a&&a.ReactComponent?m.a.createElement(a.ReactComponent,{model:a}):null,a&&a.maxHeightReached?m.a.createElement("div",{className:n.heightOverflowed,style:{top:a.data.layout.totalHeight-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if(e instanceof tt.c)return m.a.createElement(rt,{key:"".concat(t.id,"-").concat(e.key),width:e.widthPx});if(e instanceof tt.d)return m.a.createElement(ot,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant});throw new Error("invalid block type ".concat(typeof e))})))}));var st=Object(re.observer)((function(e){var t=e.model,n=it(),a=t.blockDefinitions,r=Object(_.getContainingView)(t);return m.a.createElement("div",{"data-testid":"Blockset",className:n.linearBlocks,style:{left:a.offsetPx-r.offsetPx}},m.a.createElement(ct,{model:t}))})),lt=Object(Ze.a)({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),ut=Object(re.observer)((function(e){var t=e.model,n=e.mouseCoord,a=t.featureUnderMouse,r=a?Object(P.getConf)(t,"mouseover",{feature:a}):void 0;return r?m.a.createElement(et.a,{title:r,open:!0,placement:"right"},m.a.createElement("div",{style:{position:"absolute",left:n[0],top:n[1]}}," ")):null})),dt=Object(re.observer)((function(e){var t=lt(),n=Object($e.a)(),a=Object(p.useState)([0,0]),r=Object(f.a)(a,2),o=r[0],i=r[1],c=Object(p.useState)(),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(p.useRef)(null),g=e.model,h=e.children,b=g.TooltipComponent,v=g.DisplayMessageComponent,y=g.contextMenuItems,w=g.height,O=g.setContextMenuFeature;return m.a.createElement("div",{ref:d,"data-testid":"display-".concat(Object(P.getConf)(g,"displayId")),className:t.display,onContextMenu:function(e){e.preventDefault(),l?u(void 0):d.current&&u([e.clientX,e.clientY])},onMouseMove:function(e){if(d.current){var t=d.current.getBoundingClientRect();i([e.clientX-t.left,e.clientY-t.top])}},role:"presentation"},v?m.a.createElement(v,{model:g}):m.a.createElement(st,e),h,m.a.createElement(b,{model:g,height:w,mouseCoord:o}),m.a.createElement(ue.Menu,{open:Boolean(l)&&Boolean(y.length),onMenuItemClick:function(e,t){t(),u(void 0)},onClose:function(){u(void 0),O(void 0)},onExit:function(){u(void 0),O(void 0)},anchorReference:"anchorPosition",anchorPosition:l?{top:l[1],left:l[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:y,"data-testid":"base_linear_display_context_menu"}))})),ft=n(1679),pt=n.n(ft),mt=n(2455),gt=n(31);var ht=Object(re.observer)((function(e){var t=Object(p.useRef)(null),n=e.model,a=Object(_.getSession)(n),r=Object(ue.createJBrowseTheme)(Object(P.getConf)(a,"theme"));return Object(p.useEffect)((function(){var e=t.current;return function(){var t=n.data,a=n.html,o=n.filled,i=n.renderProps,c=n.renderingComponent;e&&o&&(e&&Object(gt.unmountComponentAtNode)(e),e.innerHTML=a,Object(_.rIC)((function(){if(Object(b.isAlive)(n)){var a=n.region;if(Object(b.isAlive)(a)){var o=Object(b.isStateTreeNode)(a)?Object(b.getSnapshot)(a):a;Object(gt.hydrate)(m.a.createElement(mt.a,{theme:r},m.a.createElement(c,Object.assign({},t,{regions:[o]},i))),e)}}}),{timeout:300}))}(),function(){e&&Object(gt.unmountComponentAtNode)(e)}}),[n,r]),m.a.createElement("div",{ref:t,"data-html-size":n.html.length,className:"ssr-container"})})),bt=Object(Ze.a)((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},blockMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),pointerEvents:"none",textAlign:"center"},blockError:{padding:e.spacing(2),width:"100%",whiteSpace:"normal",color:e.palette.error.main,overflowY:"auto"},blockReactNodeMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}}));function vt(e){var t=e.children;return m.a.createElement("div",{style:{display:"flex"}},t,t)}var yt=Object(re.observer)((function(e){var t=e.model,n=Object(p.useState)(!1),a=Object(f.a)(n,2),r=a[0],o=a[1],i=bt();Object(p.useEffect)((function(){var e=setTimeout((function(){return o(!0)}),300);return function(){return clearTimeout(e)}}),[]);var c=t.status,s=Object(b.getParent)(t,2).message||c;return r?m.a.createElement("div",{className:i.loading},m.a.createElement("div",{className:i.dots},s?"".concat(s):"Loading")):null}));function wt(e){var t=e.messageContent,n=bt();return"string"===typeof t?m.a.createElement(Je.a,{variant:"body2",className:n.blockMessage},t):m.a.createElement("div",{className:n.blockReactNodeMessage},t)}function Ot(e){var t=e.error,n=e.reload,a=e.displayHeight,r=bt();return m.a.createElement("div",{className:r.blockError,style:{height:a}},n?m.a.createElement(m.a.Fragment,null,m.a.createElement(Ge.a,{"data-testid":"reload_button",onClick:n,startIcon:m.a.createElement(pt.a,null)},"Reload"),"".concat(t)):m.a.createElement(Je.a,{color:"error",variant:"body2"},"".concat(t)))}var jt=Object(re.observer)((function(e){var t=e.model;return t.error?m.a.createElement(vt,null,m.a.createElement(Ot,{error:t.error,reload:t.reload,displayHeight:Object(Ue.getParentRenderProps)(t).displayModel.height})):t.message?m.a.createElement(vt,null,m.a.createElement(wt,{messageContent:t.message})):t.filled?m.a.createElement(ht,{model:t}):m.a.createElement(vt,null,m.a.createElement(yt,{model:t}))})),kt=b.types.model("BlockState",{key:b.types.string,region:Ie.Region,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,html:"",status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:jt,renderingComponent:void 0,renderProps:void 0}})).actions((function(e){var t;return{afterAttach:function(){var t=Object(_.getContainingDisplay)(e);Object(_.makeAbortableReaction)(e,Ct,Et,{name:"".concat(t.id,"/").concat(Object(_.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(n){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderingComponent=void 0,e.renderProps=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.html="",e.data=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderingComponent=void 0,e.renderProps=void 0,t=void 0},setRendered:function(n){if(n){var a=n.data,r=n.html,o=n.maxHeightReached,i=n.renderingComponent,c=n.renderProps;e.filled=!0,e.message=void 0,e.html=r,e.data=a,e.error=void 0,e.maxHeightReached=o,e.renderingComponent=i,e.renderProps=c,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.maxHeightReached=!1,e.error=n,e.renderingComponent=void 0,e.renderProps=void 0,t=void 0},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.data=void 0,e.html="",e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=jt,e.renderingComponent=void 0,e.renderProps=void 0,Object(b.getParent)(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var n=Object(_.getContainingDisplay)(e),a=Object(_.getSession)(e).rpcManager,r=n.rendererType,o=Ct(Object(b.cast)(e)).renderArgs;o&&r.freeResourcesInClient(a,JSON.parse(JSON.stringify(o))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function Ct(e){try{var t=Object(_.getSession)(e),n=t.assemblyManager,a=t.rpcManager,r=Object(_.getContainingDisplay)(e),o=r.adapterConfig,i=r.renderProps,c=r.rendererType,s=r.error,l=r.parentTrack,u=Object(Ue.getTrackAssemblyNames)(l),d=e.region.assemblyName;if(!u.includes(d)&&!u.find((function(e){var t;return null===(t=n.get(e))||void 0===t?void 0:t.hasName(d)})))throw new Error("region assembly (".concat(d,") does not match track assemblies (").concat(u,")"));var f=i.config;Object(P.readConfObject)(f);var p=Object(Ue.getRpcSessionId)(r);return{rendererType:c,rpcManager:a,renderProps:i,cannotBeRenderedReason:r.regionCannotBeRendered(e.region),displayError:s,renderArgs:{statusCallback:function(t){Object(b.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:o,rendererType:c.name,sessionId:p,blockKey:e.key,timeout:1e6}}}catch(m){return{displayError:m}}}function Et(e,t,n){return xt.apply(this,arguments)}function xt(){return(xt=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l,f,p,m,g,h,v;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(r=t).rendererType,i=r.renderProps,s=r.rpcManager,l=r.renderArgs,f=r.cannotBeRenderedReason,p=r.displayError,Object(b.isAlive)(a)){e.next=3;break}return e.abrupt("return",void 0);case 3:if(!p){e.next=6;break}return a.setError(p),e.abrupt("return",void 0);case 6:if(!f){e.next=9;break}return a.setMessage(f),e.abrupt("return",void 0);case 9:if(!i.notReady){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,o.renderInClient(s,Object(u.a)(Object(u.a)(Object(u.a)({},l),i),{},{signal:n}));case 13:return m=e.sent,g=m.html,h=m.maxHeightReached,v=Object(d.a)(m,["html","maxHeightReached"]),e.abrupt("return",{data:v,html:g,maxHeightReached:h,renderingComponent:o.ReactComponent,renderProps:i});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var St=b.types.compose("BaseLinearDisplay",Fe.BaseDisplay,b.types.model({height:b.types.optional(b.types.refinement("displayHeight",b.types.number,(function(e){return e>=20})),100),blockState:b.types.map(kt),userBpPerPxLimit:b.types.maybe(b.types.number)})).volatile((function(){return{message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,additionalContextMenuItemCallbacks:[],scrollTop:0}})).views((function(e){return{get maxViewBpPerPx(){return e.userBpPerPxLimit||Object(P.getConf)(e,"maxDisplayedBpPerPx")},get blockType(){return"staticBlocks"},get renderDelay(){return 50},get TooltipComponent(){return ut},get blockDefinitions(){var t=this.blockType,n=Object(_.getContainingView)(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]},get selectedFeatureId(){if(Object(b.isAlive)(e)){var t=Object(_.getSession)(e).selection;if(Object(U.b)(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){var t=!1,n={};return{get features(){var n,a=[],r=Object(He.a)(e.blockState.values());try{for(r.s();!(n=r.n()).done;){var o=n.value;o.data&&o.data.features&&a.push(o.data.features)}}catch(i){r.e(i)}finally{r.f()}return t=!0,new _e(a)},get featureUnderMouse(){return e.featureIdUnderMouse?this.features.get(e.featureIdUnderMouse):void 0},get blockLayoutFeatures(){var n,a=new Map,r=Object(He.a)(e.blockState.values());try{for(r.s();!(n=r.n()).done;){var o=n.value;o.data&&o.data.layout&&o.data.layout.rectangles&&a.set(o.key,o.data.layout.rectangles)}}catch(i){r.e(i)}finally{r.f()}return t=!0,a},get layoutFeatures(){var n,a=[],r=Object(He.a)(e.blockState.values());try{for(r.s();!(n=r.n()).done;){var o=n.value;o.data&&o.data.layout&&o.data.layout.rectangles&&a.push(o.data.layout.rectangles)}}catch(i){r.e(i)}finally{r.f()}return t=!0,new _e(a)},get rtree(){if(t){n={};var e,a=Object(He.a)(this.blockLayoutFeatures);try{for(a.s();!(e=a.n()).done;){var r=Object(f.a)(e.value,2),o=r[0],i=r[1];n[o]=new Ke.a;var c,s=n[o],l=Object(He.a)(i);try{for(l.s();!(c=l.n()).done;){var u=Object(f.a)(c.value,2),d=u[0],p=u[1];s.insert({minX:p[0],minY:p[1],maxX:p[2],maxY:p[3],name:d})}}catch(m){l.e(m)}finally{l.f()}}}catch(m){a.e(m)}finally{a.f()}t=!1}return n},getFeatureOverlapping:function(e,t,n){var a={minX:t,minY:n,maxX:t+1,maxY:n+1},r=this.rtree[e];return r&&r.collides(a)?r.search(a):[]}}})).actions((function(e){return{afterAttach:function(){var t=this,n=Object(le.autorun)((function(){var n={};Object(_.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(a){n[a.key]=!0,e.blockState.has(a.key)||t.addBlock(a.key,a)})),e.blockState.forEach((function(e,a){n[a]||t.deleteBlock(a)})))}));Object(b.addDisposer)(e,n)},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},setScrollTop:function(t){e.scrollTop=t},setUserBpPerPxLimit:function(t){e.userBpPerPxLimit=t},setMessage:function(t){e.message=t},addBlock:function(t,n){e.blockState.set(t,kt.create({key:t,region:n.toRegion()}))},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var n=Object(_.getSession)(e);if(Object(_.isSessionModelWithWidgets)(n)){var a=n.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:Object(_.getContainingView)(e)});n.showWidget(a)}Object(_.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection:function(){Object(_.getSession)(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){var t=JSON.parse(JSON.stringify(e.blockState));Object.keys(t).forEach((function(e){t[e].key+="-reload"})),e.blockState=t},addAdditionalContextMenuItemCallback:function(t){e.additionalContextMenuItemCallbacks.push(t)},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{regionCannotBeRendered:function(){var t=Object(_.getContainingView)(e);if(t&&t.bpPerPx>e.maxViewBpPerPx)return m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{component:"span",variant:"body2"},"Zoom in to see features or"," "),m.a.createElement(Ge.a,{"data-testid":"reload_button",onClick:function(){e.setUserBpPerPxLimit(t.bpPerPx),e.reload()},variant:"outlined"},"Force Load"),m.a.createElement(Je.a,{component:"span",variant:"body2"},"(force load may be slow)"))},get trackMenuItems(){return[]},get composedTrackMenuItems(){return[]},get contextMenuItems(){var t=Object(b.getEnv)(e).pluginManager,n=e.contextMenuFeature?[{label:"Open feature details",icon:Xe.a,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[];return e.additionalContextMenuItemCallbacks.forEach((function(a){var r=a(e.contextMenuFeature,e,t);n.push.apply(n,Object(s.a)(r))})),n},get composedRenderProps(){return Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),{},{displayModel:e,onFeatureClick:function(t,n){var a=n||e.featureIdUnderMouse;if(a){var r=e.features.get(a);e.selectFeature(r)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){var a=n||e.featureIdUnderMouse;a?e.setContextMenuFeature(e.features.get(a)):e.clearFeatureSelection()},onMouseMove:function(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})},get renderProps(){return this.composedRenderProps}}})).postProcessSnapshot((function(e){e.blockState;return Object(d.a)(e,["blockState"])}));var Tt=n(387);function Nt(e){return b.types.compose("LinearBareDisplay",St,b.types.model({type:b.types.literal("LinearBareDisplay"),configuration:Object(Tt.a)(e)})).views((function(e){return{get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(Ue.getParentRenderProps)(e)),{},{config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var At=n(693),Rt=n(994),Mt=n(981);function Pt(e){return m.a.createElement(Mt.a,e,m.a.createElement("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}))}function Ft(e){return m.a.createElement(Mt.a,e,m.a.createElement("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"}))}var It=n(1690),Bt=n.n(It),Lt=n(709),Dt=n.n(Lt),Vt=n(1691),Wt=n.n(Vt),qt=n(547),zt=n.n(qt),Ht=n(1680),_t=n.n(Ht),Ut=n(430),Gt=n(2505),Jt=n(2508),Qt=n(2471),Xt=n(2491),Yt=n(2509),Kt=n(2511),Zt=n(171),$t=n.n(Zt),en=Object(Ze.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));var tn=Object(re.observer)((function(e){var t=e.model,n=e.handleClose,a=en();return m.a.createElement(Gt.a,{maxWidth:"xl",open:!0,onClose:n},m.a.createElement(Jt.a,null,"Reference sequence",n?m.a.createElement(Qt.a,{className:a.closeButton,onClick:function(){n()}},m.a.createElement($t.a,null)):null),m.a.createElement(Xt.a,null),m.a.createElement(Yt.a,null,"Are you sure you want to return to the import form? This will lose your current view"),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){t.clearView(),n()},variant:"contained",color:"primary",autoFocus:!0},"OK"),m.a.createElement(Ge.a,{onClick:function(){n()},color:"secondary",variant:"contained",autoFocus:!0},"Cancel")))})),nn=n(2467),an=n(209),rn=n(2516),on=n(1683),cn=n.n(on),sn=n(1682),ln=n.n(sn),un=n(63),dn=n(2456),fn=n(1681),pn=n.n(fn),mn=n(2518),gn=n(1652),hn=n(1329),bn=Object(gn.a)({trim:!0,limit:36});var vn=Object(re.observer)((function(e){var t=e.model,n=e.onSelect,a=e.assemblyName,r=e.style,o=e.value,i=e.TextFieldProps,c=void 0===i?{}:i,s=Object(_.getSession)(t).assemblyManager,l=a&&s.get(a),d=l&&l.regions||[],f=t.coarseVisibleLocStrings,g=0!==d.length,h=Object(p.useMemo)((function(){return d.map((function(e){return{type:"reference sequence",value:e.refName}}))}),[d]);return m.a.createElement(hn.a,{id:"refNameAutocomplete-".concat(t.id),"data-testid":"autocomplete",disabled:!a||!g,disableListWrap:!0,disableClearable:!0,freeSolo:!0,includeInputInList:!0,clearOnBlur:!0,loading:g,selectOnFocus:!0,style:r,value:f||o||"",options:h,groupBy:function(e){return String(e.type)},filterOptions:function(e,t){var n=bn(e,t);if(""!==t.inputValue){var a={type:"Search",inputValue:t.inputValue,value:t.inputValue};n.push(a)}return n},ListboxProps:{style:{maxHeight:250}},onChange:function(e,t){!function(e){var t;e&&("object"===typeof e&&(t=e.inputValue||e.value),"string"===typeof e&&(t=e),n(t))}(t)},renderInput:function(e){var t=c.helperText,n=c.InputProps,a=void 0===n?{}:n,r=Object(u.a)(Object(u.a)(Object(u.a)({},e.InputProps),a),{},{endAdornment:m.a.createElement(m.a.Fragment,null,g?m.a.createElement(mn.a,{position:"end",style:{marginRight:7}},m.a.createElement(pn.a,null)):m.a.createElement(un.a,{color:"inherit",size:20}),e.InputProps.endAdornment)});return m.a.createElement(dn.a,Object.assign({},e,c,{helperText:t,value:f||o||"",InputProps:r,placeholder:"Search for location"}))},renderOption:function(e){return m.a.createElement(Je.a,{noWrap:!0},e.value)},getOptionLabel:function(e){return"string"===typeof e?e:e.inputValue?e.inputValue:e.value}})})),yn=n(2519),wn=n(26);function On(e,t,n){for(var a=t*(e=Math.abs(e)),r=parseInt(Number(a).toExponential().split(/e/i)[1],10),o=Math.pow(10,r);o<a&&!((o*=2)>=a);)o*=2.5;var i=(o=Math.max(o,5))/e,c=0;return!(o%10)&&i/10>=n?c=o/10:!(o%5)&&i/5>=n?c=o/5:!(o%2)&&i/2>=n&&(c=o/2),{majorPitch:o,minorPitch:c}}function jn(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=On(n,60,15),i=e,c=t;if(null===i||null===c)return[];if(n<0){var s=[c,i];i=s[0],c=s[1]}i-=Math.abs(20*n)-1,c+=Math.abs(20*n)+1;for(var l=o.minorPitch||o.majorPitch,u=0,d=[],f=Math.ceil(i/l)*l;f<c;f+=l)r&&f%o.majorPitch?(d.push({type:"minor",base:f-1,index:u}),u+=1):!a||f%(2*o.majorPitch)?a&&(d.push({type:"major",base:f-1,index:u}),u+=1):(d.push({type:"labeledMajor",base:f-1,index:u}),u+=1);return d}var kn=n(2463),Cn=Object(Ze.a)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?Object(an.fade)(e.palette.tertiary.main,.7):Object(an.fade)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}}));function En(e){var t=e.model,n=e.overview,a=e.ControlComponent,r=void 0===a?m.a.createElement("div",null):a,o=Object(p.useState)(),i=Object(f.a)(o,2),c=i[0],s=i[1],l=Object(p.useState)(),u=Object(f.a)(l,2),d=u[0],g=u[1],h=Object(p.useState)(),b=Object(f.a)(h,2),v=b[0],y=b[1],w=Object(p.useRef)(null),O=Object(p.useRef)(null),j=Cn(),k=void 0!==c;function C(e){e.preventDefault(),e.stopPropagation(),w.current&&s(e.clientX-w.current.getBoundingClientRect().left)}function E(e){w.current&&y(e.clientX-w.current.getBoundingClientRect().left)}function x(){y(void 0)}if(Object(p.useEffect)((function(){function e(e){if(w.current&&k){var t=e.clientX-w.current.getBoundingClientRect().left;g(t)}}function a(){if(w.current&&void 0!==c&&void 0!==d&&Math.abs(d-c)>3&&t.zoomToDisplayedRegions(n.pxToBp(c),n.pxToBp(d)),w.current&&void 0!==c&&void 0===d){var e=n.pxToBp(c);t.centerAt(Math.round(e.coord),e.refName,e.index)}s(void 0),g(void 0),void 0!==c&&y(void 0)}function r(e){"Escape"===e.key&&(s(void 0),g(void 0))}return k?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",a,!0),window.addEventListener("keydown",r,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",a,!0),window.removeEventListener("keydown",r,!0)}):function(){}}),[k,d,c,t,n]),void 0===c)return m.a.createElement("div",{style:{position:"relative"}},void 0!==v?m.a.createElement(et.a,{open:!k,placement:"top",title:Object(_.stringify)(n.pxToBp(v)),arrow:!0},m.a.createElement("div",{className:j.guide,style:{left:v}})):null,m.a.createElement("div",{className:j.rubberBandControl,role:"presentation",ref:w,onMouseDown:C,onMouseOut:x,onMouseMove:E},r));var S,T,N=c||0,A=0;if(void 0!==c&&void 0!==d&&(N=d<c?d:c,A=d-c),c&&(S=n.pxToBp(c),T=n.pxToBp(c+A),d&&d<c)){var R=[T,S];S=R[0],T=R[1]}return m.a.createElement("div",{style:{position:"relative"}},O.current?m.a.createElement(m.a.Fragment,null,m.a.createElement(kn.a,{className:j.popover,classes:{paper:j.paper},open:!0,anchorEl:O.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},m.a.createElement(Je.a,null,S?Object(_.stringify)(S):"")),m.a.createElement(kn.a,{className:j.popover,classes:{paper:j.paper},open:!0,anchorEl:O.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},m.a.createElement(Je.a,null,T?Object(_.stringify)(T):""))):null,m.a.createElement("div",{ref:O,className:j.rubberBand,style:{left:N,width:Math.abs(A),height:Ka}}),m.a.createElement("div",{"data-testid":"rubberBand_controls",className:j.rubberBandControl,role:"presentation",ref:w,onMouseDown:C,onMouseOut:x,onMouseMove:E},r))}En.defaultProps={ControlComponent:m.a.createElement("div",null)};var xn=Object(re.observer)(En),Sn=Object(Ze.a)((function(e){var t=e.palette.tertiary?e.palette.tertiary.light:e.palette.primary.light;return{scaleBar:{width:"100%",height:Ka,overflow:"hidden"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:Ka,border:"1px solid",borderBottomColor:"black"},scaleBarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarRegionIncompleteLeft:{width:10,height:17.5,background:"linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopLeftRadius:"2px",borderBottomLeftRadius:"2px",float:"left"},scaleBarRegionIncompleteRight:{width:10,height:17.5,background:"linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopRightRadius:"2px",borderBottomRightRadius:"2px",float:"right"},scaleBarRefName:{position:"absolute",fontWeight:"bold",lineHeight:"normal",pointerEvents:"none",left:5},scaleBarLabel:{height:Ka,width:1,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{background:Object(an.fade)(t,.3),position:"absolute",height:Ka,pointerEvents:"none",top:-1,zIndex:100,borderWidth:1,borderStyle:"solid",borderColor:Object(an.fade)(t,.8),boxSizing:"content-box"},overview:{height:Ya,position:"relative"},overviewSvg:{position:"absolute"}}})),Tn=Object(re.observer)((function(e){var t=e.model,n=e.overview,a=Object($e.a)(),r=Sn(),o=t.offsetPx,i=t.dynamicBlocks,c=i.contentBlocks,s=i.totalWidthPxWithoutBorders,l=a.palette.tertiary?a.palette.tertiary.light:a.palette.primary.light;if(!c.length)return null;var u=c[0],d=c[c.length-1],f=n.bpToPx({refName:u.refName,coord:u.reversed?u.end:u.start,regionNumber:u.regionNumber}),p=n.bpToPx({refName:d.refName,coord:d.reversed?d.start:d.end,regionNumber:d.regionNumber}),g=Math.max(0,-o),h=g+s+c.length*t.interRegionPaddingWidth/2,b=[[g,Ya],[h,Ya],[p,0],[f,0]];return m.a.createElement("svg",{height:Ya,width:"100%",className:r.overviewSvg},b&&m.a.createElement("polygon",{points:b.toString(),fill:Object(an.fade)(l,.3),stroke:Object(an.fade)(l,.8)}))})),Nn=Object(re.observer)((function(e){var t=e.model,n=e.scale,a=e.overview,r=Sn(),o=t.dynamicBlocks,i=Object(_.getSession)(t).assemblyManager,c=On(n,120,15),s=a.dynamicBlocks;if(!o.contentBlocks.length)return null;var l=o.contentBlocks[0],u=a.bpToPx({refName:l.refName,regionNumber:l.regionNumber,coord:l.reversed?l.end:l.start})||0,d=o.contentBlocks[o.contentBlocks.length-1],f=a.bpToPx({refName:d.refName,coord:d.reversed?d.start:d.end,regionNumber:d.regionNumber})||0;return m.a.createElement("div",{className:r.scaleBar},m.a.createElement("div",{className:r.scaleBarVisibleRegion,style:{width:f-u,left:u}}),s.map((function(e,t){var a,o=i.get(e.assemblyName);o&&(a=o.getRefNameColor(e.refName));for(var s=e.end-e.start,l=[],u=0;u<Math.floor(s/c.majorPitch);u++){var d=(u+1)*c.majorPitch;l.push(e.reversed?e.end-d:e.start+d)}return e instanceof tt.b?m.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:Object(wn.a)(r.scaleBarContig,e.reversed?r.scaleBarContigReverse:r.scaleBarContigForward),style:{left:e.offsetPx,width:e.widthPx,borderColor:a}},m.a.createElement(Je.a,{style:{color:a},className:r.scaleBarRefName},e.refName),l.map((function(t,o){return m.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t,"-").concat(o),className:r.scaleBarLabel,style:{left:(o+1)*c.majorPitch/n,pointerEvents:"none",color:a}},t.toLocaleString("en-US"))}))):m.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:r.scaleBarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}})})))}));var An=Object(re.observer)((function(e){var t=e.model,n=e.children,a=Sn(),r=t.width,o=t.displayedRegions,i=Ut.a.create({displayedRegions:JSON.parse(JSON.stringify(o)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth});i.setVolatileWidth(r),i.showAllRegions();var c=t.totalBp/(r-2*(o.length-1));return o.length?m.a.createElement("div",null,m.a.createElement(xn,{model:t,overview:i,ControlComponent:m.a.createElement(Nn,{model:t,overview:i,scale:c})}),m.a.createElement("div",{className:a.overview},m.a.createElement(Tn,{model:t,overview:i}),n)):m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:a.scaleBar},m.a.createElement(yn.a,{variant:"indeterminate",style:{marginTop:4,width:"100%"}})),m.a.createElement("div",null,n))})),Rn=n(2547),Mn=n(439),Pn=n.n(Mn),Fn=n(545),In=n.n(Fn),Bn=Object(Ze.a)({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});var Ln=Object(re.observer)((function(e){var t=e.model,n=Bn(),a=t.maxBpPerPx,r=t.minBpPerPx,o=t.bpPerPx,i=t.scaleFactor,c=Object(p.useState)(100*-Math.log2(o)),s=Object(f.a)(c,2),l=s[0],u=s[1];return Object(p.useEffect)((function(){u(100*-Math.log2(o))}),[u,o]),m.a.createElement("div",{className:n.container},m.a.createElement(Qt.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*o)},disabled:o>=a-1e-4||1!==i,color:"secondary"},m.a.createElement(In.a,null)),m.a.createElement(Rn.a,{className:n.slider,value:l,min:100*-Math.log2(a),max:100*-Math.log2(r),onChange:function(e,t){return u(t)},onChangeCommitted:function(){return t.zoomTo(Math.pow(2,-l/100))},disabled:1!==i}),m.a.createElement(Qt.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:o<=r+1e-4||1!==i,color:"secondary"},m.a.createElement(Pn.a,null)))})),Dn=Object(Ze.a)((function(e){return{headerBar:{height:Ya,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},input:{},headerRefName:{minWidth:100},panButton:{background:Object(an.fade)(e.palette.background.paper,.8),height:32,margin:7},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),Vn=Object(re.observer)((function(e){var t=e.model,n=Dn();return m.a.createElement(Ge.a,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",color:"secondary"},m.a.createElement(Ft,{className:n.buttonSpacer}))}));function Wn(e){var t=e.model,n=Dn();return m.a.createElement(m.a.Fragment,null,m.a.createElement(Ge.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)}},m.a.createElement(ln.a,null)),m.a.createElement(Ge.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)}},m.a.createElement(cn.a,null)))}var qn=Object(re.observer)((function(e){var t=e.model,n=Dn(),a=Object($e.a)(),r=Object(_.getSession)(t),o=t.coarseDynamicBlocks,i=t.displayedRegions,c=Object(p.useCallback)((function(e){try{if(e){var n=t.displayedRegions.find((function(t){return e===t.refName}));n?(t.setDisplayedRegions([n]),t.showAllRegions()):e&&t.navToLocString(e)}}catch(a){console.warn(a),r.notify("".concat(a),"warning")}}),[t,r]),s=o[0]||{refName:""},l=s.assemblyName,u=s.refName,d=m.a.createElement("div",{className:n.headerBar},m.a.createElement(Vn,{model:t}),m.a.createElement("div",{className:n.spacer}),m.a.createElement(rn.a,{row:!0,className:n.headerForm},m.a.createElement(Wn,{model:t}),m.a.createElement(vn,{onSelect:c,assemblyName:l,value:i.length>1?"":u,model:t,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:7,minWidth:"175px"},InputProps:{style:{padding:0,height:32,background:Object(an.fade)(a.palette.background.paper,.8)}}}})),m.a.createElement(zn,{model:t}),m.a.createElement(Ln,{model:t}),m.a.createElement("div",{className:n.spacer}));return t.hideHeaderOverview?d:m.a.createElement(An,{model:t},d)})),zn=Object(re.observer)((function(e){var t=e.model,n=Dn(),a=t.coarseTotalBp;return m.a.createElement(Je.a,{variant:"body2",color:"textSecondary",className:n.bp},"".concat(Math.round(a).toLocaleString("en-US")," bp"))})),Hn=n(695),_n=n.n(Hn),Un=n(1684),Gn=n.n(Un),Jn=Object(Ze.a)((function(e){return{root:{background:Object(an.fade)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),Qn=m.a.forwardRef((function(e,t){var n=Jn(),a=m.a.useState(null),r=Object(f.a)(a,2),o=r[0],i=r[1],c=e.track,l=e.className,u=Object(_.getContainingView)(c),d=Object(_.getSession)(c),p=c.configuration,g=Object(P.getConf)(c,"trackId"),h=function(){i(null)},b=Object(P.getConf)(c,"name");return"ReferenceSequenceTrack"===Object(P.getConf)(c,"type")&&(b="Reference Sequence",d.assemblies.forEach((function(e){e.sequence===p&&(b="Reference Sequence (".concat(Object(P.readConfObject)(e,"name"),")"))}))),m.a.createElement(m.a.Fragment,null,m.a.createElement(nn.a,{ref:t,className:Object(wn.a)(l,n.root)},m.a.createElement("span",{draggable:!0,className:n.dragHandle,onDragStart:function(e){var t=e.target;t.parentNode&&(e.dataTransfer.setDragImage(t.parentNode,20,20),u.setDraggingTrackId(c.id))},onDragEnd:function(){u.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(u.id,"-").concat(g)},m.a.createElement(Gn.a,{className:n.dragHandleIcon})),m.a.createElement(Qt.a,{onClick:function(){return u.hideTrack(g)},className:n.iconButton,title:"close this track",color:"secondary"},m.a.createElement($t.a,null)),m.a.createElement(Je.a,{variant:"body1",component:"span",className:n.trackName},b),m.a.createElement(Qt.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)},className:n.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!c.trackMenuItems.length},m.a.createElement(_n.a,null))),m.a.createElement(ue.Menu,{anchorEl:o,onMenuItemClick:function(e,t){t(),h()},open:Boolean(o),onClose:h,menuItems:[].concat(Object(s.a)(d.getTrackActionMenuItems?d.getTrackActionMenuItems(p):[]),Object(s.a)(c.trackMenuItems)).sort((function(e,t){return(t.priority||0)-(e.priority||0)}))}))})),Xn=Object(re.observer)(Qn),Yn=Object(Ze.a)((function(e){return{root:{},resizeHandle:{height:$a,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3,borderRadius:e.shape.borderRadius},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabel:{zIndex:3,margin:e.spacing(1)},trackLabelInline:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2,boxSizing:"content-box"}}}));var Kn=Object(re.observer)((function(e){var t=Yn(),n=e.model,a=e.track,r=a.displays[0],o=n.horizontalScroll,i=n.draggingTrackId,c=n.moveTrack,s=r.height,l=Object(_.getContainingView)(r),u=Object(P.getConf)(a,"trackId"),d=Object(p.useRef)(null);Object(p.useEffect)((function(){return d.current&&(n.trackRefs[u]=d.current),function(){delete n.trackRefs[u]}}),[n.trackRefs,u]);var f=Object(_.useDebouncedCallback)((function(){void 0!==i&&Object(b.isAlive)(r)&&i!==r.id&&c(i,a.id)}),100),g=r.RenderingComponent,h=r.DisplayBlurb,v=void 0!==i&&i!==r.id;return m.a.createElement("div",{className:t.root},"hidden"!==l.trackLabels?m.a.createElement(Xn,{track:a,className:Object(wn.a)(t.trackLabel,"overlapping"===l.trackLabels?t.trackLabelOverlap:t.trackLabelInline)}):null,m.a.createElement(nn.a,{variant:"outlined",className:t.trackRenderingContainer,style:{height:s},onScroll:function(e){var t=e.target;r.setScrollTop(t.scrollTop)},onDragEnter:f,"data-testid":"trackRenderingContainer-".concat(l.id,"-").concat(u),role:"presentation"},m.a.createElement("div",{ref:d,className:t.renderingComponentContainer,style:{transform:"scaleX(".concat(n.scaleFactor,")")}},m.a.createElement(g,{model:r,blockState:{},onHorizontalScroll:o})),h?m.a.createElement("div",{style:{position:"absolute",left:0,top:r.height-20}}," ",m.a.createElement(h,{model:r})):null),m.a.createElement("div",{className:t.overlay,style:{height:r.height,background:v?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:f}),m.a.createElement(ue.ResizeHandle,{onDrag:r.resizeHeight,className:t.resizeHandle}))})),Zn=n(1044),$n=n.n(Zn),ea=Object(Ze.a)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?Object(an.fade)(e.palette.tertiary.main,.7):Object(an.fade)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),ta=Object(re.observer)((function(e){var t=e.model,n=e.coordX,a=ea();return m.a.createElement(et.a,{open:!0,placement:"top",title:Object(_.stringify)(t.pxToBp(n)),arrow:!0},m.a.createElement("div",{className:a.guide,style:{left:n,background:"red"}}))}));function na(e){var t=e.model,n=e.ControlComponent,a=void 0===n?m.a.createElement("div",null):n,r=Object(p.useState)(),o=Object(f.a)(r,2),i=o[0],c=o[1],s=Object(p.useState)(),l=Object(f.a)(s,2),u=l[0],d=l[1],g=Object(p.useState)(),h=Object(f.a)(g,2),b=h[0],v=h[1],y=Object(p.useState)(),w=Object(f.a)(y,2),O=w[0],j=w[1],k=Object(p.useRef)(null),C=Object(p.useRef)(null),E=ea(),x=void 0!==i&&void 0===b;function S(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-e.target.getBoundingClientRect().left;c(t),d(t)}function T(e){var t=e.target;j(e.clientX-t.getBoundingClientRect().left)}function N(){j(void 0),t.setOffsets(void 0,void 0)}function A(){v(void 0),c(void 0),d(void 0)}Object(p.useEffect)((function(){function e(e){if(k.current&&x){var t=e.clientX-k.current.getBoundingClientRect().left;d(t)}}function t(e){if(void 0!==i&&k.current){var t=e.clientX,n=e.clientY,a=t-k.current.getBoundingClientRect().left;v({offsetX:a,clientX:t,clientY:n}),j(void 0)}}return x?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[i,x,b]),Object(p.useEffect)((function(){!x&&void 0!==u&&void 0!==i&&Math.abs(u-i)<=3&&A()}),[x,u,i,t.bpPerPx]);var R=Boolean(b);var M=[{label:"Zoom to region",icon:Pn.a,onClick:function(){!function(){if(void 0!==i&&void 0!==b){var e=i,n=b.offsetX;if(n<e){var a=[n,e];e=a[0],n=a[1]}var r=t.pxToBp(e),o=t.pxToBp(n);t.moveTo(r,o)}}(),A()}},{label:"Get sequence",disabled:void 0!==u&&void 0!==i&&Math.abs(u-i)*t.bpPerPx>5e8,icon:Xe.a,onClick:function(){!function(){if(void 0!==i&&void 0!==b){var e=i,n=b.offsetX;if(n<e){var a=[n,e];e=a[0],n=a[1]}var r=t.pxToBp(e),o=t.pxToBp(n);t.setOffsets(r,o)}}(),A()}}];if(void 0===i)return m.a.createElement(m.a.Fragment,null,void 0!==O?m.a.createElement(ta,{model:t,coordX:O}):null,m.a.createElement("div",{"data-testid":"rubberBand_controls",className:E.rubberBandControl,role:"presentation",ref:k,onMouseDown:S,onMouseOut:N,onMouseMove:T},a));var P=b?b.offsetX:u||0,F=P<i?P:i,I=Math.abs(P-i),B=t.pxToBp(F),L=t.pxToBp(F+I),D=Math.ceil(I*t.bpPerPx);return m.a.createElement(m.a.Fragment,null,C.current?m.a.createElement(m.a.Fragment,null,m.a.createElement(kn.a,{className:E.popover,classes:{paper:E.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},m.a.createElement(Je.a,null,Object(_.stringify)(B))),m.a.createElement(kn.a,{className:E.popover,classes:{paper:E.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},m.a.createElement(Je.a,null,Object(_.stringify)(L)))):null,m.a.createElement("div",{ref:C,className:E.rubberBand,style:{left:F,width:I}},m.a.createElement(Je.a,{variant:"h6",className:E.rubberBandText},D.toLocaleString("en-US")," bp")),m.a.createElement("div",{"data-testid":"rubberBand_controls",className:E.rubberBandControl,role:"presentation",ref:k,onMouseDown:S,onMouseOut:N,onMouseMove:T},a),b?m.a.createElement(ue.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:b.clientX,top:b.clientY},onMenuItemClick:function(e,t){t(),A()},open:R,onClose:A,menuItems:M}):null)}na.defaultProps={ControlComponent:m.a.createElement("div",null)};var aa=Object(re.observer)(na),ra=Object(Ze.a)((function(e){return{scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),oa=Object(re.observer)((function(e){var t=e.model,n=ra(),a=0;return t.staticBlocks.forEach((function(e,n){e.offsetPx-t.offsetPx<0&&(a=n)})),m.a.createElement(m.a.Fragment,null,t.staticBlocks.map((function(e,r){return e instanceof tt.b&&(e.isLeftEndOfDisplayedRegion||r===a)?m.a.createElement(Je.a,{key:"refLabel-".concat(e.key,"-").concat(r),style:{left:r===a?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:r===a?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName)},e.refName):null})))})),ia=Object(re.observer)((function(e){var t=e.model,n=ra();return m.a.createElement(m.a.Fragment,null,t.staticBlocks.map((function(e,a){if(e instanceof tt.b){var r=jn(e.start,e.end,t.bpPerPx,!0,!1);return m.a.createElement(at,{key:"".concat(e.key,"-").concat(a),block:e},r.map((function(a){if("labeledMajor"===a.type){var r=(e.reversed?e.end-a.base:a.base-e.start)/t.bpPerPx,o=(a.base+1).toLocaleString("en-US");return m.a.createElement("div",{key:a.base,className:n.tick,style:{left:r}},o?m.a.createElement(Je.a,{className:n.majorTickLabel},o):null)}return null})))}return e instanceof tt.c?m.a.createElement(rt,{key:e.key,width:e.widthPx}):e instanceof tt.d?m.a.createElement(ot,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),ca=m.a.forwardRef((function(e,t){var n=e.model,a=e.style,r=e.className,o=Object(d.a)(e,["model","style","className"]),i=ra(),c=n.staticBlocks.offsetPx-n.offsetPx;return m.a.createElement(nn.a,Object.assign({"data-resizer":"true",className:Object(wn.a)(i.scaleBarContainer,r),variant:"outlined",ref:t,style:a},o),m.a.createElement("div",{className:i.scaleBarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0}},m.a.createElement("div",{className:i.scaleBar,style:Object(u.a)({left:c-1,width:n.staticBlocks.totalWidthPx},a)},m.a.createElement(ia,{model:n}))),m.a.createElement(oa,{model:n}))})),sa=Object(re.observer)(ca),la=Object(Ze.a)((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.hint},minorTick:{background:e.palette.divider}}})),ua=Object(re.observer)((function(e){var t=e.model,n=la();return m.a.createElement(m.a.Fragment,null,t.staticBlocks.map((function(e,a){if(e instanceof tt.b){var r=jn(e.start,e.end,t.bpPerPx);return m.a.createElement(at,{key:"".concat(e.key,"-").concat(a),block:e},r.map((function(a){var r=(e.reversed?e.end-a.base:a.base-e.start)/t.bpPerPx;return m.a.createElement("div",{key:a.base,className:Object(wn.a)(n.tick,"major"===a.type||"labeledMajor"===a.type?n.majorTick:n.minorTick),style:{left:r}})})))}return e instanceof tt.c?m.a.createElement(rt,{key:e.key,width:e.widthPx}):e instanceof tt.d?m.a.createElement(ot,{key:e.key,width:e.widthPx,boundary:"boundary"===e.variant}):null})))}));var da=Object(re.observer)((function(e){var t=e.model,n=la(),a=t.staticBlocks.offsetPx-t.offsetPx;return m.a.createElement("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0}},m.a.createElement("div",{className:n.verticalGuidesContainer,style:{left:a,width:t.staticBlocks.totalWidthPx}},m.a.createElement(ua,{model:t})))})),fa=Object(Ze.a)((function(){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));var pa=Object(re.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.centerLineInfo,r=t.trackHeights,o=t.tracks,i=t.width,c=Object(p.useRef)(null),s=fa(),l=i/2;return o.length?m.a.createElement("div",{"data-testid":"centerline_container",className:s.centerLineContainer,role:"presentation",ref:c,style:{left:"".concat(l,"px"),width:Math.max(1/n,1)}},a&&m.a.createElement("div",{"data-testid":"centerline_text",className:s.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:r}},a.refName,":"," ",Math.max(Math.round(a.offset)+1,0))):null})),ma=Object(Ze.a)((function(e){return{tracksContainer:{position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden"},spacer:{position:"relative",height:$a}}}));var ga=Object(re.observer)((function(e){var t=e.children,n=e.model,a=ma(),r=Object(p.useRef)(0),o=Object(p.useRef)(!1),i=Object(p.useRef)(),c=Object(p.useRef)(null),s=Object(p.useRef)(0),l=Object(p.useState)(!1),u=Object(f.a)(l,2),d=u[0],g=u[1];return Object(p.useEffect)((function(){var e=function(){};function t(e){e.preventDefault();var t=e.clientX-s.current;t&&(o.current||(o.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(-t),o.current=!1,s.current=e.clientX}))))}function a(){s.current=0,d&&g(!1)}return d&&(window.addEventListener("mousemove",t,!0),window.addEventListener("mouseup",a,!0),e=function(){window.removeEventListener("mousemove",t,!0),window.removeEventListener("mouseup",a,!0)}),e}),[n,d,s]),Object(p.useEffect)((function(){var e=c.current;function t(e){var t=$n()(e);!0===e.ctrlKey?(e.preventDefault(),r.current+=t.pixelY/500,n.setScaleFactor(r.current<0?1-r.current:1/(1+r.current)),i.current&&clearTimeout(i.current),i.current=setTimeout((function(){n.setScaleFactor(1),n.zoomTo(r.current>0?n.bpPerPx*(1+r.current):n.bpPerPx/(1-r.current)),r.current=0}),300)):(Math.abs(t.pixelX)>Math.abs(2*t.pixelY)&&e.preventDefault(),r.current+=t.pixelX,o.current||(o.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(r.current),r.current=0,o.current=!1}))))}return e?(e.addEventListener("wheel",t),function(){e.removeEventListener("wheel",t)}):function(){}}),[n]),m.a.createElement("div",{ref:c,role:"presentation",className:a.tracksContainer,onMouseDown:function(e){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(e.preventDefault(),s.current=e.clientX,g(!0))},onMouseUp:function(e){e.preventDefault(),g(!1)},onMouseLeave:function(e){e.preventDefault()}},m.a.createElement(da,{model:n}),n.showCenterLine?m.a.createElement(pa,{model:n}):null,m.a.createElement(aa,{model:n,ControlComponent:m.a.createElement(sa,{model:n,style:{height:Za,boxSizing:"border-box"}})}),m.a.createElement("div",{className:a.spacer}),t)})),ha=n(2501),ba=n(2499),va=n(2475),ya=Object(Ze.a)((function(e){return{importFormContainer:{padding:e.spacing(2)},importFormEntry:{minWidth:180},button:{margin:e.spacing(2)}}})),wa=Object(re.observer)((function(e){var t=e.model,n=ya(),a=Object(_.getSession)(t),r=a.assemblyNames,o=a.assemblyManager,i=Object(p.useState)(0),s=Object(f.a)(i,2),u=s[0],d=s[1],g=Object(p.useState)(""),h=Object(f.a)(g,2),v=h[0],y=h[1],w=Object(p.useState)([]),O=Object(f.a)(w,2),j=O[0],k=O[1],C=r.length?"":"No configured assemblies",E=Boolean(C),x=r[u],S=x&&!C?u:"";function T(e){var n=j.find((function(e){return v===e.refName}));if(n)t.setDisplayedRegions([n]),t.showAllRegions();else try{e&&t.navToLocString(e,x)}catch(r){console.warn(r),a.notify("".concat(r),"warning")}}return Object(p.useEffect)((function(){var e=!1;return Object(l.a)(c.a.mark((function t(){var n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!x){t.next=5;break}return t.next=3,o.waitForAssembly(x);case 3:(n=t.sent)&&n.regions&&(a=Object(b.getSnapshot)(n.regions),!e&&a&&(y(a[0].refName),k(a)));case 5:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[o,x]),m.a.createElement(ha.a,{className:n.importFormContainer},m.a.createElement(ba.a,{container:!0,spacing:1,justify:"center",alignItems:"center"},m.a.createElement(ba.a,{item:!0},m.a.createElement(dn.a,{select:!0,variant:"outlined",value:S,onChange:function(e){d(Number(e.target.value))},label:"Assembly",helperText:C||"Select assembly to view",error:E,disabled:E,margin:"normal",className:n.importFormEntry},r.map((function(e,t){return m.a.createElement(va.a,{key:e,value:t},e)})))),m.a.createElement(ba.a,{item:!0},x?v&&t.volatileWidth?m.a.createElement(vn,{model:t,assemblyName:C?void 0:r[u],value:v,onSelect:y,TextFieldProps:{margin:"normal",variant:"outlined",className:n.importFormEntry,helperText:"Enter a sequence or locstring",onBlur:function(e){y(e.target.value)},onKeyPress:function(e){var t=e.target.value;"Enter"===e.key&&T(t)}}}):m.a.createElement(un.a,{role:"progressbar",color:"inherit",size:20,disableShrink:!0}):null),m.a.createElement(ba.a,{item:!0},m.a.createElement(Ge.a,{disabled:!v,className:n.button,onClick:function(){v&&T(v)},variant:"contained",color:"primary"},"Open"),m.a.createElement(Ge.a,{disabled:!v,className:n.button,onClick:function(){t.showAllRegionsInAssembly(x)},variant:"contained",color:"secondary"},"Show all regions in assembly"))))})),Oa=n(708),ja=n.n(Oa),ka=n(314),Ca=Object(re.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.maxBpPerPx,r=t.minBpPerPx,o=t.scaleFactor,i=Object(p.useState)(),c=Object(f.a)(i,2),s=c[0],l=c[1];return m.a.createElement(m.a.Fragment,null,m.a.createElement(nn.a,{style:{background:"#aaa7"}},m.a.createElement(Qt.a,{color:"secondary",onClick:function(e){l(e.currentTarget)}},m.a.createElement(ja.a,null)),m.a.createElement(Qt.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*n)},disabled:n>=a-1e-4||1!==o,color:"secondary"},m.a.createElement(In.a,null)),m.a.createElement(Qt.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:n<=r+1e-4||1!==o,color:"secondary"},m.a.createElement(Pn.a,null))),m.a.createElement(ka.a,{anchorEl:s,open:Boolean(s),onMenuItemClick:function(e,t){t(),l(void 0)},onClose:function(){l(void 0)},menuItems:t.menuItems}))})),Ea=n(2487),xa=n(2489),Sa=n(2490),Ta=n(692),Na=n.n(Ta),Aa=n(429),Ra=n(691),Ma=n.n(Ra),Pa=Object(Ze.a)((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},field:{display:"flex"},fieldName:{wordBreak:"break-all",minWidth:100,maxWidth:350,borderBottom:"1px solid #0003",backgroundColor:e.palette.grey[200],marginRight:e.spacing(1),padding:e.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),backgroundColor:e.palette.grey[100],border:"1px solid ".concat(e.palette.grey[300]),boxSizing:"border-box",overflow:"auto"}}})),Fa=function(e){var t=Pa(),n=e.children,a=e.title;return m.a.createElement(Ea.a,{style:{marginTop:"4px"},defaultExpanded:!0},m.a.createElement(xa.a,{expandIcon:m.a.createElement(Na.a,{className:t.expandIcon})},m.a.createElement(Je.a,{variant:"button"}," ",a)),m.a.createElement(Sa.a,{className:t.expansionPanelDetails},n))},Ia=["refNames","displays","baseUri"],Ba=function e(t){var n=Pa(),a=t.attributes,r=t.prepend,o=void 0===r?"":r,i=t.omit,c=void 0===i?[]:i,s=t.formatter,l=void 0===s?function(e){return m.a.createElement(Aa.a,{html:Ma()(e)?JSON.stringify(e):String(e)})}:s,u=t.descriptions,d=Object.values(a).filter((function(e){return void 0!==e})).map((function(e){return e.tag})).filter((function(e){return!!e})).reduce((function(e,t){return e[t]?e[t]++:e[t]=1,e}),{}),g=Object.entries(d).filter((function(e){var t=Object(f.a)(e,2);t[0];return t[1]>50})).map((function(e){return e[0]})),h=Object(p.useState)(g),b=Object(f.a)(h,2),v=b[0],y=b[1],w=function(e){var t=e.name,a=e.value,r=u&&u[t];return m.a.createElement("div",{style:{display:"flex"}},r?m.a.createElement(et.a,{title:r,placement:"left"},m.a.createElement("div",{className:n.fieldName},t)):m.a.createElement("div",{className:n.fieldName},t),m.a.createElement("div",{className:n.fieldValue},l(a)))},O=function(e){var t=e.name,a=e.value,r=u&&u[t];return m.a.createElement("div",{style:{display:"flex"}},r?m.a.createElement(et.a,{title:r,placement:"left"},m.a.createElement("div",{className:n.fieldName},t)):m.a.createElement("div",{className:n.fieldName},t),a.map((function(e,a){return m.a.createElement("div",{key:"".concat(t,"-").concat(a),className:n.fieldSubvalue},l(e))})))};return m.a.createElement(m.a.Fragment,null,Object.entries(a).filter((function(e){var t=Object(f.a)(e,2),n=t[0];return void 0!==t[1]&&!Ia.includes(n)&&!c.includes(n)})).map((function(t,n){var a=Object(f.a)(t,2),r=a[0],i=a[1];return i.tag&&i.data?v.includes(i.tag)?null:m.a.createElement(w,{key:"".concat(i.tag,"_").concat(n),name:i.tag,value:i.data}):Array.isArray(i)?1===i.length?m.a.createElement(w,{key:r,name:"".concat(o?"".concat(o,"."):"").concat(r),value:i[0]}):m.a.createElement(O,{key:r,name:"".concat(o?"".concat(o,"."):"").concat(r),value:i}):Ma()(i)?m.a.createElement(e,{key:r,attributes:i,descriptions:u,prepend:"".concat(o?"".concat(o,"."):"").concat(r)}):m.a.createElement(w,{key:r,name:"".concat(o?"".concat(o,"."):"").concat(r),value:i})})),g.length?m.a.createElement(m.a.Fragment,null,v.length?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{color:"textSecondary"},"Note: Some entries were hidden (".concat(v,"), click button below to reveal")),m.a.createElement(Ge.a,{variant:"contained",color:"primary",onClick:function(){return y([])}},"Show ".concat(v))):m.a.createElement(Ge.a,{color:"primary",variant:"contained",onClick:function(){return y(g)}},"Hide ".concat(g))):null)};function La(e){var t=e.model,n=e.handleClose,a=Object(p.useState)(),r=Object(f.a)(a,2),o=r[0],i=r[1],s=Object(p.useState)(),u=Object(f.a)(s,2),d=u[0],g=u[1],h=Object(P.getConf)(t),b=Object(_.getSession)(t),v=b.rpcManager,y=Object(Ue.getRpcSessionId)(t);Object(p.useEffect)((function(){var e=new AbortController,n=e.signal,a=!1;return Object(l.a)(c.a.mark((function e(){var r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=Object(P.getConf)(t,"adapter"),e.next=4,v.call(y,"CoreGetInfo",{adapterConfig:r,signal:n});case 4:o=e.sent,a||i(o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),a||g(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))(),function(){e.abort(),a=!0}}),[t,v,y]);var w=Object(P.getConf)(t,"name");return"ReferenceSequenceTrack"===Object(P.getConf)(t,"type")&&(w="Reference Sequence",b.assemblies.forEach((function(e){e.sequence===t.configuration&&(w="Reference Sequence (".concat(Object(P.readConfObject)(e,"name"),")"))}))),m.a.createElement(Gt.a,{open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},w),m.a.createElement(Yt.a,null,m.a.createElement(Fa,{title:"Configuration"},m.a.createElement(Ba,{attributes:h})),null!==o?m.a.createElement(Fa,{title:"File info"},d?m.a.createElement(Je.a,{color:"error"},"".concat(d)):void 0===o?"Loading file data...":m.a.createElement(Ba,{attributes:"string"===typeof o?{header:"<pre>".concat(o.replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</pre>")}:o})):null))}var Da=n(1045),Va=n(546),Wa=n.n(Va),qa=n(1046),za=n.n(qa);var Ha=Object(Ze.a)((function(e){return{loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}}));function _a(e,t){return Ua.apply(this,arguments)}function Ua(){return(Ua=Object(l.a)(c.a.mark((function e(t,n){var a,r,o,i,s,l,u,d,f,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(_.getSession)(t),s=(null===(a=t.leftOffset)||void 0===a?void 0:a.assemblyName)||(null===(r=t.rightOffset)||void 0===r?void 0:r.assemblyName)||"",l=i.rpcManager,u=i.assemblyManager,d=null===(o=u.get(s))||void 0===o?void 0:o.configuration,f=Object(P.readConfObject)(d,["sequence","adapter"]),"getSequence",e.next=8,Promise.all(n.map((function(e){return l.call("getSequence","CoreGetFeatures",{adapterConfig:f,region:e,sessionId:"getSequence"})})));case 8:return p=e.sent,e.abrupt("return",p.map((function(e){return e[0]})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ga=Object(re.observer)((function(e){var t=e.model,n=e.handleClose,a=Ha(),r=Object(_.getSession)(t),o=Object(p.useState)(),i=Object(f.a)(o,2),s=i[0],u=i[1],d=Object(p.useState)(""),g=Object(f.a)(d,2),h=g[0],b=g[1],v=Boolean(!h)||Boolean(s),y=t.leftOffset,w=t.rightOffset,O=Object(p.useMemo)((function(){return t.getSelectedRegions(y,w)}),[t,y,w]);Object(p.useEffect)((function(){var e=!0;function n(e){var t=[],n=[];e.forEach((function(e){var a=e.get("seq"),r=e.get("refName"),o=e.get("start")+1,i=e.get("end"),c="".concat(r,":").concat(o,"-").concat(i);a&&(t.push({header:c,seq:a}),a.length!==i-o+1&&n.push("".concat(c," returned ").concat(a.length.toLocaleString()," bases, but should have returned ").concat((i-o).toLocaleString())))})),n.length>0&&r.notify("Unable to retrieve complete reference sequence from regions:".concat(n.join())),b(t.map((function(e){return">".concat(e.header,"\n").concat(e.seq.replace(/(.{1,80})/g,"$1\n").trimEnd())})).join("\n"))}return Object(l.a)(c.a.mark((function a(){var r;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!(O.length>0)){a.next=8;break}return a.next=4,_a(t,O);case 4:r=a.sent,e&&n(r),a.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:a.next=15;break;case 11:a.prev=11,a.t0=a.catch(0),console.error(a.t0),e&&u(a.t0);case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))(),function(){e=!1}}),[t,r,O,b]);var j=h.length>1e6;return m.a.createElement(Gt.a,{"data-testid":"sequence-dialog",maxWidth:"xl",open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Reference sequence",n?m.a.createElement(Qt.a,{"data-testid":"close-seqDialog",className:a.closeButton,onClick:function(){n(),t.setOffsets(void 0,void 0)}},m.a.createElement($t.a,null)):null),m.a.createElement(Xt.a,null),m.a.createElement(Yt.a,null,s?m.a.createElement(Je.a,{color:"error"},"".concat(s)):null,v&&!s?m.a.createElement(ha.a,null,"Retrieving reference sequence...",m.a.createElement(un.a,{style:{marginLeft:10},size:20,disableShrink:!0})):null,void 0!==h?m.a.createElement(dn.a,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,rows:3,rowsMax:5,disabled:j,className:a.dialogContent,fullWidth:!0,value:j?"Reference sequence too large to display, use the download FASTA button":h,InputProps:{readOnly:!0,classes:{input:a.textAreaFont}}}):null),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){Wa()(h||""),r.notify("Copied to clipboard","success")},disabled:v||j,color:"primary",startIcon:m.a.createElement(Pt,null)},"Copy to clipboard"),m.a.createElement(Ge.a,{onClick:function(){var e=new Blob([h||""],{type:"text/x-fasta;charset=utf-8"});Object(Da.saveAs)(e,"jbrowse_ref_seq.fa")},disabled:v,color:"primary",startIcon:m.a.createElement(za.a,null)},"Download FASTA"),m.a.createElement(Ge.a,{onClick:function(){n(),t.setOffsets(void 0,void 0)},color:"primary",autoFocus:!0},"Close")))})),Ja=Object(Ze.a)((function(e){return{errorMessage:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},spacer:{marginRight:e.spacing(2)}}})),Qa=Object(re.observer)((function(e){var t=e.model,n=t.tracks,a=t.error,r=t.hideHeader,o=t.initialized,i=t.hasDisplayedRegions,c=Ja(),s=t.tracks.find((function(e){return e.showAbout})),l=t.tracks.find((function(e){return e.DialogComponent}));return o?i?m.a.createElement("div",{style:{position:"relative"}},s?m.a.createElement(La,{model:s,handleClose:function(){return s.setShowAbout(!1)}}):null,t.DialogComponent?m.a.createElement(t.DialogComponent,{model:t,handleClose:function(){return t.setDialogComponent(void 0)}}):null,l?m.a.createElement(l.DialogComponent,{track:l,display:l.DialogDisplay,handleClose:function(){return l.setDialogComponent(void 0,void 0)}}):null,t.isSeqDialogDisplayed?m.a.createElement(Ga,{model:t,handleClose:function(){t.setOffsets(void 0,void 0)}}):null,r?m.a.createElement("div",{style:{position:"absolute",right:0,zIndex:1001}},m.a.createElement(Ca,{model:t})):m.a.createElement(qn,{model:t}),a?m.a.createElement(nn.a,{variant:"outlined",className:c.errorMessage},m.a.createElement(Je.a,{color:"error"},a.message)):m.a.createElement(m.a.Fragment,null,m.a.createElement(ga,{model:t},n.length?n.map((function(e){return m.a.createElement(Kn,{key:e.id,model:t,track:e})})):m.a.createElement(nn.a,{variant:"outlined",className:c.errorMessage},m.a.createElement(Je.a,null,"No tracks active."),m.a.createElement(Ge.a,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3}},m.a.createElement(Ft,{className:c.spacer}),"Open track selector"))))):m.a.createElement(wa,{model:t}):null}));function Xa(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return Object(_.assembleLocString)(Object(u.a)(Object(u.a)({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(";")}var Ya=48,Ka=20,Za=17,$a=3;function er(e){var t=b.types.model("LinearGenomeView",{id:Ie.ElementId,type:b.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:b.types.array(Ie.Region),tracks:b.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,trackSelectorType:b.types.optional(b.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:"overlapping",showCenterLine:!1}).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,error:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,DialogComponent:void 0}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth}}})).views((function(e){return{get initialized(){var t=Object(_.getSession)(e).assemblyManager,n=this.assemblyNames.every((function(e){var n;return!(null===(n=t.assemblyList)||void 0===n?void 0:n.map((function(e){return e.name})).includes(e))||(t.get(e)||{}).initialized}));return void 0!==e.volatileWidth&&n},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSeqDialogDisplayed(){return e.leftOffset&&e.rightOffset},get scaleBarHeight(){return Za+$a},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?Ya:Ya+Ka},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*$a},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get interRegionPaddingWidth(){return 2},get totalBp(){var t=0;return e.displayedRegions.forEach((function(e){t+=e.end-e.start})),t},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get maxOffset(){return this.displayedRegionsTotalPx-10},get displayedParentRegions(){var t=[],n=Object(_.getSession)(e).assemblyManager;return e.displayedRegions.forEach((function(e){var a=e.refName,r=e.assemblyName,o=n.get(r),i=o&&o.regions;if(i){var c=i.find((function(e){return e.refName===a})),s=t.find((function(e){return e.refName===a}));c&&!s&&t.push(c)}})),t},get displayedParentRegionsLength(){return this.displayedParentRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get renderProps(){return Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:Object(P.getConf)(Object(_.getSession)(e),"highResolutionScaling")})},get assemblyNames(){return Object(s.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},parentRegion:function(e,t){return this.displayedParentRegions.find((function(n){return n.assemblyName===e&&n.refName===t}))},bpToPx:function(t){var n=t.refName,a=t.coord,r=t.regionNumber,o=0,i=this.interRegionPaddingWidth*e.bpPerPx,c=e.displayedRegions.findIndex((function(e,t){return n===e.refName&&a>=e.start&&a<=e.end&&(!r||r===t)?(o+=e.reversed?e.end-a:a-e.start,!0):(o+=e.end-e.start+i,!1)}));if(e.displayedRegions[c])return{index:c,offsetPx:Math.round(o/e.bpPerPx)}},pxToBp:function(t){var n=0,a=(e.offsetPx+t)*e.bpPerPx,r=e.displayedRegions.length;if(a<0){var o=e.displayedRegions[0],i=a;return Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(o)),{},{oob:!0,coord:o.reversed?Math.floor(o.end-i)+1:Math.floor(o.start+i)+1,offset:i,index:0})}for(var c=this.interRegionPaddingWidth*e.bpPerPx,s=e.minimumBlockWidth*e.bpPerPx,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l],f=d.end-d.start,p=a-n;if(f+n>a&&n<=a)return Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(d)),{},{oob:!1,offset:p,coord:d.reversed?Math.floor(d.end-p)+1:Math.floor(d.start+p)+1,index:l});d.end-d.start>s&&p/e.bpPerPx>0&&p/e.bpPerPx<e.width?n+=f+c:n+=f}if(a>=n){var m=e.displayedRegions[r-1],g=a-n+(m.end-m.start);return Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(m)),{},{oob:!0,offset:g,coord:m.reversed?Math.floor(m.end-g)+1:Math.floor(m.start+g)+1,index:r-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rewriteOnClicks:function(t,n){var a=this;n.forEach((function(n){if("subMenu"in n&&a.rewriteOnClicks(t,n.subMenu),"onClick"in n){var r=n.onClick;n.onClick=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];e.tracks.forEach((function(e){e.type===t&&r.apply(e,[e].concat(a))}))}}}))},get trackTypeActions(){var t=this,n=new Map;return e.tracks.forEach((function(e){if(!n.get(e.type)){var a=_t()(e.viewMenuActions);t.rewriteOnClicks(e.type,a),n.set(e.type,a)}})),n},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}})).actions((function(t){return{setDialogComponent:function(e){t.DialogComponent=e},setWidth:function(e){t.volatileWidth=e},setError:function(e){t.error=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},scrollTo:function(e){var n=Object(_.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo:function(e){var n=Object(_.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;var a=t.bpPerPx;if(t.bpPerPx=n,Math.abs(a-n)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),a;var r=t.width;return this.scrollTo(Math.round((t.offsetPx+r/2)*a/n-r/2)),n},setOffsets:function(e,n){t.leftOffset=e,t.rightOffset=n},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=Object(b.cast)(t.displayedRegions.slice().reverse().map((function(e){return Object(u.a)(Object(u.a)({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.pluggableConfigSchemaType("track"),o=Object(b.resolveIdentifier)(r,Object(b.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),l=o.displays.find((function(e){return s.includes(e.type)}));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));var d=i.stateModel.create(Object(u.a)(Object(u.a)({},a),{},{type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]}));t.tracks.push(d)},hideTrack:function(n){var a=e.pluggableConfigSchemaType("track"),r=Object(b.resolveIdentifier)(a,Object(b.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===r}));return Object(le.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length}}})).actions((function(e){return{moveTrack:function(t,n){var a=e.tracks.findIndex((function(e){return e.id===t}));if(-1===a)throw new Error("Track ID ".concat(t," not found"));var r=e.tracks.findIndex((function(e){return e.id===n}));if(-1===r)throw new Error("Track ID ".concat(n," not found"));var o=Object(b.getSnapshot)(e.tracks[a]);e.tracks.splice(a,1),e.tracks.splice(r,0,o)},closeView:function(){var t=Object(_.getContainingView)(e);t?Object(_.isViewContainer)(t)&&t.removeView(e):Object(_.getSession)(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions:function(t){e.displayedRegions=Object(b.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=Object(_.getSession)(e);if(Object(_.isSessionModelWithWidgets)(t)){var n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},navToLocString:function(t,n){var a=Object(_.getSession)(e).assemblyManager,r=a.isValidRefName,o=t.split(";");if(e.displayedRegions.length>1){var i=o.map((function(e){return Object(_.parseLocString)(e,r)}));this.navToMultiple(i)}else{var c=n,s="";0!==e.displayedRegions.length&&(c=e.displayedRegions[0].assemblyName,s=e.displayedRegions[0].refName);var l=c&&a.get(c);if(!l)throw new Error("Could not find assembly ".concat(c));var d=l.regions;if(!d)throw new Error("Regions for assembly ".concat(c," not yet loaded"));if(o.length>1)throw new Error("Navigating to multiple locations is not allowed when viewing a whole chromosome");var f=Object(_.parseLocString)(o[0],(function(e){return r(e,c)})),p=!1;if(f.assemblyName&&f.assemblyName!==c){var m=a.get(f.assemblyName);if(!m)throw new Error("Could not find assembly ".concat(f.assemblyName));l=m,p=!0;var g=m.regions;if(!g)throw new Error("Regions for assembly ".concat(f.assemblyName," not yet loaded"));d=g}var h=l.getCanonicalRefName(f.refName);if(!h)throw new Error("Could not find refName ".concat(f.refName," in ").concat(l.name));if(p||h!==s){var v=d.find((function(e){return e.refName===h}));if(!v)throw new Error("Could not find refName ".concat(f.refName," in ").concat(l.name));this.setDisplayedRegions([Object(b.getSnapshot)(v)])}var y=d.find((function(e){return e.refName===h}));if(y){var w,O,j=Object(_.clamp)(null!==(w=null===f||void 0===f?void 0:f.start)&&void 0!==w?w:0,0,y.end),k=Object(_.clamp)(null!==(O=null===f||void 0===f?void 0:f.end)&&void 0!==O?O:y.end,0,y.end);this.navTo(Object(u.a)(Object(u.a)({},f),{},{start:j,end:k}))}}},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var n=t[0],a=n.refName,r=n.start,o=n.end,i=n.assemblyName,c=void 0===i?e.assemblyNames[0]:i;if(void 0!==r&&void 0!==o&&r>o)throw new Error('start "'.concat(r+1,'" is greater than end "').concat(o,'"'));var s=Object(_.getSession)(e).assemblyManager.get(c);if(s){var l=s.getCanonicalRefName(a);l&&(a=l)}for(var u,d=r,f=o,p=!1,m=function(e){if(a===e.refName){if(p=!0,void 0===d&&(d=e.start),void 0===f&&(f=e.end),d>=e.start&&d<=e.end&&f<=e.end&&f>=e.start)return!0;d=r,f=o}return!1},g=Object(_.findLastIndex)(e.displayedRegions,m);u!==g;)try{var h=u;if(u=e.displayedRegions.slice(void 0===h?0:h+1).findIndex(m),void 0!==h&&(u+=h+1),!p)throw new Error('could not find a region with refName "'.concat(a,'"'));if(void 0===d)throw new Error('could not find a region with refName "'.concat(a,'" that contained an end position ').concat(f));if(void 0===f)throw new Error('could not find a region with refName "'.concat(a,'" that contained a start position ').concat(d+1));if(-1===u)throw new Error('could not find a region that completely contained "'.concat(Object(_.assembleLocString)(n),'"'));if(1===t.length){var b=e.displayedRegions[u];return void this.moveTo({index:u,offset:b.reversed?b.end-f:d-b.start},{index:u,offset:b.reversed?b.end-d:f-b.start})}for(var v=0,y=0,w=0;v<t.length;v++){var O=t[v],j=e.displayedRegions[u+v];if(y=O.start||j.start,w=O.end||j.end,O.refName!==j.refName)throw new Error("Entered location ".concat(Object(_.assembleLocString)(O)," does not match with displayed regions"));if(v>0)if(!(j.reversed?w===j.end:y===j.start))throw new Error("".concat(j.reversed?"End":"Start"," of region ").concat(Object(_.assembleLocString)(O)," should be ").concat((j.reversed?j.end:j.start+1).toLocaleString("en-US"),", but it is not"));if(!(v===t.length-1))if(!(j.reversed?y===j.start:w===j.end))throw new Error("".concat(j.reversed?"Start":"End"," of region ").concat(Object(_.assembleLocString)(O)," should be ").concat((j.reversed?j.start+1:j.end).toLocaleString("en-US"),", but it is not"))}v-=1;var k=e.displayedRegions[u],C=e.displayedRegions[u+v];return void this.moveTo({index:u,offset:k.reversed?k.end-f:d-k.start},{index:u+v,offset:C.reversed?C.end-y:w-C.start})}catch(E){if(u===g)throw E}},zoomToDisplayedRegions:function(t,n){if(void 0!==t&&void 0!==n){if(t.refName===n.refName&&t.index===n.index&&n.offset<t.offset||t.index>n.index){var a=[n,t];t=a[0],n=a[1]}var r={start:t.start,end:t.end,index:t.index,offset:t.offset},o={start:n.start,end:n.end,index:n.index,offset:n.offset};if(r&&o)this.moveTo(r,o);else Object(_.getSession)(e).notify("No regions found to navigate to","warning")}},getSelectedRegions:function(t,n){var a=Ut.a.create(Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(e)),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return a.setVolatileWidth(e.width),a.zoomToDisplayedRegions(t,n),a.dynamicBlocks.contentBlocks.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},moveTo:function(t,n){var a=0;if(t.index===n.index)a+=n.offset-t.offset;else{var r=e.displayedRegions[t.index];if(a+=r.end-r.start-t.offset,n.index-t.index>=2)for(var o=t.index+1;o<n.index;o+=1)a+=e.displayedRegions[o].end-e.displayedRegions[o].start;a+=n.offset}var i=a/(e.width-e.interRegionPaddingWidth*(n.index-t.index)),c=e.zoomTo(i),s=0;i<c&&(s=(c-i)*e.width/2);for(var l=-s,u=0;u<e.displayedRegions.length;u+=1){var d=e.displayedRegions[u];if(t.index===u){l+=t.offset;break}l+=d.end-d.start}e.scrollTo(Math.round(l/e.bpPerPx)+e.interRegionPaddingWidth*t.index)},horizontalScroll:function(t){var n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},centerAt:function(t,n,a){var r=e.bpToPx({refName:n,coord:t,regionNumber:a});r&&e.scrollTo(Math.round(r.offsetPx-e.width/2))},center:function(){var t=e.totalBp/2;e.scrollTo(Math.round(t/e.bpPerPx-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var n=Object(_.getSession)(e),a=n.assemblyManager;if(!t){var r=Object(s.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))));if(r.length>1)return void n.notify("Can't perform this with multiple assemblies currently");t=Object(f.a)(r,1)[0]}var o=a.get(t);if(o){var i=Object(b.getSnapshot)(o).regions;i&&(this.setDisplayedRegions(i),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t}}})).actions((function(e){var t=function(){};return{slide:function(n){var a=Object(_.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo),r=Object(f.a)(a,2),o=r[0],i=r[1];t(),t=i,o()}}})).actions((function(e){var t=function(){};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),!(n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var a=e.bpPerPx/n,r=Object(_.springAnimate)(1,a,e.setScaleFactor,(function(){e.zoomTo(n),e.setScaleFactor(1)})),o=Object(f.a)(r,2),i=o[0],c=o[1];t(),t=c,i()}}}})).views((function(e){var t,n="";return{get menuItems(){var t,n=[{label:"Return to import form",onClick:function(){e.setDialogComponent(tn)},icon:zt.a},{label:"Open track selector",onClick:e.activateTrackSelector,icon:Ft},{label:"Horizontally flip",icon:Bt.a,onClick:e.horizontallyFlip},{label:"Show all regions in assembly",icon:Dt.a,onClick:e.showAllRegionsInAssembly},{label:"Show center line",icon:Dt.a,type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{type:"divider"},{label:"Show header",icon:Dt.a,type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",icon:Dt.a,type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Track labels",icon:Wt.a,subMenu:[{label:"Overlapping",icon:Dt.a,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:Dt.a,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:Dt.a,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}],a=Object(He.a)(e.trackTypeActions.entries());try{for(a.s();!(t=a.n()).done;){var r=Object(f.a)(t.value,2),o=r[0],i=r[1];i.length&&(n.push({type:"divider"},{type:"subHeader",label:o}),i.forEach((function(e){n.push(e)})))}}catch(c){a.e(c)}finally{a.f()}return n},get staticBlocks(){var a=Object(Rt.a)(e),r=JSON.stringify(a);return n!==r&&(t=a,n=r),t},get dynamicBlocks(){return Object(At.a)(e)},get visibleLocStrings(){return Xa(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return Xa(e.coarseDynamicBlocks)}}})).actions((function(e){return{clearView:function(){e.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(le.autorun)((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150}))}}}));return b.types.compose(Fe.BaseViewModel,t)}var tr=Object(Ze.a)((function(e){return{root:{width:500},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}})),nr=Object(re.observer)((function(e){var t=e.display,n=e.handleClose,a=tr(),r=t.maxHeight,o=void 0===r?"":r,i=Object(p.useState)("".concat(o)),c=Object(f.a)(i,2),s=c[0],l=c[1];return m.a.createElement(Gt.a,{open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Filter options",m.a.createElement(Qt.a,{"aria-label":"close",className:a.closeButton,onClick:n},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,null,m.a.createElement("div",{className:a.root},m.a.createElement(Je.a,null,"Set max height for the track"),m.a.createElement(dn.a,{value:s,onChange:function(e){l(e.target.value)},placeholder:"Enter max score"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},onClick:function(){t.setMaxHeight(""===s||Number.isNaN(+s)?void 0:+s),n()}},"Submit"))))})),ar=function(e){return b.types.compose("LinearBasicDisplay",St,b.types.model({type:b.types.literal("LinearBasicDisplay"),trackShowLabels:b.types.maybe(b.types.boolean),trackDisplayMode:b.types.maybe(b.types.string),trackMaxHeight:b.types.maybe(b.types.number),configuration:Object(P.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return Object(P.getConf)(e,["renderer","type"])},get showLabels(){var t=Object(P.getConf)(e,["renderer","showLabels"]);return void 0!==e.trackShowLabels?e.trackShowLabels:t},get maxHeight(){var t=Object(P.getConf)(e,["renderer","maxHeight"]);return void 0!==e.trackMaxHeight?e.trackMaxHeight:t},get displayMode(){var t=Object(P.getConf)(e,["renderer","displayMode"]);return void 0!==e.trackDisplayMode?e.trackDisplayMode:t},get rendererConfig(){var t=Object(P.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{showLabels:this.showLabels,displayMode:this.displayMode,maxHeight:this.maxHeight}))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get renderProps(){var t=e.rendererConfig;return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(Ue.getParentRenderProps)(e)),{},{config:t})},get trackMenuItems(){return[].concat(Object(s.a)(t),[{label:"Show labels",icon:Dt.a,type:"checkbox",checked:e.showLabels,onClick:function(){e.toggleShowLabels()}},{label:"Display mode",icon:Dt.a,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){Object(_.getContainingTrack)(e).setDialogComponent(nr,e)}}])}}}))};function rr(e){return Object(P.ConfigurationSchema)("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer"),maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:1e3}},{baseConfiguration:ze,explicitlyTyped:!0})}var or=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:dt,BaseLinearDisplay:St,baseLinearDisplayConfigSchema:ze},e}return Object(h.a)(n,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new w.a({name:"FeatureTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"FeatureTrack",t)})})),e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new w.a({name:"BasicTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"BasicTrack",t)})})),e.addDisplayType((function(){var t=function(e){return Object(P.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:ze,explicitlyTyped:!0})}(e);return new O.a({name:"LinearBareDisplay",configSchema:t,stateModel:Nt(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addDisplayType((function(){var t=rr(e);return new O.a({name:"LinearBasicDisplay",configSchema:t,stateModel:ar(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addViewType((function(){return new j.a({name:"LinearGenomeView",stateModel:er(e),ReactComponent:Qa})})),e.addWidgetType((function(){return new k.a({name:"BaseFeatureWidget",heading:"Feature details",configSchema:Le,stateModel:De(e),ReactComponent:Be.BaseFeatureDetails})}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Linear genome view",icon:qe.a,onClick:function(e){e.addView("LinearGenomeView",{})}})}}]),n}(F.a),ir=n(432),cr=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"makeImageData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,u,d,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.height,a=t.regions,r=t.bpPerPx,o=t.highResolutionScaling,i=void 0===o?1:o,s=Object(f.a)(a,1),l=s[0],(u=(l.end-l.start)/r)>0&&n>0){e.next=5;break}return e.abrupt("return",{height:0,width:0});case 5:return d=Object(ir.b)(Math.ceil(u*i),n*i),(p=d.getContext("2d")).scale(i,i),this.draw(p,t),e.next=11,Object(ir.c)(d);case 11:return m=e.sent,e.abrupt("return",{imageData:m,height:n,width:u});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeImageData(t);case 2:return n=e.sent,a=n.height,r=n.width,o=n.imageData,i=m.a.createElement(this.ReactComponent,Object(u.a)(Object(u.a)({},t),{},{height:a,width:r,imageData:o}),null),e.abrupt("return",{element:i,imageData:o,height:a,width:r});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(z.a);var sr=Object(re.observer)((function(e){var t=e.regions,n=e.features,a=e.bpPerPx,r=e.width,o=e.height,i=e.onMouseLeave,c=void 0===i?function(){}:i,s=e.onMouseMove,l=void 0===s?function(){}:s,u=e.onFeatureClick,d=void 0===u?function(){}:u,g=Object(f.a)(t,1)[0],h=Object(p.useRef)(null);function b(e){var t=0;h.current&&(t=h.current.getBoundingClientRect().left);var o,i,c=e-t,s=g.reversed?r-c:c,l=g.start+a*s,u=Object(He.a)(n.values());try{for(u.s();!(i=u.n()).done;){var d=i.value;if(l<=d.get("end")&&l>=d.get("start")){o=d;break}}}catch(f){u.e(f)}finally{u.f()}return o}return m.a.createElement("div",{ref:h,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t=b(e.clientX);l(e,t?t.id():void 0)},onClick:function(e){var t=b(e.clientX);d(e,t?t.id():void 0)},onMouseLeave:function(e){return c(e)},role:"presentation",className:"WiggleRendering",style:{overflow:"visible",position:"relative",height:o}},m.a.createElement(ue.PrerenderedCanvas,e))})),lr=n(1047),ur=n(147),dr=n(529),fr=n(194),pr=n(684),mr=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).bigwig=void 0,a.bigwig=new lr.BigWig({filehandle:Object(oe.openLocation)(Object(P.readConfObject)(e,"bigWigLocation"))}),a}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t||{}).statusCallback,(a=void 0===n?function(){}:n)("Downloading bigwig header"),e.next=4,this.bigwig.getHeader(t);case 4:return r=e.sent,a(""),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return n=e.sent,e.abrupt("return",Object.keys(n.refsByName));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refIdToName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup();case 2:return n=e.sent,e.abrupt("return",(n.refsByNumber[t]||{name:void 0}).name);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlobalStats",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return n=e.sent,e.abrupt("return",Object(pr.b)(n.totalSummary));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.refName,r=e.start,o=e.end,i=n.bpPerPx,s=void 0===i?0:i,d=n.signal,f=n.resolution,p=void 0===f?1:f,m=n.statusCallback,g=void 0===m?function(){}:m;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(i){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g("Downloading bigwig data"),e.next=3,t.bigwig.getFeatureStream(a,r,o,Object(u.a)(Object(u.a)({},n),{},{basesPerSpan:s/p}));case 3:e.sent.pipe(Object(dr.a)(),Object(fr.a)((function(e){return new U.a({id:"".concat(a,":").concat(e.start,"-").concat(e.end),data:Object(u.a)(Object(u.a)({},e),{},{refName:a})})}))).subscribe(i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d)}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter);mr.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];var gr=Object(P.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw"}}},{explicitlyTyped:!0}),hr=n(2447),br=n(2552),vr=n(2535);function yr(e){var t,n=e.domain,a=void 0===n?[]:n,r=e.range,o=void 0===r?[]:r,i=e.scaleType,c=e.pivotValue,s=e.inverted,l=Object(f.a)(a,2),u=l[0],d=l[1];if(void 0===u||void 0===d)throw new Error("invalid domain");if("linear"===i)t=Object(hr.a)();else if("log"===i)(t=Object(br.a)()).base(2);else{if("quantize"!==i)throw new Error("undefined scaleType");t=Object(vr.a)()}t.domain(void 0!==c?[u,c,d]:[u,d]),t.nice();var p=Object(f.a)(o,2),m=p[0],g=p[1];if(void 0===m||void 0===g)throw new Error("invalid range");return t.range(s?o.slice().reverse():o),t}function wr(e){return"log"===e?1:0}function Or(e){var t=e.scaleType,n=e.domain,a=e.bounds,r=Object(f.a)(a,2),o=r[0],i=r[1],c=Object(f.a)(n,2),s=c[0],l=c[1];if("linear"===t&&(l<0&&(l=0),s>0&&(s=0)),"log"===t&&(0===s||s>1)&&(s=1),void 0===s||void 0===l)throw new Error("invalid domain");void 0!==o&&o!==Number.MIN_VALUE&&(s=o),void 0!==i&&i!==Number.MAX_VALUE&&(l=i);var u=function(e){if("linear"===e)return Object(hr.a)();if("log"===e){var t=Object(br.a)();return t.base(2),t}if("quantize"===e)return Object(vr.a)();throw new Error("undefined scaleType ".concat(e))}(t);return u.domain([s,l]),u.nice(),u.domain()}var jr=Object(P.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},highlightColor:{type:"color",description:"the color of highlights over the wiggle track",defaultValue:"rgba(255,255,0,0.5)"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},renderType:{type:"stringEnum",model:b.types.enumeration("Rendering type",["xyplot","density","line"]),description:"The type of rendering for wiggle data to use",defaultValue:"xyplot"},filled:{type:"boolean",description:"fill in histogram",defaultValue:!0},bicolorPivot:{type:"stringEnum",model:b.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"},summaryScoreMode:{type:"stringEnum",model:b.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{explicitlyTyped:!0}),kr=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,a,r=t.features,o=t.regions,i=t.bpPerPx,c=t.scaleOpts,s=t.height,l=t.config,d=Object(f.a)(o,1)[0],p=Object(P.readConfObject)(l,"bicolorPivot"),m=Object(P.readConfObject)(l,"bicolorPivotValue"),g=Object(P.readConfObject)(l,"negColor"),h=Object(P.readConfObject)(l,"posColor");"#f0f"===Object(P.readConfObject)(l,"color")?(a=yr("none"!==p?Object(u.a)(Object(u.a)({},c),{},{pivotValue:m,range:[g,"white",h]}):Object(u.a)(Object(u.a)({},c),{},{range:["white",h]})),n=function(e){return a(e.get("score"))}):n=function(e){return Object(P.readConfObject)(l,"color",{feature:e})};var b,v=Object(He.a)(r.values());try{for(v.s();!(b=v.n()).done;){var y=b.value,w=Object(_.featureSpanPx)(y,d,i),O=Object(f.a)(w,2),j=O[0],k=O[1]-j+.3;e.fillStyle=n(y),e.fillRect(j,0,k,s)}}catch(C){v.e(C)}finally{v.f()}}}]),n}(cr),Cr=Object(P.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:jr,explicitlyTyped:!0});var Er=n(1058),xr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return parseFloat(e.toPrecision(6))},Sr=Object(Ze.a)((function(e){return{popper:{fontSize:"0.8em",zIndex:e.zIndex.tooltip,pointerEvents:"none"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}}}));function Tr(e){var t=e.feature,n=t.get("refName"),a="".concat(n?"".concat(n,":"):""),r=(t.get("start")+1).toLocaleString("en-US"),o=t.get("end").toLocaleString("en-US"),i=r===o?r:"".concat(r,"..").concat(o),c="".concat(a).concat(i);return void 0!==t.get("summary")?m.a.createElement("div",null,c,m.a.createElement("br",null),"Max: ",xr(t.get("maxScore")),m.a.createElement("br",null),"Avg: ",xr(t.get("score")),m.a.createElement("br",null),"Min: ",xr(t.get("minScore"))):m.a.createElement("div",null,c,m.a.createElement("br",null),"".concat(xr(t.get("score"))))}var Nr=Object(re.observer)((function(e){var t=e.model,n=e.height,a=e.mouseCoord,r=t.featureUnderMouse,o=Sr();return r?m.a.createElement(m.a.Fragment,null,m.a.createElement(et.a,{placement:"right-start",className:o.popper,open:!0,title:m.a.createElement(Tr,{feature:r})},m.a.createElement("div",{style:{position:"absolute",left:a[0],top:5}}," ")),m.a.createElement("div",{className:o.hoverVertical,style:{left:a[0],height:n-2*Lr}})):null})),Ar=n(1059),Rr=n.n(Ar),Mr=Object(Ze.a)((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Pr(e){var t=Mr(),n=e.display,a=e.handleClose,r=n.minScore,o=n.maxScore,i=Object(p.useState)("".concat(r!==Number.MIN_VALUE?r:"")),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(p.useState)("".concat(o!==Number.MAX_VALUE?o:"")),d=Object(f.a)(u,2),g=d[0],h=d[1],b=!(""!==s&&""!==g&&!Number.isNaN(+s)&&!Number.isNaN(+g))||+g>+s;return m.a.createElement(Gt.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Set min/max score for track",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:a},m.a.createElement(Rr.a,null))),m.a.createElement(Yt.a,{style:{overflowX:"hidden"}},m.a.createElement("div",{className:t.root},m.a.createElement(Je.a,null,"Enter min/max score: "),b?null:m.a.createElement(Je.a,{color:"error"},"Max is greater than or equal to min"),m.a.createElement(dn.a,{value:s,onChange:function(e){l(e.target.value)},placeholder:"Enter min score"}),m.a.createElement(dn.a,{value:g,onChange:function(e){h(e.target.value)},placeholder:"Enter max score"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},disabled:!b,onClick:function(){n.setMinScore(""===s||Number.isNaN(+s)?void 0:+s),n.setMaxScore(""===g||Number.isNaN(+g)?void 0:+g),a()}},"Submit"))))}var Fr=n(1322),Ir=Object(Ze.a)((function(e){return{root:{},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Br(e){var t=Ir(),n=e.display,a=e.handleClose;return m.a.createElement(Gt.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Select a color",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:a},m.a.createElement(Rr.a,null))),m.a.createElement(Yt.a,{style:{overflowX:"hidden"}},m.a.createElement("div",{className:t.root},m.a.createElement(Fr.b,{onChange:function(e){n.setColor(function(e){if(e instanceof Object){var t=e,n=t.r,a=t.g,r=t.b,o=t.a;return"rgb(".concat(n,",").concat(a,",").concat(r,",").concat(o,")")}return e}(e.rgb))}}),m.a.createElement("br",null),m.a.createElement("div",{style:{margin:20}},m.a.createElement(Ge.a,{onClick:function(){n.setColor(void 0)},color:"secondary",variant:"contained"},"Restore default from config"),m.a.createElement(Ge.a,{variant:"contained",color:"primary",type:"submit",onClick:function(){a()}},"Submit")))))}var Lr=5,Dr=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]);function Vr(e,t){return Math.log(t)/Math.log(e)}function Wr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5;return(e>=0?1:-1)*Math.pow(t,1+Math.floor(Vr(t,Math.abs(e))))}var qr=function(e,t){return b.types.compose("LinearWiggleDisplay",St,b.types.model({type:b.types.literal("LinearWiggleDisplay"),configuration:Object(P.ConfigurationReference)(t),selectedRendering:b.types.optional(b.types.string,""),resolution:b.types.optional(b.types.number,1),fill:b.types.maybe(b.types.boolean),color:b.types.maybe(b.types.string),summaryScoreMode:b.types.maybe(b.types.string),rendererTypeNameState:b.types.maybe(b.types.string),scale:b.types.maybe(b.types.string),autoscale:b.types.maybe(b.types.string),displayCrossHatches:b.types.maybe(b.types.boolean),constraints:b.types.optional(b.types.model({max:b.types.maybe(b.types.number),min:b.types.maybe(b.types.number)}),{})})).volatile((function(){return{ready:!1,message:void 0,stats:Object(le.observable)({scoreMin:0,scoreMax:50}),statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){e.stats.scoreMin=t.scoreMin,e.stats.scoreMax=t.scoreMax,e.ready=!0},setColor:function(t){e.color=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=Object(_.getSession)(e);Object(_.isSelectionContainer)(n)&&n.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){e.fill=t},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches}}})).views((function(e){return{get TooltipComponent(){return Nr},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeName(){var t=e.rendererTypeNameState||Object(P.getConf)(e,"defaultRendering"),n=Dr.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},get filters(){},get scaleType(){return e.scale||Object(P.getConf)(e,"scaleType")},get filled(){return"undefined"!==typeof e.fill?e.fill:Object(P.readConfObject)(this.rendererConfig,"filled")},get maxScore(){var t=e.constraints.max;return void 0!==t?t:Object(P.getConf)(e,"maxScore")},get minScore(){var t=e.constraints.min;return void 0!==t?t:Object(P.getConf)(e,"minScore")},get rendererConfig(){var t=Object(P.getConf)(e,["renderers",this.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{filled:e.fill,scaleType:this.scaleType,displayCrossHatches:e.displayCrossHatches,summaryScoreMode:e.summaryScoreMode,color:e.color}))}}})).views((function(e){var t=[0,0];return{get summaryScoreModeSetting(){return e.summaryScoreMode||Object(P.readConfObject)(e.rendererConfig,"summaryScoreMode")},get domain(){var n=e.stats,a=e.scaleType,r=e.minScore,o=e.maxScore,i=Or({domain:[n.scoreMin,n.scoreMax],bounds:[r,o],scaleType:a}),c=Object(P.getConf)(e,"headroom")||0;return"log"===a&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(o===Number.MAX_VALUE&&i[1]>1&&(i[1]=Wr(i[1]+c)),r===Number.MIN_VALUE&&i[0]<-1&&(i[0]=Wr(i[0]-c)),JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:Object(P.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){return e.autoscale||Object(P.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){return e.displayCrossHatches||Object(P.readConfObject)(e.rendererConfig,"displayCrossHatches")}}})).views((function(t){var n=t.trackMenuItems;return{get ticks(){var e=t.scaleType,n=t.domain,a=t.height,r=yr({scaleType:e,domain:n,range:[a-Lr,Lr],inverted:Object(P.getConf)(t,"inverted")}),o=a<50?2:4;return Object(Er.axisPropsFromTickScale)(r,o)},get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},t.composedRenderProps),Object(Ue.getParentRenderProps)(t)),{},{notReady:!t.ready,displayModel:t,config:t.rendererConfig,scaleOpts:t.scaleOpts,resolution:t.resolution,height:t.height,ticks:this.ticks,displayCrossHatches:t.displayCrossHatches,filters:t.filters})},get hasResolution(){return e.getAdapterType(t.adapterTypeName).AdapterClass.capabilities.includes("hasResolution")},get hasGlobalStats(){return e.getAdapterType(t.adapterTypeName).AdapterClass.capabilities.includes("hasGlobalStats")},get composedTrackMenuItems(){return[].concat(Object(s.a)(this.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){t.setResolution(5*t.resolution)}},{label:"Coarser resolution",onClick:function(){t.setResolution(t.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(e){return{label:e,onClick:function(){return t.setSummaryScoreMode(e)}}}))}]:[]),Object(s.a)(t.canHaveFill?[{label:t.filled?"Turn off histogram fill":"Turn on histogram fill",onClick:function(){t.setFill(!t.filled)}}]:[]),[{label:"log"===t.scaleType?"Set linear scale":"Set log scale",onClick:function(){t.toggleLogScale()}},{type:"checkbox",label:"Draw cross hatches",checked:t.displayCrossHatchesSetting,onClick:function(){t.toggleCrossHatches()}}],Object(s.a)(Object.keys(Object(P.getConf)(t,"renderers")||{}).length>1?[{label:"Renderer type",subMenu:Object(s.a)(Dr.keys()).map((function(e){return{label:e,onClick:function(){return t.setRendererType(e)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat(Object(s.a)(this.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(e){var n=Object(f.a)(e,2),a=n[0];return{label:n[1],onClick:function(){t.setAutoscale(a)}}}))},{label:"Set min/max score",onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(Pr,t)}},{label:"Set color",onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(Br,t)}}])},get trackMenuItems(){return[].concat(Object(s.a)(n),Object(s.a)(this.composedTrackMenuItems))}}})).actions((function(e){var t=e.reload;function n(e){return a.apply(this,arguments)}function a(){return(a=Object(l.a)(c.a.mark((function t(n){var a,r,o,i,s,l,d,f,p,m,g,h,v,y,w,O,j,k;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object(_.getSession)(e),r=a.rpcManager,o=Object(P.getConf)(e,"numStdDev")||3,i=e.adapterConfig,s=e.autoscaleType,l=Object(Ue.getRpcSessionId)(e),d=Object(u.a)({sessionId:l,adapterConfig:i,statusCallback:function(t){Object(b.isAlive)(e)&&e.setMessage(t)}},n),"global"!==s&&"globalsd"!==s){t.next=11;break}return t.next=8,r.call(l,"WiggleGetGlobalStats",d);case 8:return f=t.sent,p=f.scoreMin,m=f.scoreMean,g=f.scoreStdDev,t.abrupt("return","globalsd"===s?Object(u.a)(Object(u.a)({},f),{},{scoreMin:p>=0?0:m-o*g,scoreMax:m+o*g}):f);case 11:if("local"!==s&&"localsd"!==s){t.next=18;break}return h=Object(_.getContainingView)(e),v=h.dynamicBlocks,y=h.bpPerPx,t.next=15,r.call(l,"WiggleGetMultiRegionStats",Object(u.a)(Object(u.a)({},d),{},{assemblyName:Object(Ue.getTrackAssemblyNames)(e.parentTrack)[0],regions:JSON.parse(JSON.stringify(v.contentBlocks.map((function(e){var t=e.start,n=e.end;return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(t),end:Math.ceil(n)})})))),bpPerPx:y}));case 15:return w=t.sent,O=w.scoreMin,j=w.scoreMean,k=w.scoreStdDev,t.abrupt("return","localsd"===s?Object(u.a)(Object(u.a)({},w),{},{scoreMin:O>=0?0:j-o*k,scoreMax:j+o*k}):w);case 18:if("zscale"!==s){t.next=20;break}return t.abrupt("return",r.call(l,"WiggleGetGlobalStats",d));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{reload:function(){return Object(l.a)(c.a.mark((function a(){var r,o;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.setError(),r=new AbortController,a.next=4,n({signal:r.signal,filters:e.filters});case 4:o=a.sent,Object(b.isAlive)(e)&&(e.updateStats(o),t());case 6:case"end":return a.stop()}}),a)})))()},afterAttach:function(){Object(b.addDisposer)(e,Object(le.autorun)(Object(l.a)(c.a.mark((function t(){var a,r,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=new AbortController,r=Object(_.getContainingView)(e),e.setLoading(a),r.initialized){t.next=6;break}return t.abrupt("return");case 6:if(!(r.bpPerPx>e.maxViewBpPerPx)){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,n({signal:a.signal,filters:e.filters});case 10:o=t.sent,Object(b.isAlive)(e)&&e.updateStats(o),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),!Object(_.isAbortException)(t.t0)&&Object(b.isAlive)(e)&&e.setError(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])}))),{delay:1e3}))}}}))},zr=Object(re.observer)((function(e){var t=e.model,n=e.orientation,a=t.ticks;return m.a.createElement(Er.Axis,Object.assign({},a,{format:function(e){return e},style:{orient:"left"===n?Er.LEFT:Er.RIGHT}}))})),Hr=Object(re.observer)((function(e){var t=e.model,n=t.ready,a=t.stats,r=t.height,o=t.needsScalebar;return m.a.createElement("div",null,m.a.createElement(dt,e),n&&a&&o?m.a.createElement("svg",{style:{position:"absolute",top:0,left:300,pointerEvents:"none",height:r,width:50}},m.a.createElement(zr,{model:t})):null)})),_r=n(1088),Ur=n.n(_r),Gr=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,a=t.features,r=t.bpPerPx,o=t.regions,i=t.scaleOpts,c=t.height,s=t.config,l=t.ticks.values,d=t.displayCrossHatches,p=Object(f.a)(o,1)[0],m=(p.end-p.start)/r,g=Lr,h=c-2*g,b=Object(P.readConfObject)(s,"bicolorPivotValue"),v=Object(P.readConfObject)(s,"negColor"),y=Object(P.readConfObject)(s,"posColor"),w=Object(P.readConfObject)(s,"filled"),O=Object(P.readConfObject)(s,"clipColor"),j=Object(P.readConfObject)(s,"highlightColor"),k=Object(P.readConfObject)(s,"summaryScoreMode"),C=yr(Object(u.a)(Object(u.a)({},i),{},{range:[0,h]})),E=wr(i.scaleType),x=C.domain(),S=Object(f.a)(x,2),T=S[0],N=S[1],A=function(e){return h-C(e)+g},R=function(e){return A(E)-A(e)},M="#f0f"===Object(P.readConfObject)(s,"color")?function(e,t){return t<b?v:y}:function(e,t){return Object(P.readConfObject)(s,"color",{feature:e})},F=T<b&&N>b,I=Object(He.a)(a.values());try{for(I.s();!(n=I.n()).done;){var B=n.value,L=Object(_.featureSpanPx)(B,p,r),D=Object(f.a)(L,2),V=D[0],W=D[1],q=B.get("score"),z=B.get("maxScore"),H=B.get("minScore"),U=q<T,G=q>N,J=W-V+.4,Q=B.get("summary");if("max"===k)q=Q?z:q,e.fillStyle=M(B,q),e.fillRect(V,A(q),J,w?R(q):1);else if("min"===k)q=Q?H:q,e.fillStyle=M(B,q),e.fillRect(V,A(q),J,w?R(q):1);else if("whiskers"===k){var X=M(B,q);Q&&(e.fillStyle=F?M(B,z):Ur()(X).lighten(.6).toString(),e.fillRect(V,A(z),J,w?R(z)-R(q):1)),e.fillStyle=F&&Q?Ur()(M(B,z)).mix(Ur()(M(B,H))):X,e.fillRect(V,A(q),J,w?R(q)-(Q?R(H):0):1),Q&&(e.fillStyle=F?M(B,H):Ur()(X).darken(.6).toString(),e.fillRect(V,A(H),J,w?R(H):1))}else e.fillStyle=M(B,q),e.fillRect(V,A(q),J,w?R(q):1);G?(e.fillStyle=O,e.fillRect(V,0,J,4)):U&&"log"!==i.scaleType&&(e.fillStyle=O,e.fillRect(V,h-4,J,h)),B.get("highlighted")&&(e.fillStyle=j,e.fillRect(V,0,J,h))}}catch(Y){I.e(Y)}finally{I.f()}d&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",l.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(A(t))),e.lineTo(m,Math.round(A(t))),e.stroke()})))}}]),n}(cr),Jr=Object(P.ConfigurationSchema)("XYPlotRenderer",{},{baseConfiguration:jr,explicitlyTyped:!0}),Qr=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,a,r=t.features,o=t.regions,i=t.bpPerPx,c=t.scaleOpts,s=t.height,l=t.ticks.values,d=t.displayCrossHatches,p=t.config,m=Object(f.a)(o,1)[0],g=(m.end-m.start)/i,h=Lr,b=s-2*h,v=Object(P.readConfObject)(p,"clipColor"),y=Object(P.readConfObject)(p,"highlightColor"),w=yr(Object(u.a)(Object(u.a)({},c),{},{range:[0,b]})),O=w.domain(),j=Object(f.a)(O,2),k=j[0],C=j[1],E=function(e){return b-w(e)+h},x="#f0f"===Object(P.readConfObject)(p,"color")?function(e){return"grey"}:function(e){return Object(P.readConfObject)(p,"color",{feature:e})},S=Object(He.a)(r.values());try{for(S.s();!(a=S.n()).done;){var T=a.value,N=Object(_.featureSpanPx)(T,m,i),A=Object(f.a)(N,2),R=A[0],M=A[1],F=T.get("score"),I=F<k,B=F>C,L=M-R+.3,D=x(T);e.strokeStyle=D,e.beginPath(),m.reversed?(e.moveTo(M,E("undefined"!==typeof n?n:F)),e.lineTo(M,E(F)),e.lineTo(R,E(F))):(e.moveTo(R,E("undefined"!==typeof n?n:F)),e.lineTo(R,E(F)),e.lineTo(M,E(F))),e.stroke(),n=F,B?(e.fillStyle=v,e.fillRect(R,0,L,4)):I&&"log"!==c.scaleType&&(e.fillStyle=v,e.fillRect(R,b-4,L,b)),T.get("highlighted")&&(e.fillStyle=y,e.fillRect(R,0,L,b))}}catch(V){S.e(V)}finally{S.f()}d&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",l.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(E(t))),e.lineTo(g,Math.round(E(t))),e.stroke()})))}}]),n}(cr),Xr=Object(P.ConfigurationSchema)("LinePlotRenderer",{},{baseConfiguration:jr,explicitlyTyped:!0}),Yr=n(334),Kr=n(232),Zr=n(997),$r=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="WiggleGetGlobalStats",e}return Object(h.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Yr.a)(Object(Kr.a)(n.prototype),"deserializeArguments",this).call(this,t);case 2:return a=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)({},a),{},{filters:t.filters?new Zr.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.adapterConfig,r=n.sessionId,o=W(this.pluginManager,r,a),!((i=o.dataAdapter)instanceof H.BaseFeatureDataAdapter&&i.constructor.capabilities.includes("hasGlobalStats"))){e.next=7;break}return e.abrupt("return",i.getGlobalStats(n));case 7:return e.abrupt("return",Object(pr.a)());case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),eo=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="WiggleGetMultiRegionStats",e}return Object(h.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Yr.a)(Object(Kr.a)(n.prototype),"deserializeArguments",this).call(this,t);case 2:return a=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)({},a),{},{filters:t.filters?new Zr.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.pluginManager.rootModel)||void 0===n||null===(a=n.session)||void 0===a?void 0:a.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",Object(_.renameRegionsIfNeeded)(r,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.regions,r=n.adapterConfig,o=n.sessionId,i=W(this.pluginManager,o,r),!((s=i.dataAdapter)instanceof H.BaseFeatureDataAdapter)){e.next=7;break}return e.abrupt("return",s.getMultiRegionStats(a,n));case 7:return e.abrupt("return",Object(pr.a)());case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),to=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:Hr,XYPlotRendererReactComponent:sr,utils:r,WiggleBaseRenderer:cr,linearWiggleDisplayModelFactory:qr},e}return Object(h.a)(n,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e)});return new w.a({name:"QuantitativeTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"QuantitativeTrack",t)})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,a=e.getRendererType("LinePlotRenderer").configSchema;return Object(P.ConfigurationSchema)("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:b.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:b.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:b.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:Object(P.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:a})},{baseConfiguration:ze,explicitlyTyped:!0})}(e);return new O.a({name:"LinearWiggleDisplay",configSchema:t,stateModel:qr(e,t),trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:Hr})})),e.addAdapterType((function(){return new y.a({name:"BigWigAdapter",configSchema:gr,AdapterClass:mr})})),e.addRendererType((function(){return new kr({name:"DensityRenderer",ReactComponent:sr,configSchema:Cr,pluginManager:e})})),e.addRendererType((function(){return new Qr({name:"LinePlotRenderer",ReactComponent:sr,configSchema:Xr,pluginManager:e})})),e.addRendererType((function(){return new Gr({name:"XYPlotRenderer",ReactComponent:sr,configSchema:Jr,pluginManager:e})})),e.addRpcMethod((function(){return new $r(e)})),e.addRpcMethod((function(){return new eo(e)}))}}]),n}(F.a),no=n(2520);function ao(e){return(e||"").split(/([MIDNSHPX=])/)}function ro(e,t,n){for(var a=0,r=0,o=[],i=0;i<e.length-1;i+=2){var c=+e[i],s=e[i+1];if("M"!==s&&"="!==s&&"E"!==s||(r+=c),"I"===s)o.push({start:a,type:"insertion",base:"".concat(c),length:0}),r+=c;else if("D"===s)o.push({start:a,type:"deletion",base:"*",length:c});else if("N"===s)o.push({start:a,type:"skip",base:"N",length:c});else if("X"===s){for(var l=t.slice(r,r+c),u=(null===n||void 0===n?void 0:n.slice(r,r+c))||[],d=0;d<c;d++)o.push({start:a+d,type:"mismatch",base:l[d],qual:u[d],length:1});r+=c}else"H"===s?o.push({start:a,type:"hardclip",base:"H".concat(c),cliplen:c,length:1}):"S"===s&&(o.push({start:a,type:"softclip",base:"S".concat(c),cliplen:c,length:1}),r+=c);"I"!==s&&"S"!==s&&"H"!==s&&(a+=c)}return o}function oo(e,t,n,a,r){var o=[],i={start:0,base:"",length:0,type:"mismatch"},c=n.filter((function(e){return"skip"===e.type})),s=0,l=0,u=0,d=0;function f(){o.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}function p(e){for(var n=l,a=u,r=s;r<t.length&&a<=e;s=r+=2){var o=+t[r],i=t[r+1];"S"===i||"I"===i?n+=o:"D"===i||"P"===i||"N"===i?a+=o:"H"!==i&&(n+=o,a+=o)}return l=n,u=a,n-(a-e)}for(var m=e.match(/(\d+|\^[a-z]+|[a-z])/gi)||[],g=0;g<m.length;g++){var h=m[g];if(h.match(/^\d/))i.start+=parseInt(h,10);else if(h.match(/^\^/))i.length=h.length-1,i.base="*",i.type="deletion",i.seq=h.substring(1),f();else if(h.match(/^[a-z]/i))for(var b=0;b<h.length;b+=1){for(i.length=1;d<c.length;){var v=c[d];if(!(i.start>=v.start))break;i.start+=v.length,d++}var y=t?p(i.start):i.start;i.base=a?a.substr(y,1):"X";var w=null===r||void 0===r?void 0:r.slice(y,y+1)[0];w&&(i.qual=w),i.altbase=h,f()}}return o}function io(e,t){for(var n=0,a=0,r=0;r<t.length&&a<=e;r+=2){var o=+t[r],i=t[r+1];"S"===i||"I"===i?n+=o:"D"===i||"P"===i?a+=o:"H"!==i&&(n+=o,a+=o)}return n-(a-e)}function co(e,t,n,a){var r=[],o=[];e&&(o=ao(e),r=r.concat(ro(o,n,a))),t&&(r=r.concat(oo(t,o,r,n,a)));var i={};return r.filter((function(e){var t="".concat(e.type,",").concat(e.start,",").concat(e.length),n=i[t];return i[t]=!0,!n}))}function so(e,t,n){var a=0,r=0,o=0;if(!e)return console.warn("no ref supplied to generateMD"),"";for(var i=ao(n),c="",s=0;s<i.length;s+=2){var l=+i[s],u=i[s+1];if("M"===u||"X"===u||"="===u){for(var d=0;d<l;d++)t[a+d].toLowerCase()!==e[r+d].toLowerCase()?(c+="".concat(o).concat(e[r+d].toUpperCase()),o=0):o++;a+=l,r+=l}else if("I"===u)a+=l;else if("D"===u){for(var f="",p=0;p<l;p++)f+=e[r+p].toUpperCase();c+="".concat(o,"^").concat(f),o=0,r+=l}else"N"===u?r+=l:"S"===u&&(a+=l)}return o>0&&(c+=o),c}var lo=["clipPos","flags"];function uo(e){var t=Object(Be.useStyles)(),n=e.feature.flags;return m.a.createElement(Be.BaseCard,Object.assign({},e,{title:"Flags"}),m.a.createElement("div",{style:{display:"flex"}},m.a.createElement("div",{className:t.fieldName},"Flag"),m.a.createElement("div",{className:t.fieldValue},n)),["read paired","read mapped in proper pair","read unmapped","mate unmapped","read reverse strand","mate reverse strand","first in pair","second in pair","not primary alignment","read fails platform/vendor quality checks","read is PCR or optical duplicate","supplementary alignment"].map((function(e,t){var a=n&1<<t,r="".concat(e,"_").concat(a);return m.a.createElement("div",{key:r},m.a.createElement("input",{type:"checkbox",checked:Boolean(a),id:r,readOnly:!0}),m.a.createElement("label",{htmlFor:r},e))})))}function fo(e){var t=e.value,n=Object(p.useState)(!1),a=Object(f.a)(n,2),r=a[0],o=a[1],i=String(t);return i.length>100?m.a.createElement(m.a.Fragment,null,m.a.createElement("button",{type:"button",onClick:function(){return Wa()(i)}},"Copy"),m.a.createElement("button",{type:"button",onClick:function(){return o((function(e){return!e}))}},r?"Show less":"Show more"),m.a.createElement("div",null,r?i:"".concat(i.slice(0,100),"..."))):m.a.createElement("div",null,i)}function po(e){var t=e.tag,n=e.model,a=Object(_.getSession)(n);return m.a.createElement(Be.BaseCard,Object.assign({},e,{title:"Supplementary alignments"}),m.a.createElement(Je.a,null,"List of supplementary alignment locations"),m.a.createElement("ul",null,t.split(";").filter((function(e){return!!e})).map((function(e,t){var r=e.split(","),o=Object(f.a)(r,4),i=o[0],c=o[1],s=o[2],l=function(e){for(var t=ao(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"H"!==o&&"S"!==o&&"I"!==o&&(n+=r)}return n}(o[3]),u=Math.floor(l/5),d=+c,p=+c+l,g="".concat(i,":").concat(Math.max(1,d-u),"-").concat(p+u),h="".concat(i,":").concat(d,"-").concat(p," (").concat(s,")");return m.a.createElement("li",{key:"".concat(g,"-").concat(t)},m.a.createElement(no.a,{onClick:function(){var e=n.view;e?e.navToLocString(g):a.notify("No view associated with this feature detail panel anymore","warning")},href:"#"},h))}))))}function mo(e){var t=e.locString,n=e.model,a=Object(_.getSession)(n);return m.a.createElement(no.a,{onClick:function(){var e=n.view;e?e.navToLocString(t):a.notify("No view associated with this feature detail panel anymore","warning")},href:"#"},t)}var go=Object(re.observer)((function(e){var t=e.model,n=JSON.parse(JSON.stringify(t.featureData)),a=n.tags&&n.tags.SA||n.SA;return m.a.createElement(nn.a,{"data-testid":"alignment-side-drawer"},m.a.createElement(Be.FeatureDetails,Object.assign({},e,{omit:lo,feature:n,formatter:function(e,n){return"next_segment_position"===n?m.a.createElement(mo,{model:t,locString:e}):m.a.createElement(fo,{value:e})}})),a?m.a.createElement(po,{model:t,tag:a}):null,m.a.createElement(uo,Object.assign({feature:n},e)))})),ho=Object(P.ConfigurationSchema)("AlignmentsFeatureWidget",{});function bo(e){return b.types.model("AlignmentsFeatureWidget",{id:Ie.ElementId,type:b.types.literal("AlignmentsFeatureWidget"),featureData:b.types.frozen(),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var vo=b.types.late((function(){return Object(P.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam"}},index:Object(P.ConfigurationSchema)("BamIndex",{indexType:{model:b.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai"}}}),chunkSizeLimit:{type:"number",defaultValue:1e8},fetchSizeLimit:{type:"number",defaultValue:5e8},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),yo=n(1093),wo=function(){function e(t,n,a){Object(g.a)(this,e),this.record=void 0,this.adapter=void 0,this.ref=void 0,this.record=t,this.adapter=n,this.ref=a}return Object(h.a)(e,[{key:"_get_name",value:function(){return this.record.get("name")}},{key:"_get_type",value:function(){return"match"}},{key:"_get_score",value:function(){return this.record.get("mq")}},{key:"_get_flags",value:function(){return this.record.flags}},{key:"_get_strand",value:function(){return this.record.isReverseComplemented()?-1:1}},{key:"_get_read_group_id",value:function(){return this.record.readGroupId}},{key:"_get_pair_orientation",value:function(){return this.record.isPaired()?this.record.getPairOrientation():void 0}},{key:"_get_next_seq_id",value:function(){return this.record._next_refid()}},{key:"_get_seq_id",value:function(){return this.record._refID}},{key:"_get_next_refName",value:function(){return this.adapter.refIdToName(this.record._next_refid())}},{key:"_get_next_segment_position",value:function(){return this.record.isPaired()?"".concat(this.adapter.refIdToName(this.record._next_refid()),":").concat(this.record._next_pos()+1):void 0}},{key:"_get_seq",value:function(){return this.record.getReadBases()}},{key:"_get_MD",value:function(){var e=this.record.get("MD"),t=this.get("seq");return!e&&t&&this.ref?so(this.ref,this.record.getReadBases(),this.get("CIGAR")):e}},{key:"qualRaw",value:function(){return this.record.qualRaw()}},{key:"set",value:function(){}},{key:"tags",value:function(){var t=Object.getOwnPropertyNames(e.prototype);return Object(s.a)(new Set(t.filter((function(e){return e.startsWith("_get_")&&"_get_mismatches"!==e&&"_get_skips_and_dels"!==e&&"_get_cram_read_features"!==e&&"_get_tags"!==e&&"_get_next_seq_id"!==e&&"_get_seq_id"!==e})).map((function(e){return e.replace("_get_","")})).concat(this.record._tags())))}},{key:"id",value:function(){return"".concat(this.adapter.id,"-").concat(this.record.id())}},{key:"get",value:function(e){var t="_get_".concat(e);return this[t]?this[t]():this.record.get(e)}},{key:"_get_refName",value:function(){return this.adapter.refIdToName(this.record.seq_id())}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"pairedFeature",value:function(){return!1}},{key:"toJSON",value:function(){var e=this,t=Object.fromEntries(this.tags().map((function(t){return[t,e.get(t)]})).filter((function(e){return void 0!==e[1]})));return Object(u.a)(Object(u.a)({},t),{},{uniqueId:this.id()})}},{key:"_get_skips_and_dels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cigarAttributeName:"CIGAR"},t=e.cigarAttributeName,n=[],a=[],r=this.get(t);return r&&(a=ao(r),n=n.concat(ro(a,this.get("seq"),this.qualRaw()))),n}},{key:"_get_mismatches",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cigarAttributeName,n=void 0===t?"CIGAR":t,a=e.mdAttributeName,r=void 0===a?"MD":a,o=[],i=[],c=this.get(n);c&&(i=ao(c),o=o.concat(ro(i,this.get("seq"),this.qualRaw())));var s=this.get(r);s&&(o=o.concat(oo(s,i,o,this.get("seq"),this.qualRaw())));var l={};return o.filter((function(e){var t="".concat(e.type,",").concat(e.start,",").concat(e.length),n=l[t];return l[t]=!0,!n}))}},{key:"_get_clipPos",value:function(){var e=this.get("CIGAR")||"";return-1===this.get("strand")?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}}]),e}(),Oo=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r;return Object(g.a)(this,n),(r=t.call(this,e)).bam=void 0,r.sequenceAdapter=void 0,r.samHeader={},r.configure(e,a),r}return Object(h.a)(n,[{key:"configure",value:function(e,t){var n=Object(P.readConfObject)(e,"bamLocation"),a=Object(P.readConfObject)(e,["index","location"]),r=Object(P.readConfObject)(e,["index","indexType"]),o=Object(P.readConfObject)(e,"chunkSizeLimit"),i=Object(P.readConfObject)(e,"fetchSizeLimit");this.bam=new yo.BamFile({bamFilehandle:Object(oe.openLocation)(n),csiFilehandle:"CSI"===r?Object(oe.openLocation)(a):void 0,baiFilehandle:"CSI"!==r?Object(oe.openLocation)(a):void 0,chunkSizeLimit:o,fetchSizeLimit:i});var c=Object(P.readConfObject)(e,"sequenceAdapter");if(c&&t){var s=t(c).dataAdapter;this.sequenceAdapter=s}}},{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.bam.getHeaderText(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t||{}).statusCallback,a=void 0===n?function(){}:n,0!==Object.keys(this.samHeader).length){e.next=12;break}return a("Downloading index"),e.next=5,this.bam.getHeader(t);case 5:r=e.sent,o=[],i={},r.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var n=e.value;i[n]=t,o[t]=n}}))})),o.length&&(this.samHeader={idToName:o,nameToId:i}),a("");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:if(!this.samHeader.idToName){e.next=4;break}return e.abrupt("return",this.samHeader.idToName);case 4:throw new Error("unable to get refnames");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"seqFetch",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.sequenceAdapter){e.next=3;break}return e.abrupt("return",void 0);case 3:if(t){e.next=5;break}return e.abrupt("return",void 0);case 5:return o=r.getFeatures({refName:t,start:n,end:a,assemblyName:""}),e.next=8,o.pipe(Object(B.a)()).toPromise();case 8:if(i=e.sent,s=[],i.sort((function(e,t){return e.get("start")-t.get("start")})).forEach((function(e){var t=e.get("start"),r=e.get("end"),o=Math.max(n-t,0),i=Math.min(a-t,r-t)-o,c=e.get("seq")||e.get("residues");s.push(c.substr(o,i))})),(l=s.join("")).length===a-n){e.next=14;break}throw new Error("sequence fetch failed: fetching ".concat(t,":").concat((n-1).toLocaleString(),"-").concat(a.toLocaleString()," returned ").concat(l.length.toLocaleString()," bases, but should have returned ").concat((a-n).toLocaleString()));case 14:return e.abrupt("return",l);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e,t){var n=this,a=e.refName,r=e.start,o=e.end,i=e.originalRefName,s=t||{},u=s.signal,d=s.statusCallback,f=void 0===d?function(){}:d;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(s){var l,d,p,m,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setup(t);case 2:return f("Downloading alignments"),e.next=5,n.bam.getRecordsForRange(a,r,o,t);case 5:l=e.sent,Object(_.checkAbortSignal)(u),d=Object(He.a)(l),e.prev=8,d.s();case 10:if((p=d.n()).done){e.next=20;break}if(m=p.value,g=void 0,m.get("md")){e.next=17;break}return e.next=16,n.seqFetch(i||a,m.get("start"),m.get("end"));case 16:g=e.sent;case 17:s.next(new wo(m,n,g));case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(8),d.e(e.t0);case 25:return e.prev=25,d.f(),e.finish(25);case 28:f(""),s.complete();case 30:case"end":return e.stop()}}),e,null,[[8,22,25,28]])})));return function(t){return e.apply(this,arguments)}}(),u)}},{key:"freeResources",value:function(){}},{key:"refIdToName",value:function(e){if(this.samHeader.idToName)return this.samHeader.idToName[e]}}]),n}(H.BaseFeatureDataAdapter),jo=function(){return{configSchema:vo,AdapterClass:Oo}},ko=function(e){return e.lib["mobx-state-tree"].types.late((function(){return Object(P.ConfigurationSchema)("CramAdapter",{cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai"}},sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},Co=n(947),Eo=n(2003),xo=function(){function e(t,n){Object(g.a)(this,e),this.record=void 0,this._store=void 0,this.record=t,this._store=n}return Object(h.a)(e,[{key:"_get_name",value:function(){return this.record.readName}},{key:"_get_start",value:function(){return this.record.alignmentStart-1}},{key:"_get_end",value:function(){return this.record.alignmentStart+this.record.lengthOnRef-1}},{key:"_get_cram_read_features",value:function(){return this.record.readFeatures}},{key:"_get_type",value:function(){return"match"}},{key:"_get_score",value:function(){return this.record.mappingQuality}},{key:"_get_flags",value:function(){return this.record.flags}},{key:"_get_strand",value:function(){return this.record.isReverseComplemented()?-1:1}},{key:"_read_group_id",value:function(){var e=this._store.samHeader.readGroups;return e?e[this.record.readGroupId]:void 0}},{key:"_get_qual",value:function(){return(this.record.qualityScores||[]).join(" ")}},{key:"qualRaw",value:function(){return this.record.qualityScores}},{key:"_get_seq_id",value:function(){return this._store.refIdToName(this.record.sequenceId)}},{key:"_get_refName",value:function(){return this._get_seq_id()}},{key:"_get_is_paired",value:function(){return!!this.record.mate}},{key:"_get_pair_orientation",value:function(){return this.record.isPaired()?this.record.getPairOrientation():void 0}},{key:"_get_template_length",value:function(){return this.record.templateLength||this.record.templateSize}},{key:"_get_next_seq_id",value:function(){return this.record.mate?this._store.refIdToName(this.record.mate.sequenceId):void 0}},{key:"_get_next_pos",value:function(){return this.record.mate?this.record.mate.alignmentStart:void 0}},{key:"_get_next_segment_position",value:function(){return this.record.mate?"".concat(this._store.refIdToName(this.record.mate.sequenceId),":").concat(this.record.mate.alignmentStart):void 0}},{key:"_get_tags",value:function(){var e=this._read_group_id(),t=this.record.tags;return void 0!==e?Object(u.a)(Object(u.a)({},t),{},{RG:e}):t}},{key:"_get_seq",value:function(){return this.record.getReadBases()}},{key:"_get_CIGAR",value:function(){var e="",t="",n="M",a=0,r=this.record._refRegion.seq,o=this.record._refRegion.start,i=this.record.alignmentStart,c=0;return"undefined"!==typeof this.record.readFeatures?this.record.readFeatures.forEach((function(l){var u=l.code,d=l.refPos,f=l.sub,p=l.data;if(c=d-i,e+=r.substring(i-o,d-o),i=d,a&&"M"!==n&&(t+=a+n,a=0),c&&(n="M",a+=c),"b"===u){var m=p.split(","),g=String.fromCharCode.apply(String,Object(s.a)(m));e+=g,i+=g.length,a+=g.length}else"B"===u||"X"===u?(e+=f,i++,a++):"D"===u||"N"===u?(i+=p,a&&(t+=a+n),t+=p+u,a=0):"I"===u||"S"===u?(e+=p,a&&(t+=a+n),t+=p.length+u,a=0):"i"===u?(e+=p,a&&(t+=a+n),t+="".concat(1,"I"),a=0):"P"===u?(a&&(t+=a+n),t+="".concat(p,"P")):"H"===u&&(a&&(t+=a+n),t+="".concat(p,"H"),a=0)})):c=this.record.readLength-e.length,e.length!==this.record.readLength&&(c=this.record.readLength-e.length,e+=r.substring(i-o,i-o+c),a&&"M"!==n&&(t+=a+n,a=0),n="M",a+=c),a&&(t+=a+n),t}},{key:"tags",value:function(){return Object.getOwnPropertyNames(e.prototype).filter((function(e){return e.startsWith("_get_")&&"_get_mismatches"!==e&&"_get_skips_and_dels"!==e&&"_get_cram_read_features"!==e})).map((function(e){return e.replace("_get_","")}))}},{key:"id",value:function(){return"".concat(this._store.id,"-").concat(this.record.uniqueId)}},{key:"get",value:function(e){var t="_get_".concat(e);if(this[t])return this[t]()}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"set",value:function(){}},{key:"pairedFeature",value:function(){return!1}},{key:"_get_clipPos",value:function(){var e=this.get("mismatches");if(e.length){var t=-1===this.get("strand")?e[e.length-1]:e[0],n=t.type,a=t.cliplen;if("softclip"===n||"hardclip"===n)return a}return 0}},{key:"toJSON",value:function(){var e=this,t={};return this.tags().forEach((function(n){var a=e.get(n);void 0!==a&&(t[n]=a)})),Object(u.a)(Object(u.a)({},t),{},{name:this.get("name"),type:this.get("type"),uniqueId:this.id()})}},{key:"_get_mismatches",value:function(){var e=this.get("cram_read_features"),t=this.qualRaw();if(!e)return[];var n=this.get("start"),a=[];return e.forEach((function(e){var r=e.code,o=e.pos,i=e.data,c=e.sub,s=e.ref,l=e.refPos-1-n;if("X"===r)a.push({start:l,length:1,base:c,qual:null===t||void 0===t?void 0:t[o],altbase:s,type:"mismatch"});else if("I"===r)a.push({start:l,type:"insertion",base:"".concat(i.length),length:0});else if("N"===r)a.push({type:"skip",length:i,start:l,base:"N"});else if("S"===r){var u=i.length;a.push({start:l,type:"softclip",base:"S".concat(u),cliplen:u,length:1})}else if("P"===r);else if("H"===r){var d=i;a.push({start:l,type:"hardclip",base:"H".concat(d),cliplen:d,length:1})}else"D"===r?a.push({type:"deletion",length:i,start:l,base:"*"}):"b"===r||"q"===r||"B"===r||"i"===r&&a.push({start:l,type:"insertion",base:i,length:1})})),a}},{key:"_get_skips_and_dels",value:function(){return this._get_mismatches()}}]),e}(),So=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r;Object(g.a)(this,n),(r=t.call(this,e)).cram=void 0,r.sequenceAdapter=void 0,r.samHeader={},r.seqIdToRefName=void 0,r.seqIdToOriginalRefName=[];var o=Object(P.readConfObject)(e,"cramLocation"),i=Object(P.readConfObject)(e,"craiLocation");if(!o)throw new Error("missing cramLocation argument");if(!i)throw new Error("missing craiLocation argument");r.cram=new Eo.IndexedCramFile({cramFilehandle:Object(oe.openLocation)(o),index:new Eo.CraiIndex({filehandle:Object(oe.openLocation)(i)}),seqFetch:r.seqFetch.bind(Object(Co.a)(r)),checkSequenceMD5:!1,fetchSizeLimit:e.fetchSizeLimit||6e8});var c=Object(P.readConfObject)(e,["sequenceAdapter","type"]),s=null===a||void 0===a?void 0:a(Object(P.readConfObject)(e,"sequenceAdapter")).dataAdapter;if(!(s instanceof H.BaseFeatureDataAdapter))throw new Error("CRAM feature adapters cannot use sequence adapters of type '".concat(c,"'"));return r.sequenceAdapter=s,r}return Object(h.a)(n,[{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cram.cram.getHeaderText(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"seqFetch",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n-=1,r=this.sequenceAdapter){e.next=4;break}return e.abrupt("return",void 0);case 4:if(o=this.refIdToOriginalName(t)||this.refIdToName(t)){e.next=7;break}return e.abrupt("return",void 0);case 7:return i=r.getFeatures({refName:o,start:n,end:a,assemblyName:""},{}),e.next=10,i.pipe(Object(B.a)()).toPromise();case 10:if(s=e.sent,l=[],s.sort((function(e,t){return e.get("start")-t.get("start")})).forEach((function(e){var t=e.get("start"),r=e.get("end"),o=Math.max(n-t,0),i=Math.min(a-t,r-t)-o,c=e.get("seq")||e.get("residues");l.push(c.substr(o,i))})),(u=l.join("")).length===a-n){e.next=16;break}throw new Error("sequence fetch failed: fetching ".concat(o,":").concat((n-1).toLocaleString(),"-").concat(a.toLocaleString()," returned ").concat(u.length.toLocaleString()," bases, but should have returned ").concat((a-n).toLocaleString()));case 16:return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t||{}).statusCallback,a=void 0===n?function(){}:n,0!==Object.keys(this.samHeader).length){e.next=14;break}return a("Downloading index"),e.next=5,this.cram.cram.getSamHeader(null===t||void 0===t?void 0:t.signal);case 5:r=e.sent,o=[],i={},r.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var n=e.value;i[n]=t,o[t]=n}}))})),s=r.filter((function(e){return"RG"===e.tag})),l=s.map((function(e){return(e.data.find((function(e){return"ID"===e.tag}))||{}).value})),o.length&&(this.samHeader={idToName:o,nameToId:i,readGroups:l}),a("");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:if(!this.samHeader.idToName){e.next=4;break}return e.abrupt("return",this.samHeader.idToName);case 4:if(!this.sequenceAdapter){e.next=6;break}return e.abrupt("return",this.sequenceAdapter.getRefNames());case 6:throw new Error("unable to get refnames");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refNameToId",value:function(e){return this.samHeader.nameToId?this.samHeader.nameToId[e]:this.seqIdToRefName?this.seqIdToRefName.indexOf(e):void 0}},{key:"refIdToName",value:function(e){return this.samHeader.idToName?this.samHeader.idToName[e]:this.seqIdToRefName?this.seqIdToRefName[e]:void 0}},{key:"refIdToOriginalName",value:function(e){return this.seqIdToOriginalRefName[e]}},{key:"getFeatures",value:function(e,t){var n=this,a=t||{},r=a.signal,o=a.statusCallback,i=void 0===o?function(){}:o,s=e.refName,u=e.start,d=e.end,f=e.originalRefName;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(a){var o,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setup(t);case 2:if(!n.sequenceAdapter||n.seqIdToRefName){e.next=6;break}return e.next=5,n.sequenceAdapter.getRefNames(t);case 5:n.seqIdToRefName=e.sent;case 6:if(void 0===(o=n.refNameToId(s))){e.next=15;break}return f&&(n.seqIdToOriginalRefName[o]=f),i("Downloading alignments"),e.next=12,n.cram.getRecordsForRange(o,u,d,t);case 12:l=e.sent,Object(_.checkAbortSignal)(r),l.forEach((function(e){a.next(n.cramRecordToFeature(e))}));case 15:i(""),a.complete();case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r)}},{key:"freeResources",value:function(){}},{key:"cramRecordToFeature",value:function(e){return new xo(e,this)}}]),n}(H.BaseFeatureDataAdapter),To=function(){return So},No=function(e){return{configSchema:e.load(ko),AdapterClass:e.load(To)}},Ao=b.types.late((function(){return Object(P.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",defaultValue:""},htsgetTrackId:{type:"string",defaultValue:""},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),Ro=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"configure",value:function(e,t){var n=Object(P.readConfObject)(e,"htsgetBase"),a=Object(P.readConfObject)(e,"htsgetTrackId");this.bam=new yo.HtsgetFile({baseUrl:n,trackId:a});var r=Object(P.readConfObject)(e,"sequenceAdapter");if(r&&t){var o=t(r).dataAdapter;this.sequenceAdapter=o}}}]),n}(Oo),Mo=function(){return{configSchema:Ao,AdapterClass:Ro}},Po=function(e){var t=e.getRendererType("PileupRenderer").configSchema,n=e.getRendererType("SvgFeatureRenderer").configSchema,a=e.getRendererType("SNPCoverageRenderer").configSchema;return Object(P.ConfigurationSchema)("LinearAlignmentsDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:b.types.enumeration("Autoscale type",["local"]),description:"performs SNP Coverage local autoscaling"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the SNP coverage y-scale"},maxScore:{type:"number",description:"maximum value for the SNP coverage y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:b.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use for SNP coverage",defaultValue:"linear"},headroom:{type:"number",description:"round the upper value of the SNP coverage domain scale to the nearest N",defaultValue:0},defaultRendering:{type:"stringEnum",model:b.types.enumeration("Rendering",["pileup","svg"]),defaultValue:"pileup"},renderers:Object(P.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:t,SvgFeatureRenderer:n,SNPCoverageRenderer:a})},{baseConfiguration:ze,explicitlyTyped:!0})},Fo=n(1220),Io=n.n(Fo),Bo=function(e,t){return b.types.compose("LinearAlignmentsDisplay",Fe.BaseDisplay,b.types.model({PileupDisplay:b.types.maybe(e.getDisplayType("LinearPileupDisplay").stateModel),SNPCoverageDisplay:b.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:b.types.literal("LinearAlignmentsDisplay"),configuration:Object(P.ConfigurationReference)(t),height:250,showCoverage:!0,showPileup:!0})).volatile((function(){return{scrollTop:0}})).actions((function(e){return{toggleCoverage:function(){e.showCoverage=!e.showCoverage},togglePileup:function(){e.showPileup=!e.showPileup},setScrollTop:function(t){e.scrollTop=t},setSNPCoverageHeight:function(t){e.snpCovHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get pileupDisplayConfig(){var t=Object(P.getConf)(e),n=Object(_.getContainingTrack)(e),a=t.renderers,r=(a.SNPCoverageRenderer,Object(d.a)(a,["SNPCoverageRenderer"]));return Object(u.a)(Object(u.a)({},t),{},{renderers:Object(u.a)({},r),type:"LinearPileupDisplay",name:"".concat(Object(P.getConf)(n,"name")," pileup"),displayId:"".concat(e.configuration.displayId,"_pileup_xyz")})},get layoutFeatures(){return e.PileupDisplay.layoutFeatures},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get sortedByPosition(){return e.PileupDisplay.sortedByPosition},get sortedByRefName(){return e.PileupDisplay.sortedByRefName},get snpCoverageDisplayConfig(){var t=Object(P.getConf)(e),n=t.renderers.SNPCoverageRenderer;return Object(u.a)(Object(u.a)({},t),{},{renderers:{SNPCoverageRenderer:n},type:"LinearSNPCoverageDisplay",name:"".concat(Object(P.getConf)(Object(b.getParent)(e,2),"name")," pileup"),displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")})},get trackMenuItems(){return[].concat(Object(s.a)(t),[{type:"subMenu",label:"Pileup settings",subMenu:e.PileupDisplay.composedTrackMenuItems},{type:"subMenu",label:"SNPCoverage settings",subMenu:[].concat(Object(s.a)(e.SNPCoverageDisplay.composedTrackMenuItems),Object(s.a)(e.SNPCoverageDisplay.extraTrackMenuItems))}])}}})).actions((function(e){return{setSNPCoverageDisplay:function(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setPileupDisplay:function(t){e.PileupDisplay={type:"LinearPileupDisplay",configuration:t}},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n}}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(le.autorun)((function(){e.SNPCoverageDisplay?Io()(e.snpCoverageDisplayConfig,Object(b.getSnapshot)(e.SNPCoverageDisplay.configuration))||(e.SNPCoverageDisplay.setHeight(e.snpCovHeight),e.SNPCoverageDisplay.setConfig(e.snpCoverageDisplayConfig)):e.setSNPCoverageDisplay(e.snpCoverageDisplayConfig),e.PileupDisplay?Io()(e.pileupDisplayConfig,Object(b.getSnapshot)(e.PileupDisplay.configuration))||e.PileupDisplay.setConfig(e.pileupDisplayConfig):e.setPileupDisplay(e.pileupDisplayConfig),Io()(Object(b.getSnapshot)(e.PileupDisplay.filterBy),Object(b.getSnapshot)(e.SNPCoverageDisplay.filterBy))||e.SNPCoverageDisplay.setFilterBy(Object(b.getSnapshot)(e.PileupDisplay.filterBy))}))),Object(b.addDisposer)(e,Object(le.autorun)((function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)})))}}}))},Lo=Object(re.observer)((function(e){var t=e.model,n=t.PileupDisplay,a=t.SNPCoverageDisplay,r=t.showPileup,o=t.showCoverage;return m.a.createElement("div",{"data-testid":"display-".concat(Object(P.getConf)(t,"displayId")),style:{position:"relative"}},m.a.createElement("div",{"data-testid":"Blockset-snpcoverage"},o?m.a.createElement(a.RenderingComponent,{model:a}):null),m.a.createElement(ue.ResizeHandle,{onDrag:function(e){return a?(a.setHeight(a.height+e),e):0},style:{position:"absolute",top:o?a.height+2:0,height:3}}),m.a.createElement("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:o?a.height+5:0,height:3}},r?m.a.createElement(n.RenderingComponent,{model:n}):null))}));var Do=function(e){var t=e.getRendererType("PileupRenderer").configSchema,n=e.getRendererType("SvgFeatureRenderer").configSchema;return Object(P.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:b.types.enumeration("Rendering",["pileup","svg"]),defaultValue:"pileup"},renderers:Object(P.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:t,SvgFeatureRenderer:n}),maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:100},colorScheme:{type:"stringEnum",model:b.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:ze,explicitlyTyped:!0})},Vo=n(1228),Wo=n.n(Vo),qo=n(2132),zo=n.n(qo),Ho=n(2133),_o=n.n(Ho);var Uo=Object(re.observer)((function(e){var t=e.model,n=t.sortedBy;return n?m.a.createElement("div",{"data-testid":"blurb-".concat(t.sortedBy),style:{backgroundColor:"white"}},m.a.createElement(Je.a,{color:"secondary",variant:"caption"},t.sortedBy?"Sorted by ".concat(n.type.toLowerCase()," at ").concat(n.refName,":").concat(n.pos):null)):null})),Go=Object(Ze.a)((function(e){return{root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Jo(e){var t=Go(),n=e.display,a=e.handleClose,r=Object(p.useState)(""),o=Object(f.a)(r,2),i=o[0],c=o[1],s=i.match(/^[A-Za-z][A-Za-z0-9]$/);return m.a.createElement(Gt.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Color by tag",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:a},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,{style:{overflowX:"hidden"}},m.a.createElement("div",{className:t.root},m.a.createElement(Je.a,null,"Enter tag to color by: "),m.a.createElement(Je.a,{color:"textSecondary"},"Examples: XS or TS for RNA-seq inferred read strand, ts (lower-case) for minimap2 read strand, HP for haplotype, RG for read group, etc."),m.a.createElement(dn.a,{value:i,onChange:function(e){c(e.target.value)},placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"color-tag-name-input"},error:2===i.length&&!s,helperText:2!==i.length||s?"":"Not a valid tag",autoComplete:"off","data-testid":"color-tag-name"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",style:{marginLeft:20},onClick:function(){n.setColorScheme({type:"tag",tag:i}),a()},disabled:!s},"Submit"))))}var Qo=Object(Ze.a)((function(e){return{root:{width:500},paper:{padding:e.spacing(2),margin:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}})),Xo=["read paired","read mapped in proper pair","read unmapped","mate unmapped","read reverse strand","mate reverse strand","first in pair","second in pair","not primary alignment","read fails platform/vendor quality checks","read is PCR or optical duplicate","supplementary alignment"];function Yo(e){var t=e.flag,n=void 0===t?0:t,a=e.setFlag;return m.a.createElement(m.a.Fragment,null,m.a.createElement(dn.a,{type:"number",value:n,onChange:function(e){return a(+e.target.value)}}),Xo.map((function(e,t){var r=n&1<<t,o="".concat(e,"_").concat(r);return m.a.createElement("div",{key:o},m.a.createElement("input",{type:"checkbox",checked:Boolean(r),onChange:function(e){e.target.checked?a(n|1<<t):a(n&~(1<<t))}}),m.a.createElement("label",{htmlFor:o},e))})))}var Ko=Object(re.observer)((function(e){var t,n,a=e.display,r=e.handleClose,o=Qo(),i=a.filterBy,c=Object(p.useState)(null===i||void 0===i?void 0:i.flagInclude),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(p.useState)(null===i||void 0===i?void 0:i.flagExclude),g=Object(f.a)(d,2),h=g[0],b=g[1],v=Object(p.useState)((null===i||void 0===i||null===(t=i.tagFilter)||void 0===t?void 0:t.tag)||""),y=Object(f.a)(v,2),w=y[0],O=y[1],j=Object(p.useState)((null===i||void 0===i||null===(n=i.tagFilter)||void 0===n?void 0:n.value)||""),k=Object(f.a)(j,2),C=k[0],E=k[1],x=Object(p.useState)((null===i||void 0===i?void 0:i.readName)||""),S=Object(f.a)(x,2),T=S[0],N=S[1],A=w.match(/^[A-Za-z][A-Za-z0-9]$/),R="https://broadinstitute.github.io/picard/explain-flags.html";return m.a.createElement(Gt.a,{open:!0,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Filter options",m.a.createElement(Qt.a,{"aria-label":"close",className:o.closeButton,onClick:r},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,null,m.a.createElement(Je.a,null,"Set filter bitmask options. Refer to ",m.a.createElement(no.a,{href:R},R)," ","for details"),m.a.createElement("div",{className:o.root},m.a.createElement(nn.a,{className:o.paper,variant:"outlined"},m.a.createElement("div",{style:{display:"flex"}},m.a.createElement("div",null,m.a.createElement(Je.a,null,"Read must have ALL these flags"),m.a.createElement(Yo,{flag:l,setFlag:u})),m.a.createElement("div",null,m.a.createElement(Je.a,null,"Read must have NONE of these flags"),m.a.createElement(Yo,{flag:h,setFlag:b})))),m.a.createElement(nn.a,{className:o.paper,variant:"outlined"},m.a.createElement(Je.a,null,"Filter by tag name and value. Use * in the value field to get all reads containing any value for that tag. Example: filter tag name SA with value * to get all split/supplementary reads. Other examples include HP for haplotype, or RG for read group"),m.a.createElement(dn.a,{className:o.field,value:w,onChange:function(e){O(e.target.value)},placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"color-tag-name-input"},error:2===w.length&&!A,helperText:2!==w.length||A?"":"Not a valid tag","data-testid":"color-tag-name"}),m.a.createElement(dn.a,{className:o.field,value:C,onChange:function(e){E(e.target.value)},placeholder:"Enter tag value",inputProps:{"data-testid":"color-tag-name-input"},"data-testid":"color-tag-value"})),m.a.createElement(nn.a,{className:o.paper,variant:"outlined"},m.a.createElement(Je.a,null,"Filter by read name"),m.a.createElement(dn.a,{className:o.field,value:T,onChange:function(e){N(e.target.value)},placeholder:"Enter read name",inputProps:{"data-testid":"color-tag-readname-input"},"data-testid":"color-tag-readname"})),m.a.createElement(Ge.a,{variant:"contained",color:"primary",onClick:function(){a.setFilterBy({flagInclude:l,flagExclude:h,readName:T,tagFilter:""!==w?{tag:w,value:C}:void 0}),r()}},"Submit"))))})),Zo=Object(Ze.a)((function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function $o(e){var t=Zo(),n=e.display,a=e.handleClose,r=Object(p.useState)(""),o=Object(f.a)(r,2),i=o[0],c=o[1],s=i.match(/^[A-Za-z][A-Za-z0-9]$/);return m.a.createElement(Gt.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Sort by tag",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:a},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,null,m.a.createElement("div",null,m.a.createElement(Je.a,null,"Set the tag to sort by"),m.a.createElement(Je.a,{color:"textSecondary"},"Examples: HP for haplotype, RG for read group, etc."),m.a.createElement(dn.a,{value:i,onChange:function(e){c(e.target.value)},placeholder:"Enter tag name",inputProps:{maxLength:2,"data-testid":"sort-tag-name-input"},error:2===i.length&&!s,helperText:2!==i.length||s?"":"Not a valid tag",autoComplete:"off","data-testid":"sort-tag-name"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",onClick:function(){n.setSortedBy("tag",i),a()}},"Submit"))))}var ei=n(2478),ti=n(2543),ni=Object(Ze.a)((function(e){return{root:{margin:e.spacing(4)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function ai(e){var t=ni(),n=e.display,a=e.handleClose,r=n.featureHeightSetting,o=n.noSpacing,i=Object(p.useState)("".concat(r)),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(p.useState)(o),d=Object(f.a)(u,2),g=d[0],h=d[1],b=""!==s&&!Number.isNaN(+s);return m.a.createElement(Gt.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Set feature height",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:a},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,{style:{overflowX:"hidden"}},m.a.createElement(Je.a,null,"Adjust the feature height and whether there is any spacing between features. Setting feature height to 1 and removing spacing makes the display very compact"),m.a.createElement("div",{className:t.root},m.a.createElement(Je.a,null,"Enter feature height: "),m.a.createElement(dn.a,{value:s,onChange:function(e){l(e.target.value)}}),m.a.createElement(ei.a,{control:m.a.createElement(ti.a,{checked:!!g,onChange:function(){return h((function(e){return!e}))}}),label:"Remove spacing between features in y-direction?"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},disabled:!b,onClick:function(){n.setFeatureHeight(""===s||Number.isNaN(+s)?void 0:+s),n.setNoSpacing(g),a()}},"Submit"))))}var ri=Object(Ze.a)((function(e){return{root:{width:500},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},field:{margin:e.spacing(2)}}})),oi=Object(re.observer)((function(e){var t=e.display,n=e.handleClose,a=ri(),r=t.maxHeight,o=void 0===r?"":r,i=Object(p.useState)("".concat(o)),c=Object(f.a)(i,2),s=c[0],l=c[1];return m.a.createElement(Gt.a,{open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Filter options",m.a.createElement(Qt.a,{"aria-label":"close",className:a.closeButton,onClick:n},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,null,m.a.createElement("div",{className:a.root},m.a.createElement(Je.a,null,"Set max height for the track"),m.a.createElement(dn.a,{value:s,onChange:function(e){l(e.target.value)},placeholder:"Enter max height for layout"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",type:"submit",style:{marginLeft:20},onClick:function(){t.setMaxHeight(""===s||Number.isNaN(+s)?void 0:+s),n()}},"Submit"))))})),ii=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]),ci=function(e,t){return b.types.compose("LinearPileupDisplay",St,b.types.model({type:b.types.literal("LinearPileupDisplay"),configuration:Object(P.ConfigurationReference)(t),showSoftClipping:!1,featureHeight:b.types.maybe(b.types.number),noSpacing:b.types.maybe(b.types.boolean),trackMaxHeight:b.types.maybe(b.types.number),sortedBy:b.types.maybe(b.types.model({type:b.types.string,pos:b.types.number,tag:b.types.maybe(b.types.string),refName:b.types.string,assemblyName:b.types.string})),colorBy:b.types.maybe(b.types.model({type:b.types.string,tag:b.types.maybe(b.types.string)})),filterBy:b.types.optional(b.types.model({flagInclude:b.types.optional(b.types.number,0),flagExclude:b.types.optional(b.types.number,1536),readName:b.types.maybe(b.types.string),tagFilter:b.types.maybe(b.types.model({tag:b.types.string,value:b.types.string}))}),{})})).volatile((function(){return{colorTagMap:le.observable.map({}),ready:!1,currBpPerPx:0}})).actions((function(e){return{setReady:function(t){e.ready=t},setCurrBpPerPx:function(t){e.currBpPerPx=t},setMaxHeight:function(t){e.trackMaxHeight=t},setFeatureHeight:function(t){e.featureHeight=t},setNoSpacing:function(t){e.noSpacing=t},setColorScheme:function(t){e.colorTagMap=le.observable.map({}),e.colorBy=Object(b.cast)(t),e.ready=!1},getUniqueTagValues:function(t,n,a){return Object(l.a)(c.a.mark((function r(){var o,i,s,l,d;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=Object(_.getSession)(e),i=o.rpcManager,s=e.adapterConfig,l=Object(Ue.getRpcSessionId)(e),r.next=5,i.call(Object(Ue.getRpcSessionId)(e),"PileupGetGlobalValueForTag",Object(u.a)({adapterConfig:s,tag:t.tag,sessionId:l,regions:n.contentBlocks},a));case 5:return d=r.sent,r.abrupt("return",d);case 7:case"end":return r.stop()}}),r)})))()},updateColorTagMap:function(t){var n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((function(t){if(!e.colorTagMap.has(t)){var a=Object(s.a)(e.colorTagMap.keys()).length,r=n[a];e.colorTagMap.set(t,r)}}))}}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(le.autorun)(Object(l.a)(c.a.mark((function t(){var n,a,r,o,i,s,l,d,f,p,m;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=Object(_.getSession)(e),a=n.rpcManager,r=e.sortedBy,o=e.colorBy,i=e.renderProps,s=Object(_.getContainingView)(e),!(null===o||void 0===o?void 0:o.tag)){t.next=9;break}return t.next=7,e.getUniqueTagValues(o,s.staticBlocks);case 7:l=t.sent,e.updateColorTagMap(l);case 9:if(!r){t.next=18;break}return d=r.pos,f=r.refName,p=r.assemblyName,m={start:d,end:(d||0)+1,refName:f,assemblyName:p},t.next=14,e.rendererType.renderInClient(a,Object(u.a)({assemblyName:p,regions:[m],adapterConfig:e.adapterConfig,rendererType:e.rendererType.name,sessionId:Object(Ue.getRpcSessionId)(e),timeout:1e6},i));case 14:e.setReady(!0),e.setCurrBpPerPx(s.bpPerPx),t.next=19;break;case 18:e.setReady(!0);case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 25:case"end":return t.stop()}}),t,null,[[0,21]])}))),{delay:1e3}))},selectFeature:function(t){var n=Object(_.getSession)(e);if(Object(_.isSessionModelWithWidgets)(n)){var a=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:Object(_.getContainingView)(e)});n.showWidget(a)}n.setSelection(t)},clearSelected:function(){e.sortedBy=void 0},copyFeatureToClipboard:function(t){var n=t.toJSON();delete n.uniqueId;var a=Object(_.getSession)(e);Wa()(JSON.stringify(n,null,4)),a.notify("Copied to clipboard","success")},toggleSoftClipping:function(){e.showSoftClipping=!e.showSoftClipping},setConfig:function(t){e.configuration=t},setSortedBy:function(t,n){var a=Object(_.getContainingView)(e).centerLineInfo;if(a){var r=a.refName,o=a.assemblyName,i=a.offset,c=Math.round(i)+1,s=r;c<0||(e.sortedBy={type:t,pos:c,refName:s,assemblyName:o,tag:n},e.ready=!1)}},setFilterBy:function(t){e.filterBy=Object(b.cast)(t)}}})).actions((function(e){var t=e.reload;return{reload:function(){e.clearSelected(),t()}}})).views((function(e){return{get maxHeight(){var t=Object(P.getConf)(e,["renderers",e.rendererTypeName])||{};return void 0!==e.trackMaxHeight?e.trackMaxHeight:t.maxHeight},get rendererConfig(){var t=Object(P.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{height:e.featureHeight,noSpacing:e.noSpacing,maxHeight:this.maxHeight}))},get featureHeightSetting(){return e.featureHeight||Object(P.readConfObject)(this.rendererConfig,"height")}}})).views((function(t){var n=t.trackMenuItems;return{get rendererTypeName(){var e=Object(P.getConf)(t,"defaultRendering"),n=ii.get(e);if(!n)throw new Error("unknown alignments view name ".concat(e));return n},get contextMenuItems(){var n=t.contextMenuFeature,a=n?[{label:"Open feature details",icon:Xe.a,onClick:function(){t.clearFeatureSelection(),n&&t.selectFeature(n)}},{label:"Copy info to clipboard",icon:Pt,onClick:function(){n&&t.copyFeatureToClipboard(n)}}]:[];return t.additionalContextMenuItemCallbacks.forEach((function(r){var o=r(n,t,e);a.push.apply(a,Object(s.a)(o))})),a},get DisplayBlurb(){return Uo},get filters(){var e=[];if(t.filterBy){var n=t.filterBy,a=n.flagInclude,r=n.flagExclude;if(e=["jexl:((get(feature,'flags')&".concat(a,")==").concat(a,") && !(get(feature,'flags')&").concat(r,")")],t.filterBy.tagFilter){var o=t.filterBy.tagFilter,i=o.tag,c=o.value;e.push('jexl:"'.concat(c,"\" =='*' ? getTag(feature,\"").concat(i,'") != undefined : getTag(feature,"').concat(i,'") == "').concat(c,'")'))}if(t.filterBy.readName){var s=t.filterBy.readName;e.push("jexl:get(feature,'name') == \"".concat(s,'"'))}}return e},get renderProps(){var e=Object(_.getContainingView)(t);return Object(u.a)(Object(u.a)(Object(u.a)({},t.composedRenderProps),Object(Ue.getParentRenderProps)(t)),{},{notReady:!t.ready||t.sortedBy&&t.currBpPerPx!==e.bpPerPx,displayModel:t,sortedBy:t.sortedBy,colorBy:t.colorBy,colorTagMap:JSON.parse(JSON.stringify(t.colorTagMap)),filters:this.filters,showSoftClip:t.showSoftClipping,config:t.rendererConfig})},get composedTrackMenuItems(){return[{label:"Show soft clipping",icon:Dt.a,type:"checkbox",checked:t.showSoftClipping,onClick:function(){t.toggleSoftClipping(),t.showSoftClipping&&t.clearSelected()}},{label:"Sort by",icon:Wo.a,disabled:t.showSoftClipping,subMenu:[].concat(Object(s.a)(["Start location","Read strand","Base pair"].map((function(e){return{label:e,onClick:function(){return t.setSortedBy(e)}}}))),[{label:"Sort by tag...",onClick:function(){return Object(_.getContainingTrack)(t).setDialogComponent($o,t)}},{label:"Clear sort",onClick:function(){return t.clearSelected()}}])},{label:"Color scheme",icon:zo.a,subMenu:[{label:"Normal",onClick:function(){t.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:function(){t.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:function(){t.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:function(){t.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:function(){t.setColorScheme({type:"perBaseQuality"})}},{label:"Adjust mismatch visibility by quality",onClick:function(){t.setColorScheme({type:"mismatchQuality"})}},{label:"Insert size",onClick:function(){t.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:function(){t.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(Jo,t)}}]},{label:"Filter by",icon:_o.a,onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(Ko,t)}},{label:"Set feature height",onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(ai,t)}},{label:"Set max height",onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(oi,t)}}]},get trackMenuItems(){return[].concat(Object(s.a)(n),Object(s.a)(this.composedTrackMenuItems))}}}))};var si=Object(Ze.a)((function(e){return{popper:{fontSize:"0.8em",zIndex:e.zIndex.tooltip,pointerEvents:"none"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}}}));function li(e){var t=e.feature,n=t.get("refName"),a="".concat(n?"".concat(n,":"):""),r=(t.get("start")+1).toLocaleString("en-US"),o=t.get("end").toLocaleString("en-US"),i=r===o?r:"".concat(r,"..").concat(o),c="".concat(a).concat(i),s=t.get("snpinfo"),l=s?s[s.map((function(e){return e.base})).indexOf("total")].score:0,u=s&&s.length>=5?"smallInfo":"info";return m.a.createElement("div",null,m.a.createElement("table",null,m.a.createElement("caption",null,c),m.a.createElement("thead",null,m.a.createElement("tr",null,m.a.createElement("th",{id:u},"Base"),m.a.createElement("th",{id:u},"Count"),m.a.createElement("th",{id:u},"% of Total"),m.a.createElement("th",{id:u},"Strands"))),m.a.createElement("tbody",null,(s||[]).map((function(e){var t=e.base,n=e.score,a=e.strands;return m.a.createElement("tr",{key:t},m.a.createElement("td",{id:u},t.toUpperCase()),m.a.createElement("td",{id:u},n),m.a.createElement("td",{id:u},"total"===t?"---":"".concat(Math.floor(n/l*100),"%")),m.a.createElement("td",{id:u},"total"===t?"---":(a["+"]?"+:".concat(a["+"]," ").concat(a["-"]?",\t":"\t"," "):"")+(a["-"]?"-:".concat(a["-"]):"")))})))))}var ui=Object(re.observer)((function(e){var t=e.model,n=e.height,a=e.mouseCoord,r=t.featureUnderMouse,o=si();return r?m.a.createElement(m.a.Fragment,null,m.a.createElement(et.a,{placement:"right-start",className:o.popper,open:!0,title:m.a.createElement(li,{feature:r})},m.a.createElement("div",{style:{position:"absolute",left:a[0],top:0}}," ")),m.a.createElement("div",{className:o.hoverVertical,style:{left:a[0],height:n}})):null})),di=new Map([["snpcoverage","SNPCoverageRenderer"]]),fi=function(e,t){return b.types.compose("LinearSNPCoverageDisplay",qr(e,t),b.types.model({type:b.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:b.types.maybe(b.types.boolean),drawIndicators:b.types.maybe(b.types.boolean),filterBy:b.types.optional(b.types.model({flagInclude:b.types.optional(b.types.number,0),flagExclude:b.types.optional(b.types.number,1536),readName:b.types.maybe(b.types.string),tagFilter:b.types.maybe(b.types.model({tag:b.types.string,value:b.types.string}))}),{})})).actions((function(e){return{setConfig:function(t){e.configuration=t},setFilterBy:function(t){e.filterBy=Object(b.cast)(t)}}})).views((function(e){return{get rendererConfig(){var t=Object(P.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{drawInterbaseCounts:void 0===e.drawInterbaseCounts?t.drawInterbaseCounts:e.drawInterbaseCounts,drawIndicators:void 0===e.drawIndicators?t.drawIndicators:e.drawIndicators}))},get drawInterbaseCountsSetting(){return void 0!==e.drawInterbaseCounts?e.drawInterbaseCounts:Object(P.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return void 0!==e.drawIndicators?e.drawIndicators:Object(P.readConfObject)(this.rendererConfig,"drawIndicators")}}})).actions((function(e){return{toggleDrawIndicators:function(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts:function(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting}}})).views((function(e){var t=e.trackMenuItems;return{get TooltipComponent(){return ui},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:Object(P.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return di.get("snpcoverage")},get needsScalebar(){return!0},get contextMenuItems(){return[]},get extraTrackMenuItems(){return[{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:function(){e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:function(){e.toggleDrawInterbaseCounts()}}]},get trackMenuItems(){return[].concat(Object(s.a)(t),Object(s.a)(e.composedTrackMenuItems),Object(s.a)(this.extraTrackMenuItems))},get filters(){var t=[];if(e.filterBy){var n=e.filterBy,a=n.flagInclude,r=n.flagExclude;if(t=["jexl:get(feature,'snpinfo') != undefined ? true : ((get(feature,'flags')&".concat(a,")==").concat(a,") && !(get(feature,'flags')&").concat(r,")")],e.filterBy.tagFilter){var o=e.filterBy.tagFilter,i=o.tag,c=o.value;t.push("jexl:get(feature,'snpinfo') ? true : \"".concat(c,"\" =='*' ? getTag(feature,\"").concat(i,'") != undefined : getTag(feature,"').concat(i,'") == "').concat(c,'")'))}if(e.filterBy.readName){var s=e.filterBy.readName;t.push("jexl:get(feature,'snpinfo') ? true : get(feature,'name') == \"".concat(s,'"'))}}return t}}}))};var pi=Object(re.observer)((function(e){var t=e.onMouseMove,n=e.blockKey,a=e.displayModel,r=e.width,o=e.height,i=e.regions,c=e.bpPerPx,s=e.sortedBy,l=e.colorBy,u=a||{},d=u.selectedFeatureId,g=u.featureIdUnderMouse,h=u.contextMenuFeature,b=u.blockLayoutFeatures,v=Object(f.a)(i,1)[0],y=Object(p.useRef)(null),w=Object(p.useState)(!1),O=Object(f.a)(w,2),j=O[0],k=O[1],C=Object(p.useState)(!1),E=Object(f.a)(C,2),x=E[0],S=E[1];function T(e){j&&S(!0);var o=0,i=0;y.current&&(o=y.current.getBoundingClientRect().left,i=y.current.getBoundingClientRect().top),o=e.clientX-o,i=e.clientY-i;var s=v.reversed?r-o:o,l=v.start+c*s,u=a.getFeatureOverlapping(n,l,i),d=u.length?u[0].name:void 0;t&&t(e,d)}function N(t,n){var a=e["onFeature".concat(t)],r=e["on".concat(t)];a&&g?a(n,g):r&&r(n,g)}Object(p.useEffect)((function(){var e=y.current;if(e){var t=e.getContext("2d");if(t){var a,r;if(t.clearRect(0,0,e.width,e.height),d&&(r=b.get(n))&&(a=r.get(d))){var o=a,i=Object(f.a)(o,4),s=i[0],l=i[1],u=i[2],p=i[3],m=Object(_.bpSpanPx)(s,u,v,c),w=Object(f.a)(m,2),O=w[0],j=w[1],k=Math.round(l),C=Math.round(p-l);t.shadowColor="#222266",t.shadowBlur=10,t.lineJoin="bevel",t.lineWidth=2,t.strokeStyle="#00b8ff",t.strokeRect(O-2,k-2,j-O+4,C+4),t.clearRect(O,k,j-O,C)}var E=g||(null===h||void 0===h?void 0:h.id());if(E&&(r=b.get(n))&&(a=r.get(E))){var x=a,S=Object(f.a)(x,4),T=S[0],N=S[1],A=S[2],R=S[3],M=Object(_.bpSpanPx)(T,A,v,c),P=Object(f.a)(M,2),F=P[0],I=P[1],B=Math.round(N),L=Math.round(R-N);t.fillStyle="#0003",t.fillRect(F,B,I-F,L)}}}}),[c,v,d,g,h,n,b]);var A=Math.ceil(r);return m.a.createElement("div",{className:"PileupRendering","data-testid":"pileup-".concat(s?s.type:l?"".concat(l.type).concat(l.tag||""):"normal"),style:{position:"relative",width:A,height:o}},m.a.createElement(ue.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})),m.a.createElement("canvas",{"data-testid":"pileup_overlay_canvas",width:A,height:o,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:y,onMouseDown:function(e){return function(e){k(!0),S(!1),N("MouseDown",e)}(e)},onMouseEnter:function(e){return function(e){N("MouseEnter",e)}(e)},onMouseOut:function(e){return function(e){N("MouseOut",e),N("MouseLeave",e)}(e)},onMouseOver:function(e){return function(e){N("MouseOver",e)}(e)},onMouseUp:function(e){return function(e){k(!1),N("MouseUp",e)}(e)},onMouseLeave:function(e){return function(e){N("MouseOut",e),N("MouseLeave",e)}(e)},onMouseMove:function(e){return T(e)},onClick:function(e){return function(e){x||N("Click",e)}(e)},onContextMenu:function(e){return function(e){N("ContextMenu",e)}(e)},onFocus:function(){},onBlur:function(){}}))})),mi=Object(P.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#c8c8c8",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:b.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orienation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:b.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px",defaultValue:0},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1}},{explicitlyTyped:!0}),gi=n(479),hi=n(353),bi=function(e,t){var n=Array.from(e.values()),a=[],r=[],o=t.pos,i=t.type;n.forEach((function(e){var t=e,n=t.get("start"),i=t.get("end");Object(hi.a)(o-1,o,n,i)?a.push(e):r.push(e)}));var c=!!n.length&&n[0].get("tags");switch(i){case"Start location":a.sort((function(e,t){return e.get("start")-t.get("start")}));break;case"tag":var s=t.tag,l=function(e,t){return c?e.get("tags")[t]:e.get(t)};"string"===typeof l(a[0],s)?a.sort((function(e,t){return l(t,s).localeCompare(l(e,s))})):a.sort((function(e,t){return(l(t,s)||0)-(l(e,s)||0)}));break;case"Base pair":var u=[];a.forEach((function(e){e.get("mismatches").forEach((function(t){var n=e.get("start")+t.start+1,a="insertion"===t.type||"softclip"===t.type?0:t.length;o>=n&&o<n+a&&u.push([e.id(),t])}))}));var d=new Map(u);a.sort((function(e,t){var n=d.get(e.id()),a=d.get(t.id()),r=a&&a.base.toUpperCase(),o=n&&n.base.toUpperCase();return r===o&&"*"===r?n.length-a.length:(r?r.charCodeAt(0):0)-(o?o.charCodeAt(0):0)}));break;case"Read strand":a.sort((function(e,t){return e.get("strand")<=t.get("strand")?1:-1}))}return new Map(a.concat(r).map((function(e){return[e.id(),e]})))},vi={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},yi=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).sortedBy=void 0,a.showSoftClip=!1,a.cachedLayout=void 0,a.config=e.config,a}return Object(h.a)(n,[{key:"cachedLayoutIsValid",value:function(e){return Object(Yr.a)(Object(Kr.a)(n.prototype),"cachedLayoutIsValid",this).call(this,e)&&this.showSoftClip===e.showSoftClip&&Io()(this.sortedBy,e.sortedBy)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(P.readConfObject)(this.config),filters:this.filters,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}]),n}(gi.a),wi={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#999",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"},Oi=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"getCharWidthHeight",value:function(e){return{charWidth:e.measureText("A").width,charHeight:e.measureText("M").width}}},{key:"layoutFeature",value:function(e,t,n,a,r,o){var i=0,c=0,s=e.get("mismatches"),l=e.get("seq");if(o&&l)for(var u=0;u<s.length;u+=1){var d=s[u],p=d.type,m=d.start,g=d.cliplen,h=void 0===g?0:g;"softclip"===p&&(0===m?i=h:c=h)}var b=Object(_.bpSpanPx)(e.get("start")-i,e.get("end")+c,r,a),v=Object(f.a)(b,2),y=v[0],w=v[1],O=Object(P.readConfObject)(n,"height",{feature:e}),j=Object(P.readConfObject)(n,"displayMode",{feature:e});if("compact"===j&&(O/=3),e.get("refName")!==r.refName)throw new Error("feature ".concat(e.id()," is not on the current region's reference sequence ").concat(r.refName));var k=t.addRect(e.id(),e.get("start")-i,e.get("end")+c,O);return null===k?null:{feature:e,leftPx:y,rightPx:w,topPx:"collapse"===j?0:k,heightPx:O}}},{key:"getExpandedRegion",value:function(e,t){var n=t.config,a=t.showSoftClip,r=Object(P.readConfObject)(n,"maxClippingSize"),o=e.start,i=e.end,c=i-o,s=Math.max(c,a?Math.round(r):0);return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(Math.max(o-s,0)),end:Math.ceil(i+s)})}},{key:"colorByOrientation",value:function(e,t){return wi[this.getOrientation(e,t)||"color_nostrand"]}},{key:"getOrientation",value:function(e,t){var n=Object(P.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[vi[n][e.get("pair_orientation")]]}},{key:"colorByInsertSize",value:function(e,t){return e.get("is_paired")&&e.get("seq_id")!==e.get("next_seq_id")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}},{key:"colorByStranded",value:function(e,t){var n=e.get("flags"),a=e.get("strand");if(1&n){var r=64&n?-1:1;return 2&n?a*r===1?"color_rev_strand":"color_fwd_strand":e.get("multi_segment_next_segment_unmapped")?a*r===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("seq_id")===e.get("next_seq_id")?a*r===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===a?"color_fwd_diff_chr":"color_rev_diff_chr"}return 1===a?"color_fwd_strand":"color_rev_strand"}},{key:"colorByPerBaseQuality",value:function(e,t,n,a,r){for(var o=t.feature,i=t.topPx,c=t.heightPx,s=(o.get("qual")||"").split(" ").map((function(e){return+e})),l=ao(o.get("CIGAR")),u=1/r,d=Object(_.bpSpanPx)(o.get("start"),o.get("end"),a,r),p=Object(f.a)(d,1)[0],m=0,g=0,h=0;h<s.length;m+=2,h++){var b=+l[m],v=l[m+1];if("S"===v||"I"===v)h+=b;else if("D"===v||"N"===v)g+=b;else if("M"===v||"X"===v||"="===v){for(var y=0;y<b;y++){var w=s[h+y];e.fillStyle="hsl(".concat(255===w?150:1.5*w,",55%,50%)"),e.fillRect(p+(g+y)*u,i,u+.5,c)}g+=b}}}},{key:"drawRect",value:function(e,t,n){var a=n.regions,r=n.bpPerPx,o=t.heightPx,i=t.topPx,c=t.feature,s=Object(f.a)(a,1)[0],l=Object(_.bpSpanPx)(c.get("start"),c.get("end"),s,r),u=Object(f.a)(l,2),d=u[0],p=u[1],m=s.reversed?-1:1,g=c.get("strand")*m;r<10?-1===g?(e.beginPath(),e.moveTo(d-5,i+o/2),e.lineTo(d,i+o),e.lineTo(p,i+o),e.lineTo(p,i),e.lineTo(d,i),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(d,i),e.lineTo(d,i+o),e.lineTo(p,i+o),e.lineTo(p+5,i+o/2),e.lineTo(p,i),e.closePath(),e.fill()):e.fillRect(d,i,p-d,o)}},{key:"drawAlignmentRect",value:function(e,t,n){var a=n.config,r=n.bpPerPx,o=n.regions,i=n.colorBy,c=(i=void 0===i?{}:i).tag,s=void 0===c?"":c,l=i.type,u=void 0===l?"":l,d=n.colorTagMap,f=void 0===d?{}:d,p=t.feature,m=o[0];switch(u){case"insertSize":e.fillStyle=this.colorByInsertSize(p,a);break;case"strand":e.fillStyle=-1===p.get("strand")?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":e.fillStyle="hsl(".concat(p.get("mq"),",50%,50%)");break;case"pairOrientation":e.fillStyle=this.colorByOrientation(p,a);break;case"stranded":e.fillStyle=wi[this.colorByStranded(p,a)];break;case"xs":case"tag":var g=p.get("tags"),h=g?g[s]:p.get(s);if("XS"===s||"TS"===s){e.fillStyle=wi[{"-":"color_rev_strand","+":"color_fwd_strand"}[h]||"color_nostrand"]}if("ts"===s){var b={"-":-1===p.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===p.get("strand")?"color_rev_strand":"color_fwd_strand"};e.fillStyle=wi[b[h]||"color_nostrand"]}else{var v=f[h];e.fillStyle=v||"color_nostrand"}break;case"insertSizeAndPairOrientation":break;case"normal":default:e.fillStyle=Object(P.readConfObject)(a,"color",{feature:p})}switch(this.drawRect(e,t,n),u){case"perBaseQuality":this.colorByPerBaseQuality(e,t,a,m,r)}}},{key:"drawMismatches",value:function(e,t,n,a,r,o){for(var i=n.config,c=n.bpPerPx,s=n.regions,l=t.heightPx,u=t.topPx,d=t.feature,p=this.getCharWidthHeight(e),m=p.charWidth,g=p.charHeight,h=Object(f.a)(s,1)[0],b=d.get("start"),v=Object(P.readConfObject)(i,"minSubfeatureWidth"),y=Math.min(1/c,2),w=Math.max(v,y),O=d.get("mismatches"),j=g-2,k=0;k<O.length;k+=1){var C=O[k],E=Object(_.bpSpanPx)(b+C.start,b+C.start+C.length,h,c),x=Object(f.a)(E,2),S=x[0],T=x[1],N=Math.max(v,Math.abs(S-T));if("mismatch"===C.type||"deletion"===C.type){var A=r["deletion"===C.type?"deletion":C.base]||"#888",R=A;a&&void 0!==C.qual&&(R=Ur()(A).alpha(C.qual/90).hsl().string()),e.fillStyle=R,e.fillRect(S,u,N,l),N>=m&&l>=j&&(e.fillStyle=o.palette.getContrastText(A),e.fillText(C.base,S+(N-m)/2+1,u+l))}else if("insertion"===C.type){e.fillStyle="purple";var M=S-1;(+C.base||C.length)<10&&(e.fillRect(M,u,w,l),1/c>=m&&(e.fillRect(M-w,u,3*w,1),e.fillRect(M-w,u+l-1,3*w,1)),1/c>=m&&l>=j&&e.fillText("(".concat(C.base,")"),S+2,u+l))}else if("hardclip"===C.type||"softclip"===C.type){e.fillStyle="hardclip"===C.type?"red":"blue";var F=S-1;e.fillRect(F,u+1,w,l-2),e.fillRect(F-w,u,3*w,1),e.fillRect(F-w,u+l-1,3*w,1),N>=m&&l>=j&&e.fillText("(".concat(C.base,")"),S+2,u+l)}else"skip"===C.type&&(S+N>0&&e.clearRect(S,u,N,l),e.fillStyle="#333",e.fillRect(S,u+l/2,N,2))}for(var I=0;I<O.length;I+=1){var B=O[I],L=Object(_.bpSpanPx)(d.get("start")+B.start,d.get("start")+B.start+B.length,h,c),D=Object(f.a)(L,1)[0],V=+B.base||B.length,W="".concat(V);if("insertion"===B.type&&V>=10){var q=e.measureText(W);e.fillStyle="purple",e.fillRect(D-q.width/2-5,u,q.width+10,l),l>g&&(e.fillStyle="white",e.fillText(W,D-q.width/2,u+l))}}}},{key:"drawSoftClipping",value:function(e,t,n,a,r){var o=t.feature,i=t.topPx,c=t.heightPx,s=n.regions,l=n.bpPerPx,u=Object(f.a)(s,1)[0],d=Object(P.readConfObject)(a,"minSubfeatureWidth"),p=o.get("mismatches"),m=o.get("seq"),g=this.getCharWidthHeight(e),h=g.charWidth,b=g.charHeight,v={A:r.palette.bases.A.main,C:r.palette.bases.C.main,G:r.palette.bases.G.main,T:r.palette.bases.T.main,deletion:"#808080"};m&&p.filter((function(e){return"softclip"===e.type})).forEach((function(t){for(var n=t.cliplen||0,a=0===t.start?o.get("start")-n:o.get("start")+t.start,s=0;s<n;s+=1){var p=m.charAt(s+t.start);if(!p)return;var g=Object(_.bpSpanPx)(a+s,a+s+1,u,l),y=Object(f.a)(g,2),w=y[0],O=y[1],j=Math.max(d,Math.abs(w-O)),k=v[p]||"#000000";e.fillStyle=k,e.fillRect(w,i,j,c),j>=h&&c>=b-5&&(e.fillStyle=r.palette.getContrastText(k),e.fillText(p,w+(j-h)/2+1,i+c))}}))}},{key:"makeImageData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,u,d,p,m,g,h,b,v,y,w,O,j,k,C,E,x,S,T=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.features,a=t.layout,r=t.config,o=t.regions,i=t.bpPerPx,s=t.sortedBy,l=t.highResolutionScaling,u=void 0===l?1:l,d=t.showSoftClip,p=t.colorBy,m=void 0===p?{}:p,g=t.theme,h=Object(ue.createJBrowseTheme)(g),b={A:h.palette.bases.A.main,C:h.palette.bases.C.main,G:h.palette.bases.G.main,T:h.palette.bases.T.main,deletion:"#808080"},v=Object(f.a)(o,1),y=v[0],a){e.next=6;break}throw new Error("layout required");case 6:if(a.addRect){e.next=8;break}throw new Error("invalid layout object");case 8:return w=s&&s.type&&y.start===s.pos?bi(n,s):null,O=w||n,j=Object(_.iterMap)(O.values(),(function(e){return T.layoutFeature(e,a,r,i,y,d)}),O.size),k=(y.end-y.start)/i,C=Math.max(a.getTotalHeight(),1),E=Object(ir.b)(Math.ceil(k*u),C*u),(x=E.getContext("2d")).scale(u,u),x.font="bold 10px Courier New,monospace",j.forEach((function(e){if(null!==e){var n=e.feature,a=e.topPx,o=e.heightPx;x.fillStyle=Object(P.readConfObject)(r,"color",{feature:n}),T.drawAlignmentRect(x,{feature:n,topPx:a,heightPx:o},t),T.drawMismatches(x,e,t,"mismatchQuality"===m.type,b,h),d&&T.drawSoftClipping(x,e,t,r,h)}})),e.next=20,Object(ir.c)(E);case 20:return S=e.sent,e.abrupt("return",{imageData:S,height:C,width:k,maxHeightReached:a.maxHeightReached});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeImageData(t);case 2:return n=e.sent,a=n.height,r=n.width,o=n.imageData,i=n.maxHeightReached,s=m.a.createElement(this.ReactComponent,Object(u.a)(Object(u.a)({},t),{},{region:t.regions[0],height:a,width:r,imageData:o}),null),e.abrupt("return",{element:s,imageData:o,height:a,width:r,maxHeightReached:i,layout:t.layout});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(e){return new yi(e)}}]),n}(gi.b),ji=n(315),ki=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(g.a)(this,e),this.categories=void 0,this.categories=Object(u.a)({},t)}return Object(h.a)(e,[{key:"total",value:function(){var e=0;for(var t in this.categories){var n=this.categories[t];e+=n.total?n.total():n}return e}},{key:"decrement",value:function(e,t){return t||(t=1),e=e?e.toString():"default",this.categories[e]?(this.categories[e]=Math.max(0,this.categories[e]-t),this.categories[e]):0}},{key:"increment",value:function(e,t){return t||(t=1),e=e?e.toString():"default",this.categories[e]=(this.categories[e]||0)+t,this.categories[e]}},{key:"get",value:function(e){return this.categories[e]||0}},{key:"getNested",value:function(t){if("string"===typeof t&&(t=t.split("/")),!t.length)return this;var n=t[0].toString(),a=this.categories[n];return a&&a.categories||(this.categories[n]=new e(a?{default:a+0}:{})),a=this.categories[n],t.length>1?a.getNested(t.slice(1)):a}},{key:"toString",value:function(){return this.total().toPrecision(6).toString().replace(/\.?0+$/,"")}},{key:"valueOf",value:function(){return this.total()}},{key:"forEach",value:function(e,t){if(t)for(var n in this.categories)e.call(t,this.categories[n],n);else for(var a in this.categories)e(this.categories[a],a)}}]),e}();function Ci(e){var t=Object.entries(e.categories).map((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1].categories;return{base:n,score:Object.values(a).reduce((function(e,t){return e+t}),0),strands:a}}));return t.sort((function(e,t){return e.score<t.score||"reference"===t.base?1:-1})),[].concat(Object(s.a)(t),[{base:"total",score:e.total()}])}var Ei=function(e){return{AdapterClass:function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r;Object(g.a)(this,n),(r=t.call(this,e)).subadapter=void 0;var o=null===a||void 0===a?void 0:a(Object(b.getSnapshot)(e.subadapter)).dataAdapter;if(!(o instanceof H.BaseFeatureDataAdapter))throw new Error("invalid subadapter type '".concat(e.subadapter.type,"'"));return r.subadapter=o,r}return Object(h.a)(n,[{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.subadapter.getFeatures(e,n).pipe(Object(ji.a)((function(e){return!n.filters||n.filters.passes(e,n)}))).pipe(Object(B.a)()).toPromise();case 2:o=a.sent,i=t.generateCoverageBins(o,e,n.bpPerPx||1),s=function(e){var t,n,a;return e.total()-((null===(t=e.categories.softclip)||void 0===t?void 0:t.total())||0)-((null===(n=e.categories.hardclip)||void 0===n?void 0:n.total())||0)-((null===(a=e.categories.deletion)||void 0===a?void 0:a.total())||0)},i.forEach((function(n,a){n.total()&&r.next(new U.a({id:"".concat(t.id,"-").concat(e.start,"-").concat(a),data:{score:s(n),snpinfo:Ci(n),start:e.start+a,end:e.start+a+1,refName:e.refName}}))})),r.complete();case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",this.subadapter.getRefNames(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}},{key:"generateCoverageBins",value:function(e,t,n){for(var a=t.start,r=t.end,o=1/n,i=n<=10?1:Math.ceil(o),c=Math.ceil((r-a)/i),s=new Array(c).fill(0),l=0;l<c;l++)s[l]=new ki,1===i&&(s[l].snpsCounted=!0);var u,d=function(e,t,n){var r=(e-a)/i,o=(t-1-a)/i,s=Math.floor(r),l=Math.floor(o);if(!(s>=c||l<0))if(s<0&&(r=0,s=0),l>=c&&(l=c-1,o=c),s===l)n(s,o-r);else{n(s,s+1-r);for(var u=s+1;u<l;u++)n(u,1);n(l,o-l)}},f=Object(He.a)(e.values());try{var p=function(){var e=u.value,t=function(e){var t="";switch(e.get("strand")){case-1:t="-";break;case 1:t="+";break;default:t="unstranded"}return t}(e),n=e.get("start"),a=e.get("end");if(d(n,a,(function(e,n){s[e].getNested("reference").increment(t,n)})),1===i){var r=e.get("mismatches");if(r)for(var o=function(e){var a,o=r[e];d(n+o.start,n+o.start+("insertion"!==(a=o).type&&"softclip"!==a.type&&"hardclip"!==a.type?a.length:1),(function(e,n){var a=s[e];"softclip"!==o.type&&"hardclip"!==o.type&&a.getNested("reference").decrement(t,n);var r=o.base;"insertion"===o.type?r="insertion":"skip"===o.type?r="skip":"softclip"===o.type?r="softclip":"hardclip"===o.type?r="hardclip":"deletion"===o.type&&(r="deletion"),"skip"===r&&a.getNested(r).decrement("reference",n),r&&"*"!==r&&"skip"!==r&&a.getNested(r).increment(t,n)}))},c=0;c<r.length;c++)o(c)}};for(f.s();!(u=f.n()).done;)p()}catch(m){f.e(m)}finally{f.f()}return s}}]),n}(H.BaseFeatureDataAdapter),configSchema:(t=e,b.types.late((function(){return Object(P.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:t.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})})))};var t},xi=Object(P.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.3},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0}),Si=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n=t.features,a=t.regions,r=t.bpPerPx,o=t.scaleOpts,i=t.height,c=t.theme,s=t.config,l=t.displayCrossHatches,d=t.ticks.values,p=Object(ue.createJBrowseTheme)(c),m=Object(f.a)(a,1)[0],g=(m.end-m.start)/r,h=Lr,b=i-2*h,v=Object(u.a)(Object(u.a)({},o),{},{range:[0,b]}),y=yr(v),w=yr(Object(u.a)(Object(u.a)({},v),{},{scaleType:"linear"})),O=wr(o.scaleType),j=wr("linear"),k=Object(P.readConfObject)(s,"indicatorThreshold"),C=Object(P.readConfObject)(s,"drawInterbaseCounts"),E=Object(P.readConfObject)(s,"drawIndicators"),x=function(e){return b-y(e)+h},S=function(e){return b-w(e)+h},T=function(e){return S(j)-S(e)},N={A:p.palette.bases.A.main,C:p.palette.bases.C.main,G:p.palette.bases.G.main,T:p.palette.bases.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red"};e.fillStyle=N.total;var A,R,M=Object(He.a)(n.values());try{for(M.s();!(A=M.n()).done;){var F=A.value,I=Object(_.featureSpanPx)(F,m,r),B=Object(f.a)(I,2),L=B[0],D=B[1],V=F.get("score");e.fillRect(L,x(V),D-L+.3,(R=V,x(O)-x(R)))}}catch(H){M.e(H)}finally{M.f()}e.fillStyle="grey",e.beginPath(),e.lineTo(0,0),e.moveTo(0,g),e.stroke();var W,q=Object(He.a)(n.values());try{var z=function(){var t,n=W.value,a=Object(_.featureSpanPx)(n,m,r),o=Object(f.a)(a,2),i=o[0],c=o[1],s=n.get("snpinfo")||[],l=(null===(t=s.find((function(e){return"total"===e.base})))||void 0===t?void 0:t.score)||0,u=Math.max(c-i+.3,1);s.filter((function(e){var t=e.base;return"reference"!==t&&"total"!==t&&"deletion"!==t&&"insertion"!==t&&"softclip"!==t&&"hardclip"!==t})).reduce((function(t,n){var a=n.base,r=n.score;return e.fillStyle=N[a],e.fillRect(i,S(r+t),u,T(r)),t+n.score}),0);var d=s.filter((function(e){var t=e.base;return"insertion"===t||"softclip"===t||"hardclip"===t}));if(C&&d.reduce((function(t,n){var a=n.score,r=n.base;return e.fillStyle=N[r],e.fillRect(i-.6,4.5+T(t),1.2,T(a)),t+n.score}),0),E){var p=0,g=0,h="";d.forEach((function(e){var t=e.score,n=e.base;p+=t,t>g&&(g=t,h=n)})),p>l*k&&l>7&&(e.fillStyle=N[h],e.beginPath(),e.moveTo(i-3,0),e.lineTo(i+3,0),e.lineTo(i,4.5),e.fill())}};for(q.s();!(W=q.n()).done;)z()}catch(H){q.e(H)}finally{q.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",d.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(x(t))),e.lineTo(g,Math.round(x(t))),e.stroke()})))}}]),n}(cr),Ti=Object(P.ConfigurationSchema)("SNPCoverageRenderer",{},{baseConfiguration:xi,explicitlyTyped:!0}),Ni=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="PileupGetGlobalValueForTag",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.pluginManager.rootModel)||void 0===n||null===(a=n.session)||void 0===a?void 0:a.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",Object(_.renameRegionsIfNeeded)(r,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,l,u,d,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:return n=e.sent,a=n.adapterConfig,r=n.sessionId,o=n.regions,i=n.tag,l=W(this.pluginManager,r,a).dataAdapter,u=l.getFeaturesInMultipleRegions(o),e.next=8,u.pipe(Object(B.a)()).toPromise();case 8:return d=e.sent,f=new Set,d.forEach((function(e){var t=e.get("tags"),n=t?t[i]:e.get(i);void 0!==n&&f.add("".concat(n))})),e.abrupt("return",Object(s.a)(f));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),Ai=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="AlignmentsPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e)}),n=new w.a({name:"AlignmentsTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"AlignmentsTrack",t)}),a=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(a),n})),e.addDisplayType((function(){var t=Do(e);return new O.a({name:"LinearPileupDisplay",configSchema:t,stateModel:ci(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("SNPCoverageRenderer").configSchema;return Object(P.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:b.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:b.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:100},headroom:{type:"number",description:"round the upper value of the domain scale to the nearest N",defaultValue:0},renderers:Object(P.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:t})},{baseConfiguration:ze,explicitlyTyped:!0})}(e);return new O.a({name:"LinearSNPCoverageDisplay",configSchema:t,stateModel:fi(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Hr})})),e.addDisplayType((function(){var t=Po(e);return new O.a({name:"LinearAlignmentsDisplay",configSchema:t,stateModel:Bo(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Lo})})),e.addWidgetType((function(){return new k.a({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:ho,stateModel:bo(e),ReactComponent:go})})),e.addAdapterType((function(){return new y.a(Object(u.a)({name:"BamAdapter"},e.load(jo)))})),e.addAdapterType((function(){return new y.a(Object(u.a)({name:"SNPCoverageAdapter"},e.load(Ei)))})),e.addAdapterType((function(){return new y.a(Object(u.a)({name:"CramAdapter"},e.load(No)))})),e.addAdapterType((function(){return new y.a(Object(u.a)({name:"HtsgetBamAdapter"},e.load(Mo)))})),e.addRendererType((function(){return new Oi({name:"PileupRenderer",ReactComponent:pi,configSchema:mi,pluginManager:e})})),e.addRendererType((function(){return new Si({name:"SNPCoverageRenderer",ReactComponent:sr,configSchema:Ti,pluginManager:e})})),e.addRpcMethod((function(){return new Ni(e)}))}}]),n}(F.a),Ri=n(1229),Mi=n.n(Ri);function Pi(e){var t=e.children(),n=e.get("thickStart"),a=e.get("thickEnd");if(!n&&!a)return e;var r=t?t.filter((function(e){return"block"===e.get("type")})).sort((function(e,t){return e.get("start")-t.get("start")})):[],o=[];r.forEach((function(t){var r=t.get("start"),i=t.get("end");if(n>=i){var c=e.get("strand")>0?"five":"three";o.push({type:"".concat(c,"_prime_UTR"),start:r,end:i})}else if(n>r&&n<i&&a>=i){var s=e.get("strand")>0?"five":"three";o.push({type:"".concat(s,"_prime_UTR"),start:r,end:n},{type:"CDS",start:n,end:i})}else if(n<=r&&a>=i)o.push({type:"CDS",start:r,end:i});else if(n>r&&n<i&&a<i){var l=e.get("strand")>0?"five":"three",u=e.get("strand")>0?"three":"five";o.push({type:"".concat(l,"_prime_UTR"),start:r,end:n},{type:"CDS",start:n,end:a},{type:"".concat(u,"_prime_UTR"),start:a,end:i})}else if(n<=r&&a>r&&a<i){var d=e.get("strand")>0?"three":"five";o.push({type:"CDS",start:r,end:a},{type:"".concat(d,"_prime_UTR"),start:a,end:i})}else if(a<=r){var f=e.get("strand")>0?"three":"five";o.push({type:"".concat(f,"_prime_UTR"),start:r,end:i})}}));var i={};return e.tags().forEach((function(t){i[t]=e.get(t)})),i.subfeatures=o,i.type="mRNA",i.uniqueId=e.id(),delete i.chromStarts,delete i.chromStart,delete i.chromEnd,delete i.chrom,delete i.blockStarts,delete i.blockSizes,delete i.blockCount,delete i.thickStart,delete i.thickEnd,new U.a({data:i,id:e.id()})}var Fi=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).bigbed=void 0,a.parser=void 0;var r=Object(P.readConfObject)(e,"bigBedLocation");return a.bigbed=new lr.BigBed({filehandle:Object(oe.openLocation)(r)}),a.parser=a.bigbed.getHeader().then((function(e){var t=e.autoSql;return new Mi.a({autoSql:t})})),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,this.bigbed.getHeader();case 3:return e.t1=e.sent.refsByName,e.abrupt("return",e.t0.keys.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,f;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bigbed.getHeader(t);case 2:return n=e.sent,a=n.version,r=n.fileType,e.next=7,this.parser;case 7:return o=e.sent,i=o.autoSql,s=i.fields,l=Object(d.a)(i,["fields"]),f=Object.fromEntries(s.map((function(e){return[e.name,e.comment]}))),e.abrupt("return",{version:a,fileType:r,autoSql:Object(u.a)({},l),fields:f});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refIdToName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bigbed.getHeader();case 2:if(e.t1=t,e.t0=e.sent.refsByNumber[e.t1],e.t0){e.next=6;break}e.t0={};case 6:return e.abrupt("return",e.t0.name);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.refName,r=e.start,o=e.end,i=n.signal;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(n){var s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.parser;case 3:return s=e.sent,e.next=6,t.bigbed.getFeatureStream(a,r,o,{signal:i,basesPerSpan:o-r});case 6:e.sent.pipe(Object(dr.a)(),Object(fr.a)((function(e){var n=s.parseLine("".concat(a,"\t").concat(e.start,"\t").concat(e.end,"\t").concat(e.rest),{uniqueId:e.uniqueId}),r=n.blockCount,o=n.blockSizes,i=n.blockStarts,c=n.chromStarts;if(r){var l=c||i||[],d=o,f=e.start;n.subfeatures=[];for(var p=0;p<r;p+=1){var m=(l[p]||0)+f,g=m+(d[p]||0);n.subfeatures.push({uniqueId:"".concat(e.uniqueId,"-").concat(p),start:m,end:g,type:"block"})}}if(void 0===e.uniqueId)throw new Error("invalid bbi feature");delete n.chromStart,delete n.chromEnd,delete n.chrom;var h=new U.a({id:"".concat(t.id,"-").concat(e.uniqueId),data:Object(u.a)(Object(u.a)({},n),{},{start:e.start,end:e.end,refName:a})});return h.get("thickStart")&&h.get("blockCount")&&0!==h.get("strand")?Pi(h):h}))).subscribe(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),n.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),n.signal)}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),Ii=Object(P.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb"}}},{explicitlyTyped:!0}),Bi=n(795),Li=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).parser=void 0,a.bed=void 0,a.columnNames=void 0,a.scoreColumn=void 0;var r=Object(P.readConfObject)(e,"bedGzLocation"),o=Object(P.readConfObject)(e,"index"),i=Object(P.readConfObject)(e,"autoSql"),c=o.location,s=o.indexType;return a.bed=new Bi.TabixIndexedFile({filehandle:Object(oe.openLocation)(r),csiFilehandle:"CSI"===s?Object(oe.openLocation)(c):void 0,tbiFilehandle:"CSI"!==s?Object(oe.openLocation)(c):void 0,chunkCacheSize:50*Math.pow(2,20)}),a.columnNames=Object(P.readConfObject)(e,"columnNames"),a.scoreColumn=Object(P.readConfObject)(e,"scoreColumn"),a.parser=new Mi.a({autoSql:i}),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",this.bed.getReferenceSequenceNames(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.bed.getHeader());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"defaultParser",value:function(e,t){return Object.fromEntries(t.split("\t").map((function(t,n){return[e[n],t]})))}},{key:"getNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.columnNames.length){e.next=2;break}return e.abrupt("return",this.columnNames);case 2:return e.next=4,this.bed.getHeader();case 4:return t=e.sent,n=t.split("\n").filter((function(e){return!!e})),a=n[n.length-1],e.abrupt("return",a&&a.includes("\t")?a.slice(1).split("\t").map((function(e){return e.trim()})):null);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s,l,d,f,p;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.bed.getMetadata();case 2:return o=a.sent,i=o.columnNumbers,s=i.ref-1,l=i.start-1,d=i.end-1,f=l===d?1:0,a.next=10,t.getNames();case 10:return p=a.sent,a.next=13,t.bed.getLines(e.refName,e.start,e.end,{lineCallback:function(e,n){var a=e.split("\t"),o=a[s],i=+a[l],c=+a[d]+f,m="".concat(t.id,"-").concat(n),g=p?t.defaultParser(p,e):t.parser.parseLine(e,{uniqueId:m}),h=g.blockCount,b=g.blockSizes,v=g.blockStarts,y=g.chromStarts;if(h){var w=y||v||[],O=b,j=i;g.subfeatures=[];for(var k=0;k<h;k+=1){var C=(w[k]||0)+j,E=C+(O[k]||0);g.subfeatures.push({uniqueId:"".concat(m,"-").concat(k),start:C,end:E,type:"block"})}}t.scoreColumn&&(g.score=g[t.scoreColumn]),delete g.chrom,delete g.chromStart,delete g.chromEnd;var x=new U.a(Object(u.a)(Object(u.a)({},g),{},{start:i,end:c,refName:o,uniqueId:m})),S=x.get("thickStart")?Pi(x):x;r.next(S)},signal:n.signal});case 13:r.complete();case 14:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter);Li.capabilities=["getFeatures","getRefNames"];var Di=Object(P.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz"}},index:Object(P.ConfigurationSchema)("TabixIndex",{indexType:{model:b.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),Vi=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="BedPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"BigBedAdapter",configSchema:Ii,AdapterClass:Fi})})),e.addAdapterType((function(){return new y.a({name:"BedTabixAdapter",configSchema:Di,AdapterClass:Li})}))}}]),n}(F.a),Wi=Object(re.observer)((function(e){var t=e.model,n=JSON.parse(JSON.stringify(t.featureData)),a=n.feature1,r=n.feature2;return m.a.createElement(nn.a,{"data-testid":"alignment-side-drawer"},m.a.createElement(Be.BaseCoreDetails,{title:"Feature 1",feature:a}),m.a.createElement(Be.BaseCoreDetails,{title:"Feature 2",feature:r}),m.a.createElement(Be.BaseAttributes,{title:"Feature 1 attributes",feature:a}),m.a.createElement(Be.BaseAttributes,{title:"Feature 2 attributes",feature:r}))})),qi=Object(P.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),zi=b.types.model("BreakpointAlignmentsWidget",{id:Ie.ElementId,type:b.types.literal("BreakpointAlignmentsWidget"),featureData:b.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),Hi=n(1264),_i=n.n(Hi);function Ui(e){var t=e.jbrequire,n=t("mobx-state-tree"),a=n.types,r=n.getParent,o=n.onAction,i=n.addDisposer,c=n.getPath,l=t("@jbrowse/core/pluggableElementTypes/models").BaseViewModel,u=a.model("BreakpointSplitView",{type:b.types.literal("BreakpointSplitView"),headerHeight:0,height:b.types.optional(b.types.refinement("viewHeight",b.types.number,(function(e){return e>=40})),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:b.types.array(e.getViewType("LinearGenomeView").stateModel)}).volatile((function(){return{width:800}})).views((function(e){return{get matchedTracks(){var t=e.views.map((function(e){return e.tracks.map((function(e){return e.configuration.trackId}))}));return _i.a.apply(void 0,Object(s.a)(t))},get menuItems(){var t=[];return e.views.forEach((function(e,n){e.menuItems&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems})})),t},get viewDividerHeight(){return 3},getMatchedTracks:function(t){return e.views.map((function(e){return e.getTrack(t)})).filter((function(e){return!!e}))},hasPairedReads:function(e){return this.getTrackFeatures(e).find((function(e){return 64&e.get("flags")}))},hasTranslocations:function(e){return this.getTrackFeatures(e).find((function(e){return"translocation"===e.get("type")}))},getTrackFeatures:function(e){var t=this.getMatchedTracks(e);return new _e((t||[]).map((function(e){return e.displays[0].features})))},getMatchedTranslocationFeatures:function(e){var t,n=this.getTrackFeatures(e),a=[],r=new Set,o=Object(He.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;r.has(i.id())||"<TRA>"===i.get("ALT")[0]&&a.push([i]),r.add(i.id())}}catch(c){o.e(c)}finally{o.f()}return a},getMatchedBreakendFeatures:function(e){var t,n=this.getTrackFeatures(e),a={},r=new Set,o=Object(He.a)(n.values());try{var i=function(){var e=t.value;r.has(e.id())||"breakend"===e.get("type")&&e.get("ALT").forEach((function(t){var n="".concat(e.get("refName"),":").concat(e.get("start")+1);if(Ma()(t)){var r=t;a[n]?a[n].push(e):a[r.MatePosition]=[e]}})),r.add(e.id())};for(o.s();!(t=o.n()).done;)i()}catch(c){o.e(c)}finally{o.f()}return Object.values(a).filter((function(e){return e.length>1}))},getMatchedAlignmentFeatures:function(e){var t,n=this.getTrackFeatures(e),a={},r=new Set,o=Object(He.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value,c=i.id(),s=4&i.get("flags");if(!r.has(c)&&!s){var l=i.get("name");a[l]||(a[l]=[]),a[l].push(i)}r.add(i.id())}}catch(u){o.e(u)}finally{o.f()}return Object.values(a).filter((function(e){return e.length>1}))},getBadlyPairedAlignments:function(e){var t,n=this.getTrackFeatures(e),a={},r=new Set,o=Object(He.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value,c=i.get("flags"),s=i.id(),l=4&c,u=2&c;if(!r.has(s)&&!u&&!l){var d=i.get("name");a[d]||(a[d]=[]),a[d].push(i)}r.add(i.id())}}catch(f){o.e(f)}finally{o.f()}return Object.values(a).filter((function(e){return e.length>1}))},getMatchedFeaturesInLayout:function(e,t){var n=this.getMatchedTracks(e),a=function(e,t){return e.displays[0].layoutFeatures.get(t.id())};return t.map((function(e){return e.map((function(e){var t=n.findIndex((function(t){return a(t,e)})),r=a(n[t],e);return{feature:e,layout:r,level:t}}))}))}}})).actions((function(e){return{afterAttach:function(){var t=this;i(e,o(e,(function(n){var a=n.name,r=n.path,o=n.args;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(a)&&r&&t.onSubviewAction(a,r,o)}})))},onSubviewAction:function(t,n,a){e.views.forEach((function(e){var r=c(e);r.lastIndexOf(n)!==r.length-n.length&&e[t](a[0])}))},setWidth:function(t){e.width=t,e.views.forEach((function(e){return e.setWidth(t)}))},removeView:function(t){e.views.remove(t)},closeView:function(){r(e,2).removeView(e)},setHeaderHeight:function(t){e.headerHeight=t},toggleInteract:function(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks:function(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews:function(){e.linkViews=!e.linkViews}}}));return{stateModel:a.compose(l,u)}}var Gi=n(822),Ji=n.n(Gi),Qi=[0,1,2,3],Xi=Qi[1],Yi=Qi[3];function Ki(e,t,n){return((e.bpToPx({refName:t,coord:n})||{}).offsetPx||0)-e.offsetPx}function Zi(e,t,n,a,r){var o,i=a[t].displays[0],c=i.height,s=0,l=i.showCoverage,u=i.SNPCoverageDisplay;return u&&l&&(s=u.height+5),Object(_.clamp)(r[Xi]-i.scrollTop+((o=r)[Yi]-o[Xi])/2+s,0,c)+function(e,t,n){var a=e[n].trackRefs[t];return(null===a||void 0===a?void 0:a.getBoundingClientRect().top)||0}(n,e,t)+i.scrollTop}var $i=function(e){var t=Object(p.useState)(),n=Object(f.a)(t,2)[1];Object(p.useEffect)((function(){n(e)}),[e])},ec=[0,1,2,3],tc=ec[0],nc=ec[2],ac=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util").getSession,a=t("mobx-react").observer,r=t("react"),o=t("react").useState,i=t("mobx-state-tree").getSnapshot;return a((function(e){var t=e.model,a=e.trackConfigId,c=e.parentRef,s=t.views,l=t.showIntraviewLinks,u=n(t),d=i(t);$i(d);var p=t.getTrackFeatures(a),m=t.hasPairedReads(a)?t.getBadlyPairedAlignments(a):t.getMatchedAlignmentFeatures(a),g=t.getMatchedFeaturesInLayout(a,m);g.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))}));var h=o(),b=Object(f.a)(h,2),v=b[0],y=b[1],w=0;if(c.current){var O=c.current.getBoundingClientRect();w=O.top}return r.createElement("g",{stroke:"#333",fill:"none","data-testid":g.length?"".concat(a,"-loaded"):a},g.map((function(e){for(var t=[],n=function(n){var o=e[n],i=o.layout,c=o.feature,d=o.level,f=e[n+1],m=f.layout,g=f.feature,h=f.level;if(!i||!m)return console.warn("received null layout for a overlay feature"),{v:null};if(!l&&d===h)return{v:null};var b=Ki(s[d],c.get("refName"),i[-1===c.get("strand")?tc:nc]),O=Ki(s[h],g.get("refName"),m[-1===g.get("strand")?nc:tc]),j=s[d].pxToBp(b).reversed,k=s[h].pxToBp(O).reversed,C=s.map((function(e){return e.getTrack(a)})),E=Zi(a,d,s,C,i)-w,x=Zi(a,h,s,C,m)-w,S=Ji()().moveTo(b,E).curveTo(b+200*c.get("strand")*(j?-1:1),E,O-200*g.get("strand")*(k?-1:1),x,O,x).end(),T="".concat(c.id(),"-").concat(g.id());t.push(r.createElement("path",{d:S,key:T,"data-testid":"r1",strokeWidth:v===T?5:1,onClick:function(){var e=u.addWidget("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(p.get(c.id())||{toJSON:function(){}}).toJSON(),feature2:(p.get(g.id())||{toJSON:function(){}}).toJSON()}});u.showWidget(e)},onMouseOver:function(){return y(T)},onMouseOut:function(){return y(void 0)}}))},o=0;o<e.length-1;o+=1){var i=n(o);if("object"===typeof i)return i.v}return t})))}))};var rc=function(e){var t=e.jbrequire,n=t("mobx-react").observer,a=t("react"),r=t("react").useState,o=t("mobx-state-tree").getSnapshot;return n((function(e){var t=e.model,n=e.trackConfigId,i=e.parentRef,c=t.views,s=t.getMatchedBreakendFeatures(n),l=t.getMatchedFeaturesInLayout(n,s),u=r(),d=Object(f.a)(u,2),p=d[0],m=d[1],g=o(t);$i(g);var h=0;if(i.current){var b=i.current.getBoundingClientRect();h=b.top}return a.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":l.length?"".concat(n,"-loaded"):n},l.map((function(e){for(var t=[],r=function(r){var o=e[r],i=o.layout,s=o.feature,l=o.level,u=e[r+1],d=u.layout,f=u.feature,g=u.level,b="".concat(s.id(),"-").concat(f.id()),v=function(e,t){var n={};return e.get("ALT").forEach((function(e){n[e.MatePosition]=e})),n["".concat(t.get("refName"),":").concat(t.get("start")+1)]}(s,f);if(!i||!d)return{v:null};var y=Ki(c[l],s.get("refName"),i[0]),w=Ki(c[g],f.get("refName"),d[0]),O=c[l].pxToBp(y).reversed,j=c[g].pxToBp(w).reversed,k=c.map((function(e){return e.getTrack(n)})),C=Zi(n,l,c,k,i)-h,E=Zi(n,g,c,k,d)-h;if(v){var x=Ji()().moveTo(y-20*("left"===v.Join?-1:1)*(O?-1:1),C).lineTo(y,C).lineTo(w,E).lineTo(w-20*("left"===v.MateDirection?1:-1)*(j?-1:1),E).end();t.push(a.createElement("path",{d:x,key:JSON.stringify(x),strokeWidth:b===p?10:5,onMouseOver:function(){return m(b)},onMouseOut:function(){return m(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1){var i=r(o);if("object"===typeof i)return i.v}return t})))}))},oc=n(1269),ic=n(1272),cc=n.n(ic),sc=n(1273),lc=n.n(sc),uc=n(1276),dc=n.n(uc),fc=n(1277),pc=n.n(fc),mc=n(1274),gc=n.n(mc),hc=n(1275),bc=n.n(hc),vc=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("react")),o=t("@material-ui/core/IconButton"),i=(0,t("@material-ui/core/styles").makeStyles)((function(e){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},emphasis:{background:e.palette.secondary.main,padding:e.spacing(1)},hovered:{background:e.palette.secondary.light},displayName:{background:e.palette.secondary.main,paddingTop:3,paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),c=a((function(e){var t=e.model,n=i();return r.createElement(o,{onClick:function(){return t.toggleInteract()},className:n.iconButton,title:"Toggle interacting with the overlay"},t.interactToggled?r.createElement(cc.a,null):r.createElement(lc.a,null))})),s=a((function(e){var t=e.model,n=i();return r.createElement(o,{onClick:function(){return t.toggleLinkViews()},className:n.iconButton,title:"Toggle linked scrolls and behavior across views"},t.linkViews?r.createElement(gc.a,{color:"secondary"}):r.createElement(bc.a,{color:"secondary"}))})),l=a((function(e){var t=e.model,n=i();return r.createElement(o,{onClick:t.toggleIntraviewLinks,className:n.iconButton,title:"Toggle rendering intraview links"},t.showIntraviewLinks?r.createElement(dc.a,{color:"secondary"}):r.createElement(pc.a,{color:"secondary"}))})),u=a((function(e){var t=e.model,n=e.size,a=i();return t.setHeaderHeight(n.height),r.createElement("div",{className:a.headerBar},r.createElement(s,{model:t}),r.createElement(c,{model:t}),r.createElement(l,{model:t}),r.createElement("div",{className:a.spacer}))}));return Object(oc.withSize)({monitorHeight:!0})(u)},yc=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util").getSession,a=t("mobx-react").observer,r=t("react"),o=t("react").useState,i=t("mobx-state-tree").getSnapshot;return a((function(e){var t=e.model,a=e.trackConfigId,c=e.parentRef,s=t.views,l=n(t),u=t.getMatchedTranslocationFeatures(a),d=t.getTrackFeatures(a),p=t.getMatchedFeaturesInLayout(a,u),m=o(),g=Object(f.a)(m,2),h=g[0],b=g[1],v=i(t);$i(v);var y=0;if(c.current){var w=c.current.getBoundingClientRect();y=w.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":p.length?"".concat(a,"-loaded"):a},p.map((function(e){for(var t=[],n=function(n){var o=e[n],i=o.layout,c=o.feature,u=o.level,p=0===u?1:0,m=c.id();if(!i)return{v:null};var g=c.get("INFO"),v=g.CHR2[0],w=g.END[0],O=g.STRANDS[0].split(""),j=Object(f.a)(O,2),k=j[0],C=j[1],E=Ki(s[p],v,w);if(E){var x=[E,0,E+1,0],S=Ki(s[u],c.get("refName"),i[0]),T=E,N=s[u].pxToBp(S).reversed,A=s[p].pxToBp(T).reversed,R=s.map((function(e){return e.getTrack(a)})),M=Zi(a,u,s,R,i)-y,P=Zi(a,p,s,R,x)-y,F=Ji()().moveTo(S-20*("+"===k?1:-1)*(N?-1:1),M).lineTo(S,M).lineTo(T,P).lineTo(T-20*("+"===C?1:-1)*(A?-1:1),P).end();t.push(r.createElement("path",{d:F,key:JSON.stringify(F),strokeWidth:m===h?10:5,onClick:function(){var e=l.addWidget("VariantFeatureWidget","variantFeature",{featureData:(d.get(m)||{toJSON:function(){}}).toJSON()});l.showWidget(e)},onMouseOver:function(){return b(m)},onMouseOut:function(){return b(void 0)}}))}},o=0;o<e.length;o+=1){var i=n(o);if("object"===typeof i)return i.v}return t})))}))},wc=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("react")),o=r.useRef,i=t("@material-ui/core/styles").makeStyles,c=t(ac),s=t(rc),l=t(yc),u=t(vc),d=i((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:"3px",background:"magenta"},viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}},content:{gridArea:"1/1"}}})),f=a((function(e){var t=e.model,n=e.trackConfigId,a=t.getMatchedTracks(n);return"PileupTrack"===a[0].type||"AlignmentsTrack"===a[0].type?r.createElement(c,e):"VariantTrack"===a[0].type?t.hasTranslocations(n)?r.createElement(l,e):r.createElement(s,e):null}));return a((function(t){var n=t.model,a=d(),i=n.views,c=o(null);return r.createElement("div",null,r.createElement(u,{model:n}),r.createElement("div",{className:a.container},r.createElement("div",{className:a.content},r.createElement("div",{style:{position:"relative"}},i.map((function(t,n){var o=e.getViewType(t.type).ReactComponent,c=r.createElement(o,{key:t.id,model:t});return n===i.length-1?c:[c,r.createElement("div",{key:"".concat(t.id,"-divider"),className:a.viewDivider})]})))),r.createElement("div",{className:a.overlay},r.createElement("svg",{ref:c,style:{width:"100%",zIndex:10,pointerEvents:n.interactToggled?void 0:"none"}},n.matchedTracks.map((function(e){return r.createElement(f,{parentRef:c,key:e,model:n,trackConfigId:e})}))))))}))},Oc=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"snapshotFromBreakendFeature",value:function(e,t){var n,a=(e.get("ALT")||[])[0],r=e.get("start"),o=t.displayedRegions[0].assemblyName,i=Object(_.getSession)(t).assemblyManager.get(o);if(!i)throw new Error("assembly ".concat(o," not found"));if(!i.regions)throw new Error("assembly ".concat(o," regions not loaded"));var c,s=i.getCanonicalRefName,l=s(e.get("refName")),d=i.regions.find((function(e){return e.refName===String(l)})),f=0,p=0;if(a)if("<TRA>"===a){var m=e.get("INFO")||[];n=m.END[0]-1,c=s(m.CHR2[0])}else{var g=a.MatePosition.split(":");n=parseInt(g[1],10)-1,c=s(g[0]),"left"===a.Join&&(f=-1),"left"===a.MateDirection&&(p=-1)}else if(e.get("mate")){var h=e.get("mate");c=s(h.refName),n=h.start}if(!c)return console.warn("unable to resolve mate refName ".concat(c," in reference genome")),{};var b=i.regions.find((function(e){return e.refName===String(c)}));if(!d||!b)return console.warn("unable to find the refName for the top or bottom of the breakpoint view"),{};var v=[Object(u.a)({},d),Object(u.a)({},d)],y=[Object(u.a)({},b),Object(u.a)({},b)];return v[0].end=r+f,v[1].start=r+f,y[0].end=n+p,y[1].start=n+p,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:v,hideHeader:!0,bpPerPx:10,offsetPx:(d.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:y,hideHeader:!0,bpPerPx:10,offsetPx:(b.start+n)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail")}}}]),n}(j.a),jc=function(e){var t=e.load,n=t(wc),a=t(Ui).stateModel;return new Oc({name:"BreakpointSplitView",stateModel:a,ReactComponent:n})},kc=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="BreakpointSplitViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(jc)})),e.addWidgetType((function(){return new k.a({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:qi,stateModel:zi,ReactComponent:Wi})}))}},{key:"configure",value:function(){}}]),n}(F.a),Cc=n(2289),Ec=n.n(Cc),xc=n(2285),Sc=n.n(xc),Tc=n(2286),Nc=n.n(Tc),Ac=n(2287),Rc=n.n(Ac),Mc=n(2288),Pc=n.n(Mc),Fc=function(e){var t=e.jbrequire,n=t("mobx-react").observer,a=t("react"),r=t("@jbrowse/core/util").getSession,o=t("@jbrowse/core/util/color").makeContrasting,i=t("@material-ui/core/styles"),c=i.makeStyles,l=i.useTheme,u=t("@jbrowse/core/util"),d=u.polarToCartesian,f=u.radToDeg,p=u.assembleLocString,m=c({rulerLabel:{fontSize:"0.8rem",fontWeight:500,lineHeight:1.6,letterSpacing:"0.0075em"}});function g(e,t,n,a){if(e.flipped){var r=[a,n];n=r[0],a=r[1]}var o=e.bpToXY(n,t),i=e.bpToXY(a,t),c=Math.abs(a-n)/e.bpPerRadian>Math.PI?"1":"0";return["M"].concat(Object(s.a)(o),["A",t,t,"0",c,"1"],Object(s.a)(i)).join(" ")}var h=n((function(e){var t=e.model,n=e.slice,r=l(),o=t.radiusPx+1,i=n.endRadians,c=n.startRadians,u=n.region,f=d(o,c),p=d(o,i),m=(i-c)*o,g=i-c>Math.PI?"1":"0",h=(i+c)/2,v="[".concat(Number(u.regions.length).toLocaleString(),"]");return a.createElement(a.Fragment,null,a.createElement(b,{text:v,view:t,maxWidthPx:m,radians:h,radiusPx:o,title:"".concat(Number(u.regions.length).toLocaleString()," more regions"),color:r.palette.text.primary}),a.createElement("path",{d:["M"].concat(Object(s.a)(f),["A",o,o,"0",g,"1"],Object(s.a)(p)).join(" "),stroke:r.palette.text.secondary,strokeWidth:2,strokeDasharray:"2,2",fill:"none"}))})),b=n((function(e){var t=e.view,n=e.text,r=e.maxWidthPx,o=e.radians,i=e.radiusPx,c=e.title,s=e.color,l=m(),u=d(i+5,o);return n?6.5*n.length<r?a.createElement("text",{x:0,y:0,className:l.rulerLabel,textAnchor:"middle",dominantBaseline:"baseline",transform:"translate(".concat(u,") rotate(").concat(f(o)+90,")"),style:{fill:s}},n,a.createElement("title",null,c||n)):r>4?f(o+t.offsetRadians-Math.PI/2)>=180?a.createElement("text",{x:0,y:0,className:l.rulerLabel,textAnchor:"start",dominantBaseline:"middle",transform:"translate(".concat(u,") rotate(").concat(f(o),")"),style:{fill:s}},n,a.createElement("title",null,c||n)):a.createElement("text",{x:0,y:0,className:l.rulerLabel,textAnchor:"end",dominantBaseline:"middle",transform:"translate(".concat(u,") rotate(").concat(f(o)+180,")"),style:{fill:s}},n,a.createElement("title",null,c||n)):null:null})),v=n((function(e){var t,n=e.model,i=e.slice,c=l(),s=n.radiusPx,u=i.region,d=i.endRadians,f=i.startRadians,p=(d+f)/2,m=(d-f)*s,h=r(n).assemblyManager.get(i.region.assemblyName);if(h&&(t=h.getRefNameColor(u.refName)),t)try{t=o(t,c.palette.background.paper)}catch(v){t=c.palette.text.primary}else t=c.palette.text.primary;return a.createElement(a.Fragment,null,a.createElement(b,{text:u.refName,view:n,maxWidthPx:m,radians:p,radiusPx:s,color:t}),a.createElement("path",{d:g(i,s+1,u.start,u.end),stroke:t,strokeWidth:2,fill:"none"},a.createElement("title",null,u.refName)))}));return n((function(e){var t=e.model,n=e.slice;return n.region.elided?a.createElement(h,{key:p(n.region.regions[0]),model:t,slice:n}):a.createElement(v,{key:p(n.region),model:t,slice:n})}))},Ic=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("mobx-state-tree").getSnapshot),o=t("react"),i=t("react").useState,c=t("@material-ui/core/Button"),s=t("@material-ui/core/Container"),l=t("@material-ui/core/Grid"),u=t("@material-ui/core/IconButton"),d=t("@material-ui/core/MenuItem"),p=t("@material-ui/core/TextField"),m=t("@material-ui/core/styles").makeStyles,g=t("@material-ui/core/colors").grey,h=t("@jbrowse/core/ui").ResizeHandle,b=t("@jbrowse/core/util"),v=b.assembleLocString,y=b.getSession,w=t(Fc),O=m((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden",background:"white"},scroller:{overflow:"auto"},sliceRoot:{background:"none",boxSizing:"content-box",display:"block"},iconButton:{padding:"4px",margin:"0 2px 0 2px"},controls:{overflow:"hidden",whiteSpace:"nowrap",position:"absolute",background:g[200],boxSizing:"border-box",borderRight:"1px solid #a2a2a2",borderBottom:"1px solid #a2a2a2",left:0,top:0},importFormContainer:{marginBottom:e.spacing(4)}}})),j=a((function(e){var t=e.model;return o.createElement(o.Fragment,null,o.createElement(o.Fragment,null,t.staticSlices.map((function(e){return o.createElement(w,{key:v(e.region.elided?e.region.regions[0]:e.region),model:t,slice:e})}))),o.createElement(o.Fragment,null,t.tracks.map((function(e){var n=e.displays[0];return o.createElement(n.RenderingComponent,{key:n.id,display:n,view:t})}))))})),k=a((function(e){var t=e.model,n=e.showingFigure,a=O();return o.createElement("div",{className:a.controls},o.createElement(u,{onClick:t.zoomOutButton,className:a.iconButton,title:t.lockedFitToWindow?"unlock to zoom out":"zoom out",disabled:!n||t.atMaxBpPerPx||t.lockedFitToWindow,color:"secondary"},o.createElement(In.a,null)),o.createElement(u,{onClick:t.zoomInButton,className:a.iconButton,title:"zoom in",disabled:!n||t.atMinBpPerPx,color:"secondary"},o.createElement(Pn.a,null)),o.createElement(u,{onClick:t.rotateCounterClockwiseButton,className:a.iconButton,title:"rotate counter-clockwise",disabled:!n,color:"secondary"},o.createElement(Sc.a,null)),o.createElement(u,{onClick:t.rotateClockwiseButton,className:a.iconButton,title:"rotate clockwise",disabled:!n,color:"secondary"},o.createElement(Nc.a,null)),o.createElement(u,{onClick:t.toggleFitToWindowLock,className:a.iconButton,title:t.lockedFitToWindow?"locked model to window size":"unlocked model to zoom further",disabled:t.tooSmallToLock,color:"secondary"},t.lockedFitToWindow?o.createElement(Rc.a,null):o.createElement(Pc.a,null)),t.hideTrackSelectorButton?null:o.createElement(u,{onClick:t.activateTrackSelector,title:"Open track selector","data-testid":"circular_track_select",color:"secondary"},o.createElement(Ft,null)))})),C=a((function(e){var t=e.model,n=O(),a=i(0),u=Object(f.a)(a,2),m=u[0],g=u[1],h=y(t),b=h.assemblyNames,v=h.assemblyManager,w=b.length?"":"No configured assemblies",j=v.get(b[m]),k=j&&j.regions?r(j.regions):[];return o.createElement(o.Fragment,null,o.createElement(s,{className:n.importFormContainer},o.createElement(l,{container:!0,spacing:1,justify:"center",alignItems:"center"},o.createElement(l,{item:!0},o.createElement(p,{select:!0,value:b[m]&&!w?m:"",onChange:function(e){g(Number(e.target.value))},helperText:w||"Select assembly to view",error:!!w,disabled:!!w,margin:"normal"},b.map((function(e,t){return o.createElement(d,{key:e,value:t},e)})))),o.createElement(l,{item:!0},o.createElement(c,{disabled:!(k&&k.length),onClick:function(){t.setDisplayedRegions(k)},variant:"contained",color:"primary"},k.length?"Open":"Loading\u2026")))))}));return a((function(e){var t=e.model,n=O(),a=!!t.displayedRegions.length&&t.figureWidth&&t.figureHeight,r=!a&&!t.disableImportForm,i=a&&!r;return o.createElement("div",{className:n.root,style:{width:t.width,height:t.height},"data-testid":t.id},t.error?o.createElement("p",{style:{color:"red"}},t.error.message):o.createElement(o.Fragment,null,r?o.createElement(C,{model:t}):null,o.createElement(o.Fragment,null,i?o.createElement("div",{className:n.scroller,style:{width:t.width,height:t.height}},o.createElement("div",{className:n.rotator,style:{transform:["rotate(".concat(t.offsetRadians,"rad)")].join(" "),transition:"transform 0.5s",transformOrigin:t.centerXY.map((function(e){return"".concat(e,"px")})).join(" ")}},o.createElement("svg",{style:{position:"absolute",left:0,top:0},className:n.sliceRoot,width:"".concat(t.figureWidth,"px"),height:"".concat(t.figureHeight,"px"),version:"1.1"},o.createElement("g",{transform:"translate(".concat(t.centerXY,")")},o.createElement(j,{model:t}))))):null,o.createElement(k,{model:t,showingFigure:i}),t.hideVerticalResizeHandle?null:o.createElement(h,{onDrag:t.resizeHeight,style:{height:3,position:"absolute",bottom:0,left:0,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))))}))};function Bc(e,t,n,a,r){var o=Math.abs(e-n);if(!(o>a)){o===a&&r.push([t,e]);var i=Math.sqrt(a*a-o*o);r.push([t-i,e]),r.push([t+i,e])}}function Lc(e,t,n,a,r){var o=Math.abs(e-t);if(!(o>a)){o===a&&r.push([e,n]);var i=Math.sqrt(a*a-o*o);r.push([e,n-i]),r.push([e,n+i])}}function Dc(e,t){var n=Math.sqrt(e*e+t*t);return 0===n?[0,0]:[n,function(e,t){var n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t)]}var Vc=2*Math.PI;var Wc=function(){function e(t,n,a,r){Object(g.a)(this,e),this.key=void 0,this.region=void 0,this.offsetRadians=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.radianWidth=void 0,this.flipped=void 0;var o=t.bpPerRadian;this.key=Object(_.assembleLocString)(n),this.region=n,this.offsetRadians=a,this.bpPerRadian=o,this.radianWidth=r,this.flipped=!1,this.startRadians=this.offsetRadians,this.endRadians=n.widthBp/this.bpPerRadian+this.offsetRadians,Object.freeze(this)}return Object(h.a)(e,[{key:"bpToXY",value:function(e,t){var n=(this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start)/this.bpPerRadian+this.offsetRadians;return Object(_.polarToCartesian)(t,n)}},{key:"toJSON",value:function(){return Object(_.objectFromEntries)(Object.entries(this))}}]),e}();function qc(e,t){var n,a,r,o,i=Object(f.a)(e.visibleSection.theta,2),c=i[0],s=i[1];return n=t.offsetRadians+e.offsetRadians,a=t.radianWidth,r=c,o=s-c,!(a<=0||o<=0)&&(a+1e-4>=Vc||o+1e-4>=Vc||(n=(n%Vc+Vc)%Vc+Vc)<(r=(r%Vc+Vc)%Vc+Vc)+o&&n+a>r||n<(r-=Vc)+o&&n+a>r||n<(r+=Vc+Vc)+o&&n+a>r)}function zc(e){var t=e.lib,n=t.mobx.transaction,a=t["mobx-state-tree"],r=a.types,o=a.getParent,i=a.resolveIdentifier,c=a.getRoot,s=a.cast,l=t["@jbrowse/core/util/types/mst"].Region,d=t["@jbrowse/core/configuration"].readConfObject,p=t["@jbrowse/core/util"],m=p.clamp,g=p.getSession,h=p.isSessionModelWithWidgets,b=t["@jbrowse/core/pluggableElementTypes/models"].BaseViewModel,v=r.model("CircularView",{type:r.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:2e6,tracks:r.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:r.optional(r.refinement("trackHeight",r.number,(function(e){return e>=40})),400),minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,displayedRegions:r.array(l),scrollX:0,scrollY:0,trackSelectorType:"hierarchical"}).volatile((function(){return{width:800}})).views((function(e){return{get staticSlices(){return function(e){var t,n=[],a=0,r=Object(He.a)(e.elidedRegions);try{for(r.s();!(t=r.n()).done;){var o=t.value,i=o.widthBp/e.bpPerRadian+e.spacingPx/e.pxPerRadian;n.push(new Wc(e,o,a,i)),a+=i}}catch(c){r.e(c)}finally{r.f()}return n}(e)},get visibleStaticSlices(){return this.staticSlices.filter(qc.bind(this,e))},get visibleSection(){return function(e,t,n){var a=Object(f.a)(e,4),r=a[0],o=a[1],i=a[2],c=a[3],s=Object(f.a)(t,2),l=s[0],u=s[1];if(o-=l,i-=u,c-=u,(r-=l)<0&&o>0&&i<0&&c>0){for(var d=[[r,i],[o,i],[r,c],[o,c]],p=-1/0,m=0;m<d.length;m+=1){var g=Object(f.a)(d[m],2),h=g[0],b=g[1],v=Math.sqrt(h*h+b*b);v>p&&(p=v)}return{rho:[0,Math.min(n,p)],theta:[0,2*Math.PI]}}var y=[[r,i],[o,i],[r,c],[o,c]];Lc(r,0,0,n,y),Lc(o,0,0,n,y),Bc(i,0,0,n,y),Bc(c,0,0,n,y),-r<n&&y.push([r,0]),o<n&&y.push([o,0]),-i<n&&y.push([0,i]),c<n&&y.push([0,c]);for(var w=r>=0?-1:1,O=1/0,j=-1/0,k=1/0,C=-1/0,E=0;E<y.length;E+=1){var x=Object(f.a)(y[E],2),S=x[0],T=x[1];if(S>=r&&S<=o&&T>=i&&T<=c){var N=Dc(S*w,T*w),A=Object(f.a)(N,2),R=A[0],M=A[1];R<=n+.001&&(M<k&&R>1e-4&&(k=M),M>C&&R>1e-4&&(C=M),R<O&&(O=R),R>j&&(j=R))}}return-1===w&&(k+=Math.PI,C+=Math.PI),k>2*Math.PI&&C>2*Math.PI&&(k-=2*Math.PI,C-=2*Math.PI),{rho:[O,Math.min(n,j)],theta:[k,C]}}([e.scrollX,e.scrollX+e.width,e.scrollY,e.scrollY+e.height],this.centerXY,this.radiusPx)},get circumferencePx(){var t,n=0,a=Object(He.a)(this.elidedRegions);try{for(a.s();!(t=a.n()).done;){n+=t.value.widthBp}}catch(r){a.e(r)}finally{a.f()}return n/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){var t,n=0,a=Object(He.a)(e.displayedRegions);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.end-r.start}}catch(o){a.e(o)}finally{a.f()}return n},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){var t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){var e=2*Math.PI*this.maximumRadiusPx;return m(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){var t=[];e.displayedRegions.forEach((function(n){var a=n.end-n.start;if(a/e.bpPerPx<e.minVisibleWidth){var r=t[t.length-1];r&&r.elided?(r.regions.push(Object(u.a)({},n)),r.widthBp+=a):t.push({elided:!0,widthBp:a,regions:[Object(u.a)({},n)]})}else t.push(Object(u.a)(Object(u.a)({},n),{},{widthBp:a}))}));for(var n=0;n<t.length;n+=1){var a=t[n];a.elided&&1===a.regions.length&&(delete a.elided,t[n]=Object(u.a)(Object(u.a)({},a),a.regions[0]))}return t},get assemblyNames(){var t=[];return e.displayedRegions.forEach((function(e){t.includes(e.assemblyName)||t.push(e.assemblyName)})),t}}})).volatile((function(){return{error:void 0}})).actions((function(t){return{setWidth:function(e){return t.width=Math.max(e,100),t.width},setHeight:function(e){return t.height=Math.max(e,40),t.height},resizeHeight:function(e){var n=t.height,a=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),a-n},resizeWidth:function(e){var n=t.width,a=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),a-n},rotateClockwiseButton:function(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton:function(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton:function(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton:function(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx:function(e){t.bpPerPx=m(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust:function(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView:function(){o(t,2).removeView(t)},setDisplayedRegions:function(e){var n=0===t.displayedRegions.length;t.displayedRegions=s(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=g(t);if(h(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setError:function(e){t.error=e},showTrack:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.pluggableConfigSchemaType("track"),o=i(r,c(t),n),s=e.getTrackType(o.type);if(!s)throw new Error("unknown track type ".concat(o.type));var l=e.getViewType(t.type),d=l.displayTypes.map((function(e){return e.name})),f=o.displays.find((function(e){return d.includes(e.type)})),p=s.stateModel.create(Object(u.a)(Object(u.a)({},a),{},{type:o.type,configuration:o,displays:[{type:f.type,configuration:f}]}));t.tracks.push(p)},addTrackConf:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.type,o=d(n,"name"),i=e.getTrackType(r);if(!i)throw new Error("unknown track type ".concat(n.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),l=n.displays.find((function(e){return s.includes(e.type)})),f=i.stateModel.create(Object(u.a)(Object(u.a)({},a),{},{name:o,type:r,configuration:n,displays:[{type:l.type,configuration:l}]}));t.tracks.push(f)},hideTrack:function(a){var r=e.pluggableConfigSchemaType("track"),o=i(r,c(t),a),s=t.tracks.filter((function(e){return e.configuration===o}));return n((function(){return s.forEach((function(e){return t.tracks.remove(e)}))})),s.length},toggleFitToWindowLock:function(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow}}}));return{stateModel:r.compose(b,v)}}var Hc=function(e){var t=e.lib,n=e.load,a=t["@jbrowse/core/pluggableElementTypes/ViewType"],r=n(Ic);return new a({name:"CircularView",stateModel:n(zc).stateModel,ReactComponent:r})},_c=function(e){var t=e.lib,n=t.react,a=n.useState,r=n.useEffect,o=t["@material-ui/core/styles"].makeStyles,i=t["mobx-react"].observer,c=o((function(e){return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:e.palette.primary.light},"25%":{stroke:e.palette.secondary.light},"50%":{stroke:e.palette.tertiary.light},"75%":{stroke:e.palette.quaternary.light},"100%":{stroke:e.palette.primary.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}));return i((function(e){var t=e.model.renderProps.radius,o=c(),i=a(!1),s=Object(f.a)(i,2),l=s[0],u=s[1];return r((function(){var e=setTimeout((function(){return u(!0)}),400);return function(){return clearTimeout(e)}})),l?n.createElement("g",null,n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}}))),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),n.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},"Loading\u2026"),n.createElement("circle",{className:o.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})):null}))},Uc=function(e){var t=e.jbrequire,n=t("react"),a=t("@material-ui/core/styles").makeStyles,r=t("mobx-react").observer,o=a({errorMessage:{},errorBackground:{},errorText:{}});return r((function(e){var t=e.model,a=t.renderProps.radius,r=t.error,i=o();return n.createElement("g",{className:i.errorMessage},n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}}))),n.createElement("circle",{className:i.errorBackground,cx:"0",cy:"0",r:a,fill:"#ffb4b4"}),n.createElement("circle",{className:i.errorPattern,cx:"0",cy:"0",r:a,fill:"url(#diagonalHatch)"}),n.createElement("text",{className:i.errorText,x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},String(r)))}))},Gc=function(e){var t=e.jbrequire,n=t("react"),a=t("mobx-state-tree").isAlive,r=n.useEffect,o=n.useRef,i=t("mobx-react"),c=i.observer,s=(i.PropTypes,t("react-dom")),l=s.unmountComponentAtNode,d=s.hydrate,f=t("@jbrowse/core/util").rIC;return c((function(e){var t=e.model,i=t.data,c=t.html,s=t.filled,p=t.renderProps,m=t.renderingComponent,g=o(null);return r((function(){var e=g.current;return e&&s&&(e&&e.innerHTML&&(e.style.display="none",l(e)),e.style.display="inline",e.innerHTML=c,f((function(){if(a(t)){var r=n.createElement(m,Object(u.a)(Object(u.a)({},i),p),null);f((function(){a(t)&&d(r,e)}))}}))),function(){e&&l(e)}})),n.createElement("g",{ref:g})}))},Jc=function(e){var t=e.lib,n=e.load,a=t.react,r=t["mobx-react"],o=r.observer,i=(r.PropTypes,n(_c)),c=n(Uc),s=n(Gc);return o((function(e){var t=e.display;return t.error?a.createElement(c,{model:t}):t.filled?a.createElement(s,{model:t}):a.createElement(i,{model:t})}))},Qc=n(1005),Xc=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util/tracks").getRpcSessionId,a=t("@jbrowse/core/util").getContainingView,r=t("@jbrowse/core/util").getSession;function o(){return(o=Object(l.a)(c.a.mark((function e(t,n,a){var r,o,i,s,l,f,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:if(r=t.rendererType,o=t.rpcManager,i=t.cannotBeRenderedReason,s=t.renderArgs,l=t.renderProps,!i){e.next=5;break}return e.abrupt("return",{message:i});case 5:if(t.renderProps.radius&&t.renderArgs.regions&&t.renderArgs.regions.length){e.next=7;break}return e.abrupt("return",{message:"Skipping render"});case 7:if(a.isCompatibleWithRenderer(r)){e.next=9;break}throw new Error("renderer ".concat(r.name," is not compatible with this display type"));case 9:return e.next=11,r.renderInClient(o,Object(u.a)(Object(u.a)(Object(u.a)({},s),l),{},{signal:n}));case 11:return f=e.sent,p=f.html,m=Object(d.a)(f,["html"]),e.abrupt("return",{html:p,data:m,renderingComponent:r.ReactComponent});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{renderReactionData:function(e){var t,o=e,i=a(o),c=o.rendererType,s=o.renderProps;return{rendererType:c,rpcManager:r(i).rpcManager,renderProps:s,renderArgs:{assemblyName:null===(t=i.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:JSON.parse(JSON.stringify(o.adapterConfig)),rendererType:c.name,regions:JSON.parse(JSON.stringify(i.displayedRegions)),blockDefinitions:i.blockDefinitions,sessionId:n(o),timeout:1e6}}},renderReactionEffect:function(e,t,n){return o.apply(this,arguments)}}},Yc=b.types.compose("BaseChordDisplay",Fe.BaseDisplay,b.types.model({bezierRadiusRatio:.1,assemblyName:b.types.maybe(b.types.string)})).volatile((function(){return{filled:!1,html:"",data:void 0,message:"",error:void 0,renderingComponent:void 0,refNameMap:void 0}})).actions((function(e){var t=Object(b.getEnv)(e).pluginManager,n=e;return{onChordClick:function(a){Object(P.getConf)(e,"onChordClick",{feature:a,track:n,pluginManager:t})}}})).views((function(e){return{get blockDefinitions(){var t=Object(_.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;var n=JSON.parse(JSON.stringify(t));return n.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(t){var n,a=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];a&&t.refName!==a&&(t.refName=a)}))})),n},get renderProps(){var t=Object(_.getContainingView)(e);return Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),{},{displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick})},get rendererType(){var t=e,n=Object(b.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},isCompatibleWithRenderer:function(e){return!!(e instanceof Qc.a)},get selectedFeatureId(){if(Object(b.isAlive)(e)){var t=Object(_.getSession)(e);if(t){var n=t.selection;return Object(U.b)(n)?n.id():void 0}}}}})).actions((function(e){return{renderStarted:function(){e.filled=!1,e.message="",e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess:function(t){var n=t.message,a=t.data,r=t.html,o=t.renderingComponent;n?(e.filled=!1,e.message=n,e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.html=r,e.data=a,e.error=void 0,e.renderingComponent=o)},renderError:function(t){console.error(t),e.filled=!1,e.message="",e.html="",e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap:function(t){e.refNameMap=t},setError:function(t){e.error=t}}})).actions((function(e){var t=Object(b.getEnv)(e).pluginManager.jbrequire(Xc),n=t.renderReactionData,a=t.renderReactionEffect;return{afterAttach:function(){Object(_.makeAbortableReaction)(e,n,a,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),Object(_.makeAbortableReaction)(e,(function(){return{assemblyNames:Object(Ue.getTrackAssemblyNames)(e.parentTrack),adapter:Object(P.getConf)(Object(b.getParent)(e,2),"adapter"),assemblyManager:Object(_.getSession)(e).assemblyManager}}),function(){var t=Object(l.a)(c.a.mark((function t(n,a){var r,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.assemblyNames,o=n.adapter,i=n.assemblyManager,t.abrupt("return",i.getRefNameMapForAdapter(o,r[0],{signal:a,sessionId:Object(Ue.getRpcSessionId)(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(function(){}),(function(t){e.setRefNameMap(t)}),(function(t){console.error(t),e.setError(t)}))}}})),Kc=Object(P.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),Zc=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CircularViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(Hc)}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Circular view",icon:Ec.a,onClick:function(e){e.addView("CircularView",{})}})}}]),n}(F.a),$c=n(2462),es=n(2290),ts=n(342),ns=n(2502),as=n(2514),rs=n(2504),os=n(982),is=n(2470),cs=n(2461),ss=n(2469),ls=n(2476),us=n(313),ds=n.n(us),fs=n(331),ps=n.n(fs),ms=n(999),gs=n.n(ms),hs=n(520),bs=n(1280),vs=n.n(bs),ys=n(1278),ws=n.n(ys),Os=n(2542),js=n(2305),ks=n.n(js);Os.a.registerLanguage("javascript",ks.a);var Cs='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',Es=Object(Ze.a)((function(e){return{callbackEditor:{marginTop:"16px",borderBottom:"1px solid ".concat(e.palette.divider),fontFamily:Cs,fontSize:"12px"},syntaxHighlighter:{margin:0,fontFamily:Cs,fontSize:"12px"}}}));var xs=Object(re.observer)((function(e){var t=e.slot,n=Es(),a=Object(p.useState)(t.value),r=Object(f.a)(a,2),o=r[0],i=r[1],c=Object(p.useState)(),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(_.useDebounce)(o,400);return Object(p.useEffect)((function(){try{var e,n=d.startsWith("jexl:")?d:"jexl:".concat(d);Object(hs.a)(n,null===(e=Object(b.getEnv)(t).pluginManager)||void 0===e?void 0:e.jexl),t.set(n),u(null)}catch(a){u(a)}}),[d,t]),m.a.createElement(m.a.Fragment,null,m.a.createElement(os.a,null,m.a.createElement(cs.a,{shrink:!0,htmlFor:"callback-editor"},t.name),m.a.createElement(ws.a,{className:n.callbackEditor,value:o.startsWith("jexl:")?o.split("jexl:")[1]:o,onValueChange:function(e){i(e)},highlight:function(e){return e},padding:10,style:{background:l?"#fdd":void 0}}),m.a.createElement(is.a,null,t.description)),m.a.createElement(et.a,{title:m.a.createElement("div",null,"Callbacks are written in Jexl format. Click to learn more.",m.a.createElement("br",null)," Names of available context items: ",t.contextVariable),arrow:!0},m.a.createElement(Qt.a,{color:"primary",onClick:function(){var e=window.open("https://github.com/TomFrost/Jexl","_blank","noopener,noreferrer");e&&(e.opener=null)}},m.a.createElement(vs.a,null))))}));var Ss=Object(Ze.a)({popover:{position:"absolute",zIndex:2},cover:{position:"fixed",top:0,right:0,bottom:0,left:0}});function Ts(e){var t=e.color,n=e.onChange,a=Ss(),r=Object(p.useState)(!0),o=Object(f.a)(r,2),i=o[0],c=o[1];return m.a.createElement("div",null,i?m.a.createElement("div",{className:a.popover},m.a.createElement("div",{role:"presentation",className:a.cover,onClick:function(){c(!1)}}),m.a.createElement(Fr.a,{color:t,onChange:n})):null)}var Ns=function(e){var t=e.value,n=e.label,a=e.TextFieldProps,r=e.onChange,o=Object(p.useState)(!1),i=Object(f.a)(o,2),c=i[0],s=i[1];return m.a.createElement(m.a.Fragment,null,m.a.createElement(dn.a,Object.assign({value:t,label:n,InputProps:{style:{color:t,borderRightWidth:"25px",borderRightStyle:"solid",borderRightColor:t}},onClick:function(){return s(!c)},onChange:function(e){r(e.target.value)}},a)),c?m.a.createElement(Ts,{color:t,onChange:function(e){r(function(e){if(e instanceof Object){var t=e,n=t.r,a=t.g,r=t.b,o=t.a;return"rgb(".concat(n,",").concat(a,",").concat(r,",").concat(o,")")}return e}(e.rgb))}}):null)};Ns.defaultProps={label:"",value:"#000",TextFieldProps:{}};var As=Object(re.observer)((function(e){var t=e.slot;return m.a.createElement(Ns,{label:t.name,value:t.value,onChange:function(e){t.set(e)},TextFieldProps:{helperText:t.description,fullWidth:!0}})})),Rs=n(2307),Ms=n.n(Rs),Ps=n(2309),Fs=n.n(Ps),Is=n(2310),Bs=n.n(Is);Os.a.registerLanguage("json",Ms.a);var Ls='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',Ds=Object(Ze.a)({callbackEditor:{fontFamily:Ls,fontSize:"12px",overflowX:"auto",marginTop:"16px",borderBottom:"1px solid rgba(0,0,0,0.42)"},syntaxHighlighter:{margin:0,fontFamily:Ls,fontSize:"12px"},error:{color:"red",fontSize:"0.8em"}});var Vs=Object(re.observer)((function(e){var t=e.slot,n=Ds(),a=Object($e.a)(),r=Object(p.useState)(JSON.stringify(t.value,null,"  ")),o=Object(f.a)(r,2),i=o[0],c=o[1],s=Object(p.useState)(),l=Object(f.a)(s,2),u=l[0],d=l[1],g=Object(_.useDebounce)(i,400);return Object(p.useEffect)((function(){try{t.set(JSON.parse(g)),d(void 0)}catch(e){d(e.message)}}),[g]),m.a.createElement(m.a.Fragment,null,u?m.a.createElement("p",{className:n.error},u):null,m.a.createElement(os.a,{error:u},m.a.createElement(cs.a,{shrink:!0,htmlFor:"callback-editor"},t.name),m.a.createElement(ws.a,{className:n.callbackEditor,value:i,onValueChange:c,highlight:function(e){return m.a.createElement(Os.a,{language:"json",style:"dark"===a.palette.type?Fs.a:Bs.a,className:n.syntaxHighlighter,customStyle:{background:"none",padding:0}},e)},padding:10,style:{}}),m.a.createElement(is.a,null,t.description)))})),Ws=Object(re.observer)((function(e){var t=e.slot;return m.a.createElement(dn.a,{label:t.name,helperText:t.description,fullWidth:!0,value:t.value,onChange:function(e){return t.set(e.target.value)}})})),qs=Object(re.observer)((function(e){var t=e.slot;return m.a.createElement(dn.a,{label:t.name,helperText:t.description,fullWidth:!0,multiline:!0,value:t.value,onChange:function(e){return t.set(e.target.value)}})})),zs=function(){return m.a.createElement(Mt.a,null,m.a.createElement("path",{d:"M20.41,3C21.8,5.71 22.35,8.84 22,12C21.8,15.16 20.7,18.29 18.83,21L17.3,20C18.91,17.57 19.85,14.8 20,12C20.34,9.2 19.89,6.43 18.7,4L20.41,3M5.17,3L6.7,4C5.09,6.43 4.15,9.2 4,12C3.66,14.8 4.12,17.57 5.3,20L3.61,21C2.21,18.29 1.65,15.17 2,12C2.2,8.84 3.3,5.71 5.17,3M12.08,10.68L14.4,7.45H16.93L13.15,12.45L15.35,17.37H13.09L11.71,14L9.28,17.33H6.76L10.66,12.21L8.53,7.45H10.8L12.08,10.68Z"}))},Hs=Object(re.observer)((function(e){var t=e.slot,n=Object(p.useState)(""),a=Object(f.a)(n,2),r=a[0],o=a[1];return m.a.createElement(m.a.Fragment,null,t.name?m.a.createElement(cs.a,null,t.name):null,m.a.createElement(ss.a,{disablePadding:!0},t.value.map((function(e,n){return m.a.createElement(ls.a,{key:n,disableGutters:!0},m.a.createElement(dn.a,{value:e,onChange:function(e){return t.setAtIndex(n,e.target.value)},InputProps:{endAdornment:m.a.createElement(mn.a,null,m.a.createElement(Qt.a,{color:"secondary",onClick:function(){return t.removeAtIndex(n)}},m.a.createElement(ds.a,null)))}}))})),m.a.createElement(ls.a,{disableGutters:!0},m.a.createElement(dn.a,{value:r,placeholder:"add new",onChange:function(e){return o(e.target.value)},InputProps:{endAdornment:m.a.createElement(mn.a,null,m.a.createElement(Qt.a,{onClick:function(){t.add(r),o("")},disabled:""===r,color:"secondary"},m.a.createElement(ps.a,null)))}}))),m.a.createElement(is.a,null,t.description))})),_s=Object(Ze.a)((function(e){return{card:{marginTop:e.spacing(1)}}})),Us=Object(re.observer)((function(e){var t=e.slot,n=_s(),a=Object(p.useState)(""),r=Object(f.a)(a,2),o=r[0],i=r[1];return m.a.createElement(m.a.Fragment,null,m.a.createElement(cs.a,null,t.name),Array.from(t.value,(function(e){var a=Object(f.a)(e,2),r=a[0],o=a[1];return m.a.createElement(ns.a,{raised:!0,key:r,className:n.card},m.a.createElement(rs.a,{title:r,action:m.a.createElement(Qt.a,{color:"secondary",onClick:function(){return t.remove(r)}},m.a.createElement(ds.a,null))}),m.a.createElement(as.a,null,m.a.createElement(Hs,{slot:{value:o,description:"Values associated with entry ".concat(r),setAtIndex:function(e,n){t.setAtKeyIndex(r,e,n)},removeAtIndex:function(e){t.removeAtKeyIndex(r,e)},add:function(e){t.addToKey(r,e)}}})))})),m.a.createElement(ns.a,{raised:!0,className:n.card},m.a.createElement(rs.a,{disableTypography:!0,title:m.a.createElement(dn.a,{fullWidth:!0,value:o,placeholder:"add new",onChange:function(e){return i(e.target.value)},InputProps:{endAdornment:m.a.createElement(mn.a,null,m.a.createElement(Qt.a,{disabled:""===o,onClick:function(){t.add(o,[]),i("")},color:"secondary"},m.a.createElement(ps.a,null)))}})})),m.a.createElement(is.a,null,t.description))})),Gs=Object(re.observer)((function(e){var t=e.slot,n=_s(),a=Object(p.useState)(""),r=Object(f.a)(a,2),o=r[0],i=r[1];return m.a.createElement(m.a.Fragment,null,m.a.createElement(cs.a,null,t.name),Array.from(t.value,(function(e){var a=Object(f.a)(e,2),r=a[0],o=a[1];return m.a.createElement(ns.a,{raised:!0,key:r,className:n.card},m.a.createElement(rs.a,{title:r,action:m.a.createElement(Qt.a,{color:"secondary",onClick:function(){return t.remove(r)}},m.a.createElement(ds.a,null))}),m.a.createElement(as.a,null,m.a.createElement(Js,{slot:{value:o,set:function(e){return t.add(r,e)}}})))})),m.a.createElement(ns.a,{raised:!0,className:n.card},m.a.createElement(rs.a,{disableTypography:!0,title:m.a.createElement(dn.a,{fullWidth:!0,value:o,placeholder:"add new",onChange:function(e){return i(e.target.value)},InputProps:{endAdornment:m.a.createElement(mn.a,null,m.a.createElement(Qt.a,{disabled:""===o,onClick:function(){t.add(o,0),i("")},color:"secondary"},m.a.createElement(ps.a,null)))}})})),m.a.createElement(is.a,null,t.description))})),Js=Object(re.observer)((function(e){var t=e.slot,n=Object(p.useState)(t.value),a=Object(f.a)(n,2),r=a[0],o=a[1];return Object(p.useEffect)((function(){var e=parseFloat(r,10);Number.isNaN(e)?t.reset():t.set(e)}),[t,r]),m.a.createElement(dn.a,{label:t.name,helperText:t.description,value:r,type:"number",onChange:function(e){return o(e.target.value)}})})),Qs=Object(re.observer)((function(e){var t=e.slot,n=Object(p.useState)(t.value),a=Object(f.a)(n,2),r=a[0],o=a[1];return Object(p.useEffect)((function(){var e=parseInt(r,10);Number.isNaN(e)||t.set(e)}),[t,r]),m.a.createElement(dn.a,{label:t.name,helperText:t.description,value:r,type:"number",onChange:function(e){return o(e.target.value)}})})),Xs=Object(re.observer)((function(e){var t=e.slot;return m.a.createElement(os.a,null,m.a.createElement(ei.a,{label:t.name,control:m.a.createElement(ti.a,{checked:t.value,onChange:function(e){return t.set(e.target.checked)}})}),m.a.createElement(is.a,null,t.description))})),Ys=Object(re.observer)((function(e){var t=e.slot,n=e.slotSchema,a=Object(b.getPropertyMembers)(Object(ts.getSubType)(n)),r=Object(ts.getUnionSubTypes)(Object(ts.getUnionSubTypes)(Object(ts.getSubType)(Object(ts.getPropertyType)(a,"value")))[1]).map((function(e){return e.value}));return m.a.createElement(dn.a,{value:t.value,label:t.name,select:!0,helperText:t.description,fullWidth:!0,onChange:function(e){return t.set(e.target.value)}},r.map((function(e){return m.a.createElement(va.a,{key:e,value:e},e)})))}));function Ks(e){return function(t){e.set(Object(u.a)(Object(u.a)({},e.value),t))}}var Zs=Object(re.observer)((function(e){var t=e.slot;return m.a.createElement(ue.FileSelector,{location:t.value,setLocation:Ks(t),name:t.name,description:t.description})})),$s={string:Ws,text:qs,fileLocation:Zs,stringArray:Hs,stringArrayMap:Us,numberMap:Gs,number:Js,integer:Qs,color:As,stringEnum:Ys,boolean:Xs,frozen:Vs,configRelationships:Vs},el=Object(Ze.a)((function(e){return{paper:{display:"flex",marginBottom:e.spacing(2),position:"relative",overflow:"visible"},paperContent:{flex:"auto",padding:e.spacing(1),overflow:"auto"},slotModeSwitch:{width:24,background:e.palette.secondary.light,display:"flex",justifyContent:"center",alignItems:"center"}}})),tl=Object(re.observer)((function(e){var t=e.slot,n=e.slotSchema,a=el(),r=t.type,o=t.isCallback?xs:$s[r];return o||(console.warn("no slot editor defined for ".concat(r,", editing as string")),o=Ws),r in $s||console.warn("SlotEditor needs to implement ".concat(r)),m.a.createElement(nn.a,{className:a.paper},m.a.createElement("div",{className:a.paperContent},m.a.createElement(o,{slot:t,slotSchema:n})),m.a.createElement("div",{className:a.slotModeSwitch},t.contextVariable.length?m.a.createElement(Qt.a,{className:a.slotModeIcon,onClick:function(){return t.isCallback?t.convertToValue():t.convertToCallback()},title:"convert to ".concat(t.isCallback?"regular value":"callback"),color:"secondary"},t.isCallback?m.a.createElement(zs,null):m.a.createElement(gs.a,null)):null))})),nl=Object(re.observer)((function(e){var t=e.typeNameChoices,n=e.slot,a=e.slotName,r=e.onChange,o=el();return m.a.createElement(nn.a,{className:o.paper},m.a.createElement("div",{className:o.paperContent},m.a.createElement(dn.a,{value:n.type,label:"Type",select:!0,helperText:"Type of ".concat(a," to use"),fullWidth:!0,onChange:r},t.map((function(e){return m.a.createElement(va.a,{key:e,value:e},e)})))))})),al=Object(Ze.a)((function(e){return{subSchemaContainer:{marginLeft:e.spacing(1),borderLeft:"1px solid ".concat(e.palette.secondary.main),paddingLeft:e.spacing(1),marginBottom:e.spacing(1)}}})),rl=Object(re.observer)((function(e){var t,n=al(),a=e.slotName,r=e.slotSchema,o=e.schema,i=e.slot,c=void 0===i?o[a]:i;if(Object(P.isConfigurationSchemaType)(r)){if(c.length)return m.a.createElement(m.a.Fragment,null,c.map((function(t,n){var r="".concat(Object(es.singular)(a)," ").concat(n+1);return m.a.createElement(rl,Object.assign({},e,{key:r,slot:t,slotName:r}))})));var s=Object(P.getTypeNamesFromExplicitlyTypedUnion)(r);return s.length&&(t=m.a.createElement(nl,{typeNameChoices:s,slotName:a,slot:c,onChange:function(e){e.target.value!==c.type&&o.setSubschema(a,{type:e.target.value})}})),m.a.createElement(m.a.Fragment,null,m.a.createElement($c.a,null,a),m.a.createElement("div",{className:n.subSchemaContainer},t,m.a.createElement(rn.a,null,m.a.createElement(ol,{schema:c}))))}return Object(P.isConfigurationSlotType)(r)?m.a.createElement(tl,{key:a,slot:c,slotSchema:r}):null})),ol=Object(re.observer)((function(e){var t=e.schema;return Object(_.iterMap)(Object.entries(Object(b.getMembers)(t).properties),(function(e){var n=Object(f.a)(e,2),a=n[0],r=n[1];return m.a.createElement(rl,Object.assign({key:a},{slotName:a,slotSchema:r,schema:t}))}))})),il=Object(Ze.a)((function(e){return{root:{padding:e.spacing(1,3,1,1),background:e.palette.background.default,overflowX:"hidden"}}}));var cl=Object(re.observer)((function(e){var t=e.model,n=il(),a=t.target&&Object(P.readConfObject)(t.target,"trackId");return m.a.createElement("div",{className:n.root,key:a,"data-testid":"configEditor"},t.target?m.a.createElement(ol,{schema:t.target}):"no target set")})),sl=function(e){return b.types.model("ConfigurationEditorWidget",{id:Ie.ElementId,type:b.types.literal("ConfigurationEditorWidget"),target:b.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{setTarget:function(t){e.target=t}}}))},ll=Object(P.ConfigurationSchema)("ConfigurationEditorWidget",{}),ul=Object(re.observer)((function(e){var t=e.model;if(t&&t.target){if(t.target.type)return"".concat(t.target.type," settings");if(Object(b.isStateTreeNode)(t.target)){var n=Object(b.getType)(t.target);if(n&&n.name)return"".concat(n.name.replace("ConfigurationSchema","")," settings")}}return"Settings"})),dl=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).features=void 0;var r=Object(P.readConfObject)(e,"features");return a.features=n.makeFeatures(r||[]),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new Set,n=Object(He.a)(this.features);try{for(n.s();!(a=n.n()).done;)r=Object(f.a)(a.value,2),o=r[0],i=r[1],t.add(o),i.forEach((function(e){var n=e.get("mate");n&&n.refName&&t.add(n.refName);var a=((e.get("INFO")||{}).SVTYPE||[])[0];if("BND"===a){var r=(e.get("ALT")||[])[0].MatePosition.split(":");t.add(r[0])}else if("TRA"===a){var o=((e.get("INFO")||{}).CHR2||[])[0];t.add(o)}}))}catch(c){n.e(c)}finally{n.f()}return e.abrupt("return",Array.from(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Array.from(this.features.values()).map((function(e){return{refName:e[0].get("refName"),aliases:e[0].get("aliases")}})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,a=e.start,r=e.end;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(o){var i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.features.get(n)||[],s=0;s<i.length;s+=1)(l=i[s]).get("end")>a&&l.get("start")<r&&o.next(l);o.complete();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}],[{key:"makeFeatures",value:function(e){for(var t=new Map,n=0;n<e.length;n+=1)if(e[n]){var a=this.makeFeature(e[n]),r=a.get("refName"),o=t.get(r);o||(o=[],t.set(r,o)),o.push(a)}var i,c=Object(He.a)(t.values());try{for(c.s();!(i=c.n()).done;){i.value.sort((function(e,t){return e.get("start")-t.get("start")}))}}catch(s){c.e(s)}finally{c.f()}return t}},{key:"makeFeature",value:function(e){return new U.a(e)}}]),n}(H.BaseFeatureDataAdapter),fl=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).features=void 0;var r=Object(P.readConfObject)(e,"features");return a.features=dl.makeFeatures(r||[]),a}return Object(h.a)(n,[{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a,r,o,i,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(He.a)(this.features);try{for(n.s();!(a=n.n()).done;){r=Object(f.a)(a.value,2),o=r[0],i=r[1],s=void 0,l=Object(He.a)(i);try{for(l.s();!(u=l.n()).done;)d=u.value,s&&s.end>=d.get("start")&&s.start<=d.get("end")?s.end=d.get("end"):(s&&t.push(s),s={refName:o,start:d.get("start"),end:d.get("end")})}catch(c){l.e(c)}finally{l.f()}s&&t.push(s)}}catch(c){n.e(c)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(H.BaseAdapter),pl=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"getFeatures",value:function(e){var t=this,a=Object(Yr.a)(Object(Kr.a)(n.prototype),"getFeatures",this);return Object(ur.ObservableCreate)(function(){var n=Object(l.a)(c.a.mark((function n(r){var o,i;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.call(t,e).pipe(Object(B.a)()).toPromise();case 2:o=n.sent,i=o[0],r.next(new U.a(Object(u.a)(Object(u.a)({},i.toJSON()),{},{uniqueId:"".concat(i.id(),":").concat(e.start,"-").concat(e.end),end:e.end,start:e.start,seq:i.get("seq").slice(Math.max(e.start-i.get("start"),0),Math.max(e.end-i.get("start"),0))}))),r.complete();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a,r,o,i,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(He.a)(this.features);try{for(n.s();!(a=n.n()).done;){r=Object(f.a)(a.value,2),o=r[0],i=r[1],s=void 0,l=Object(He.a)(i);try{for(l.s();!(u=l.n()).done;)d=u.value,s&&s.end>=d.get("start")&&s.start<=d.get("end")?s.end=d.get("end"):(s&&t.push(s),s={refName:o,start:d.get("start"),end:d.get("end")})}catch(c){l.e(c)}finally{l.f()}s&&t.push(s)}}catch(c){n.e(c)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(dl),ml=Object(P.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),gl=Object(P.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),hl=Object(P.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),bl=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).location=void 0,a.promise=void 0,a.location=Object(oe.openLocation)(Object(P.readConfObject)(e,"location")),a.promise=a.downloadResults(),a}return Object(h.a)(n,[{key:"downloadResults",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.location.readFile("utf8");case 2:return t=e.sent,e.abrupt("return",t.trim().split("\n").map((function(e){var t=e.split("\t"),n=Object(Oe.a)(t);return{refName:n[0],aliases:n.slice(1)}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){return this.promise}},{key:"freeResources",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(H.BaseAdapter),vl=Object(P.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt"}}},{explicitlyTyped:!0}),yl=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="ConfigurationPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"FromConfigAdapter",configSchema:ml,AdapterClass:dl})})),e.addAdapterType((function(){return new y.a({name:"FromConfigRegionsAdapter",configSchema:gl,AdapterClass:fl})})),e.addAdapterType((function(){return new y.a({name:"FromConfigSequenceAdapter",configSchema:hl,AdapterClass:pl})})),e.addAdapterType((function(){return new y.a({name:"RefNameAliasAdapter",configSchema:vl,AdapterClass:bl})})),e.addWidgetType((function(){return new k.a({name:"ConfigurationEditorWidget",HeadingComponent:ul,configSchema:ll,stateModel:sl(e),ReactComponent:cl})}))}}]),n}(F.a),wl=n(2319),Ol=n.n(wl),jl=n(2320),kl=n.n(jl),Cl=Object(P.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt"},description:"location of the hub file (usually called hub.txt)"}},{baseConfiguration:Fe.baseConnectionConfig}),El=n(431),xl=n.n(El),Sl=n(1281);"ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9".split(/\r?\n/);function Tl(){return(Tl=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(oe.openLocation)(t).readFile("utf8");case 3:return n=e.sent,e.abrupt("return",new Sl.HubFile(n));case 7:throw e.prev=7,e.t0=e.catch(0),new Error("Not a valid hub.txt file, got error: '".concat(e.t0,"'"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Nl(e){return Al.apply(this,arguments)}function Al(){return(Al=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(oe.openLocation)(t).readFile("utf8");case 2:return n=e.sent,e.abrupt("return",new Sl.GenomesFile(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rl(e){return Ml.apply(this,arguments)}function Ml(){return(Ml=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(oe.openLocation)(t).readFile("utf8");case 2:return n=e.sent,e.abrupt("return",new Sl.TrackDbFile(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pl(e,t,n,a){var r=[];return e.forEach((function(o,i){var c=Array.from(o.keys()),s=["superTrack","compositeTrack","container","view"];if(!c.some((function(e){return s.includes(e)}))){var l=[],u=i;do{if(u=e.get(u).get("parent")){var d=u.split(" ");u=Object(f.a)(d,1)[0],l.push(e.get(u))}}while(u);l.reverse();var p=function(e,t,n,a,r){var o=e.get("type");o||(o=a.get(e.get("parent")).get("type"));var i,c,s=o.split(" ")[0];"bam"===s&&e.get("bigDataUrl").toLowerCase().endsWith("cram")&&(s="cram");i=n.uri?{uri:new URL(e.get("bigDataUrl"),n.uri).href}:{localPath:e.get("bigDataUrl")};switch(s){case"bam":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".bai"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".bai")},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:i,index:{location:c}}};case"bed":case"bed5FloatScore":case"bedGraph":case"bedRnaElements":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"bigBarChart":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":case"bigGenePred":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i}};case"bigChain":case"bigInteract":case"bigMaf":case"bigPsl":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i},renderer:{type:"SvgFeatureRenderer"}};case"bigWig":return{type:"QuantitativeTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:i}};case"broadPeak":case"coloredExon":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"cram":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".crai"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".crai")},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:i,craiLocation:c,sequenceAdapter:r}};case"gvf":case"ld2":case"narrowPeak":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"bigNarrowPeak":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i}};case"peptideMapping":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"vcfTabix":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".tbi"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".tbi")},{type:"VariantTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:i,index:{location:c}}};case"wig":case"wigMaf":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"hic":return{type:"HicTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:i}};case"halSnake":return Object(Ue.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);default:return Object(Ue.generateUnknownTrackConf)(e.get("shortLabel"),s,t)}}(o,l.map((function(e){return e.get("shortLabel")})),t,e,a);p.trackId="ucsc-trackhub-".concat(xl()(p)),p.assemblyNames=[n],r.push(p)}})),r}var Fl=function(e){return b.types.compose("UCSCTrackHubConnection",Object(Fe.BaseConnectionModelFactory)(e),b.types.model({configuration:Object(P.ConfigurationReference)(Cl),type:b.types.literal("UCSCTrackHubConnection")}).actions((function(e){return{connect:function(){var t=Object(P.readConfObject)(e.configuration,"name"),n=Object(P.readConfObject)(e.configuration,"hubTxtLocation"),a=Object(P.readConfObject)(e.configuration,"assemblyName"),r=Object(_.getSession)(e),o=r.assemblies.find((function(e){return Object(P.readConfObject)(e,"name")===a}));(function(e){return Tl.apply(this,arguments)})(n).then((function(e){var t;return t=n.uri?{uri:new URL(e.get("genomesFile"),n.uri).href}:{localPath:e.get("genomesFile")},Promise.all([e,Nl(t)])})).then((function(e){var r,o=Object(f.a)(e,2),i=o[0],c=o[1];if(!c.has(a))throw new Error('Assembly "'.concat(a,'" not in genomes file from connection "').concat(t,'"'));return r=n.uri?{uri:new URL(c.get(a).get("trackDb"),new URL(i.get("genomesFile"),n.uri)).href}:{localPath:c.get(a).get("trackDb")},Promise.all([r,Rl(r)])})).then((function(t){var n=Object(f.a)(t,2),r=n[0],i=n[1],c=Object(P.readConfObject)(o,["sequence","adapter"]),s=Pl(i,r,a,c);e.setTrackConfs(s)})).catch((function(t){console.error(t),r.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(t,'"'),"error"),r.breakConnection(e.configuration)}))}}})))},Il=n(2521),Bl=n(2524),Ll=n(2522),Dl=n(2525),Vl=Object(Ze.a)((function(e){return{spacing:{marginBottom:e.spacing(3)}}}));var Wl=Object(re.observer)((function(e){var t=e.model,n=Vl(),a=Object(_.getSession)(t),r="",o=t.trackName,i=t.trackData,c=t.trackAdapter,s=t.trackType,l=t.assembly;if(t.isFtp?r="Warning: JBrowse cannot access files using the ftp protocol":t.isRelativeUrl?r="Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":t.wrongProtocol&&(r="Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol"),t.unsupported)return m.a.createElement(Je.a,{className:n.spacing},"This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse or"," ",m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type.");if(c.type===Ue.UNKNOWN)return m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{className:n.spacing},"Was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse to see if they support this data type or"," ",m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type."),m.a.createElement(dn.a,{className:n.spacing,value:c,label:"adapterType",helperText:"An adapter type",select:!0,fullWidth:!0,onChange:function(e){t.setTrackAdapter({type:e.target.value})},SelectProps:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},Object(b.getEnv)(a).pluginManager.getElementTypesInGroup("adapter").map((function(e){return"SNPCoverageAdapter"!==e.name&&m.a.createElement(va.a,{key:e.name,value:e.name},e.name)}))));if(!c.type)return m.a.createElement(Je.a,null,"Could not recognize this data type.");if(i.uri||i.localPath||i.config){var u=null;return u=i.uri||i.localPath?"SNPCoverageAdapter"===c.type?m.a.createElement(Je.a,{className:n.spacing},"Selected ",m.a.createElement("code",null,s),". Using adapter"," ",m.a.createElement("code",null,c.type)," with subadapter"," ",m.a.createElement("code",null,c.subadapter.type),". Please enter a track name and, if necessary, update the track type."):m.a.createElement(Je.a,{className:n.spacing},"Using adapter ",m.a.createElement("code",null,c.type)," and guessing track type ",m.a.createElement("code",null,s),". Please enter a track name and, if necessary, update the track type."):m.a.createElement(Je.a,{className:n.spacing},"Please enter a track type and track name."),m.a.createElement(m.a.Fragment,null,u,r?m.a.createElement(Je.a,{style:{color:"orange"}},r):null,m.a.createElement(dn.a,{className:n.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:o,onChange:function(e){return t.setTrackName(e.target.value)},inputProps:{"data-testid":"trackNameInput"}}),m.a.createElement(dn.a,{className:n.spacing,value:s,label:"trackType",helperText:"A track type",select:!0,fullWidth:!0,onChange:function(e){t.setTrackType(e.target.value)},SelectProps:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},Object(b.getEnv)(a).pluginManager.getElementTypesInGroup("track").map((function(e){return m.a.createElement(va.a,{key:e.name,value:e.name},e.name)}))),m.a.createElement(dn.a,{value:l,label:"assemblyName",helperText:"Assembly to which the track will be added",select:!0,fullWidth:!0,onChange:function(e){t.setAssembly(e.target.value)},SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}},a.assemblies.map((function(e){var t=Object(P.readConfObject)(e,"name");return m.a.createElement(va.a,{key:t,value:t},t)}))))}return m.a.createElement(m.a.Fragment,null)})),ql=Object(Ze.a)((function(e){return{root:{display:"flex",flexDirection:"column"},paper:{padding:e.spacing(1)}}}));var zl=function(e){var t=e.model,n=ql();return m.a.createElement("div",{className:n.root},m.a.createElement(nn.a,{className:n.paper},m.a.createElement(ue.FileSelector,{name:"URL",description:"",location:t.trackData,setLocation:t.setTrackData}),m.a.createElement(ue.FileSelector,{name:"Index URL (optional)",description:"Automatically inferred from the URL if not supplied",location:t.indexTrackData,setLocation:t.setIndexTrackData})))},Hl=Object(Ze.a)((function(e){return{root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginTop:e.spacing(1),marginRight:e.spacing(1)},actionsContainer:{marginBottom:e.spacing(2)},stepContent:{margin:e.spacing(1)}}})),_l=["Enter track data","Confirm track type"];var Ul=Object(re.observer)((function(e){var t=e.model,n=Object(p.useState)(0),a=Object(f.a)(n,2),r=a[0],o=a[1],i=Hl(),c=Object(_.getSession)(t),s=t.assembly,l=t.trackAdapter,d=t.trackData,g=t.trackName,h=t.trackType;function b(){if(r===_l.length-1){var e="".concat(g.toLowerCase().replace(/ /g,"_"),"-").concat(Date.now()),n=c.assemblyManager.get(s);c.addTrackConf({trackId:e,type:h,name:g,assemblyNames:[s],adapter:Object(u.a)(Object(u.a)({},l),{},{sequenceAdapter:Object(P.getConf)(n,["sequence","adapter"])})}),t.view?t.view.showTrack(e):c.notify("Open a new view, or use the track selector in an existing view, to view this track","info"),t.clearData(),c.hideWidget(t)}else o(r+1)}function v(){o(r-1)}function y(){switch(r){case 0:return!(d.uri||d.localPath||d.blob);case 1:return!(g&&h&&l.type&&s);default:return!0}}return m.a.createElement("div",{className:i.root},m.a.createElement(Dl.a,{className:i.stepper,activeStep:r,orientation:"vertical"},_l.map((function(e,n){return m.a.createElement(Il.a,{key:e},m.a.createElement(Ll.a,null,e),m.a.createElement(Bl.a,null,function(e){switch(e){case 0:return m.a.createElement(zl,{model:t});case 1:return m.a.createElement(Wl,{model:t});default:return m.a.createElement(Je.a,null,"Unknown step")}}(n),m.a.createElement("div",{className:i.actionsContainer},m.a.createElement(Ge.a,{disabled:0===r,onClick:v,className:i.button},"Back"),m.a.createElement(Ge.a,{disabled:y(),variant:"contained",color:"primary",onClick:b,className:i.button,"data-testid":"addTrackNextButton"},r===_l.length-1?"Add":"Next"))))}))))}));function Gl(e){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function Jl(e){return b.types.model("AddTrackModel",{id:Ie.ElementId,type:b.types.literal("AddTrackWidget"),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{trackSource:"fromFile",trackData:{uri:""},indexTrackData:{uri:""},altAssemblyName:"",altTrackName:"",altTrackType:"",altTrackAdapter:{}}})).actions((function(e){return{setTrackAdapter:function(t){e.altTrackAdapter=t},setTrackSource:function(t){e.trackSource=t},setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},setAssembly:function(t){e.altAssemblyName=t},setTrackName:function(t){e.altTrackName=t},setTrackType:function(t){e.altTrackType=t},clearData:function(){e.trackSource="",e.altTrackAdapter={},e.indexTrackData={uri:""},e.trackData={uri:""},e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.altTrackAdapter={}}}})).views((function(e){return{get trackAdapter(){var t=e.trackData,n=e.indexTrackData;return(null===t||void 0===t?void 0:t.uri)?Object(Ue.guessAdapter)(t.uri,"uri",n.uri):t.localPath?Object(Ue.guessAdapter)(t.localPath,"localPath"):e.altTrackAdapter},get trackName(){var t,n,a=null===(t=e.trackData)||void 0===t?void 0:t.uri,r=null===(n=e.trackData)||void 0===n?void 0:n.localPath;return e.altTrackName||(a?a.slice(a.lastIndexOf("/")+1):null)||(r?r.slice(r.lastIndexOf("/")+1):null)},get isFtp(){var t=e.trackData,n=e.indexTrackData;return!!(n.uri&&n.uri.startsWith("ftp://")||t.uri&&t.uri.startsWith("ftp://"))},get isRelativeUrl(){return!(e.indexTrackData.uri&&Gl(e.indexTrackData.uri)||e.trackData.uri&&Gl(e.trackData.uri))},get wrongProtocol(){return"https:"===window.location.protocol&&(e.indexTrackData.uri&&e.indexTrackData.uri.startsWith("http://")||e.trackData.uri.startsWith("http://"))},get unsupported(){return this.trackAdapter.type===Ue.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||Object(Ue.guessTrackType)(this.trackAdapter.type)}}}))}var Ql=Object(P.ConfigurationSchema)("AddTrackWidget",{});var Xl=Object(re.observer)((function(e){var t=e.connectionType,n=e.model,a=e.setModelReady,r=t.configEditorComponent||cl;return m.a.createElement(r,{model:{target:n},setModelReady:a})})),Yl=n(825),Kl=n.n(Yl);var Zl=function(e){var t=e.connectionTypeChoices,n=e.connectionType,a=e.setConnectionType,r=e.assemblyNameChoices,o=e.assemblyName,i=e.setAssemblyName;return m.a.createElement("form",{autoComplete:"off"},m.a.createElement(dn.a,{value:o,label:"assemblyName",helperText:"Assembly to which the track will be added",select:!0,fullWidth:!0,onChange:function(e){return i(e.target.value)},inputProps:{"data-testid":"assemblyNameSelect"}},r.map((function(e){return m.a.createElement(va.a,{key:e,value:e},e)}))),m.a.createElement(dn.a,{value:n.name||"",label:"connectionType",helperText:n.description?m.a.createElement(m.a.Fragment,null,n.description,n.url?m.a.createElement(Qt.a,{href:n.url,rel:"noopener noreferrer",target:"_blank",color:"secondary"},m.a.createElement(Kl.a,null)):null):null,select:!0,fullWidth:!0,onChange:function(e){a(t.find((function(t){return t.name===e.target.value})))}},t.map((function(e){return m.a.createElement(va.a,{key:e.name,value:e.name},e.displayName||e.name)}))))},$l=Object(Ze.a)((function(e){return{root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginTop:e.spacing(1),marginRight:e.spacing(1)},actionsContainer:{marginBottom:e.spacing(2)}}})),eu=["Select a Connection Type","Configure Connection"];var tu=Object(re.observer)((function(e){var t=e.model,n=Object(p.useState)({}),a=Object(f.a)(n,2),r=a[0],o=a[1],i=Object(p.useState)({}),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(p.useState)(!0),d=Object(f.a)(u,2),g=d[0],h=d[1],v=Object(p.useState)(""),y=Object(f.a)(v,2),w=y[0],O=y[1],j=Object(p.useState)(0),k=Object(f.a)(j,2),C=k[0],E=k[1],x=$l(),S=Object(_.getSession)(t),T=Object(b.getEnv)(S).pluginManager;function N(e){o(e),l(e.configSchema.create({connectionId:"".concat(e.name,"-").concat(w,"-").concat(Date.now()),assemblyName:w}))}function A(){C===eu.length-1?function(){var e=S.addConnectionConf(s);S.makeConnection(e),S.hideWidget(t)}():E(C+1)}function R(){E(C-1)}return m.a.createElement("div",{className:x.root},m.a.createElement(Dl.a,{className:x.stepper,activeStep:C,orientation:"vertical"},eu.map((function(e){return m.a.createElement(Il.a,{key:e},m.a.createElement(Ll.a,null,e),m.a.createElement(Bl.a,null,function(){switch(C){case 0:return m.a.createElement(Zl,{connectionTypeChoices:T.getElementTypesInGroup("connection"),connectionType:r,setConnectionType:N,assemblyNameChoices:S.assemblies.map((function(e){return Object(P.readConfObject)(e,"name")})),assemblyName:w,setAssemblyName:O});case 1:return m.a.createElement(Xl,{connectionType:r,model:s,setModelReady:h});default:return m.a.createElement(Je.a,null,"Unknown step")}}(),m.a.createElement("div",{className:x.actionsContainer},m.a.createElement(Ge.a,{disabled:0===C,onClick:R,className:x.button},"Back"),m.a.createElement(Ge.a,{disabled:!(0===C&&r.name||1===C&&s&&g),variant:"contained",color:"primary",onClick:A,className:x.button,"data-testid":"addConnectionNext"},C===eu.length-1?"Connect":"Next"))))}))))})),nu=b.types.model("AddConnectionModel",{id:Ie.ElementId,type:b.types.literal("AddConnectionWidget")}),au=Object(P.ConfigurationSchema)("AddConnectionWidget",{}),ru=n(2510),ou=n(2498),iu=n(1604),cu=n(2480),su=n(2526),lu=n(2540),uu=n(607),du=n.n(uu),fu=Object(Ze.a)((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},accordionBorder:{marginTop:4,border:"1px solid #444"}}}));function pu(e){var t=e.model,n=e.path,a=e.filterPredicate,r=e.disabled,o=e.connection,i=e.assemblyName,c=fu(),s=n.join("|"),l=n[n.length-1],u=t.allTracksInCategoryPath(n,o,i),d=Object.keys(u).length,f=Object.values(u).filter(a).length;return 0===f&&0!==d?null:m.a.createElement(Ea.a,{className:c.accordionBorder,expanded:!t.collapsed.get(s),onChange:function(){return t.toggleCategory(s)}},m.a.createElement(xa.a,{expandIcon:m.a.createElement(Na.a,{className:c.expandIcon})},m.a.createElement(Je.a,{variant:"body2"},"".concat(l).concat(f?" (".concat(f,")"):""))),m.a.createElement(Sa.a,{className:c.expansionPanelDetails},m.a.createElement(ju,{model:t,path:n,filterPredicate:a,disabled:r,connection:o,assemblyName:i})))}pu.defaultProps={assemblyName:void 0,filterPredicate:function(){return!0},path:[],disabled:!1,connection:void 0};var mu=Object(re.observer)(pu),gu=n(2316),hu=n.n(gu),bu=Object(Ze.a)((function(e){return{formControlLabel:{marginLeft:0,"&:hover":{textDecoration:"none",backgroundColor:Object(an.fade)(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},flexGrow:1,wordBreak:"break-all"},checkbox:{padding:0},track:{display:"flex",flexDirection:"row"},configureButton:{padding:2}}}));function vu(e){var t=e.model,n=e.disabled,a=e.trackConf,r=e.assemblyName,o=bu(),i=Object(p.useState)(null),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(_.getSession)(t),d=r?"The reference sequence for ".concat(r):Object(P.readConfObject)(a,"description"),g=Object(P.readConfObject)(a,"name"),h=Object(P.readConfObject)(a,"trackId"),b=g&&(g.endsWith("(Unsupported)")||g.endsWith("(Unknown)")),v=u.getTrackActionMenuItems?u.getTrackActionMenuItems(a):[];return m.a.createElement("div",{className:o.track},m.a.createElement(et.a,{title:d,placement:"left",enterDelay:500},m.a.createElement(ei.a,{className:o.formControlLabel,control:m.a.createElement(ti.a,{inputProps:{"data-testid":"htsTrackEntry-".concat(h)},className:o.checkbox}),label:r?"Reference Sequence (".concat(r,")"):g,checked:t.view.tracks.some((function(e){return e.configuration===a})),onChange:function(){return t.view.toggleTrack(a.trackId)},disabled:n||b})),v.length?m.a.createElement(Qt.a,{className:o.configureButton,onClick:function(e){l(e.currentTarget)},color:"secondary","data-testid":"htsTrackEntryMenu-".concat(h)},m.a.createElement(hu.a,null)):null,m.a.createElement(ue.Menu,{anchorEl:s,onMenuItemClick:function(e,t){t(),l(null)},open:Boolean(s),onClose:function(){l(null)},menuItems:v}))}vu.defaultProps={disabled:!1,assemblyName:null};var yu=Object(re.observer)(vu),wu=Object(Ze.a)((function(e){return{divider:{marginTop:e.spacing(2),marginBottom:e.spacing(2)}}}));function Ou(e){var t=e.model,n=e.path,a=e.filterPredicate,r=e.disabled,o=e.connection,i=e.top,c=e.assemblyName,s=wu(),l=o?t.connectionHierarchy(o,c):t.hierarchy(c);n.forEach((function(e){l=l.get(e)||new Map}));var u=[],d=[];Array.from(l).slice(0).forEach((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1];a.trackId?u.push(a):d.push([n,a])}));var p=t.getRefSeqTrackConf(c),g=i&&!o&&p;return m.a.createElement(m.a.Fragment,null,g?m.a.createElement(m.a.Fragment,null,m.a.createElement(rn.a,null,m.a.createElement(yu,{model:t,trackConf:p,assemblyName:c})),m.a.createElement(Xt.a,{className:s.divider})):null,m.a.createElement(rn.a,null,u.filter(a).map((function(e){return m.a.createElement(yu,{key:e.trackId,model:t,trackConf:e,disabled:r})}))),d.sort().map((function(e){var i=Object(f.a)(e,1)[0];return m.a.createElement(mu,{key:i,model:t,path:n.concat([i]),filterPredicate:a,disabled:r,connection:o,assemblyName:c})})))}Ou.defaultProps={assemblyName:void 0,filterPredicate:function(){return!0},path:[],disabled:!1,connection:void 0,top:!1};var ju=Object(re.observer)(Ou),ku=Object(Ze.a)((function(e){return{root:{textAlign:"left",padding:e.spacing(1)},searchBox:{marginBottom:e.spacing(2)},fab:{float:"right",position:"sticky",marginTop:e.spacing(2),bottom:e.spacing(2),right:e.spacing(2)},connectionsPaper:{padding:e.spacing(1),marginTop:e.spacing(1)},tabs:{marginBottom:e.spacing(1)}}})),Cu=Object(re.observer)((function(e){var t=e.open,n=e.modalInfo,a=e.setModalInfo,r=n||{},o=r.name,i=r.dereferenceTypeCount,c=r.safelyBreakConnection;return m.a.createElement(Gt.a,{"aria-labelledby":"connection-modal-title","aria-describedby":"connection-modal-description",open:t},m.a.createElement(Jt.a,null,'Close connection "',o,'"'),m.a.createElement(Yt.a,null,m.a.createElement(m.a.Fragment,null,i?m.a.createElement(m.a.Fragment,null,m.a.createElement(ru.a,null,"Closing this connection will close:"),m.a.createElement(ss.a,null,Object.entries(i).map((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1];return m.a.createElement(ls.a,{key:n},"".concat(a," ").concat(n))})))):null,m.a.createElement(ru.a,null,"Are you sure you want to close this connection?"))),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){a()},color:"primary"},"Cancel"),m.a.createElement(Ge.a,{variant:"contained",onClick:n?function(){c&&c(),a()}:function(){},color:"primary"},"OK")))})),Eu=Object(re.observer)((function(e){var t=e.open,n=e.modalInfo,a=e.session,r=e.setModalInfo,o=n||{},i=o.connectionConf,c=o.name,s=o.dereferenceTypeCount,l=o.safelyBreakConnection;return m.a.createElement(Gt.a,{"aria-labelledby":"connection-modal-title","aria-describedby":"connection-modal-description",open:t},m.a.createElement(Jt.a,null,'Delete connection "',c,'"'),m.a.createElement(Yt.a,null,s?m.a.createElement(m.a.Fragment,null,"Closing this connection will close",m.a.createElement(ss.a,null,Object.entries(s).map((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1];return m.a.createElement(ls.a,{key:n},"".concat(a," ").concat(n))})))):null,m.a.createElement(ru.a,null,"Are you sure you want to delete this connection?")),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){r()},color:"primary"},"Cancel"),m.a.createElement(Ge.a,{variant:"contained",onClick:n?function(){l&&l(),a.deleteConnection(i),r()}:function(){},color:"primary"},"OK")))}));var xu=Object(re.observer)((function(e){var t=e.model,n=Object(p.useState)(null),a=Object(f.a)(n,2),r=a[0],o=a[1],i=Object(p.useState)(0),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(p.useState)(),d=Object(f.a)(u,2),g=d[0],h=d[1],b=ku(),v=Object(_.getSession)(t);function y(){o(null)}function w(e){return!t.filterText||Object(P.readConfObject)(e,"name").toLowerCase().includes(t.filterText.toLowerCase())}function O(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(P.readConfObject)(e,"name"),a=v.prepareToBreakConnection(e);if(a){var r=Object(f.a)(a,2),o=r[0],i=r[1];Object.keys(i).length>0||t?h({connectionConf:e,safelyBreakConnection:o,dereferenceTypeCount:i,name:n,deleting:t}):o()}else t&&h({name:n,deleting:t,connectionConf:e})}var j=t.assemblyNames,k=j[s];if(!k)return null;var C=t.trackConfigurations(k,v.tracks)>0&&0===t.trackConfigurations(k,v.tracks).filter(w).length;return m.a.createElement("div",{key:t.view.id,className:b.root,"data-testid":"hierarchical_track_selector"},j.length>1?m.a.createElement(lu.a,{className:b.tabs,value:s,onChange:function(e,t){l(t)}},j.map((function(e,t){return m.a.createElement(su.a,{key:"".concat(e,"-").concat(t),label:e})}))):null,m.a.createElement(dn.a,{className:b.searchBox,label:"Filter Tracks",value:t.filterText,error:C,helperText:C?"No matches":"",onChange:function(e){t.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:m.a.createElement(mn.a,{position:"end"},m.a.createElement(Qt.a,{color:"secondary",onClick:t.clearFilterText},m.a.createElement(du.a,null)))}}),m.a.createElement(ju,{model:t,filterPredicate:w,assemblyName:k,top:!0}),m.a.createElement(rn.a,null,v.connections.filter((function(e){return Object(P.readConfObject)(e,"assemblyName")===k})).map((function(e){var t=Object(P.readConfObject)(e,"name"),n=e.connectionId;return m.a.createElement(rn.a,{row:!0,key:n},m.a.createElement(ei.a,{control:m.a.createElement(cu.a,{checked:v.connectionInstances.has(k)&&!!v.connectionInstances.get(k).find((function(e){return e.name===t})),onChange:function(){return function(e){var t=v.connectionInstances.get(k);t&&!!t.find((function(t){return t.name===Object(P.readConfObject)(e,"name")}))?O(e):v.makeConnection(e)}(e)}}),label:t}),m.a.createElement(Qt.a,{"data-testid":"delete-connection",onClick:function(){O(e,!0)}},m.a.createElement($t.a,null)))}))),v.connectionInstances.has(k)?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{variant:"h5"},"Connections"),v.connectionInstances.get(k).map((function(e){return m.a.createElement(nn.a,{key:e.name,className:b.connectionsPaper,elevation:8},m.a.createElement(Je.a,{variant:"h6"},e.name),m.a.createElement(ju,{model:t,filterPredicate:w,connection:e,assemblyName:k,top:!0}))}))):null,m.a.createElement(ou.a,{color:"secondary",className:b.fab,onClick:function(e){o(e.currentTarget)}},m.a.createElement(ps.a,null)),m.a.createElement(iu.a,{id:"simple-menu",anchorEl:r,open:Boolean(r),onClose:y},m.a.createElement(va.a,{onClick:function(){y();var e=v.addWidget("AddConnectionWidget","addConnectionWidget");v.showWidget(e)}},"Add connection"),m.a.createElement(va.a,{onClick:function(){y();var e=v.addWidget("AddTrackWidget","addTrackWidget",{view:t.view.id});v.showWidget(e)}},"Add track")),m.a.createElement(Cu,{modalInfo:g,setModalInfo:h,open:Boolean(g)&&!g.deleting,session:v}),m.a.createElement(Eu,{modalInfo:g,setModalInfo:h,open:Boolean(g)&&g.deleting,session:v}))}));function Su(e){var t=new Map;return e.forEach((function(e){var n=Object(s.a)(Object(P.readConfObject)(e,"category")||[]);e.trackId.endsWith("sessionTrack")&&n.unshift(" Session tracks");for(var a=t,r=0;r<n.length;r++){var o=n[r];a.has(o)||a.set(o,new Map),a=a.get(o)}a.set(e.trackId,e)})),t}var Tu=function(e){return b.types.model("HierarchicalTrackSelectorWidget",{id:Ie.ElementId,type:b.types.literal("HierarchicalTrackSelectorWidget"),collapsed:b.types.map(b.types.boolean),filterText:"",view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setView:function(t){e.view=t},toggleCategory:function(t){e.collapsed.set(t,!e.collapsed.get(t))},clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}})).views((function(t){return{trackConfigurations:function(n,a){if(!t.view)return[];var r=Object(_.getSession)(t).assemblyManager.get(n);return r?a.filter((function(e){var t=Object(P.readConfObject)(e,"assemblyNames"),n=r.allAliases;return _i()(n,t).length>0})).filter((function(n){var a=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),r=n.displays.map((function(e){return e.type}));return _i()(a,r).length>0})):[]},getRefSeqTrackConf:function(n){var a=Object(_.getSession)(t).assemblyManager.get(n),r=null===a||void 0===a?void 0:a.configuration.sequence,o=e.getViewType(t.view.type);if(r){var i,c=Object(He.a)(r.displays);try{var s=function(){var e=i.value;if(o.displayTypes.find((function(t){return t.name===e.type})))return{v:r}};for(c.s();!(i=c.n()).done;){var l=s();if("object"===typeof l)return l.v}}catch(u){c.e(u)}finally{c.f()}}},get assemblyNames(){return t.view?t.view.assemblyNames:[]},connectionTrackConfigurations:function(n){return t.view?n.tracks.filter((function(n){var a=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),r=n.displays.map((function(e){return e.type}));return _i()(a,r).length>0})):[]},hierarchy:function(e){var n=Object(_.getSession)(t);return Su(t.trackConfigurations(e,n.tracks))},connectionHierarchy:function(e){return Su(t.connectionTrackConfigurations(e))},allTracksInCategoryPath:function(e,n,a){var r=n?t.connectionHierarchy(n):t.hierarchy(a);e.forEach((function(e){r=r.get(e)||new Map}));var o={};return r.forEach((function(n,a){n.trackId?o[n.trackId]=n:o=Object.assign(o,t.allTracksInCategoryPath(e.concat([a])))})),o}}}))},Nu=Object(P.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{}),Au=n(2318),Ru=n.n(Au),Mu=n(2527),Pu=n(2528),Fu=n(2483),Iu=n(2529),Bu=n(2530),Lu=n(2531),Du=n(2317),Vu=n.n(Du),Wu=Object(Ze.a)((function(){return{table:{minWidth:650},buttonCell:{padding:3},button:{display:"inline-block",padding:3,minHeight:0,minWidth:0}}})),qu=Object(re.observer)((function(e){var t=e.rootModel,n=e.setIsAssemblyBeingEdited,a=e.setAssemblyBeingEdited,r=Wu();var o=t.jbrowse.assemblies.map((function(e){var o=Object(P.readConfObject)(e,"name"),i=Object(P.readConfObject)(e,"aliases");return m.a.createElement(Lu.a,{key:o},m.a.createElement(Fu.a,null,o),m.a.createElement(Fu.a,null,i?i.toString():""),m.a.createElement(Fu.a,{className:r.buttonCell},m.a.createElement(Qt.a,{"data-testid":"".concat(o,"-edit"),className:r.button,onClick:function(){n(!0),a(e)}},m.a.createElement(Vu.a,{color:"primary"})),m.a.createElement(Qt.a,{"data-testid":"".concat(o,"-delete"),className:r.button,onClick:function(){!function(e){t.jbrowse.removeAssemblyConf(e)}(o)}},m.a.createElement(ds.a,{color:"error"}))))}));return m.a.createElement(Iu.a,{component:nn.a},m.a.createElement(Mu.a,null,m.a.createElement(Bu.a,null,m.a.createElement(Lu.a,null,m.a.createElement(Fu.a,null,"Name"),m.a.createElement(Fu.a,null,"Aliases"),m.a.createElement(Fu.a,null,"Actions"))),m.a.createElement(Pu.a,null,o)))})),zu=n(694),Hu=n(1328),_u=Object(Ze.a)((function(e){return Object(Hu.a)({root:{flexGrow:1,overflow:"hidden",padding:e.spacing(0,3)},paper:{maxWidth:400,margin:"".concat(e.spacing(1),"px auto"),padding:e.spacing(2)},createButton:{marginTop:"1em",justifyContent:"center"},paperContent:{flex:"auto",margin:"".concat(e.spacing(1),"px auto"),padding:e.spacing(1),overflow:"auto"}})})),Uu=Object(re.observer)((function(e){var t=e.adapterSelection,n=e.setAdapterSelection,a=e.adapterTypes;return m.a.createElement(dn.a,{value:t,label:"Type",select:!0,helperText:"Type of adapter to use",fullWidth:!0,onChange:function(e){n(e.target.value)}},a.map((function(e){return m.a.createElement(va.a,{key:e,value:e},e)})))})),Gu=Object(re.observer)((function(e){var t=e.adapterSelection,n=e.fastaLocation,a=e.setFastaLocation,r=e.faiLocation,o=e.setFaiLocation,i=e.gziLocation,c=e.setGziLocation,s=e.twoBitLocation,l=e.setTwoBitLocation;return"IndexedFastaAdapter"===t||"BgzipFastaAdapter"===t?m.a.createElement(ba.a,{container:!0,spacing:2},m.a.createElement(ba.a,{item:!0},m.a.createElement(zu.a,{name:"fastaLocation",location:n,setLocation:function(e){return a(e)}})),m.a.createElement(ba.a,{item:!0},m.a.createElement(zu.a,{name:"faiLocation",location:r,setLocation:function(e){return o(e)}})),"BgzipFastaAdapter"===t?m.a.createElement(ba.a,{item:!0},m.a.createElement(zu.a,{name:"gziLocation",location:i,setLocation:function(e){return c(e)}})):null):"TwoBitAdapter"===t?m.a.createElement(zu.a,{name:"twoBitLocation",location:s,setLocation:function(e){return l(e)}}):null})),Ju=Object(re.observer)((function(e){var t=e.rootModel,n=e.setFormOpen,a=_u(),r=["IndexedFastaAdapter","BgzipFastaAdapter","TwoBitAdapter"],o=Object(p.useState)(""),i=Object(f.a)(o,2),c=i[0],s=i[1],l=Object(p.useState)(r[0]),u=Object(f.a)(l,2),d=u[0],g=u[1],h=Object(p.useState)({uri:""}),b=Object(f.a)(h,2),v=b[0],y=b[1],w=Object(p.useState)({uri:""}),O=Object(f.a)(w,2),j=O[0],k=O[1],C=Object(p.useState)({uri:""}),E=Object(f.a)(C,2),x=E[0],S=E[1],T=Object(p.useState)({uri:""}),N=Object(f.a)(T,2),A=N[0],R=N[1];return m.a.createElement("div",{className:a.root},m.a.createElement(nn.a,{className:a.paper},m.a.createElement(dn.a,{id:"assembly-name",inputProps:{"data-testid":"assembly-name"},label:"Assembly Name",variant:"outlined",value:c,onChange:function(e){return s(e.target.value)}}),m.a.createElement(Uu,{adapterSelection:d,setAdapterSelection:g,adapterTypes:r}),m.a.createElement("div",{className:a.paperContent},m.a.createElement(Gu,{adapterSelection:d,fastaLocation:v,setFastaLocation:y,faiLocation:j,setFaiLocation:k,gziLocation:x,setGziLocation:S,twoBitLocation:A,setTwoBitLocation:R}))),m.a.createElement(ba.a,{container:!0,className:a.createButton},m.a.createElement(ba.a,{item:!0},m.a.createElement(Ge.a,{variant:"contained",color:"secondary",startIcon:m.a.createElement(ps.a,null),onClick:function(){var e;""===c?t.session.notify("Can't create an assembly without a name"):(n(!1),"IndexedFastaAdapter"===d?e={name:c,sequence:{adapter:{type:"IndexedFastaAdapter",fastaLocation:v,faiLocation:j}}}:"BgzipFastaAdapter"===d?e={name:c,sequence:{adapter:{type:"BgzipFastaAdapter",fastaLocation:v,faiLocation:j,gziLocation:x}}}:"TwoBitAdapter"===d&&(e={name:c,sequence:{adapter:{type:"TwoBitAdapter",twoBitLocation:A}}}),t.jbrowse.addAssemblyConf(e),t.session.notify("Successfully added ".concat(c," assembly to JBrowse 2"),"success"))}},"Create new assembly"))))})),Qu=Object(re.observer)((function(e){var t=e.assembly;return m.a.createElement(cl,{model:{target:t}})})),Xu=Object(Ze.a)((function(e){return{titleBox:{color:"#fff",backgroundColor:e.palette.primary.main,textAlign:"center"},dialogContent:{width:"100%"},backButton:{color:"#fff",position:"absolute",left:e.spacing(4),top:e.spacing(4)}}}));var Yu=Object(re.observer)((function(e){var t=e.rootModel,n=e.open,a=e.onClose,r=Xu(),o=Object(p.useState)(!1),i=Object(f.a)(o,2),c=i[0],s=i[1],l=Object(p.useState)(!1),u=Object(f.a)(l,2),d=u[0],g=u[1],h=Object(p.useState)(),b=Object(f.a)(h,2),v=b[0],y=b[1],w=!c&&!d;return m.a.createElement(Gt.a,{open:n},m.a.createElement(Jt.a,{className:r.titleBox},w?"Assembly manager":null,c?m.a.createElement(m.a.Fragment,null,m.a.createElement(Qt.a,{"aria-label":"back",className:r.backButton,onClick:function(){return s(!1)}},m.a.createElement(Ru.a,null)),"Add new assembly"):null,d?m.a.createElement(m.a.Fragment,null,m.a.createElement(Qt.a,{"aria-label":"back",className:r.backButton,onClick:function(){return g(!1)}},m.a.createElement(Ru.a,null)),function(e){if(void 0!==e)return e.name;return null}(v)):null),m.a.createElement(Yt.a,null,m.a.createElement("div",{className:r.dialogContent},w?m.a.createElement(qu,{rootModel:t,setIsAssemblyBeingEdited:g,setAssemblyBeingEdited:y}):null,d?m.a.createElement(Qu,{assembly:v}):null,c?m.a.createElement(Ju,{rootModel:t,setFormOpen:s}):null)),m.a.createElement(Kt.a,null,w?m.a.createElement(m.a.Fragment,null,m.a.createElement(Ge.a,{color:"secondary",variant:"contained",onClick:function(){a(!1)}},"Return"),m.a.createElement(Ge.a,{variant:"contained",color:"secondary",startIcon:m.a.createElement(ps.a,null),onClick:function(){s(!0)}},"Add new assembly")):null))})),Ku=n(2482),Zu=n(2495),$u=n(2494),ed=n(2544),td=n(1283),nd=n.n(td),ad=Object(Ze.a)((function(e){return{root:{margin:e.spacing(1)},message:{padding:e.spacing(3)},titleBox:{color:"#fff",backgroundColor:e.palette.primary.main,textAlign:"center"},dialogContent:{width:600},resetButton:{justifyContent:"center",marginBottom:"6px"}}})),rd=Object(re.observer)((function(e){var t=e.session,n=e.selectedDefault,a=e.handleRadio,r=ad();return m.a.createElement(nn.a,{className:r.root},m.a.createElement(ss.a,{subheader:m.a.createElement($u.a,null,"Currently open session")},m.a.createElement(ls.a,null,m.a.createElement(Ku.a,null,m.a.createElement(ed.a,{checked:t.name===n,onChange:function(){return a(t)}})),m.a.createElement(Zu.a,{primary:t.name}))))})),od=Object(re.observer)((function(e){var t=e.rootModel,n=e.open,a=e.onClose,r=e.currentDefault,o=ad(),i=t.session,c=Object(p.useState)(r),s=Object(f.a)(c,2),l=s[0],u=s[1];function d(e){u(e.name),t.jbrowse.setDefaultSessionConf(e),i.notify("Set default session to ".concat(e.name),"success")}return m.a.createElement(Gt.a,{open:n},m.a.createElement(Jt.a,{className:o.titleBox},"Set Default Session"),m.a.createElement(Yt.a,null,m.a.createElement(ba.a,{className:o.resetButton,container:!0},m.a.createElement(ba.a,{item:!0},m.a.createElement(Ge.a,{color:"secondary",variant:"contained",onClick:function(){u("New session"),t.jbrowse.setDefaultSessionConf({name:"New session"}),i.notify("Reset default session","success")}},"Clear default session"))),m.a.createElement(rd,{session:i,selectedDefault:l,handleRadio:d}),m.a.createElement(nn.a,{className:o.root},m.a.createElement(ss.a,{subheader:m.a.createElement($u.a,null,"Saved sessions")},i.savedSessions.length?i.savedSessions.map((function(e){var t=e.views,n=void 0===t?[]:t,a=n.map((function(e){return e.tracks.length})).reduce((function(e,t){return e+t}),0);return e.name!==i.name?m.a.createElement(ls.a,{key:e.name},m.a.createElement(Ku.a,null,m.a.createElement(ed.a,{checked:e.name===l,onChange:function(){return d(e)}})),m.a.createElement(Zu.a,{primary:e.name,secondary:"".concat(n.length," ").concat(nd()("view",n.length),"; ").concat(a,"\n                             open ").concat(nd()("track",a))})):null})):m.a.createElement(Je.a,{className:o.message},"No saved sessions found")))),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{color:"secondary",variant:"contained",onClick:function(){a(!1)}},"Return")))})),id=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="DataManagementPlugin",e.exports={AssemblyManager:Yu,SetDefaultSession:od},e}return Object(h.a)(n,[{key:"install",value:function(e){e.addConnectionType((function(){return new S({name:"UCSCTrackHubConnection",configSchema:Cl,stateModel:Fl(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})})),e.addWidgetType((function(){return new k.a({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:Nu,stateModel:Tu(e),ReactComponent:xu})})),e.addWidgetType((function(){return new k.a({name:"AddTrackWidget",heading:"Add a track",configSchema:Ql,stateModel:Jl(e),ReactComponent:Ul})})),e.addWidgetType((function(){return new k.a({name:"AddConnectionWidget",heading:"Add a connection",configSchema:au,stateModel:nu,ReactComponent:tu})}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("File",{label:"Open track",icon:Ol.a,onClick:function(e){if(0===e.views.length)e.notify("Please open a view to add a track first");else if(e.views.length>=1){var t=e.addWidget("AddTrackWidget","addTrackWidget",{view:e.views[0].id});e.showWidget(t),e.views.length>1&&e.notify("This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right")}}}),e.rootModel.appendToMenu("File",{label:"Open connection",icon:kl.a,onClick:function(e){var t=e.addWidget("AddConnectionWidget","addConnectionWidget");e.showWidget(t)}}))}}]),n}(F.a),cd=n(2323),sd=n.n(cd),ld=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={hasError:!1},a}return Object(h.a)(n,[{key:"componentDidCatch",value:function(e,t){console.error(e,t)}},{key:"render",value:function(){var e=this.state,t=e.hasError,n=e.error;return t&&(null===n||void 0===n?void 0:n.message)?m.a.createElement("div",{style:{color:"red"}},n.message):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}}]),n}(p.Component);var ud=Object(re.observer)((function(e){var t=Object(p.useRef)(null),n=e.model,a=Object(_.getSession)(n),r=Object(ue.createJBrowseTheme)(Object(P.getConf)(a,"theme"));return Object(p.useEffect)((function(){var e=t.current;return function(){var t=n.data,a=n.html,o=n.renderProps,i=n.renderingComponent;e&&n.filled&&(e&&Object(gt.unmountComponentAtNode)(e),e.innerHTML=a,Object(_.rIC)((function(){Object(b.isAlive)(n)&&Object(gt.hydrate)(m.a.createElement(mt.a,{theme:r},m.a.createElement(ld,null,m.a.createElement(i,Object.assign({},t,o)))),e)}),{timeout:300}))}(),function(){e&&Object(gt.unmountComponentAtNode)(e)}}),[n,r]),m.a.createElement("div",{ref:t,"data-html-size":n.html.length,className:"ssr-container"})})),dd=Object(Ze.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function fd(){var e=Object(p.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],r=dd();return Object(p.useEffect)((function(){var e=setTimeout((function(){return a(!0)}),300);return function(){return clearTimeout(e)}}),[]),n?m.a.createElement("div",{"data-testid":"loading-synteny",className:r.loading},"Loading \u2026",m.a.createElement(yn.a,null)):null}function pd(e){var t=e.messageText,n=dd();return m.a.createElement("div",{className:n.blockMessage},t)}function md(e){var t=e.error,n=dd();return m.a.createElement("div",{className:n.blockError},t.message)}var gd=Object(re.observer)((function(e){var t=e.model;return t.error?m.a.createElement(md,{error:t.error,"data-testid":"reload_button"}):t.message?m.a.createElement(pd,{messageText:t.message}):t.filled?m.a.createElement(ud,{model:t}):m.a.createElement(fd,null)})),hd=function(e){var t=e.model,n=e.children,a=t.data||{},r=a.offsetX,o=void 0===r?0:r,i=a.offsetY,c=void 0===i?0:i,s=Object(_.getContainingView)(t),l=s.vview.offsetPx-c,u=-(s.hview.offsetPx-o);return m.a.createElement("div",{style:{position:"relative"}},m.a.createElement("div",{style:{position:"absolute",top:l,left:u}},m.a.createElement(t.ReactComponent2,e),n))};hd.defaultProps={children:null};var bd=Object(re.observer)(hd);function vd(e){return b.types.compose("DotplotDisplay",Fe.BaseDisplay,b.types.model({type:b.types.literal("DotplotDisplay"),configuration:Object(P.ConfigurationReference)(e)}).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,html:"",message:void 0,renderingComponent:void 0,ReactComponent2:gd}}))).views((function(e){return{get rendererTypeName(){return Object(P.getConf)(e,"renderer").type},get renderProps(){return Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),{},{displayModel:e})}}})).actions((function(e){var t;return{afterAttach:function(){Object(_.makeAbortableReaction)(e,(function(){return function(e){var t=Object(_.getSession)(e).rpcManager,n=e.renderProps,a=e.rendererType,r=e.adapterConfig,o=Object(_.getContainingView)(e);if(Object(P.readConfObject)(e.configuration),Object(b.getSnapshot)(o),o.initialized){var i=o.viewWidth,c=o.viewHeight,s=o.borderSize,l=o.borderX,d=o.borderY;return{rendererType:a,rpcManager:t,renderProps:Object(u.a)(Object(u.a)({},n),{},{view:Object(b.getSnapshot)(o),width:i,height:c,borderSize:s,borderX:l,borderY:d}),renderArgs:{adapterConfig:r,rendererType:a.name,sessionId:Object(Ue.getRpcSessionId)(e),timeout:1e6}}}return}(e)}),(function(e){return e?function(e){return yd.apply(this,arguments)}(e):void 0}),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){if(void 0!==n){var a=n.data,r=n.html,o=n.renderingComponent;e.filled=!0,e.message=void 0,e.html=r,e.data=a,e.error=void 0,e.renderingComponent=o,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function yd(){return(yd=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,a=t.rpcManager,r=t.renderArgs,o=t.renderProps,e.next=5,n.renderInClient(a,Object(u.a)(Object(u.a)({},r),o));case 5:return i=e.sent,s=i.html,l=Object(d.a)(i,["html"]),e.abrupt("return",{html:s,data:l,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wd=Object(re.observer)((function(e){return m.a.createElement(ue.PrerenderedCanvas,e)})),Od=Object(P.ConfigurationSchema)("DotplotRenderer",{drawMode:{type:"stringEnum",description:"drawing mode",model:b.types.enumeration("Rendering",["normal"]),defaultValue:"normal"},color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"black",contextVariable:["feature"]},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:1.5}},{explicitlyTyped:!0}),jd=n(996),kd=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"serializeArgsInClient",value:function(e){return e=Object(u.a)(Object(u.a)({},e),{},{displayModel:{}})}},{key:"deserializeResultsInClient",value:function(e,t){return e.blockKey=t.blockKey,e}},{key:"deserializeArgsInWorker",value:function(e){if(this.configSchema){var t=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager});e.config=t}}},{key:"serializeResultsInWorker",value:function(){}},{key:"renderInClient",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.serializeArgsInClient(n),e.next=3,t.call(n.sessionId,"ComparativeRender",a);case 3:return r=e.sent,o=this.deserializeResultsInClient(r,n),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"renderInWorker",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(_.checkAbortSignal)(t.signal),this.deserializeArgsInWorker(t),Object(_.checkAbortSignal)(t.signal),e.next=5,this.render(t);case 5:return n=e.sent,Object(_.checkAbortSignal)(t.signal),n.html=Object(jd.renderToString)(n.element),delete n.element,this.serializeResultsInWorker(),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dataAdapter,a=t.signal,r=[],(r=t.regions)&&0!==r.length){e.next=6;break}return console.warn("no regions supplied to comparative renderer"),e.abrupt("return",[]);case 6:return o=r.map((function(e){var t=Object(u.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),i=n.getFeaturesInMultipleRegions(o,{signal:a}),e.abrupt("return",i.pipe(Object(ji.a)((function(e){return s.featurePassesFilters(t,e)})),Object(B.a)()).toPromise());case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(e,t){var n=this.serializeArgsInClient(t);return e.call(t.sessionId,"freeResources",n)}},{key:"freeResourcesInWorker",value:function(){}}]),n}(v.a),Cd=n(532);function Ed(e){return.7*e.length*12}var xd=Ut.a.extend((function(e){var t=le.observable.box(1);return{views:{get dynamicBlocks(){return Object(At.a)(e,!1,!1)},get scaleFactor(){return t.get()}},actions:{setScaleFactor:function(e){t.set(e)}}}})),Sd=xd.extend((function(e){return{views:{get width(){return Object(b.getParent)(e).viewWidth}}}})),Td=xd.extend((function(e){return{views:{get width(){return Object(b.getParent)(e).viewHeight}}}}));function Nd(e){return b.types.compose(Cd.a,b.types.model("DotplotView",{id:Ie.ElementId,type:b.types.literal("DotplotView"),headerHeight:0,height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:b.types.array(b.types.string),hview:b.types.optional(Sd,{}),vview:b.types.optional(Td,{}),tracks:b.types.array(e.pluggableMstType("track","stateModel")),viewTrackConfigs:b.types.array(e.pluggableConfigSchemaType("track")),viewAssemblyConfigs:b.types.array(b.types.frozen())}).volatile((function(){return{volatileWidth:void 0,error:void 0,borderX:100,borderY:100}})).views((function(e){return{get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}})).views((function(e){return{get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},get renderProps(){return Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),{},{highResolutionScaling:Object(P.getConf)(Object(_.getSession)(e),"highResolutionScaling")})}}})).actions((function(t){return{afterAttach:function(){var e=this,n=Object(_.getSession)(t);Object(b.addDisposer)(t,Object(le.autorun)((function(){if(void 0!==t.volatileWidth){var e=[t.viewWidth,t.viewHeight],a=[t.hview,t.vview];t.initialized||t.assemblyNames.forEach((function(t,r){var o=n.assemblyManager.get(t);if(o){var i=o.regions;if(i&&i.length){var c=Object(b.getSnapshot)(i);c&&Object(le.transaction)((function(){a[r].setDisplayedRegions(c),a[r].setBpPerPx(a[r].totalBp/e[r])}))}}}))}}),{delay:1e3})),Object(b.addDisposer)(t,Object(le.autorun)((function(){if(void 0!==t.volatileWidth){e.setBorderY(Math.max(t.hview.dynamicBlocks.contentBlocks.reduce((function(e,t){return Math.max(e,Ed(t.refName.slice(0,30)))}),0)+10,100)),e.setBorderX(Math.max(t.vview.dynamicBlocks.contentBlocks.reduce((function(e,t){return Math.max(e,Ed(t.refName.slice(0,30)))}),0)+10,100))}})))},setBorderX:function(e){t.borderX=e},setBorderY:function(e){t.borderY=e},setWidth:function(e){t.volatileWidth=e},setHeight:function(e){t.height=e},setError:function(e){t.error=e},closeView:function(){Object(b.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},zoomOutButton:function(){t.hview.zoomOut(),t.vview.zoomOut()},zoomInButton:function(){t.hview.zoomIn(),t.vview.zoomIn()},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=Object(_.getSession)(t),n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},showTrack:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.pluggableConfigSchemaType("track"),o=Object(b.resolveIdentifier)(r,Object(b.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var c=e.getViewType(t.type),s=o.displays.find((function(e){return!!c.displayTypes.find((function(t){return t.name===e.type}))}));if(!s)throw new Error("could not find a compatible display for view type ".concat(t.type));var l=i.stateModel.create(Object(u.a)(Object(u.a)({},a),{},{type:o.type,configuration:o,displays:[{type:s.type,configuration:s}]}));t.tracks.push(l)},hideTrack:function(n){var a=e.pluggableConfigSchemaType("track"),r=Object(b.resolveIdentifier)(a,Object(b.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===r}));return Object(le.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames:function(e){t.assemblyNames=Object(b.cast)(e)},setViews:function(e){t.hview=Object(b.cast)(e[0]),t.vview=Object(b.cast)(e[1])},getCoords:function(e,n){var a=Object(_.minmax)(n[0],e[0]),r=Object(f.a)(a,2),o=r[0],i=r[1],c=Object(_.minmax)(n[1],e[1]),s=Object(f.a)(c,2),l=s[0],u=s[1];return Math.abs(i-o)>3&&Math.abs(u-l)>3?[t.hview.pxToBp(o),t.hview.pxToBp(i),t.vview.pxToBp(t.viewHeight-l),t.vview.pxToBp(t.viewHeight-u)]:void 0},zoomIn:function(e,n){var a=this.getCoords(e,n);if(a){var r=Object(f.a)(a,4),o=r[0],i=r[1],c=r[2],s=r[3];t.hview.moveTo(o,i),t.vview.moveTo(s,c)}},onDotplotView:function(e,n){var a=this.getCoords(e,n);if(a){var r=Object(f.a)(a,4),o=r[0],i=r[1],c=r[2],s=r[3],l=Object(_.getSession)(t),d=xd.create(Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(t.hview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0})),p=xd.create(Object(u.a)(Object(u.a)({},Object(b.getSnapshot)(t.vview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0}));d.setVolatileWidth(t.hview.width),p.setVolatileWidth(t.vview.width),d.moveTo(o,i),p.moveTo(s,c),d.zoomTo(d.bpPerPx/(t.width/t.hview.width),0),p.zoomTo(p.bpPerPx/(t.width/t.vview.width),0);var m=[];t.tracks.forEach((function(e){var t=e.configuration,n=t.displays.find((function(e){return"LinearSyntenyDisplay"===e.type}));n&&m.push({type:t.type,configuration:t,displays:[{type:n.type,configuration:n}]})}));var g={type:"LinearSyntenyView",views:[Object(u.a)(Object(u.a)({type:"LinearGenomeView"},Object(b.getSnapshot)(d)),{},{tracks:[],hideHeader:!0}),Object(u.a)(Object(u.a)({type:"LinearGenomeView"},Object(b.getSnapshot)(p)),{},{tracks:[],hideHeader:!0})],tracks:m};l.addView("LinearSyntenyView",g)}}}})).views((function(e){return{get menuItems(){var t=Object(_.getSession)(e);return Object(_.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector}]:[]}}})))}var Ad=o.parseCigar,Rd=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"makeImageData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,u,d,p,m,g,h,b;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.highResolutionScaling,a=void 0===n?1:n,r=t.width,o=t.height,i=t.config,s=t.views,l=Object(ir.b)(Math.ceil(r*a),o*a),u=l.getContext("2d"),d=Object(P.readConfObject)(i,"lineWidth"),u.lineWidth=d,u.scale(a,a),u.fillStyle=Object(P.readConfObject)(i,"color"),p=Object(f.a)(s,2),m=p[0],g=p[1],h=m.dynamicBlocks.contentBlocks[0].offsetPx,b=g.dynamicBlocks.contentBlocks[0].offsetPx,(m.features||[]).forEach((function(e){var t=e.get("start"),n=e.get("end"),a=e.get("refName"),r=e.get("mate"),c=r.refName,s=Object(P.readConfObject)(i,"color",{feature:e});u.fillStyle=s,u.strokeStyle=s;var l=m.bpToPx({refName:a,coord:t}),f=m.bpToPx({refName:a,coord:n}),p=g.bpToPx({refName:c,coord:r.start}),v=g.bpToPx({refName:c,coord:r.end});if(void 0!==l&&void 0!==f&&void 0!==p&&void 0!==v){var y=l-h,w=f-h,O=p-b,j=v-b;if(Math.abs(y-w)<3&&Math.abs(O-j)<3)u.fillRect(y-d/2,o-O-d/2,d,d);else{var k=y,C=O,E=e.get("cg")||e.get("CIGAR");if(E){var x=Ad(E);u.beginPath();for(var S=0;S<x.length;S+=2){var T=+x[S],N=x[S+1],A=k,R=C;"M"===N||"="===N||"X"===N?(k+=T/m.bpPerPx,C+=T/g.bpPerPx):"D"===N||"N"===N?k+=T/m.bpPerPx:"I"===N&&(C+=T/g.bpPerPx),u.moveTo(A,o-R),u.lineTo(k,o-C)}u.stroke()}else u.beginPath(),u.moveTo(y,o-O),u.lineTo(w,o-j),u.stroke()}}else console.warn("feature at ".concat(a,":").concat(t,"-").concat(n," ").concat(c,":").concat(r.start,"-").concat(r.end," not plotted, fell outside of range ").concat(l," ").concat(f," ").concat(p," ").concat(v))})),e.abrupt("return",Object(ir.c)(l));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,d,f,p,g=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,a=t.height,r=t.view,o=r.hview,i=r.vview,s=[n,a],d=[o,i].map((function(e,t){var n=xd.create(e);return n.setVolatileWidth(s[t]),n})),e.next=5,Promise.all(d.map(function(){var e=Object(l.a)(c.a.mark((function e(n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.next=3,g.getFeatures(Object(u.a)(Object(u.a)({},t),{},{regions:n.dynamicBlocks.contentBlocks}));case 3:e.t1=e.sent,e.t0.setFeatures.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.next=7,this.makeImageData(Object(u.a)(Object(u.a)({},t),{},{views:d}));case 7:return f=e.sent,p=m.a.createElement(this.ReactComponent,Object(u.a)(Object(u.a)({},t),{},{height:a,width:n,imageData:f}),null),e.abrupt("return",{element:p,imageData:f,height:a,width:n,offsetX:d[0].dynamicBlocks.blocks[0].offsetPx,offsetY:d[1].dynamicBlocks.blocks[0].offsetPx});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(kd),Md=n(211),Pd=n.n(Md),Fd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(g.a)(this,e),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}return Object(h.a)(e,[{key:"_set",value:function(e,t){this.cache.set(e,t),this._size+=1,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&(this._size-=1),this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:c.a.mark((function e(){var t,n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=Object(f.a)(n.value,1),r=a[0],e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"values",value:c.a.mark((function e(){var t,n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=Object(f.a)(n.value,2),r=a[1],e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:Symbol.iterator,value:c.a.mark((function e(){var t,n,a,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(He.a)(this.cache),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,a;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:r=Object(He.a)(this.oldCache),e.prev=18,r.s();case 20:if((o=r.n()).done){e.next=28;break}if(i=o.value,s=Object(f.a)(i,1),l=s[0],this.cache.has(l)){e.next=26;break}return e.next=26,i;case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(18),r.e(e.t1);case 33:return e.prev=33,r.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[1,11,14,17],[18,30,33,36]])}))},{key:"size",get:function(){var e,t=0,n=Object(He.a)(this.oldCache.keys());try{for(n.s();!(e=n.n()).done;){var a=e.value;this.cache.has(a)||(t+=1)}}catch(r){n.e(r)}finally{n.f()}return this._size+t}}]),e}(),Id=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).cache=new Pd.a({cache:new Fd({maxSize:1}),fill:function(e,t){return a.setup(Object(u.a)(Object(u.a)({},e),{},{signal:t}))}}),a.assemblyNames=void 0,a.pafLocation=void 0;var r=Object(P.readConfObject)(e,"pafLocation"),o=Object(P.readConfObject)(e,"assemblyNames");return a.pafLocation=Object(oe.openLocation)(r),a.assemblyNames=o,a}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pafLocation.readFile(Object(u.a)({encoding:"utf8"},t));case 2:return n=e.sent,a=[],n.split("\n").forEach((function(e,t){if(e.length){var n=e.split("\t"),r=Object(Oe.a)(n),o=r[0],i=(r[1],r[2]),c=r[3],s=r[4],l=r[5],d=(r[6],r[7]),f=r[8],p=r[9],m=r[10],g=r[11],h=r.slice(12),b=Object.fromEntries(h.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));a[t]={records:[{refName:o,start:+i,end:+c},{refName:l,start:+d,end:+f}],extra:Object(u.a)({numMatches:+p,blockLen:+m,strand:s,mappingQual:+g},b)}}})),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s,l,d,f,p,m,g,h;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.cache.get("initialize",n,n.signal);case 2:if(o=a.sent,-1!==(i=t.assemblyNames.indexOf(e.assemblyName)))for(s=0;s<o.length;s++)l=o[s],d=l.extra,f=l.records,p=f[i],m=p.start,g=p.end,h=p.refName,f[i].refName===e.refName&&Object(hi.a)(e.start,e.end,m,g)&&r.next(new U.a(Object(u.a)({uniqueId:"row_".concat(s),start:m,end:g,refName:h,syntenyId:s,mate:{start:f[+!i].start,end:f[+!i].end,refName:f[+!i].refName}},d)));r.complete();case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter);Id.capabilities=["getFeatures","getRefNames"];var Bd=Object(P.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[]},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf"}}},{explicitlyTyped:!0}),Ld=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="ComparativeRender",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.pluginManager.rootModel)||void 0===n||null===(a=n.session)||void 0===a?void 0:a.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",Object(_.renameRegionsIfNeeded)(r,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,d,f,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t);case 2:if(n=e.sent,a=n.sessionId,r=n.adapterConfig,o=n.rendererType,i=n.renderProps,s=n.signal,a){e.next=6;break}throw new Error("must pass a unique session id");case 6:if(Object(_.checkAbortSignal)(s),l=W(this.pluginManager,a,r),(d=l.dataAdapter)instanceof H.BaseFeatureDataAdapter){e.next=10;break}throw new Error("ComparativeRender cannot handle this type of data adapter ".concat(d));case 10:if(f=this.pluginManager.getRendererType(o)){e.next=13;break}throw new Error('renderer "'.concat(o,'" not found'));case 13:if(f.ReactComponent){e.next=15;break}throw new Error("renderer ".concat(o," has no ReactComponent, it may not be completely implemented yet"));case 15:if(f instanceof kd){e.next=17;break}throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");case 17:return delete(p=Object(u.a)(Object(u.a)(Object(u.a)({},n),i),{},{dataAdapter:d})).renderProps,e.next=21,f.renderInWorker(p);case 21:return m=e.sent,Object(_.checkAbortSignal)(s),e.abrupt("return",m);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(M),Dd=function(){var e=Object(Ze.a)((function(e){return{importFormContainer:{padding:e.spacing(4),margin:"0 auto"},importFormEntry:{minWidth:180},errorMessage:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)}}})),t=Object(re.observer)((function(t){var n=t.model,a=t.selected,r=t.onChange,o=t.error,i=e(),c=Object(_.getSession)(n).assemblyNames;return m.a.createElement(ba.a,{container:!0,item:!0,justify:"center",spacing:2,alignItems:"center"},m.a.createElement(dn.a,{select:!0,variant:"outlined",value:c[a]?a:"",inputProps:{"data-testid":"dotplot-input"},onChange:function(e){r(Number(e.target.value))},error:Boolean(o),disabled:Boolean(o),className:i.importFormEntry},c.map((function(e,t){return m.a.createElement(va.a,{key:e,value:t},e)}))))}));return Object(re.observer)((function(n){var a=n.model,r=e(),o=Object(p.useState)(2),i=Object(f.a)(o,1)[0],c=Object(p.useState)([0,0]),l=Object(f.a)(c,2),u=l[0],d=l[1],g=Object(p.useState)({uri:""}),h=Object(f.a)(g,2),b=h[0],v=h[1],y=Object(_.getSession)(a),w=y.assemblyNames,O=w.length?"":"No configured assemblies";return m.a.createElement(ha.a,{className:r.importFormContainer},m.a.createElement(ba.a,{container:!0,spacing:1,justify:"center",alignItems:"center",style:{width:"50%",margin:"0 auto"}},O?m.a.createElement(Je.a,{color:"error"},O):m.a.createElement(m.a.Fragment,null,m.a.createElement(ba.a,{item:!0},m.a.createElement(nn.a,{style:{padding:12,marginBottom:10}},m.a.createElement("p",{style:{textAlign:"center"}},"Select assemblies for dotplot view"),Object(s.a)(new Array(i)).map((function(e,n){return m.a.createElement(t,{key:"row_".concat(n,"_").concat(u[n]),error:O,selected:u[n],onChange:function(e){var t=u.slice(0);t[n]=e,d(t)},model:a})}))),m.a.createElement(nn.a,{style:{padding:12,marginBottom:10}},m.a.createElement("p",{style:{textAlign:"center"}},m.a.createElement("b",null,"Optional"),": Add a PAF"," ",m.a.createElement("a",{href:"https://github.com/lh3/miniasm/blob/master/PAF.md"},"(pairwise mapping format)")," ","file for the dotplot view. Note that the first assembly should be the left column of the PAF and the second assembly should be the right column"),m.a.createElement(ba.a,{container:!0,justify:"center"},m.a.createElement(ba.a,{item:!0},m.a.createElement(ue.FileSelector,{name:"URL",description:"",location:b,setLocation:function(e){return v(e)}}))))),m.a.createElement(ba.a,{item:!0},m.a.createElement(Ge.a,{"data-testid":"submitDotplot",onClick:function(){if(a.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),a.setAssemblyNames([w[u[0]],w[u[1]]]),"uri"in b){var e=b.uri?b.uri.slice(b.uri.lastIndexOf("/")+1):null,t=y.addTrackConf({trackId:"fileName-".concat(Date.now()),name:e,assemblyNames:u.map((function(e){return w[e]})),type:"SyntenyTrack",adapter:{type:"PAFAdapter",pafLocation:b,assemblyNames:u.map((function(e){return w[e]}))}});a.toggleTrack(t.trackId)}},variant:"contained",color:"primary"},"Open")))))}))},Vd=n(1284),Wd=n.n(Vd),qd=n(2321),zd=n.n(qd),Hd=n(2322),_d=n.n(Hd),Ud=function(){var e=Object(Ze.a)({iconButton:{padding:"4px",margin:"0 2px 0 2px"},controls:{overflow:"hidden",background:"white",whiteSpace:"nowrap",position:"absolute",boxSizing:"border-box",border:"1px solid #a2a2a2",right:0,top:0,zIndex:1001}});return Object(re.observer)((function(t){var n=t.model,a=e();return m.a.createElement("div",{className:a.controls},m.a.createElement(Qt.a,{onClick:function(){n.hview.scroll(-100)},className:a.iconButton,title:"left",color:"secondary"},m.a.createElement(zd.a,null)),m.a.createElement(Qt.a,{onClick:function(){n.hview.scroll(100)},className:a.iconButton,title:"left",color:"secondary"},m.a.createElement(_d.a,null)),m.a.createElement(Qt.a,{onClick:function(){n.vview.scroll(100)},className:a.iconButton,title:"left",color:"secondary"},m.a.createElement(ja.a,null)),m.a.createElement(Qt.a,{onClick:function(){n.vview.scroll(-100)},className:a.iconButton,title:"left",color:"secondary"},m.a.createElement(Wd.a,null)),m.a.createElement(Qt.a,{onClick:n.zoomOutButton,className:a.iconButton,color:"secondary"},m.a.createElement(In.a,null)),m.a.createElement(Qt.a,{onClick:n.zoomInButton,className:a.iconButton,title:"zoom in",color:"secondary"},m.a.createElement(Pn.a,null)),m.a.createElement(Qt.a,{onClick:n.activateTrackSelector,title:"Open track selector",value:"track_select","data-testid":"circular_track_select",color:"secondary"},m.a.createElement(Ft,null)))}))},Gd=Object(Ze.a)((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},viewContainer:{marginTop:"3px"},container:{display:"grid",padding:5,position:"relative"},overlay:{pointerEvents:"none",overflow:"hidden",display:"flex",width:"100%",gridRow:"1/2",gridColumn:"2/2",zIndex:100,"& path":{cursor:"crosshair",fill:"none"}},vtext:{gridColumn:"1/2",gridRow:"1/2",pointerEvents:"none"},content:{gridColumn:"2/2",gridRow:"1/2"},spacer:{gridColumn:"1/2",gridRow:"2/2"},htext:{gridColumn:"2/2",gridRow:"2/2",pointerEvents:"none"},error:{color:"red"},popover:{background:"#fff",maxWidth:400,wordBreak:"break-all",zIndex:1e3,border:"1px solid black",pointerEvents:"none",position:"absolute"},majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}}));function Jd(e,t){var n=t.pxToBp(e),a=n.refName,r=n.start,o=n.offset,i=n.oob,c=Math.floor(r+o);return i?"out of bounds":"".concat(a,":").concat(c.toLocaleString("en-US"))}function Qd(e,t,n){var a=[],r=e.slice(0).sort((function(e,t){var n=e.end-e.start;return t.end-t.start-n})),o=new Array(Math.round(t));return r.forEach((function(e){var r=e.key,i=e.offsetPx,c=Math.round(t-i+n),s=[Math.max(c-12,0),c];0===c||o.slice.apply(o,s).some(Boolean)?a.push(r):o.fill.apply(o,[!0].concat(s))})),a}function Xd(e,t,n){for(var a=t*(e=Math.abs(e)),r=parseInt(Number(a).toExponential().split(/e/i)[1],10),o=Math.pow(10,r);o<a&&!((o*=2)>=a);)o*=2.5;var i=(o=Math.max(o,5))/e,c=0;return!(o%10)&&i/10>=n?c=o/10:!(o%5)&&i/5>=n?c=o/5:!(o%2)&&i/2>=n&&(c=o/2),{majorPitch:o,minorPitch:c}}function Yd(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=[],o=Xd(t,60,15),i=o.minorPitch||o.majorPitch,c=0;c<e.length;c++)for(var s=e[c],l=s.start,u=s.end,d=s.refName,f=0,p=l,m=u,g=Math.ceil(p/i)*i;g<m;g+=i)a&&g%o.majorPitch?(r.push({type:"minor",base:g-1,index:f,refName:d}),f+=1):n&&Math.abs(g-s.start)>o.minorPitch&&(r.push({type:"major",base:g-1,index:f,refName:d}),f+=1);return r}var Kd=Object(re.observer)((function(e){var t=e.model,n=Gd(),a=t.viewWidth,r=t.borderY,o=t.hview,i=t.htextRotation,c=Qd(o.dynamicBlocks.contentBlocks,a,o.offsetPx),s=Yd(o.staticBlocks.contentBlocks,o.bpPerPx);return m.a.createElement("svg",{width:a,height:r,className:n.htext},m.a.createElement("g",null,o.dynamicBlocks.contentBlocks.filter((function(e){return!c.includes(e.key)})).map((function(e){var t=e.offsetPx;return m.a.createElement("text",{transform:"rotate(".concat(i,",").concat(t-o.offsetPx,",").concat(0,")"),key:JSON.stringify(e),x:t-o.offsetPx,y:1,fill:"#000000",dominantBaseline:"hanging",textAnchor:"end"},"".concat(e.refName,":").concat(0!==e.start?Math.floor(e.start).toLocaleString("en-US"):""))})),s.map((function(e){var t=(o.bpToPx({refName:e.refName,coord:e.base})||0)-o.offsetPx;return m.a.createElement("line",{key:"line-".concat(JSON.stringify(e)),x1:t,x2:t,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?n.majorTick:n.minorTick,"data-bp":e.base})})),s.filter((function(e){return"major"===e.type})).map((function(e){var t=(o.bpToPx({refName:e.refName,coord:e.base})||0)-o.offsetPx;return m.a.createElement("text",{x:t-7,y:0,transform:"rotate(".concat(i,",").concat(t,",").concat(0,")"),key:"text-".concat(JSON.stringify(e)),style:{fontSize:"11px"},className:n.majorTickLabel,dominantBaseline:"middle",textAnchor:"end"},(e.base+1).toLocaleString("en-US"))}))))})),Zd=Object(re.observer)((function(e){var t=e.model,n=Gd(),a=t.borderX,r=t.viewHeight,o=t.vview,i=t.vtextRotation,c=Qd(o.dynamicBlocks.contentBlocks,r,o.offsetPx),s=Yd(o.staticBlocks.contentBlocks,o.bpPerPx);return m.a.createElement("svg",{className:n.vtext,width:a,height:r},m.a.createElement("g",null,o.dynamicBlocks.contentBlocks.filter((function(e){return!c.includes(e.key)})).map((function(e){var t=e.offsetPx,n=a;return m.a.createElement("text",{transform:"rotate(".concat(i,",").concat(n,",").concat(t,")"),key:JSON.stringify(e),x:a,y:r-t+o.offsetPx,fill:"#000000",textAnchor:"end"},"".concat(e.refName,":").concat(0!==e.start?Math.floor(e.start):""))})),s.map((function(e){var t=(o.bpToPx({refName:e.refName,coord:e.base})||0)-o.offsetPx;return m.a.createElement("line",{key:"line-".concat(JSON.stringify(e)),y1:r-t,y2:r-t,x1:a,x2:a-("major"===e.type?6:4),strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?n.majorTick:n.minorTick,"data-bp":e.base})})),s.filter((function(e){return"major"===e.type})).map((function(e){var t=(o.bpToPx({refName:e.refName,coord:e.base})||0)-o.offsetPx;return m.a.createElement("text",{y:r-t-3,x:a-7,key:"text-".concat(JSON.stringify(e)),textAnchor:"end",dominantBaseline:"hanging",style:{fontSize:"11px"},className:n.majorTickLabel},(e.base+1).toLocaleString("en-US"))}))))})),$d=Object(re.observer)((function(e){var t=e.model,n=e.children,a=e.stroke,r=void 0===a?"#000a":a,o=t.viewWidth,i=t.viewHeight,c=t.hview,s=t.vview,l=c.dynamicBlocks.contentBlocks,u=s.dynamicBlocks.contentBlocks,d=c.displayedRegionsTotalPx-c.offsetPx,f=l[0].offsetPx-c.offsetPx,p=s.displayedRegionsTotalPx-s.offsetPx,g=u[0].offsetPx-s.offsetPx;return m.a.createElement("svg",{style:{background:"rgba(0,0,0,0.12)"},width:o,height:i}," ",m.a.createElement("rect",{x:f,y:i-p,width:d-f,height:p-g,fill:"#fff"}),m.a.createElement("g",null,l.map((function(e){var t=e.offsetPx-c.offsetPx;return m.a.createElement("line",{key:JSON.stringify(e),x1:t,y1:0,x2:t,y2:i,stroke:r})})),u.map((function(e){var t=i-(e.offsetPx-s.offsetPx);return m.a.createElement("line",{key:JSON.stringify(e),x1:0,y1:t,x2:o,y2:t,stroke:r})})),m.a.createElement("line",{x1:d,y1:0,x2:d,y2:i,stroke:r}),m.a.createElement("line",{x1:0,y1:i-p,x2:o,y2:i-p,stroke:r})),n)})),ef=function(e){var t=e.jbrequire,n=t(Dd),a=t(Ud);function r(e,t){return e&&[e[0]-t.left,e[1]-t.top]}var o=Object(re.observer)((function(e){var t,n,o,i=e.model,c=i.hview,s=i.vview,l=i.viewHeight,u=Gd(),d=Object(p.useState)(),g=Object(f.a)(d,2),h=g[0],b=g[1],v=Object(p.useState)(),y=Object(f.a)(v,2),w=y[0],O=y[1],j=Object(p.useState)(),k=Object(f.a)(j,2),C=k[0],E=k[1],x=Object(p.useRef)(null),S=Object(p.useRef)(null),T=Object(p.useRef)(0),N=Object(p.useRef)(0),A=Object(p.useRef)(null),R=Object(p.useRef)(null),M=Object(p.useRef)(),F=Object(p.useRef)(0),I=Object(p.useRef)(!1),B={left:0,top:0,width:0,height:0},L=(null===(t=x.current)||void 0===t?void 0:t.getBoundingClientRect())||B,D=(null===(n=R.current)||void 0===n?void 0:n.getBoundingClientRect())||B,V=(null===(o=A.current)||void 0===o?void 0:o.getBoundingClientRect())||B,W=r(w,L),q=r(h,L),z=r(C,L),H=z||q;return Object(p.useEffect)((function(){function e(e){var t=$n()(e);e.preventDefault(),!0===e.ctrlKey?(F.current+=t.pixelY/500,i.vview.setScaleFactor(F.current<0?1-F.current:1/(1+F.current)),i.hview.setScaleFactor(F.current<0?1-F.current:1/(1+F.current)),M.current&&clearTimeout(M.current),M.current=setTimeout((function(){Object(le.transaction)((function(){i.hview.setScaleFactor(1),i.vview.setScaleFactor(1),i.hview.zoomTo(F.current>0?i.hview.bpPerPx*(1+F.current):i.hview.bpPerPx/(1-F.current)),i.vview.zoomTo(F.current>0?i.vview.bpPerPx*(1+F.current):i.vview.bpPerPx/(1-F.current))})),F.current=0}),300)):(T.current+=t.pixelX,N.current-=t.pixelY,I.current||(I.current=!0,window.requestAnimationFrame((function(){Object(le.transaction)((function(){i.hview.scroll(T.current),i.vview.scroll(N.current)})),I.current=!1,T.current=0,N.current=0}))))}if(x.current){var t=x.current;return t.addEventListener("wheel",e),function(){t.removeEventListener("wheel",e)}}return function(){}}),[i.hview,i.vview]),Object(p.useEffect)((function(){function e(e){b([e.clientX,e.clientY])}return window.addEventListener("mousemove",e),function(){window.removeEventListener("mousemove",e)}}),[]),Object(p.useEffect)((function(){var e=function(){};function t(e){W&&q&&Math.abs(W[0]-q[0])>3&&Math.abs(W[1]-q[1])>3?E([e.clientX,e.clientY]):O(void 0)}return W&&!z&&(window.addEventListener("mouseup",t,!0),e=function(){window.removeEventListener("mouseup",t,!0)}),e}),[W,q,z]),m.a.createElement("div",{ref:S,className:u.root},m.a.createElement(a,{model:i}),m.a.createElement("div",{className:u.container},m.a.createElement("div",{style:{display:"grid",transform:"scaleX(".concat(i.hview.scaleFactor,") scaleY(").concat(i.vview.scaleFactor,")")}},m.a.createElement(Zd,{model:i}),m.a.createElement(Kd,{model:i}),m.a.createElement("div",{ref:x,style:{position:"relative"},className:u.content},H?m.a.createElement("div",{ref:A,className:u.popover,style:{left:H[0]-(W&&H[0]-W[0]<0?V.width:0),top:H[1]-(W&&H[1]-W[1]<0?V.height:0)}},"x-".concat(Jd(H[0],c)),m.a.createElement("br",null),"y-".concat(Jd(l-H[1],s))):null,W&&H&&Math.abs(W[0]-H[0])>3&&Math.abs(W[1]-H[1])>3?m.a.createElement("div",{ref:R,className:u.popover,style:{left:W[0]-(H[0]-W[0]<0?0:D.width),top:W[1]-(H[1]-W[1]<0?0:D.height)}},"x-".concat(Jd(W[0],c)),m.a.createElement("br",null),"y-".concat(Jd(l-W[1],s))):null,m.a.createElement("div",{role:"presentation",style:{cursor:"crosshair"},onMouseDown:function(e){0===e.button&&(O([e.clientX,e.clientY]),b([e.clientX,e.clientY]))}},m.a.createElement($d,{model:i},W&&H?m.a.createElement("rect",{fill:"rgba(255,0,0,0.3)",x:Math.min(H[0],W[0]),y:Math.min(H[1],W[1]),width:Math.abs(H[0]-W[0]),height:Math.abs(H[1]-W[1])}):null)),m.a.createElement("div",{className:u.spacer})),m.a.createElement("div",{className:u.overlay},i.tracks.map((function(e){var t=Object(f.a)(e.displays,1)[0],n=t.RenderingComponent;return n?m.a.createElement(n,{key:Object(P.getConf)(e,"trackId"),model:t}):null}))),m.a.createElement(ue.Menu,{open:Boolean(z),onMenuItemClick:function(e,t){t(),E(void 0),O(void 0)},onClose:function(){E(void 0),O(void 0)},anchorReference:"anchorPosition",anchorPosition:C?{top:C[1]+30,left:C[0]+30}:void 0,style:{zIndex:1e3},menuItems:[{label:"Zoom in",onClick:function(){W&&z&&i.zoomIn(W,z)}},{label:"Open linear synteny view",onClick:function(){W&&z&&i.onDotplotView(W,z)}}]}))))}));return Object(re.observer)((function(e){var t=e.model,a=t.initialized,r=t.loading,i=t.error,c=Gd();return a||r?i?m.a.createElement("p",{className:c.error},String(i)):r?m.a.createElement("div",null,m.a.createElement("p",null,"Loading..."),m.a.createElement(yn.a,null)):m.a.createElement(o,{model:t}):m.a.createElement(n,{model:t})}))},tf=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"DotplotView",stateModel:t(Nd),ReactComponent:t(ef)})},nf=o.parseCigar;function af(e){for(var t=nf(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"D"!==o&&"N"!==o&&(n+=r)}return n}function rf(e){for(var t=nf(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"H"!==o&&"S"!==o&&"D"!==o&&"N"!==o&&(n+=r)}return n}var of=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="DotplotPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(tf)})),e.addDisplayType((function(){var t=function(e){return Object(P.ConfigurationSchema)("DotplotDisplay",{renderer:b.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new O.a({name:"DotplotDisplay",configSchema:t,stateModel:vd(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:bd})})),e.addRendererType((function(){return new Rd({name:"DotplotRenderer",configSchema:Od,ReactComponent:wd,pluginManager:e})})),e.addAdapterType((function(){return new y.a({name:"PAFAdapter",configSchema:Bd,AdapterClass:Id})})),e.addRpcMethod((function(){return new Ld(e)}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Dotplot view",icon:sd.a,onClick:function(e){e.addView("DotplotView",{})}});var t=function(e,t){var n=t.parentTrack;return e?[{label:"Dotplot of read vs ref",icon:ps.a,onClick:function(){var a=Object(_.getSession)(t),r=e.get("clipPos"),o=e.get("CIGAR"),i=e.get("flags"),c=(e.get("tags")?e.get("tags").SA:e.get("SA"))||"",l=e.get("name"),u="".concat(l,"_assembly"),d=Object(P.getConf)(n,"assemblyNames"),p=Object(f.a)(d,1)[0],m=[p,u],g="track-".concat(Date.now()),h="".concat(l,"_vs_").concat(p),b=c.split(";").filter((function(e){return!!e})).map((function(t,n){var a=t.split(","),r=Object(f.a)(a,4),o=r[0],i=r[1],c=r[2],s=r[3],u=function(e){for(var t=nf(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"H"!==o&&"S"!==o&&"I"!==o&&(n+=r)}return n}(s),d=af(s),m=rf(s),g="-"===c?-1:1,h=function(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}(s,g),b=+i-1;return{refName:o,start:b,end:b+u,seqLength:d,clipPos:h,CIGAR:s,assemblyName:p,strand:g,uniqueId:"".concat(e.id(),"_SA").concat(n),mate:{start:h,end:h+m,refName:l}}})),v=e.toJSON();v.mate={refName:l,start:r,end:r+rf(o)};var y=af(2048&i?b[0].CIGAR:o),w=[v].concat(Object(s.a)(b));w.sort((function(e,t){return e.clipPos-t.clipPos}));var O=w.reduce((function(e,t){return e+t.end-t.start}),0);a.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:O/800,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:w.map((function(e){return{start:e.start,end:e.end,refName:e.refName,assemblyName:p}}))},vview:{offsetPx:0,bpPerPx:y/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:u,start:0,end:y,refName:l}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:m,adapter:{type:"FromConfigAdapter",features:w},trackId:g,name:h}],viewAssemblyConfigs:[{name:u,sequence:{type:"ReferenceSequenceTrack",trackId:"".concat(l,"_").concat(Date.now()),adapter:{type:"FromConfigSequenceAdapter",features:[e.toJSON()]}}}],assemblyNames:m,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(g,"-DotplotDisplay")}]}],displayName:"".concat(l," vs ").concat(p)})}}]:[]};function n(e){"LinearGenomeView"===e.type&&e.tracks.forEach((function(e){"AlignmentsTrack"===e.type&&e.displays.forEach((function(e){"LinearPileupDisplay"!==e.type||e.additionalContextMenuItemCallbacks.includes(t)?"LinearAlignmentsDisplay"===e.type&&e.PileupDisplay&&!e.PileupDisplay.additionalContextMenuItemCallbacks.includes(t)&&e.PileupDisplay.addAdditionalContextMenuItemCallback(t):e.addAdditionalContextMenuItemCallback(t)}))}))}Object(le.autorun)((function(){var t,a=null===(t=e.rootModel)||void 0===t?void 0:t.session;a&&a.views.forEach((function(e){e.views?e.views.forEach((function(e){return n(e)})):n(e)}))}))}}]),n}(F.a);var cf=function(e){return b.types.compose("LinearFilteringDisplay",St,b.types.model({type:b.types.literal("LinearFilteringDisplay"),configuration:Object(P.ConfigurationReference)(e),hideExpressions:b.types.optional(b.types.array(b.types.string),(function(){return[]})),height:193,filterControlsHeight:70,dragHandleHeight:3,filterOut:b.types.map(b.types.map(b.types.boolean))}).views((function(e){return{get renderProps(){var t=function(e){var t,n=[],a=e.filterOut,r=Object(He.a)(a.keys());try{for(r.s();!(t=r.n()).done;){var o,i=t.value,c=Object(He.a)(a.get(i).keys());try{for(c.s();!(o=c.n()).done;){var s=o.value;a.get(i).get(s)&&n.push("jexl:get(feature,'".concat(i,"') != '").concat(s,"'"))}}catch(l){c.e(l)}finally{c.f()}}}catch(l){r.e(l)}finally{r.f()}return n}(e);return Object(u.a)(Object(u.a)(Object(u.a)({},Object(Ue.getParentRenderProps)(e)),this.composedRenderProps),{},{displayModel:e,config:e.configuration.renderer,filters:t})},get innerDisplayHeight(){return e.height-e.dragHandleHeight-e.filterControlsHeight},get filterControlsMinHeight(){return Math.min(e.filterControlsMaxHeight,40)},get filterControlsMaxHeight(){return Math.max(e.height-20,0)},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{setFilterControlsHeight:function(t){return t>e.filterControlsMinHeight?t<e.filterControlsMaxHeight?e.filterControlsHeight=t:e.filterControlsHeight=e.filterControlsMaxHeight:e.filterControlsHeight=e.filterControlsMinHeight,e.filterControlsHeight},resizeFilterControls:function(t){return e.filterControlsHeight-e.setFilterControlsHeight(e.filterControlsHeight-t)},toggleFilter:function(t,n,a){e.filterOut.has(t)||e.filterOut.set(t,{}),e.filterOut.get(t).set(String(n),!a)}}})))},sf=n(29),lf=n(11),uf=n.n(lf),df=function(e){return{root:{background:e.palette.background.default,overflow:"auto",paddingTop:0,paddingBottom:e.spacing(1),paddingLeft:e.spacing(1),paddingRight:e.spacing(1),display:"flex",flexWrap:"wrap"},header:{width:"100%"},title:{}}};var ff=Object(sf.a)(df)(Object(re.observer)((function(e){var t=e.attrName,n=e.model,a=e.classes,r=e.values;return m.a.createElement(os.a,{component:"fieldset",className:a.formControl},m.a.createElement($c.a,{component:"legend"},t),m.a.createElement(rn.a,{row:!0},r.length?r.map((function(e){return m.a.createElement(ei.a,{key:"".concat(t,"-").concat(e),control:m.a.createElement(ti.a,{checked:!(n.filterOut.has(t)&&n.filterOut.get(t).get(String(e))),onChange:function(a){return n.toggleFilter(t,e,a.target.checked)}}),label:e})})):m.a.createElement(is.a,{style:{marginRight:"1em"}},"no values seen yet")))})));ff.propTypes={attrName:uf.a.string.isRequired,model:re.PropTypes.objectOrObservableObject.isRequired,values:uf.a.arrayOf(uf.a.string).isRequired};var pf=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).state={seenAttributes:{}};var r=e.model;return a.autorunDisposer=Object(le.reaction)((function(){var e={};return Object(P.getConf)(r,"filterAttributes").forEach((function(t){e[t]||(e[t]={}),function(e,t){var n,a=e.features,r=e.filterOut,o=new Set,i=Object(He.a)(a.values());try{for(i.s();!(n=i.n()).done;){var c=n.value;o.add(c.get(t))}}catch(d){i.e(d)}finally{i.f()}if(r.has(t)){var s,l=Object(He.a)(r.get(t).keys());try{for(l.s();!(s=l.n()).done;){var u=s.value;o.add(u)}}catch(d){l.e(d)}finally{l.f()}}return Array.from(o.values()).sort()}(r,t).forEach((function(n){e[t][n]=!0}))})),e}),(function(e){a.setState((function(t){var n={};return Object.keys(e).forEach((function(a){n[a]=Object(u.a)(Object(u.a)({},t.seenAttributes[a]||{}),e[a])})),{seenAttributes:n}}))}),{delay:400}),a}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){this.autorunDisposer()}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.style,a=e.model,r=this.state.seenAttributes;return m.a.createElement("div",{style:n,className:t.root},m.a.createElement("div",{className:t.header},m.a.createElement(Je.a,{className:t.title,variant:"subtitle2",gutterBottom:!0},"Filters")),Object.keys(r).sort().map((function(e){return m.a.createElement(ff,{key:e,attrName:e,model:a,values:Object.keys(r[e]).sort()})})))}}]),n}(p.Component);pf.defaultProps={style:{}};var mf=Object(sf.a)(df)(Object(re.observer)(pf)),gf=Object(Ze.a)((function(e){return{display:{background:"white",height:"100%",overflow:"hidden"},innerDisplay:{overflowY:"auto",overflowX:"hidden"},filterControls:{background:e.palette.background.default}}}));var hf=Object(re.observer)((function(e){var t=e.model,n=gf(),a=t.innerDisplayHeight,r=t.filterControlsHeight,o=t.dragHandleHeight;return m.a.createElement("div",{className:n.display},m.a.createElement("div",{className:n.innerDisplay,style:{height:a}},m.a.createElement(dt,e)),m.a.createElement(ue.ResizeHandle,{onDrag:t.resizeFilterControls,style:{height:o,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}),m.a.createElement(mf,Object.assign({style:{height:r}},e)))}));var bf=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="FilteringTrackPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addDisplayType((function(){var t=function(e){return Object(P.ConfigurationSchema)("LinearFilteringDisplay",{filterAttributes:{type:"stringArray",defaultValue:["type"],description:"list of feature attributes to use for filtering"}},{baseConfiguration:rr(e),explicitlyTyped:!0})}(e);return new O.a({name:"LinearFilteringDisplay",configSchema:t,stateModel:cf(t),trackType:"FilteringTrack",viewType:"LinearGenomeView",ReactComponent:hf})}))}}]),n}(F.a),vf=n(2324),yf=n.n(vf),wf=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).gff=void 0,a.dontRedispatch=void 0;var r=Object(P.readConfObject)(e,"gffGzLocation"),o=Object(P.readConfObject)(e,["index","indexType"]),i=Object(P.readConfObject)(e,["index","location"]),c=Object(P.readConfObject)(e,"dontRedispatch");return a.dontRedispatch=c||["chromosome","contig","region"],a.gff=new Bi.TabixIndexedFile({filehandle:Object(oe.openLocation)(r),csiFilehandle:"CSI"===o?Object(oe.openLocation)(i):void 0,tbiFilehandle:"CSI"!==o?Object(oe.openLocation)(i):void 0,chunkCacheSize:50*Math.pow(2,20),renameRefSeqs:function(e){return e}}),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",this.gff.getReferenceSequenceNames(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.gff.getHeader());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.gff.getMetadata();case 2:o=a.sent,t.getFeaturesHelper(e,n,o,r,!0);case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"getFeaturesHelper",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,d,f,p=this,m=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>1&&void 0!==m[1]?m[1]:{},a=m.length>2?m[2]:void 0,r=m.length>3?m[3]:void 0,o=m.length>4?m[4]:void 0,i=m.length>5&&void 0!==m[5]?m[5]:t,e.prev=5,s=[],e.next=9,this.gff.getLines(t.refName,t.start,t.end,(function(e,t){s.push(p.parseLine(a.columnNumbers,e,t))}));case 9:if(!o||!s.length){e.next=16;break}if(l=1/0,d=-1/0,s.forEach((function(e){var t=e.fields[2];if(!p.dontRedispatch.includes(t)){var n=e.start-1;n<l&&(l=n),e.end>d&&(d=e.end)}})),!(d>t.end||l<t.start)){e.next=16;break}return this.getFeaturesHelper(Object(u.a)(Object(u.a)({},t),{},{start:l,end:d}),n,a,r,!1,t),e.abrupt("return");case 16:f=s.map((function(e){return e.fields[8]&&"."!==e.fields[8]?e.fields[8].includes("_lineHash")||(e.fields[8]+=";_lineHash=".concat(e.lineHash)):e.fields[8]="_lineHash=".concat(e.lineHash),e.fields.join("\t")})).join("\n"),yf.a.parseStringSync(f,{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1}).forEach((function(e){return p.formatFeatures(e).forEach((function(e){Object(hi.a)(e.get("start"),e.get("end"),i.start,i.end)&&r.next(e)}))})),r.complete(),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(5),r.error(e.t0);case 25:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseLine",value:function(e,t,n){var a=t.split("\t");return{start:+a[e.start-1],end:+a[e.end-1],lineHash:n,fields:a}}},{key:"formatFeatures",value:function(e){var t=this;return e.map((function(e){return new U.a({data:t.featureData(e),id:"".concat(t.id,"-offset-").concat(e.attributes._lineHash[0])})}))}},{key:"featureData",value:function(e){var t=this,n=Object(u.a)({},e);n.start-=1,n.strand={"+":1,"-":-1,".":0,"?":void 0}[e.strand],n.phase=Number(e.phase),n.refName=e.seq_id,null===e.score&&delete n.score,null===e.phase&&delete n.score;var a=["start","end","seq_id","score","type","source","phase","strand"];return Object.keys(e.attributes).forEach((function(t){var r=t.toLowerCase();if(a.includes(r)&&(r+="2"),null!==e.attributes[t]){var o=e.attributes[t];if(Array.isArray(o)&&1===o.length){var i=o;o=Object(f.a)(i,1)[0]}n[r]=o}})),n.refName=n.seq_id,e.child_features&&e.child_features.length&&(n.subfeatures=e.child_features.map((function(e){return e.map((function(e){return t.featureData(e)}))})).flat()),delete n.child_features,delete n.data,delete n.derived_features,delete n._linehash,delete n.attributes,delete n.seq_id,n}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),Of=Object(P.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz"}},index:Object(P.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:b.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),jf=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="GFF3TabixPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"Gff3TabixAdapter",configSchema:Of,AdapterClass:wf})}))}}]),n}(F.a),kf=n(2393),Cf=n(2394),Ef=n.n(Cf),xf={refName:"seq_id"},Sf={seq_id:"refName"},Tf=function(){function e(t,n,a){Object(g.a)(this,e),this.ncFeature=void 0,this.parentHandle=void 0,this.uniqueId=void 0,this.ncFeature=t,this.uniqueId=a||t.id(),this.parentHandle=n}return Object(h.a)(e,[{key:"set",value:function(){throw new Error("not implemented")}},{key:"jb2TagToJb1Tag",value:function(e){return(xf[e]||e).toLowerCase()}},{key:"jb1TagToJb2Tag",value:function(e){var t=e.toLowerCase();return Sf[t]||t}},{key:"get",value:function(t){var n=this,a=this.ncFeature.get(this.jb2TagToJb1Tag(t));return a&&"subfeatures"===t?a.map((function(t){return new e(t,n)})):a}},{key:"tags",value:function(){var e=this;return this.ncFeature.tags().map((function(t){return e.jb1TagToJb2Tag(t)}))}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var t=this,n={uniqueId:this.id()};return this.ncFeature.tags().forEach((function(a){var r=t.jb1TagToJb2Tag(a),o=t.ncFeature.get(a);"subfeatures"===r?n.subfeatures=(o||[]).map((function(n){return new e(n,t).toJSON()})):n[r]=o})),n}}]),e}(),Nf=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).nclist=void 0,a.configRefNames=void 0;var r=Object(P.readConfObject)(e,"refNames"),o=Object(P.readConfObject)(e,"rootUrlTemplate");return a.configRefNames=r,a.nclist=new Ef.a({baseUrl:"",urlTemplate:o.uri,readFile:function(e){return Object(oe.openUrl)(o.baseUri?new URL(e,o.baseUri).toString():e).readFile()}}),a}return Object(h.a)(n,[{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s,l,u,d,f,p;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=n.signal,i=!0,s=!1,a.prev=3,u=Object(kf.a)(t.nclist.getFeatures(e,n));case 5:return a.next=7,u.next();case 7:return d=a.sent,i=d.done,a.next=11,d.value;case 11:if(f=a.sent,i){a.next=19;break}p=f,Object(_.checkAbortSignal)(o),r.next(t.wrapFeature(p));case 16:i=!0,a.next=5;break;case 19:a.next=25;break;case 21:a.prev=21,a.t0=a.catch(3),s=!0,l=a.t0;case 25:if(a.prev=25,a.prev=26,i||null==u.return){a.next=30;break}return a.next=30,u.return();case 30:if(a.prev=30,!s){a.next=33;break}throw l;case 33:return a.finish(30);case 34:return a.finish(25);case 35:r.complete();case 36:case"end":return a.stop()}}),a,null,[[3,21,25,35],[26,,30,34]])})));return function(e){return a.apply(this,arguments)}}())}},{key:"wrapFeature",value:function(e){return new Tf(e,void 0,"".concat(this.id,"-").concat(e.id()))}},{key:"hasDataForRefName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nclist.getDataRoot(t);case 2:return n=e.sent,e.abrupt("return",!!(n&&n.stats&&n.stats.featureCount));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){return Promise.resolve(this.configRefNames||[])}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),Af=Object(P.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0}),Rf=Object(P.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"}},{baseConfiguration:Fe.baseConnectionConfig}),Mf=n(414),Pf=n(1313),Ff=n.n(Pf),If=n(2403),Bf=n.n(If),Lf=n(1315);function Df(e,t){if("string"===typeof e){var n;try{n=JSON.parse(e)}catch(a){throw new Error("".concat(a," when parsing configuration."))}return Wf(n,t)}return Wf(e,t)}function Vf(e,t){var n;try{n=function(e,t){var n,a,r,o,i=[],c={tracks:{}};function s(){var e;if(void 0!==r)try{var s=r.match(/^json:(.+)/i);if(e=s?JSON.parse(s[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(r)?parseFloat(r.replace(/,/g,"")):r,!n)throw new Error("Error parsing in section ".concat(i.join(" - ")));var l=i.concat(n).join(".");if("+="===a){var u=Ff()(c,l);u?Array.isArray(u)||(u=[u]):u=[],u.push(e),e=u}"true"===e&&(e=!0),"false"===e&&(e=!1),Bf()(c,l,e)}catch(d){throw new Error("syntax error".concat(t?" in ".concat(t):"").concat(o?" at line ".concat(o-1):""))}}return e.split("\n").forEach((function(e,t){o=t+1;var c,l=e.replace(/^\s*#.+/,"");if(c=l.match(/^\s*\[([^\]]+)/))s(),n=void 0,r=void 0,1===(i=c[1].trim().split(/\s*\.\s*/)).length&&"general"===i[0].toLowerCase()&&(i=[]);else if(c=l.match(void 0===r?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/)){s(),n=c[1].trim().split(/\s*\.\s*/);var u=c,d=Object(f.a)(u,3);a=d[2],"include"===i.concat(n).join(".")&&(a="+="),r=c[3].trim()}else void 0!==n&&(c=l.match(/^\s{0,4}\+\s*(.+)/))?(s(),a="+=",r=c[1].trim()):void 0!==r&&(c=l.match(/^\s+(\S.*)/))?r+=r.length?" ".concat(c[1].trim()):c[1].trim():(s(),n=void 0,r=void 0)})),s(),c}(e,t)}catch(a){throw new Error("".concat(a," when parsing configuration."))}return Wf(n,t)}function Wf(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(Object(Lf.f)(e.tracks))e.tracks=[e.tracks];else{for(var n=[],a=0,r=Object.keys(e.tracks);a<r.length;a++){var o=r[a],i=e.tracks[o];Object(Lf.f)(i)?n.push(i):n.push(Object(u.a)({label:o},i))}e.tracks=n}var c=e.trackMetadata;if(c&&c.sources){if("string"===typeof c.sources&&(c.sources=[c.sources]),Object(Lf.e)(c.sources)&&(c.sources=[c.sources]),!Array.isArray(c.sources)){for(var l=[],d=0,f=Object.keys(c.sources);d<f.length;d++){var p=f[d],m=c.sources[p];"name"in m||(m.name=p),l.push(m)}c.sources=l}c.sources=c.sources.map((function(e){if("string"===typeof e){var t={url:e},n=e.match(/\.(\w+)$/);return n&&(t.type=n[1].toLowerCase()),t}return e}))}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){var g=[];e.tracks&&g.push.apply(g,Object(s.a)(e.tracks)),e.stores&&g.push.apply(g,Object(s.a)(Object.values(e.stores))),e.names&&g.push(e.names),g.forEach((function(t){t.baseUrl||(t.baseUrl=e.baseUrl||"/")})),e.refSeqs&&"string"===typeof e.refSeqs&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach((function(t){if(t.config){var n=t.config;delete t.config,t=Object(u.a)(Object(u.a)({},n),t)}var a;t.store||(a="FeatureTrack"===t.type?"JBrowse/View/Track/HTMLFeatures":"ImageTrack"===t.type?"JBrowse/View/Track/FixedImage":"ImageTrack.Wiggle"===t.type?"JBrowse/View/Track/FixedImage/Wiggle":"SequenceTrack"===t.type?"JBrowse/View/Track/Sequence":qf("JBrowse/View/Track",t.type),t.type=a,zf(e,t),t.histograms&&(t.histograms.baseUrl||(t.histograms.baseUrl=t.baseUrl),zf(e,t.histograms)))})),e}function qf(e,t){return t?(t.includes("/")||(t="".concat(e,"/").concat(t)),t=t.replace(/^\//,"")):""}function zf(e,t){var n,a=t.urlTemplate,r=void 0===a?"":a;if(n=t.storeClass?qf("JBrowse/Store",t.storeClass):function(e,t){return e?e.type&&e.type.includes("/FixedImage")?"JBrowse/Store/TiledImage/Fixed".concat(0===e.backendVersion?"_v0":""):/\.jsonz?$/i.test(t)?"JBrowse/Store/SeqFeature/NCList".concat(0===e.backendVersion?"_v0":""):/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}(t,r)){var o=Object(u.a)(Object(u.a)({},t),{},{type:n});"JBrowse/Store/Sequence/StaticChunked"!==n&&"JBrowse/Store/Sequence/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/BgzipIndexedFasta"!==n&&"JBrowse/Store/SeqFeature/TwoBit"!==n&&"JBrowse/Store/Sequence/TwoBit"!==n&&!t.useAsRefSeqStore||e.stores&&e.stores.refseqs?o.name="store".concat(Object(Lf.g)(o)):o.name="refseqs",e.stores||(e.stores={}),e.stores[o.name]=o,t.store=o.name}else console.warn("Unable to determine an appropriate data store to use with track '".concat(t.label,"', please explicitly specify a storeClass in the configuration."))}function Hf(e){return void 0!==e.uri}function _f(e){return void 0!==e.localPath}function Uf(){return(Uf=Object(l.a)(c.a.mark((function e(){var t,n,a,r,o,i,s,l,u,d,f,p,m,g,h=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{uri:""},n=h.length>1&&void 0!==h[1]?h[1]:{include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},a=h.length>2&&void 0!==h[2]?h[2]:{uri:""},r="uri"in t?"uri":"localPath",o=JSON.parse(JSON.stringify(t)),i="",Hf(t)&&(i=t.uri),_f(t)&&(i=t.localPath),i.endsWith("/")&&(o[r]=i.slice(0,i.length-1)),!(Hf(a)&&a.uri||_f(a)&&a.localPath)){e.next=35;break}s="uri"in a?"uri":"localPath",l="",Hf(a)&&(l=a.uri),_f(a)&&(l=a.localPath),l.endsWith("/")&&(l=l.slice(0,l.length-1)),u={},d=0,f=["jbrowse.conf","jbrowse_conf.json"];case 17:if(!(d<f.length)){e.next=33;break}return p=f[d],m=null,e.prev=20,e.next=23,Qf(Object(Mf.a)({},s,"".concat(l,"/").concat(p)));case 23:m=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(20),console.error("tried to access ".concat(l,"/").concat(p,", but failed"));case 29:u=Kf(u,m)||{};case 30:d++,e.next=17;break;case 33:return o[r]&&(u.dataRoot=o[r]),e.abrupt("return",Gf(u));case 35:return g=Wf(n,window.location.href),o[r]&&(g.dataRoot=o[r]),e.abrupt("return",Gf(g));case 38:case"end":return e.stop()}}),e,null,[[20,26]])})))).apply(this,arguments)}function Gf(e){return Jf.apply(this,arguments)}function Jf(){return(Jf=Object(l.a)(c.a.mark((function e(t){var n,a,r,o=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:ap,a=Object(Lf.b)(Object(Lf.a)(n),t),e.next=4,$f(a);case 4:return np(r=Kf(r=e.sent,t)||r,r),rp(r=Object(Lf.c)(r)),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qf(e){return Xf.apply(this,arguments)}function Xf(){return(Xf=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(oe.openLocation)(t).readFile("utf8");case 2:if("string"===typeof(n=e.sent)){e.next=5;break}throw new Error("Error opening location: ".concat(t));case 5:if(!Hf(t)){e.next=7;break}return e.abrupt("return",Yf(n,t.uri));case 7:if(!_f(t)){e.next=9;break}return e.abrupt("return",Yf(n,t.localPath));case 9:return e.abrupt("return",Yf(n));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.trim().startsWith("{")?Df(e,t):Vf(e,t)}function Kf(e,t){if(null===t)return null;null===e&&(e={});for(var n=0,a=Object.keys(t);n<a.length;n++){var r=a[n];if("tracks"===r&&r in e){var o=e[r]||[],i=t[r]||[];if(!Array.isArray(o)||!Array.isArray(i))throw new Error("Track config has not been properly regularized: ".concat(o," ").concat(i));e[r]=Zf(o||[],i||[])}else"datasets"!==r&&r in e&&"object"===typeof t[r]&&"object"===typeof e[r]?e[r]=Object(Lf.b)(e[r],t[r]):"dataRoot"===r?(void 0===e[r]||"data"===e[r]&&void 0!==t[r])&&(e[r]=t[r]):void 0!==e[r]&&void 0===t[r]||(e[r]=t[r])}return e}function Zf(e,t){if(!t.length)return e;var n={};return e.forEach((function(e,t){e.index=t,n[e.label]=e})),t.forEach((function(t){var a=n[t.label];a?Kf(a,t):e.push(t)})),e}function $f(e){return ep.apply(this,arguments)}function ep(){return(ep=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return(a=Object(l.a)(c.a.mark((function e(a,r){var o,i,s,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.sourceUrl||a.baseUrl){e.next=3;break}throw new Error("Could not determine source URL: ".concat(JSON.stringify(a)));case 3:if(i=Kf(Object(Lf.a)(r),a)){e.next=6;break}throw new Error("Problem merging configs");case 6:return s=np(tp(a.include||[]),i),delete a.include,u=s.map(function(){var e=Object(l.a)(c.a.mark((function e(a){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.cacheBuster=t.cacheBuster,e.next=3,Qf({uri:new URL(a.url,o).href});case 3:return r=e.sent,e.abrupt("return",n(r,i));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(u);case 11:return e.sent.forEach((function(e){a=Kf(a,e)||a})),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)},n=function(e,t){return a.apply(this,arguments)},t=Object(Lf.a)(t),e.abrupt("return",n(t,{}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tp(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return"string"===typeof e&&(e={url:e}),"format"in e||(e.format=e.url.endsWith(".conf")?"conf":"JB_json"),"JB_json"!==e.format||"version"in e||(e.version=1),e}))):[]}function np(e,t){if(!e)return e;if(Array.isArray(e))for(var n=0;n<e.length;n+=1)e[n]=np(e[n],t);else if("object"===typeof e)for(var a=e,r=0,o=Object.keys(a);r<o.length;r++){var i=o[r];a[i]=np(a[i],t)}else if("string"===typeof e)return Object(Lf.d)(e,t);return e}var ap={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function rp(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}function op(e,t,n){var a={trackId:xl()(e),name:e.key||e.label},r=e.metadata&&(e.metadata.description||e.metadata.Description);r&&(a.description=r);var o=e.category||e.metadata&&e.metadata.category;a.category=o?o.split(/\s*\/\s*/):[];var i=e.storeClass;if(!e.urlTemplate){if(!i||!i.endsWith("FromConfig")){var c=e.key||e.label;return console.warn('Could not import JBrowse1 track "'.concat(c,'" because it does not have a "urlTemplate" or is not a "FromConfig" track')),Object(Ue.generateUnsupportedTrackConf)(a.name,c,a.category)}return function(e,t){var n=(e.features||[]).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.refName=e.seq_id,t.uniqueId="".concat(e.seq_id,":").concat(e.start,"-").concat(e.end,":").concat(e.name||""),t}));return t.adapter={type:"FromConfigAdapter",features:n},t.type="FeatureTrack",t}(e,a)}var s=function(e){return new URL(e,"".concat(t,"/")).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}")},l=s(e.urlTemplate);if(i){if("JBrowse/Store/SeqFeature/BAM"===i){var d={type:"BamAdapter",bamLocation:{uri:l}};return e.baiUrlTemplate?d.index={location:{uri:s(e.baiUrlTemplate)}}:e.csiUrlTemplate?d.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:d.index={location:{uri:"".concat(l,".bai")}},Object(u.a)(Object(u.a)({},a),{},{type:"AlignmentsTrack",adapter:d})}if("JBrowse/Store/SeqFeature/CRAM"===i){var f={type:"CramAdapter",cramLocation:{uri:l},sequenceAdapter:n};return e.craiUrlTemplate?f.craiLocation={uri:s(e.craiUrlTemplate)}:f.craiLocation={uri:"".concat(l,".crai")},Object(u.a)(Object(u.a)({},a),{},{type:"AlignmentsTrack",adapter:f})}if("JBrowse/Store/SeqFeature/NCList"===i)return Object(u.a)(Object(u.a)({},a),{},{type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:l}}});if("JBrowse/Store/SeqFeature/BigWig"===i||"JBrowse/Store/BigWig"===i)return e.type&&e.type.endsWith("XYPlot")?a.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(a.defaultRendering="density"),Object(u.a)(Object(u.a)({},a),{},{type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:l}}});if("JBrowse/Store/SeqFeature/VCFTabix"===i){var p={type:"VcfTabixAdapter",vcfGzLocation:{uri:l}};return e.tbiUrlTemplate?p.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?p.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:p.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},a),{},{type:"VariantTrack",adapter:p})}if("JBrowse/Store/SeqFeature/VCFTribble"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"VCFTribble (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/GFF3"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"GFF3 (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/BigBed"===i)return Object(u.a)(Object(u.a)({},a),{},{type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:l}}});if("JBrowse/Store/SeqFeature/GFF3Tabix"===i){var m={type:"Gff3TabixAdapter",gffGzLocation:{uri:l}};return e.tbiUrlTemplate?m.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?m.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:m.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},a),{},{type:"FeatureTrack",adapter:m})}if("JBrowse/Store/SeqFeature/BED"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"BED (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/BEDTabix"===i){var g={type:"BedTabixAdapter",bedGzLocation:{uri:l}};return e.tbiUrlTemplate?g.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?g.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:g.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},a),{},{type:"FeatureTrack",adapter:g})}if("JBrowse/Store/SeqFeature/GTF"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"GTF (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/StaticChunked"===i||"JBrowse/Store/Sequence/StaticChunked"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"StaticChunked (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/UnindexedFasta"===i)return Object(Ue.generateUnsupportedTrackConf)(a.name,"UnindexedFasta (".concat(l,")"),a.category);if("JBrowse/Store/SeqFeature/IndexedFasta"===i){var h={type:"IndexedFastaAdapter",fastaLocation:{uri:l}};return e.faiUrlTemplate?h.faiLocation={uri:s(e.faiUrlTemplate)}:h.faiLocation={uri:"".concat(l,".fai")},Object(u.a)(Object(u.a)({},a),{},{type:"SequenceTrack",adapter:h})}if("JBrowse/Store/SeqFeature/BgzipIndexedFasta"===i){var b={type:"BgzipFastaAdapter",fastaLocation:{uri:l}};return e.faiUrlTemplate?b.faiLocation={uri:s(e.faiUrlTemplate)}:b.faiLocation={uri:"".concat(l,".fai")},e.gziUrlTemplate?b.gziLocation={uri:s(e.gziUrlTemplate)}:b.gziLocation={uri:"".concat(l,".gzi")},Object(u.a)(Object(u.a)({},a),{},{type:"ReferenceSequenceTrack",adapter:b})}if("JBrowse/Store/SeqFeature/TwoBit"===i)return Object(u.a)(Object(u.a)({},a),{},{type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:l}}})}if(a.adapter=Object(Ue.guessAdapter)(l,"uri"),!a.adapter)throw new Error("Could not determine adapter");return a.adapter.type===Ue.UNSUPPORTED?Object(Ue.generateUnsupportedTrackConf)(a.name,l,a.category):a.adapter.type===Ue.UNKNOWN?Object(Ue.generateUnknownTrackConf)(a.name,l,a.category):(a.type=Object(Ue.guessTrackType)(a.adapter.type),"QuantitativeTrack"===a.type&&(e.type&&e.type.endsWith("XYPlot")?a.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(a.defaultRendering="density")),a)}var ip=function(e){return b.types.compose("JBrowse1Connection",Object(Fe.BaseConnectionModelFactory)(e),b.types.model({configuration:Object(P.ConfigurationReference)(Rf),type:b.types.literal("JBrowse1Connection")}).actions((function(e){return{connect:function(){var t=Object(P.readConfObject)(e.configuration,"dataDirLocation"),n=Object(_.getSession)(e);(function(){return Uf.apply(this,arguments)})(t).then((function(t){var a=Object(P.readConfObject)(e.configuration,"assemblyName"),r=n.assemblies.find((function(e){return Object(P.readConfObject)(e,"name")===a})),o=Object(P.readConfObject)(r,["sequence","adapter"]),i=t.tracks.map((function(e){var n=op(e,t.dataRoot,o);return n.assemblyNames=[a],n}));e.setTrackConfs(i)})).catch((function(t){console.error(t),n.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'. Please make sure you have entered a valid location. The error that was thrown is: "').concat(t,'"'),"error"),n.breakConnection(e.configuration)}))}}})))},cp=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="LegacyJBrowsePlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"NCListAdapter",configSchema:Af,AdapterClass:Nf})})),e.addConnectionType((function(){return new S({name:"JBrowse1Connection",configSchema:Rf,stateModel:ip(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})}))}}]),n}(F.a),sp=n(2405),lp=n.n(sp),up=Object(re.observer)((function(e){var t=e.model,n=t.data,a=t.renderProps,r=t.renderingComponent;return t.filled?m.a.createElement(r,Object.assign({},n,a)):m.a.createElement("p",null,"Loading")})),dp=Object(Ze.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function fp(){var e=Object(p.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],r=dp();return Object(p.useEffect)((function(){var e=setTimeout((function(){return a(!0)}),300);return function(){return clearTimeout(e)}})),n?m.a.createElement("div",{"data-testid":"loading-synteny",className:r.loading},"Loading \u2026",m.a.createElement(yn.a,null)):null}function pp(e){var t=e.messageText,n=dp();return m.a.createElement("div",{className:n.blockMessage},t)}function mp(e){var t=e.error,n=dp();return m.a.createElement("div",{className:n.blockError},t.message)}var gp=Object(re.observer)((function(e){var t=e.model;return t.error?m.a.createElement(mp,{error:t.error}):t.message?m.a.createElement(pp,{messageText:t.message}):t.filled?m.a.createElement(up,{model:t}):m.a.createElement(fp,null)})),hp=function(e){var t=e.model,n=e.children;return m.a.createElement("div",null,m.a.createElement(t.ReactComponent2,e),n)};hp.defaultProps={children:null};var bp=Object(re.observer)(hp);function vp(e){return Object(P.ConfigurationSchema)("LinearComparativeDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:ze,explicitlyTyped:!0})}function yp(e){return b.types.compose("LinearComparativeDisplay",Fe.BaseDisplay,b.types.model({type:b.types.literal("LinearComparativeDisplay"),configuration:Object(P.ConfigurationReference)(e),height:100})).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,html:"",message:void 0,renderingComponent:void 0,ReactComponent2:gp}})).views((function(e){return{get rendererTypeName(){return Object(P.getConf)(e,"renderer").type},get renderProps(){return{displayModel:e}}}})).actions((function(e){var t;return{afterAttach:function(){Object(_.makeAbortableReaction)(e,wp,Op,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.html="",e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){var a=n.data,r=n.html,o=n.renderingComponent;e.filled=!0,e.message=void 0,e.html=r,e.data=a,e.error=void 0,e.renderingComponent=o,t=void 0},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.html="",e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function wp(e){var t=Object(_.getSession)(e).rpcManager,n=e,a=n.renderProps,r=n.rendererType;Object(P.readConfObject)(e.configuration);var o=e.adapterConfig,i=Object(_.getContainingView)(e),c=Object(Ue.getRpcSessionId)(e);return Object(b.getSnapshot)(i),{rendererType:r,rpcManager:t,renderProps:Object(u.a)(Object(u.a)({},a),{},{view:Object(b.getSnapshot)(i)}),renderArgs:{adapterConfig:o,rendererType:r.name,sessionId:c,timeout:1e6}}}function Op(e){return jp.apply(this,arguments)}function jp(){return(jp=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,a=t.rpcManager,r=t.renderProps,o=t.renderArgs,e.next=5,n.renderInClient(a,Object(u.a)(Object(u.a)({},o),r));case 5:return i=e.sent,s=i.html,l=Object(d.a)(i,["html"]),e.abrupt("return",{html:s,data:l,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var kp=Object(Ze.a)((function(e){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},emphasis:{background:e.palette.secondary.main,padding:e.spacing(1)},hovered:{background:e.palette.secondary.light},displayName:{background:e.palette.secondary.main,paddingTop:3,paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),Cp=Object(re.observer)((function(e){var t=e.model;return m.a.createElement(Qt.a,{onClick:t.toggleInteract,title:"Toggle interacting with the overlay"},t.interactToggled?m.a.createElement(cc.a,null):m.a.createElement(lc.a,null))})),Ep=Object(re.observer)((function(e){var t=e.model;return m.a.createElement(Qt.a,{onClick:t.toggleLinkViews,title:"Toggle linked scrolls and behavior across views"},t.linkViews?m.a.createElement(gc.a,{color:"secondary"}):m.a.createElement(bc.a,{color:"secondary"}))})),xp=Object(re.observer)((function(e){var t=e.model;return m.a.createElement(Qt.a,{onClick:t.toggleIntraviewLinks,title:"Toggle rendering intraview links"},t.showIntraviewLinks?m.a.createElement(dc.a,{color:"secondary"}):m.a.createElement(pc.a,{color:"secondary"}))})),Sp=Object(re.observer)((function(e){var t=e.model,n=e.size,a=kp();return t.setHeaderHeight(n.height),m.a.createElement("div",{className:a.headerBar},m.a.createElement(Ep,{model:t}),m.a.createElement(Cp,{model:t}),m.a.createElement(xp,{model:t}),m.a.createElement("div",{className:a.spacer}))})),Tp=Object(oc.withSize)({monitorHeight:!0})(Sp),Np=Object(Ze.a)((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:"3px",background:"magenta"},viewContainer:{marginTop:"3px"},container:{display:"grid"},overlay:{zIndex:100,gridArea:"1/1"},content:{gridArea:"1/1"}}})),Ap=Object(re.observer)((function(e){var t=e.model,n=Np();return m.a.createElement(m.a.Fragment,null,t.tracks.map((function(e){var t=Object(f.a)(e.displays,1)[0],a=t.RenderingComponent;return a?m.a.createElement("div",{className:n.overlay,key:Object(P.getConf)(e,"trackId"),style:{height:t.height}},m.a.createElement(a,{model:t})):null})))})),Rp=Object(re.observer)((function(e){var t=e.model,n=Np(),a=t.views,r=Object(b.getEnv)(t).pluginManager.getViewType(a[0].type).ReactComponent;return m.a.createElement("div",null,m.a.createElement(Tp,{model:t}),m.a.createElement("div",{className:n.container},m.a.createElement(r,{model:a[0]}),m.a.createElement("div",{style:{display:"grid"}},m.a.createElement(Ap,{model:t})),m.a.createElement(r,{model:a[1]})))})),Mp=Object(re.observer)((function(e){var t=e.model,n=Np(),a=t.views,r=Object(b.getEnv)(t).pluginManager;return m.a.createElement("div",null,m.a.createElement(Tp,{model:t}),m.a.createElement("div",{className:n.container},m.a.createElement("div",{className:n.content},m.a.createElement("div",{style:{position:"relative"}},a.map((function(e){var t=r.getViewType(e.type).ReactComponent;return m.a.createElement(t,{key:e.id,model:e})}))),m.a.createElement(Ap,{model:t}))))})),Pp=Object(re.observer)((function(e){var t=e.model;return t.tracks.some((function(e){return e.displays.some((function(e){return Object(P.getConf)(e,"middle")}))}))?m.a.createElement(Rp,{model:t}):m.a.createElement(Mp,{model:t})}));function Fp(e){var t=(0,e.jbrequire)("@jbrowse/core/util/types/mst").ElementId;return b.types.compose("LinearComparativeView",Cd.a,b.types.model({id:t,type:b.types.literal("LinearComparativeView"),height:400,displayName:"synteny detail",trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,tracks:b.types.array(e.pluggableMstType("track","stateModel")),views:b.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:b.types.array(e.pluggableConfigSchemaType("track"))})).volatile((function(){return{headerHeight:0,width:800}})).views((function(e){return{get initialized(){return e.views.length>0},get refNames(){return(e.views||[]).map((function(e){return Object(s.a)(new Set(e.staticBlocks.map((function(e){return e.refName}))))}))},get assemblyNames(){return Object(s.a)(new Set(e.views.map((function(e){return e.assemblyNames})).flat()))}}})).actions((function(t){return{afterAttach:function(){var e=this;Object(b.addDisposer)(t,Object(b.onAction)(t,(function(n){if(t.linkViews){var a=n.name,r=n.path,o=n.args;["horizontalScroll","zoomTo","setScaleFactor","showTrack","hideTrack","toggleTrack"].includes(a)&&r&&e.onSubviewAction(a,r,o)}})))},beforeDestroy:function(){var e=Object(_.getSession)(t);t.assemblyNames.forEach((function(t){var n;t.endsWith("-temp")&&(null===(n=e.removeAssembly)||void 0===n||n.call(e,t))}))},onSubviewAction:function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.views.forEach((function(t){var r=Object(b.getPath)(t);r.lastIndexOf(n)!==r.length-n.length&&t[e](a[0])}))},setWidth:function(e){t.width=e,t.views.forEach((function(t){return t.setWidth(e)}))},setHeight:function(e){t.height=e},setViews:function(e){t.views=Object(b.cast)(e)},removeView:function(e){t.views.remove(e)},closeView:function(){Object(b.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},toggleInteract:function(){t.interactToggled=!t.interactToggled},toggleIntraviewLinks:function(){t.showIntraviewLinks=!t.showIntraviewLinks},toggleLinkViews:function(){t.linkViews=!t.linkViews},activateTrackSelector:function(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));var e=Object(_.getSession)(t);if(Object(_.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},showTrack:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.pluggableConfigSchemaType("track"),o=Object(b.resolveIdentifier)(r,Object(b.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),l=o.displays.find((function(e){return s.includes(e.type)}));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));var d=i.stateModel.create(Object(u.a)(Object(u.a)({},a),{},{type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]}));t.tracks.push(d)},hideTrack:function(n){var a=e.pluggableConfigSchemaType("track"),r=Object(b.resolveIdentifier)(a,Object(b.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===r}));return Object(le.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length}}})).views((function(e){return{get menuItems(){var t=[];return e.views.forEach((function(e,n){e.menuItems&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems})})),t.push({label:"Open track selector",onClick:e.activateTrackSelector,icon:Ft}),t}}}))}var Ip=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearComparativeView",stateModel:t(Fp),ReactComponent:Pp})};function Bp(e){return b.types.compose("LinearSyntenyDisplay",yp(e),b.types.model({type:b.types.literal("LinearSyntenyDisplay"),configuration:Object(P.ConfigurationReference)(e)})).views((function(e){return{get highResolutionScaling(){return 1},get renderProps(){var t=Object(_.getContainingView)(e);return{displayModel:e,config:Object(P.getConf)(e,"renderer"),width:t.width,height:100}},get rendererTypeName(){return e.configuration.renderer.type},get adapterConfig(){return Object(u.a)({name:e.parentTrack.configuration.adapter.type,assemblyNames:Object(P.getConf)(e,"assemblyNames")},Object(P.getConf)(e.parentTrack,"adapter"))},get trackIds(){return Object(P.getConf)(e,"trackIds")}}}))}var Lp=c.a.mark(Vp);function Dp(e,t){return e?5:t-5}function Vp(){var e,t,n,a,r,o,i,s=arguments;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:e=s.length>0&&void 0!==s[0]?s[0]:[],t=s.length>1&&void 0!==s[1]?s[1]:[],n=s.length>2?s[2]:void 0,a=0,r=0;case 5:if(!(a<e.length&&r<t.length)){c.next=22;break}if(o=n(e[a]),i=n(t[r]),!(o<i)){c.next=12;break}a++,c.next=20;break;case 12:if(!(i<o)){c.next=16;break}r++,c.next=20;break;case 16:return c.next=18,[e[a],t[r]];case 18:a++,r++;case 20:c.next=5;break;case 22:case"end":return c.stop()}}),Lp)}var Wp=[0,1,2,3],qp=Wp[0],zp=Wp[2],Hp=o.parseCigar;function _p(e,t){return(e.bpToPx(t)||{}).offsetPx||0}var Up=Object(re.observer)((function(e){var t=Object(p.useRef)(null),n=e.height,a=e.width,r=e.displayModel,o=void 0===r?{}:r,i=e.highResolutionScaling,c=void 0===i?1:i,s=e.features,l=(e.trackIds,Object(p.useMemo)((function(){return s.map((function(e){return e.map((function(e){return new U.a(e)})).sort((function(e,t){return e.get("syntenyId")-t.get("syntenyId")}))}))}),[s])),u=Object(_.getContainingView)(o).views,d=function(e){for(var t=[],n=0;n<e.length;n++)for(var a=n;a<e.length;a++)if(n!==a){var r,o=Object(He.a)(Vp(e[n],e[a],(function(e){return e.get("syntenyId")})));try{for(o.s();!(r=o.n()).done;){var i=Object(f.a)(r.value,2),c=i[0],s=i[1];t.push([{feature:c,level:n,refName:c.get("refName"),layout:[c.get("start"),0,c.get("end"),10]},{feature:s,level:a,refName:s.get("refName"),layout:[s.get("start"),0,s.get("end"),10]}])}}catch(l){o.e(l)}finally{o.f()}}return t}(l),g=u.map((function(e){return e.offsetPx}));return Object(p.useEffect)((function(){if(t.current){var e=t.current.getContext("2d");if(e){e.clearRect(0,0,a,n),e.scale(c,c),e.fillStyle=Object(P.getConf)(o,["renderer","color"]),e.strokeStyle=Object(P.getConf)(o,["renderer","color"]);d.forEach((function(t){for(var a=0;a<t.length-1;a+=1){var r=t[a],o=r.layout,i=r.feature,c=r.level,s=r.refName,l=t[a+1],d=l.layout,f=l.feature,p=l.level,m=l.refName,h=u[c],b=u[p];if(!o||!d)return void console.warn("received null layout for a overlay feature");if(c!==p){var v=i.get("end")-i.get("start"),y=f.get("end")-f.get("start");v<h.bpPerPx||b.bpPerPx,0;var w=_p(h,{refName:s,coord:o[qp]})-g[c],O=_p(h,{refName:s,coord:o[zp]})-g[c],j=_p(b,{refName:m,coord:d[qp]})-g[p],k=_p(b,{refName:m,coord:d[zp]})-g[p],C=Dp(c<p,n),E=Dp(p<c,n);if(v<h.bpPerPx||y<b.bpPerPx)e.beginPath(),e.moveTo(w,C),e.lineTo(j,E),e.stroke();else{var x=w,S=j,T=w<O?1:-1,N=j<k?1:-1,A=i.get("cg")||i.get("CIGAR");if(A)for(var R=Hp(A),M=0;M<R.length;M+=2){var P=+R[M],F=R[M+1],I=x,B=S;"M"===F||"="===F?(e.fillStyle="#f003",x+=P/u[0].bpPerPx*T,S+=P/u[1].bpPerPx*N):"X"===F?(e.fillStyle="brown",x+=P/u[0].bpPerPx*T,S+=P/u[1].bpPerPx*N):"D"===F?(e.fillStyle="#00f3",x+=P/u[0].bpPerPx*T):"N"===F?(e.fillStyle="#0a03",x+=P/u[0].bpPerPx*T):"I"===F&&(e.fillStyle="#ff03",S+=P/u[1].bpPerPx*N),e.beginPath(),e.moveTo(I,C),e.lineTo(x,C),e.lineTo(S,E),e.lineTo(B,E),e.closePath(),e.fill()}else e.beginPath(),e.moveTo(w,C),e.lineTo(O,C),e.lineTo(k,E),e.lineTo(j,E),e.closePath(),e.fill()}}}}))}}})),m.a.createElement("canvas",{ref:t,"data-testid":"synteny_canvas",width:a,height:n})})),Gp=Object(P.ConfigurationSchema)("LinearSyntenyRenderer",{color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"rgb(255,100,100,0.3)"}},{explicitlyTyped:!0}),Jp=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,d=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,a=t.view.views,r=a.map((function(e){var t=Ut.a.create(e);return t.setVolatileWidth(n),t})),e.next=4,Promise.all(r.map((function(e){return d.getFeatures(Object(u.a)(Object(u.a)({},t),{},{regions:e.staticBlocks.contentBlocks}))})));case 4:for(o=e.sent,i=JSON.parse(JSON.stringify(o)),s=0;s<i.length;s++)for(l=0;l<i[s].length;l++)i[s][l]._level=s;return e.abrupt("return",{features:i});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderInWorker",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deserializeArgsInWorker(t),e.next=3,this.render(t);case 3:return n=e.sent,this.serializeResultsInWorker(),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(kd),Qp=Object(Ze.a)((function(e){return{importFormContainer:{padding:e.spacing(4)},importFormEntry:{minWidth:180},errorMessage:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},formPaper:{maxWidth:600,margin:"0 auto",padding:12,marginBottom:10}}})),Xp=Object(re.observer)((function(e){var t=e.model,n=e.selected,a=e.onChange,r=e.error,o=Qp(),i=Object(_.getSession)(t).assemblyNames;return m.a.createElement(ba.a,{container:!0,item:!0,justify:"center",spacing:2,alignItems:"center"},m.a.createElement(dn.a,{select:!0,variant:"outlined",value:i[n]?n:"",onChange:function(e){a(Number(e.target.value))},error:Boolean(r),disabled:Boolean(r),className:o.importFormEntry},i.map((function(e,t){return m.a.createElement(va.a,{key:e,value:t},e)}))))})),Yp=Object(re.observer)((function(e){var t=e.model,n=Qp(),a=Object(p.useState)([0,0]),r=Object(f.a)(a,2),o=r[0],i=r[1],u=Object(p.useState)(2),d=Object(f.a)(u,1)[0],g=Object(p.useState)({uri:""}),h=Object(f.a)(g,2),v=h[0],y=h[1],w=Object(_.getSession)(t),O=w.assemblyNames,j=O.length?"":"No configured assemblies";function k(){return(k=Object(l.a)(c.a.mark((function e(){var n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.assemblyManager,e.t0=t,e.next=4,Promise.all(o.map(function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.waitForAssembly(O[t]);case 2:if(!(a=e.sent)){e.next=5;break}return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:Object(b.getSnapshot)(a.regions)});case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).filter((function(e){return!!e})));case 4:e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),t.views.forEach((function(e){return e.setWidth(t.width)})),"uri"in v&&(a=v.uri?v.uri.slice(v.uri.lastIndexOf("/")+1):null,r=w.addTrackConf({trackId:"fileName-".concat(Date.now()),name:a,assemblyNames:o.map((function(e){return O[e]})),type:"SyntenyTrack",adapter:{type:"PAFAdapter",pafLocation:v,assemblyNames:o.map((function(e){return O[e]}))}}),t.toggleTrack(r.trackId));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return m.a.createElement(ha.a,{className:n.importFormContainer},j?m.a.createElement(Je.a,{color:"error"},j):m.a.createElement(m.a.Fragment,null,m.a.createElement(nn.a,{className:n.formPaper},m.a.createElement(ba.a,{container:!0,item:!0,justify:"center",spacing:4,alignItems:"center"},m.a.createElement(ba.a,{item:!0},m.a.createElement("p",{style:{textAlign:"center"}},"Select assemblies for synteny view"),Object(s.a)(new Array(d)).map((function(e,n){return m.a.createElement(Xp,{key:"row_".concat(n,"_").concat(o[n]),error:j,selected:o[n],onChange:function(e){var t=o.slice(0);t[n]=e,i(t)},model:t})}))))),m.a.createElement(nn.a,{className:n.formPaper},m.a.createElement(ba.a,{container:!0,justify:"center"},m.a.createElement("p",{style:{textAlign:"center"}},m.a.createElement("b",null,"Optional"),": Add a PAF"," ",m.a.createElement("a",{href:"https://github.com/lh3/miniasm/blob/master/PAF.md"},"(pairwise mapping format)")," ","file for the linear synteny view. Note that the first assembly should be the left column of the PAF and the second assembly should be the right column"),m.a.createElement(ba.a,{item:!0},m.a.createElement(ue.FileSelector,{name:"URL",description:"",location:v,setLocation:function(e){return y(e)}})))),m.a.createElement(ba.a,{container:!0,justify:"center"},m.a.createElement(ba.a,{item:!0},m.a.createElement(Ge.a,{onClick:function(){return k.apply(this,arguments)},variant:"contained",color:"primary"},"Open")))))})),Kp=Object(re.observer)((function(e){var t=e.model;return t.initialized?m.a.createElement(Pp,{model:t}):m.a.createElement(Yp,{model:t})}));function Zp(e){return b.types.compose(Fp(e),b.types.model("LinearSyntenyView",{type:b.types.literal("LinearSyntenyView")}))}var $p=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearSyntenyView",stateModel:t(Zp),ReactComponent:Kp})},em=n(1003),tm=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r;Object(g.a)(this,n),(r=t.call(this,e)).cache=new Pd.a({cache:new Fd({maxSize:1}),fill:function(){return r.setup()}}),r.initialized=!1,r.geneNameToRows={},r.rowToGeneName=[],r.subadapters=void 0,r.assemblyNames=void 0,r.mcscanAnchorsLocation=void 0;var o=Object(P.readConfObject)(e,"subadapters"),i=Object(P.readConfObject)(e,"assemblyNames");return r.mcscanAnchorsLocation=Object(oe.openLocation)(Object(P.readConfObject)(e,"mcscanAnchorsLocation")),r.subadapters=o.map((function(t){var n=null===a||void 0===a?void 0:a(t).dataAdapter;if(n instanceof H.BaseFeatureDataAdapter)return n;throw new Error("invalid subadapter type '".concat(e.subadapter.type,"'"))})),r.assemblyNames=i,r}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=6;break}return e.next=3,this.mcscanAnchorsLocation.readFile("utf8");case 3:e.sent.split("\n").forEach((function(e,n){if(e.length&&"###"!==e){var a=e.split("\t"),r=Object(f.a)(a,3),o=r[0],i=r[1],c=r[2];void 0===t.geneNameToRows[o]&&(t.geneNameToRows[o]=[]),void 0===t.geneNameToRows[i]&&(t.geneNameToRows[i]=[]),t.geneNameToRows[o].push(n),t.geneNameToRows[i].push(n),t.rowToGeneName[n]={name1:o,name2:i,score:+c}}})),this.initialized=!0;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.cache.get("initialize",n,n.signal);case 2:if(-1===(o=t.assemblyNames.indexOf(e.assemblyName))){a.next=7;break}return i=t.subadapters[o].getFeatures(e),a.next=7,i.pipe(Object(em.a)((function(e){(t.geneNameToRows[e.get("name")]||[]).forEach((function(t){r.next(new U.a(Object(u.a)(Object(u.a)({},e.toJSON()),{},{syntenyId:t})))}))}))).toPromise();case 7:r.complete();case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter);tm.capabilities=["getFeatures","getRefNames"];var nm=Object(P.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors"}},subadapters:{type:"frozen",defaultValue:[]},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),am=o.parseCigar;function rm(e){for(var t=am(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"D"!==o&&"N"!==o&&(n+=r)}return n}function om(e){for(var t=am(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"H"!==o&&"S"!==o&&"D"!==o&&"N"!==o&&(n+=r)}return n}function im(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}var cm=Object(Ze.a)((function(e){return{root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function sm(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function lm(e){var t=cm(),n=e.track,a=e.display.feature,r=e.handleClose,o=Object(p.useState)("0"),i=Object(f.a)(o,2),d=i[0],g=i[1],h=Object(p.useState)(),b=Object(f.a)(h,2),v=b[0],y=b[1],w=+d,O=Object(p.useState)(),j=Object(f.a)(O,2),k=j[0],C=j[1],E=Object(p.useState)(!1),x=Object(f.a)(E,2),S=x[0],T=x[1];return Object(p.useEffect)((function(){var e=!1;return Object(l.a)(c.a.mark((function t(){var r,o,i,s,l,u,d,p,m,g,h,b;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(2048&a.get("flags"))){t.next=14;break}return r=sm(a,"SA")||"",o=r.split(";")[0],i=o.split(","),s=Object(f.a)(i,2),l=s[0],u=s[1],d=Object(_.getSession)(n),p=d.rpcManager,m=Object(P.getConf)(n,"adapter"),g=Object(Ue.getRpcSessionId)(n),t.next=9,p.call(g,"CoreGetFeatures",{adapterConfig:m,sessionId:g,region:{refName:l,start:+u-1,end:+u}});case 9:h=t.sent,b=h.find((function(e){return e.get("name")===a.get("name")&&!(2048&e.get("flags"))})),e||C(b),t.next=15;break;case 14:C(a);case 15:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[a,n]),m.a.createElement(Gt.a,{open:!0,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Set window size",m.a.createElement(Qt.a,{"aria-label":"close",className:t.closeButton,onClick:r},m.a.createElement($t.a,null))),m.a.createElement(Yt.a,null,k?m.a.createElement("div",{className:t.root},m.a.createElement(Je.a,null,"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."),v?m.a.createElement(Je.a,{color:"error"},"".concat(v)):null,m.a.createElement(dn.a,{value:d,onChange:function(e){g(e.target.value)},label:"Set window size"}),m.a.createElement(ei.a,{control:m.a.createElement(ti.a,{checked:S,onChange:function(){return T((function(e){return!e}))}}),label:"Show qual track"}),m.a.createElement(Ge.a,{variant:"contained",color:"primary",style:{marginLeft:20},onClick:function(){try{var e,t=k||a,o=Object(_.getSession)(n),i=Object(_.getContainingView)(n),c=t.get("CIGAR"),l=im(c,1),d=t.get("flags"),p=t.get("qual"),m=sm(t,"SA")||"",g=t.get("name"),h="".concat(g,"_assembly-temp"),b=Object(P.getConf)(n,"assemblyNames"),v=Object(f.a)(b,1)[0],O=[v,h],j="track-".concat(Date.now()),C="".concat(g,"_vs_").concat(v),E=o.assemblyManager.get(v),x=m.split(";").filter((function(e){return!!e})).map((function(e,n){var a=e.split(","),r=Object(f.a)(a,4),o=r[0],i=r[1],c=r[2],s=r[3],l=function(e){for(var t=am(e),n=0,a=0;a<t.length;a+=2){var r=+t[a],o=t[a+1];"H"!==o&&"S"!==o&&"I"!==o&&(n+=r)}return n}(s),u=rm(s),d=om(s),p="-"===c?-1:1,m=im(s,1),h=+i-1;return{refName:o,start:h,end:h+l,seqLength:u,clipPos:m,CIGAR:s,assemblyName:v,strand:p,uniqueId:"".concat(t.id(),"_SA").concat(n),mate:{start:m,end:m+d,refName:g}}})),T=t.toJSON();T.clipPos=l,T.mate={refName:g,start:l,end:l+om(c)};var N=rm(2048&d?x[0].CIGAR:c),A=[T].concat(Object(s.a)(x));A.forEach((function(e,t){e.refName=(null===E||void 0===E?void 0:E.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),A.sort((function(e,t){return e.clipPos-t.clipPos}));var R=t.get("seq"),M=A.concat(A.map((function(e){return e.mate}))),F=2*w,I=A.reduce((function(e,t){return e+t.end-t.start+F}),0),B="".concat(g,"_").concat(Date.now()),L=Object(P.getConf)(E,"sequence"),D=A.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.max(0,e.start-w),end:e.end+w,assemblyName:v})})).sort((function(e,t){return e.clipPos-t.clipPos}));null===(e=o.addAssembly)||void 0===e||e.call(o,{name:"".concat(h),sequence:{type:"ReferenceSequenceTrack",trackId:B,assemblyNames:[h],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:N,seq:R,refName:g,uniqueId:"".concat(Math.random())}]}}}),o.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:I/i.width,displayedRegions:D,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[v],configuration:L.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!1,showTranslation:!1,height:35,configuration:"".concat(B,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:N/i.width,displayedRegions:[{assemblyName:h,start:0,end:N,refName:g}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:B,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!1,showTranslation:!1,height:35,configuration:"".concat(B,"-LinearReferenceSequenceDisplay")}]}].concat(Object(s.a)(S?[{id:"".concat(Math.random()),type:"QuantitativeTrack",configuration:{trackId:"qualTrack",assemblyNames:[h],name:"Read quality",type:"QuantitativeTrack",adapter:{type:"FromConfigAdapter",noAssemblyManager:!0,features:p.split(" ").map((function(e,t){return{start:t,end:t+1,refName:g,score:+e,uniqueId:"feat_".concat(t)}}))}},displays:[{id:"".concat(Math.random()),type:"LinearWiggleDisplay",height:100}]}]:[]))}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:O,adapter:{type:"FromConfigAdapter",features:M},trackId:j,name:C}],tracks:[{configuration:j,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(j,"-LinearSyntenyDisplay")}]}],displayName:"".concat(g," vs ").concat(v)}),r()}catch(V){console.error(V),y(V)}}},"Submit")):m.a.createElement("div",null,m.a.createElement(Je.a,null,"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."),m.a.createElement(un.a,null))))}var um=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="LinearComparativeViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(Ip)})),e.addViewType((function(){return e.jbrequire($p)})),e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e)});return new w.a({name:"SyntenyTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"SyntenyTrack",t)})})),e.addDisplayType((function(){var t=vp(e);return new O.a({name:"LinearComparativeDisplay",configSchema:t,stateModel:yp(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:bp})})),e.addDisplayType((function(){var t=function(e){return Object(P.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},renderer:b.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"LinearSyntenyRenderer"}),middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:vp(e),explicitlyTyped:!0})}(e);return new O.a({name:"LinearSyntenyDisplay",configSchema:t,stateModel:Bp(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:bp})})),e.addAdapterType((function(){return new y.a({name:"MCScanAnchorsAdapter",configSchema:nm,AdapterClass:tm})})),e.addRendererType((function(){return new Jp({name:"LinearSyntenyRenderer",configSchema:Gp,ReactComponent:Up,pluginManager:e})}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Linear synteny view",icon:lp.a,onClick:function(e){e.addView("LinearSyntenyView",{})}});var t=function(e,t){return e?[{label:"Linear read vs ref",icon:ps.a,onClick:function(){Object(_.getContainingTrack)(t).setDialogComponent(lm,{feature:e})}}]:[]};function n(e){return e.additionalContextMenuItemCallbacks.includes(t)}function a(e){e.addAdditionalContextMenuItemCallback(t)}function r(e){"LinearGenomeView"===e.type&&e.tracks.forEach((function(e){"AlignmentsTrack"===e.type&&e.displays.forEach((function(e){"LinearPileupDisplay"!==e.type||n(e)?"LinearAlignmentsDisplay"===e.type&&e.PileupDisplay&&!n(e.PileupDisplay)&&a(e.PileupDisplay):a(e)}))}))}Object(le.autorun)((function(){var t,n=null===(t=e.rootModel)||void 0===t?void 0:t.session;n&&n.views.forEach((function(e){e.views?e.views.forEach((function(e){return r(e)})):r(e)}))}))}}]),n}(F.a);function dm(e){return b.types.compose("LinearLollipopDisplay",St,b.types.model({type:b.types.literal("LinearLollipopDisplay"),configuration:Object(Tt.a)(e)})).views((function(e){return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(Ue.getParentRenderProps)(e)),{},{config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var fm=n(386);function pm(e){var t=e.feature,n=e.config,a=e.layoutRecord,r=a.y,o=a.data,i=o.anchorX,c=o.radiusPx,s=o.score,l=Object(P.readConfObject)(n,"innerColor",{feature:t}),u=String(s),d=1.1*(2*c/u.length);return d<12?null:m.a.createElement("text",{style:{fontSize:d,fill:Object(fm.contrastingTextColor)(l)},x:i,y:r+c-d/2.4,textAnchor:"middle",dominantBaseline:"hanging"},u)}function mm(e){var t=function(t){var n=e.onFeatureMouseDown,a=e.feature;if(n)return n(t,a.id())},n=function(t){var n=e.onFeatureMouseEnter,a=e.feature;if(n)return n(t,a.id())},a=function(t){var n=e.onFeatureMouseOut,a=e.feature;if(n)return n(t,a.id())},r=function(t){var n=e.onFeatureMouseOver,a=e.feature;if(n)return n(t,a.id())},o=function(t){var n=e.onFeatureMouseUp,a=e.feature;if(n)return n(t,a.id())},i=function(t){var n=e.onFeatureMouseLeave,a=e.feature;if(n)return n(t,a.id())},c=function(t){var n=e.onFeatureMouseMove,a=e.feature;if(n)return n(t,a.id())},s=function(t){var n=e.onFeatureClick,a=e.feature;if(n)return t.stopPropagation(),n(t,a.id())},l=e.feature,u=e.config,d=e.layoutRecord,f=d.anchorLocation,p=d.y,g=d.data,h=g.radiusPx,b=g.score,v=e.selectedFeatureId,y={fill:Object(P.readConfObject)(u,"strokeColor",{feature:l})};String(v)===String(l.id())&&(y.fill="red");var w={fill:Object(P.readConfObject)(u,"innerColor",{feature:l})},O=Object(P.readConfObject)(u,"strokeWidth",{feature:l});return m.a.createElement("g",{"data-testid":l.id()},m.a.createElement("title",null,Object(P.readConfObject)(u,"caption",{feature:l})),m.a.createElement("circle",{cx:f,cy:p+h,r:h,style:y,onMouseDown:t,onMouseEnter:n,onMouseOut:a,onMouseOver:r,onMouseUp:o,onMouseLeave:i,onMouseMove:c,onClick:s,onFocus:r,onBlur:a}),h-O<=2?null:m.a.createElement("circle",{cx:f,cy:p+h,r:h-O,style:w,onMouseDown:t,onMouseEnter:n,onMouseOut:a,onMouseOver:r,onMouseUp:o,onMouseLeave:i,onMouseMove:c,onClick:s,onFocus:r,onBlur:a}),m.a.createElement(pm,Object.assign({},e,{score:b})))}mm.defaultProps={selectedFeatureId:void 0,onFeatureMouseDown:void 0,onFeatureMouseEnter:void 0,onFeatureMouseOut:void 0,onFeatureMouseOver:void 0,onFeatureMouseUp:void 0,onFeatureMouseLeave:void 0,onFeatureMouseMove:void 0,onFeatureClick:void 0};var gm=Object(re.observer)(mm);function hm(e){var t=e.feature,n=e.config,a=e.layoutRecord,r=a.anchorLocation,o=a.y,i=a.data.radiusPx,c=e.selectedFeatureId,s={fill:Object(P.readConfObject)(n,"bodyColor",{feature:t})};return String(c)===String(t.id())&&(s.fill="red"),m.a.createElement("line",{x1:r,y1:0,x2:r,y2:o+2*i,stroke:Object(P.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:Object(P.readConfObject)(n,"stickWidth",{feature:t})})}hm.defaultProps={selectedFeatureId:void 0};var bm=Object(re.observer)(hm);function vm(e){var t=function(t){var n=e.onMouseEnter;if(n)return n(t)},n=function(t){var n=e.onMouseLeave;if(n)return n(t)};function a(e){var t=e.feature,n=e.bpPerPx,a=e.region,r=e.layout,o=Math.abs(t.get("end")+t.get("start"))/2,i=Object(_.bpToPx)(o,a,n),c=Object(P.readConfObject)(e.config,"radius",{feature:t});c||console.error(new Error("lollipop radius ".concat(c," configured for feature ").concat(t.id()))),r.add(t.id(),i,2*c,2*c,{featureId:t.id(),anchorX:i,radiusPx:c,score:Object(P.readConfObject)(e.config,"score",{feature:t})})}var r,o=e.regions,i=e.bpPerPx,c=e.layout,s=e.config,l=e.features,u=e.displayModel.selectedFeatureId,d=Object(f.a)(o,1)[0],p=[],g=[],h=Object(He.a)(l.values());try{for(h.s();!(r=h.n()).done;){a({feature:r.value,bpPerPx:i,region:d,config:s,layout:c})}}catch(S){h.e(S)}finally{h.f()}var b,v=Object(He.a)(c.getLayout(s).values());try{for(v.s();!(b=v.n()).done;){var y=b.value,w=l.get(y.data.featureId);g.push(m.a.createElement(bm,Object.assign({},e,{layoutRecord:y,feature:w,key:"stick-".concat(w.id()),selectedFeatureId:u})))}}catch(S){v.e(S)}finally{v.f()}var O,j=Object(He.a)(c.getLayout(s).values());try{for(j.s();!(O=j.n()).done;){var k=O.value,C=l.get(k.data.featureId);g.push(m.a.createElement(gm,Object.assign({},e,{layoutRecord:k,feature:C,key:"body-".concat(C.id()),selectedFeatureId:u})))}}catch(S){j.e(S)}finally{j.f()}var E=(d.end-d.start)/i,x=c.getTotalHeight();return m.a.createElement("svg",{className:"LollipopRendering",width:E,height:x,style:{position:"relative"},onMouseDown:function(t){var n=e.onMouseDown;if(n)return n(t)},onMouseUp:function(t){var n=e.onMouseUp;if(n)return n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:function(t){var n=e.onMouseOver;if(n)return n(t)},onMouseOut:function(t){var n=e.onMouseOut;if(n)return n(t)},onFocus:t,onBlur:n,onClick:function(t){var n=e.onClick;if(n)return n(t)}},p,g)}vm.defaultProps={displayModel:{},features:new Map,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onClick:void 0};var ym=Object(re.observer)(vm),wm=Object(P.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0}),Om=n(1012),jm=function(){function e(t){var n=t.width;if(Object(g.a)(this,e),this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!n)throw new Error("width required to make a new FloatingLayout");this.width=n}return Object(h.a)(e,[{key:"add",value:function(e,t,n,a,r){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:a,data:r}),this.layoutDirty=!0}},{key:"getLayout",value:function(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");for(var t=Object(P.readConfObject)(e,"minStickLength"),n=this.items.sort((function(e,t){return e.data.score-t.data.score})),a=0,r=Array(n.length),o=0;o<n.length;o+=1){for(var i=n[o],c=i.anchorLocation,s=i.width,l=i.height,d=c-s/2,p=d+s,m=t,g=m+l,h=0;h<o;h+=1){var b=Object(f.a)(r[h],2)[1],v=b.x,y=b.y,w=v+b.width,O=y+b.height;Object(hi.a)(v,w,d,p)&&Object(hi.a)(y,O,m,g)&&(g=(m=O)+l,h=-1)}r[o]=[i.uniqueId,Object(u.a)(Object(u.a)({},i),{},{x:d,y:m})],g>a&&(a=g)}return this.totalHeight=a,this.layout=new Map(r),this.layoutDirty=!1,this.layout}},{key:"getTotalHeight",value:function(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}},{key:"serializeRegion",value:function(){return this.toJSON()}},{key:"toJSON",value:function(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:Object(s.a)(this.getLayout()),totalHeight:this.getTotalHeight()}}}],[{key:"fromJSON",value:function(){throw new Error("not supported")}}]),e}(),km=function(){function e(t){var n=t.pairs,a=t.totalHeight;Object(g.a)(this,e),this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(n),this.totalHeight=a}return Object(h.a)(e,[{key:"add",value:function(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}},{key:"getLayout",value:function(){return this.layout}},{key:"getTotalHeight",value:function(){return this.totalHeight}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}(),Cm=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"makeLayout",value:function(){var e=this.regions[0],t=(e.end-e.start)/this.bpPerPx;return new Om.a(jm,{width:t})}},{key:"layoutIsValid",value:function(){return!1}}]),n}(gi.a),Em=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"createSession",value:function(e){return new Cm(e)}},{key:"deserializeLayoutInClient",value:function(e){return new km(e)}}]),n}(gi.b),xm=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="LollipopPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new Em({name:"LollipopRenderer",ReactComponent:ym,configSchema:wm,pluginManager:e})})),e.addDisplayType((function(){var t=function(e){return Object(P.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:ze,explicitlyTyped:!0})}(e);return new O.a({name:"LinearLollipopDisplay",configSchema:t,stateModel:dm(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:dt})}))}}]),n}(F.a),Sm=n(1316),Tm=n.n(Sm),Nm=n(995),Am=n.n(Nm),Rm=n(2410),Mm=n.n(Rm),Pm=n(2411),Fm=n.n(Pm),Im=Object(Ze.a)((function(e){return{root:{margin:e.spacing(2),paddingTop:e.spacing(2)},subtitle:{margin:e.spacing()},pluginList:{margin:e.spacing(1),marginTop:e.spacing(5)}}}));var Bm=Object(re.observer)((function(e){var t=e.model,n=Im(),a={version:"",pluginManager:{plugins:[],pluginMetaData:{}}},r=(t?Object(b.getEnv)(t):a).pluginManager,o=r.plugins,i=o.filter((function(e){var t;return Boolean(null===(t=r.pluginMetaData[e.name])||void 0===t?void 0:t.isCore)})).map((function(e){return e.name})),c=o.filter((function(e){return i.includes(e.name)})).map((function(e){return m.a.createElement("li",{key:e.name},e.name," ",e.version||"")})),s=o.filter((function(e){return!i.includes(e.name)})).map((function(e){var t="".concat(e.name," ").concat(e.version||"");return m.a.createElement("li",{key:e.name},e.url?m.a.createElement(no.a,{target:"_blank",rel:"noopener noreferrer",href:e.url},t):t)}));return m.a.createElement("div",{className:n.root},m.a.createElement(Je.a,{variant:"h4",align:"center",color:"primary"},"JBrowse 2"),m.a.createElement(Je.a,{variant:"h6",align:"center",className:n.subtitle},t?Object(_.getSession)(t).version:a.version),m.a.createElement(Je.a,{align:"center",variant:"body2"},"JBrowse is a"," ",m.a.createElement(no.a,{href:"http://gmod.org/",target:"_blank",rel:"noopener noreferrer"},"GMOD")," ","project"),m.a.createElement("br",null),m.a.createElement(Je.a,{align:"center"},"\xa9 2019-2021 The Evolutionary Software Foundation"),m.a.createElement("div",{className:n.pluginList},s.length?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{variant:"h6"},"External plugins loaded"),m.a.createElement("ul",null,s)):null,c.length?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,{variant:"h6"},"Core plugins loaded"),m.a.createElement("ul",null,c)):null))})),Lm=Object(P.ConfigurationSchema)("AboutWidget",{}),Dm=b.types.model("AboutWidget",{id:Ie.ElementId,type:b.types.literal("AboutWidget")}),Vm=Object(Ze.a)((function(e){return{root:{margin:e.spacing(2),fontSize:"1.2em"},subtitle:{margin:e.spacing()}}}));var Wm=Object(re.observer)((function(e){var t=e.model,n=Vm(),a=t?Object(_.getSession)(t):{version:""};return m.a.createElement("div",{className:n.root},m.a.createElement(Je.a,{variant:"h4",align:"center",color:"primary"},"JBrowse 2"),m.a.createElement(Je.a,{variant:"h6",align:"center",className:n.subtitle},a.version),m.a.createElement("p",null,"Here are some resources to get help. Please report the version number above when asking questions. Thanks!"),m.a.createElement("ul",null,m.a.createElement("li",null,m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/discussions",target:"_blank",rel:"noopener noreferrer"},"Question & answer forum")),m.a.createElement("li",null,m.a.createElement(no.a,{href:"https://github.com/GMOD/jbrowse-components/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"Report a bug")),m.a.createElement("li",null,m.a.createElement(no.a,{href:"https://jbrowse.org/jb2/docs/user_guide",target:"_blank",rel:"noopener noreferrer"},"User guide")),m.a.createElement("li",null,m.a.createElement(no.a,{href:"https://jbrowse.org/jb2/docs/",target:"_blank",rel:"noopener noreferrer"},"Documentation"))))})),qm=Object(P.ConfigurationSchema)("HelpWidget",{}),zm=b.types.model("HelpWidget",{id:Ie.ElementId,type:b.types.literal("HelpWidget")}),Hm=n(2446),_m=n(2407),Um=n.n(_m),Gm=n(2408),Jm=n.n(Gm),Qm=512*Math.pow(1024,2);function Xm(e,t){return function(n){return t[n[e]]}}var Ym=Object(Ze.a)((function(e){return{root:{margin:e.spacing(1)},paper:{display:"flex",flexDirection:"column"},dropZone:{textAlign:"center",margin:e.spacing(2),padding:e.spacing(2),borderWidth:2,borderRadius:2,borderColor:Xm("isDragActive",{true:e.palette.secondary.light,false:e.palette.divider}),borderStyle:"dashed",backgroundColor:Xm("isDragActive",{true:Object(an.fade)(e.palette.text.primary,e.palette.action.hoverOpacity),false:e.palette.background.default}),outline:"none",transition:"border .24s ease-in-out","&:focus":{borderColor:e.palette.secondary.light}},uploadIcon:{color:e.palette.text.secondary},rejectedFiles:{marginTop:e.spacing(4)},listItem:{padding:e.spacing(0,4)},expandIcon:{color:"#FFFFFF"},error:{margin:e.spacing(2)},errorHeader:{background:e.palette.error.light,color:e.palette.error.contrastText,padding:e.spacing(2),textAlign:"center"},errorMessage:{padding:e.spacing(2)}}}));var Km=Object(re.observer)((function(e){var t=Object(p.useState)(""),n=Object(f.a)(t,2),a=n[0],r=n[1],o=e.model,i=Object(Hm.a)({accept:"application/json",maxSize:Qm,multiple:!1,onDrop:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a,i,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.length){e.next=3;break}return t.length||n.length>1?r("Only one session at a time may be imported"):n[0].size>Qm?r("File size is too large (".concat(Math.round(n[0].size/Math.pow(1024,2))," MiB), max size is ").concat(Qm/Math.pow(1024,2)," MiB")):"application/json"!==n[0].type?r("File does not appear to be JSON"):r("Unknown file import error"),e.abrupt("return");case 3:return a=Object(f.a)(t,1),i=a[0],s=Object(oe.openLocation)({blob:i}),e.prev=5,e.next=8,s.readFile("utf8");case 8:l=e.sent,e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(5),console.error(e.t0),r("Problem opening file ".concat(i.path,": ").concat(e.t0)),e.abrupt("return");case 16:try{u=JSON.parse(l).session}catch(c){console.error(c),u={error:"Error parsing ".concat(i.path,": ").concat(c)}}d=Object(_.getSession)(o);try{d.setSession(u)}catch(c){console.error(c),r("Error activating session: ".concat(c," "))}case 19:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()}),s=i.getRootProps,u=i.getInputProps,d=i.isDragActive,g=Ym({isDragActive:d});return m.a.createElement("div",{className:g.root},m.a.createElement(nn.a,{className:g.paper},m.a.createElement("div",s({className:g.dropZone}),m.a.createElement("input",u()),m.a.createElement(Um.a,{className:g.uploadIcon,fontSize:"large"}),m.a.createElement(Je.a,{color:"textSecondary",align:"center",variant:"body1"},"Drag and drop files here"),m.a.createElement(Je.a,{color:"textSecondary",align:"center",variant:"body2"},"or"),m.a.createElement(Ge.a,{color:"primary",variant:"contained"},"Browse Files"))),a?m.a.createElement(nn.a,{className:g.error},m.a.createElement("div",{className:g.errorHeader},m.a.createElement(Jm.a,{color:"inherit",fontSize:"large"}),m.a.createElement("div",null,m.a.createElement(Je.a,{variant:"h6",color:"inherit",align:"center"},"Import error"))),m.a.createElement(Je.a,{className:g.errorMessage},a)):null)})),Zm=Object(P.ConfigurationSchema)("ImportSessionWidget",{}),$m=b.types.model("ImportSessionWidget",{id:Ie.ElementId,type:b.types.literal("ImportSessionWidget")}),eg=n(2493),tg=n(2409),ng=n.n(tg),ag=Object(Ze.a)((function(e){return{root:{margin:e.spacing(1)},message:{padding:e.spacing(3)}}})),rg=Object(re.observer)((function(e){var t=e.session,n=ag(),a=JSON.parse(localStorage.getItem(t.previousAutosaveId)||"{}").session,r=(a||{}).views,o=void 0===r?[]:r,i=o.map((function(e){return e.tracks.length})).reduce((function(e,t){return e+t}),0);return a?m.a.createElement(nn.a,{className:n.root},m.a.createElement(ss.a,{subheader:m.a.createElement($u.a,null,"Previous autosaved entry")},m.a.createElement(ls.a,{button:!0,onClick:function(){return t.loadAutosaveSession()}},m.a.createElement(Ku.a,null,m.a.createElement(ng.a,null)),m.a.createElement(Zu.a,{primary:a.name,secondary:t.name===a.name?"Currently open":"".concat(o.length," ").concat(nd()("view",o.length),"; ").concat(i,"\n                           open ").concat(nd()("track",i))})))):null})),og=Object(re.observer)((function(e){var t=e.session,n=ag(),a=Object(p.useState)(null),r=Object(f.a)(a,2),o=r[0],i=r[1],c=Object(p.useState)(!1),s=Object(f.a)(c,2),l=s[0],u=s[1];function d(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&t.removeSavedSession(t.savedSessions[o]),i(null),u(!1)}var g=null!==o?t.savedSessions[o].name:"";return m.a.createElement(m.a.Fragment,null,m.a.createElement(rg,{session:t}),m.a.createElement(nn.a,{className:n.root},m.a.createElement(ss.a,{subheader:m.a.createElement($u.a,null,"Saved sessions")},t.savedSessions.length?t.savedSessions.map((function(e,n){var a=e.views,r=void 0===a?[]:a,o=r.map((function(e){return e.tracks.length})).reduce((function(e,t){return e+t}),0);return m.a.createElement(ls.a,{button:!0,disabled:t.name===e.name,onClick:function(){return t.activateSession(e.name)},key:e.name},m.a.createElement(Ku.a,null,m.a.createElement(ng.a,null)),m.a.createElement(Zu.a,{primary:e.name,secondary:t.name===e.name?"Currently open":"".concat(r.length," ").concat(nd()("view",r.length),"; ").concat(o,"\n                           open ").concat(nd()("track",o))}),m.a.createElement(eg.a,null,m.a.createElement(Qt.a,{edge:"end",disabled:t.name===e.name,"aria-label":"Delete",onClick:function(){return function(e){i(e),u(!0)}(n)}},m.a.createElement(ds.a,null))))})):m.a.createElement(Je.a,{className:n.message},"No saved sessions found"))),m.a.createElement(Gt.a,{open:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},m.a.createElement(Jt.a,{id:"alert-dialog-title"},'Delete session "'.concat(g,'"?')),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,{id:"alert-dialog-description"},"This action cannot be undone")),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){return d()},color:"primary"},"Cancel"),m.a.createElement(Ge.a,{onClick:function(){return d(!0)},color:"primary",autoFocus:!0},"Delete"))))})),ig=Object(P.ConfigurationSchema)("SessionManager",{}),cg=b.types.model("SessionManager",{id:Ie.ElementId,type:b.types.literal("SessionManager")}),sg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="MenusPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addWidgetType((function(){return new k.a({name:"AboutWidget",heading:"About",configSchema:Lm,stateModel:Dm,ReactComponent:Bm})})),e.addWidgetType((function(){return new k.a({name:"HelpWidget",heading:"Help",configSchema:qm,stateModel:zm,ReactComponent:Wm})})),e.addWidgetType((function(){return new k.a({name:"ImportSessionWidget",heading:"Import session",configSchema:Zm,stateModel:$m,ReactComponent:Km})})),e.addWidgetType((function(){return new k.a({name:"SessionManager",heading:"Sessions",configSchema:ig,stateModel:cg,ReactComponent:og})}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:Am.a,onClick:function(e){var t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:vs.a,onClick:function(e){var t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}),e.rootModel.insertInMenu("File",{label:"Export session",icon:za.a,onClick:function(e){var t=new Blob([JSON.stringify({session:Object(b.getSnapshot)(e)},null,2)],{type:"text/plain;charset=utf-8"});Object(Da.saveAs)(t,"session.json")}},1),e.rootModel.insertInMenu("File",{label:"Import session\u2026",icon:Mm.a,onClick:function(e){var t=e.addWidget("ImportSessionWidget","importSessionWidget");e.showWidget(t)}},1),e.rootModel.insertInMenu("File",{label:"Open session\u2026",icon:zt.a,onClick:function(e){var t=e.addWidget("SessionManager","sessionManager");e.showWidget(t)}},1),e.rootModel.insertInMenu("File",{label:"Save session",icon:Fm.a,onClick:function(e){e.saveSessionToLocalStorage&&(e.saveSessionToLocalStorage(),e.notify('Saved session "'.concat(e.name,'"'),"success"))}},1),e.rootModel.insertInMenu("File",{label:"Duplicate session",icon:Tm.a,onClick:function(e){var t;null===(t=e.duplicateCurrentSession)||void 0===t||t.call(e)}},1))}}]),n}(F.a),lg=n(2412),ug=n.n(lg),dg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).endpoint=void 0,a.queryTemplate=void 0,a.refNamesQueryTemplate=void 0,a.additionalQueryParams=void 0,a.configRefNames=void 0,a.refNames=void 0,a.endpoint=Object(P.readConfObject)(e,"endpoint").uri,a.queryTemplate=Object(P.readConfObject)(e,"queryTemplate"),a.additionalQueryParams=Object(P.readConfObject)(e,"additionalQueryParams"),a.refNamesQueryTemplate=Object(P.readConfObject)(e,"refNamesQueryTemplate"),a.configRefNames=Object(P.readConfObject)(e,"refNames"),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n,a,r,o=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},!this.refNames){e.next=3;break}return e.abrupt("return",this.refNames);case 3:if(n=[],!this.refNamesQueryTemplate){e.next=12;break}return a=encodeURIComponent(this.refNamesQueryTemplate),e.next=8,this.querySparql(a,t);case 8:r=e.sent,n=this.resultsToRefNames(r),e.next=13;break;case 12:this.configRefNames&&(n=this.configRefNames);case 13:return this.refNames=n,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=encodeURIComponent(ug()(t.queryTemplate,e)),i=e.refName,a.next=4,t.querySparql(o,n);case 4:s=a.sent,t.resultsToFeatures(s,i).forEach((function(e){r.next(e)})),r.complete();case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"querySparql",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="",this.additionalQueryParams.length&&(a="&".concat(this.additionalQueryParams.join("&"))),r=n&&n.signal,e.next=5,fetch("".concat(this.endpoint,"?query=").concat(t).concat(a),{headers:{accept:"application/json,application/sparql-results+json"},signal:r});case 5:return o=e.sent,e.abrupt("return",o.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resultsToRefNames",value:function(e){var t=((e||{}).results||{}).bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((function(e){return e.refName.value}))}},{key:"resultsToFeatures",value:function(e,t){var n=((e||{}).results||{}).bindings||[];if(!n.length)return[];var a=e.head.vars;["start","end","uniqueId"].forEach((function(e){a.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));var r={};n.forEach((function(e){var n=[{}];a.forEach((function(t){if(t in e){for(var a=e[t].value,r=0;t.startsWith("sub_");)t=t.slice(4),r+=1;for(;r>n.length-1;)n.push({});n[r][t]=a}})),n.forEach((function(e,a){var o=e.uniqueId;a<n.length-1&&(n[a+1].parentUniqueId=o),r[o]={data:Object(u.a)(Object(u.a)({},e),{},{uniqueId:o,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0})}}))}));for(var o=0,i=Object.entries(r);o<i.length;o++){var c=Object(f.a)(i[o],2),l=c[0],d=c[1],p=d.data.parentUniqueId;if(delete d.data.parentUniqueId,p){var m=r[p];if(m)m.data.subfeatures||(m.data.subfeatures=[]),m.data.subfeatures.push(Object(u.a)(Object(u.a)({},d.data),{},{uniqueId:l})),delete r[l];else{var g,h=Object.values(r).map((function(e){return e.data.subfeatures})).filter((function(e){return!!e})).flat(),b=!1,v=Object(He.a)(h);try{for(v.s();!(g=v.n()).done;){var y=g.value;if(y&&y.uniqueId===p){y.subfeatures||(y.subfeatures=[]),y.subfeatures.push(Object(u.a)(Object(u.a)({},d.data),{},{uniqueId:l})),delete r[l],b=!0;break}y&&y.subfeatures&&h.push.apply(h,Object(s.a)(y.subfeatures))}}catch(w){v.e(w)}finally{v.f()}b||console.error("Could not find parentID ".concat(p))}}}return Object.keys(r).map((function(e){return new U.a(Object(u.a)(Object(u.a)({},r[e].data),{},{uniqueId:e,subfeatures:r[e].data.subfeatures}))}))}},{key:"hasDataForRefName",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.getRefNames(n);case 3:if(!(a=e.sent).length||a.includes(t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),fg=Object(P.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0}),pg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="RdfPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"SPARQLAdapter",configSchema:fg,AdapterClass:dg})}))}}]),n}(F.a),mg=n(1317),gg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).fasta=void 0,a.seqCache=new Pd.a({cache:new Fd({maxSize:200}),fill:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.refName,r=t.start,o=t.end,e.abrupt("return",a.fasta.getSequence(n,r,o));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var r=Object(P.readConfObject)(e,"fastaLocation"),o=Object(P.readConfObject)(e,"faiLocation");if(!r)throw new Error("must provide fastaLocation");if(!o)throw new Error("must provide faiLocation");var i={fasta:Object(oe.openLocation)(r),fai:Object(oe.openLocation)(o)};return a.fasta=new mg.IndexedFasta(i),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){return this.fasta.getSequenceList()}},{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fasta.getSequenceSizes();case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,a=e.start,r=e.end;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(o){var i,s,l,u,d,f,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fasta.getSequenceSize(n);case 2:for(i=e.sent,s=void 0!==i?Math.min(i,r):r,l=[],128e3,d=r+(128e3-r%128e3),f=u=a-a%128e3;f<d;f+=128e3)p={refName:n,start:f,end:f+128e3},l.push(t.seqCache.get(JSON.stringify(p),p));return e.next=11,Promise.all(l);case 11:(m=e.sent.join("").slice(a-u).slice(0,r-a))&&o.next(new U.a({id:"".concat(n," ").concat(a,"-").concat(s),data:{refName:n,start:a,end:s,seq:m}})),o.complete();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),hg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),a=t.call(this,e);var r=Object(P.readConfObject)(e,"fastaLocation"),o=Object(P.readConfObject)(e,"faiLocation"),i=Object(P.readConfObject)(e,"gziLocation");if(!r)throw new Error("must provide fastaLocation");if(!o)throw new Error("must provide faiLocation");if(!i)throw new Error("must provide gziLocation");var c={fasta:Object(oe.openLocation)(r),fai:Object(oe.openLocation)(o),gzi:Object(oe.openLocation)(i)};return a.fasta=new mg.BgzipIndexedFasta(c),a}return n}(gg),bg=Object(P.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi"}}},{explicitlyTyped:!0}),vg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).refSeqs=void 0,a.source=void 0;var r=Object(P.readConfObject)(e,"chromSizesLocation");if(!r)throw new Error("must provide chromSizesLocation");var o=Object(oe.openLocation)(r);return a.source=o.toString(),a.refSeqs=a.init(o),a}return Object(h.a)(n,[{key:"init",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile("utf8");case 2:if(n=e.sent,a={},n.length){e.next=6;break}throw new Error("Could not read file ".concat(t.toString()));case 6:return n.split("\n").forEach((function(e){if(e.length){var t=e.split("\t"),n=Object(f.a)(t,2),r=n[0],o=n[1];a[r]=+o}})),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.refSeqs;case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(H.BaseAdapter),yg=Object(P.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes"}}},{explicitlyTyped:!0});function wg(e){for(var t=e.codonTable,n=e.seq,a=e.frame,r=e.bpPerPx,o=e.region,i=e.height,c=e.y,s=e.reverse,l=void 0!==s&&s,u=e.theme,d=r,f=3-o.start%3,p=(a+f+3)%3,g=n.slice(p),h=[],b=0;b<g.length;b+=3){var v=g.slice(b,b+3),y=l?Object(_.revcom)(v):v,w=t[y]||"";h.push({letter:w,codon:y.toUpperCase()})}var O=1/d*3,j=0===o.start?0:O,k=1/r>=12,C=(o.end-o.start)/r,E=["#d8d8d8","#adadad","#8f8f8f"].reverse();return m.a.createElement(m.a.Fragment,null,h.map((function(e,t){var n=o.reversed?C-(O*(t+1)+p/d-j):O*t+p/d-j,r=e.letter,s=e.codon;return m.a.createElement(m.a.Fragment,{key:"".concat(t,"-").concat(r)},m.a.createElement("rect",{x:n,y:c,width:k?O:O+.7,height:i,stroke:k?"#555":"none",fill:_.defaultStarts.includes(s)?u.palette.startCodon:_.defaultStops.includes(s)?u.palette.stopCodon:E[Math.abs(a)]}),k?m.a.createElement("text",{x:n+O/2,y:c+i/2,dominantBaseline:"middle",textAnchor:"middle"},r):null)})))}function Og(e){var t=e.bpPerPx,n=e.region,a=e.feature,r=e.theme,o=e.height,i=e.seq,c=e.y,s=1/t>=12,l=Object(_.bpSpanPx)(a.get("start"),a.get("end"),n,t),u=Object(f.a)(l,2),d=u[0],p=u[1],g=n.reversed,h=a.get("end")-a.get("start"),b=Math.max((p-d)/h,.8);return m.a.createElement(m.a.Fragment,null,i.split("").map((function(e,t){var n=r.palette.bases[e.toUpperCase()],a=g?p-(t+1)*b:d+t*b;return m.a.createElement(m.a.Fragment,{key:t},m.a.createElement("rect",{x:a,y:c,width:b,height:o,fill:n?n.main:"#aaa",stroke:s?"#555":"none"}),s?m.a.createElement("text",{x:a+b/2,y:c+o/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?Object(fm.contrastingTextColor)(n.main):"black"},e):null)})))}var jg=Object(re.observer)((function(e){var t=e.features,n=void 0===t?new Map:t,a=e.regions,r=e.bpPerPx,o=e.theme,i=e.showForward,c=void 0===i||i,l=e.showReverse,u=void 0===l||l,d=e.showTranslation,p=void 0===d||d,g=Object(ue.createJBrowseTheme)(o),h=Object(f.a)(a,1)[0],b=(h.end-h.start)/r,v=Object(_.generateCodonTable)(_.defaultCodonTable),y=Object(s.a)(n.values())[0];if(!y)return null;var w=y.get("seq");if(!w)return null;var O=-20;return m.a.createElement("svg",{width:b,height:200,style:{width:b,height:200}},p&&(h.reversed?u:c)?[2,1,0].map((function(e){return m.a.createElement(wg,{key:"translation-".concat(e),seq:w,y:O+=20,codonTable:v,frame:e,bpPerPx:r,region:h,theme:g,height:20,reverse:h.reversed})})):null,c?m.a.createElement(Og,{height:20,y:O+=20,feature:y,region:h,seq:h.reversed?Object(_.complement)(w):w,bpPerPx:r,theme:g}):null,u?m.a.createElement(Og,{height:20,y:O+=20,feature:y,region:h,seq:h.reversed?w:Object(_.complement)(w),bpPerPx:r,theme:g}):null,p&&(h.reversed?c:u)?[0,-1,-2].map((function(e){return m.a.createElement(wg,{key:"rev-translation-".concat(e),seq:w,y:O+=20,codonTable:v,frame:e,bpPerPx:r,region:h,theme:g,height:20,reverse:!h.reversed})})):null)})),kg=Object(P.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),Cg=Object(P.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai"}}},{explicitlyTyped:!0}),Eg=Object(P.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:kg},{explicitIdentifier:"displayId",explicitlyTyped:!0});var xg=n(2418),Sg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).twobit=void 0;var r={filehandle:Object(oe.openLocation)(Object(P.readConfObject)(e,"twoBitLocation"))};return a.twobit=new xg.TwoBitFile(r),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){return this.twobit.getSequenceNames()}},{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.twobit.getSequenceSizes();case 2:return t=e.sent,e.abrupt("return",Object.keys(t).map((function(e){return{refName:e,start:0,end:t[e]}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,a=e.start,r=e.end;return Object(ur.ObservableCreate)(function(){var e=Object(l.a)(c.a.mark((function e(o){var i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.twobit.getSequenceSize(n);case 2:return i=e.sent,s=void 0!==i?Math.min(i,r):r,e.next=6,t.twobit.getSequence(n,a,s);case 6:(l=e.sent)&&o.next(new U.a({id:"".concat(n," ").concat(a,"-").concat(s),data:{refName:n,start:a,end:s,seq:l}})),o.complete();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),Tg=Object(P.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit"}}},{explicitlyTyped:!0}),Ng=function(e){return Object(P.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})},Ag=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r;Object(g.a)(this,n),(r=t.call(this,e)).sequenceAdapter=void 0,r.windowSize=1e3,r.windowDelta=1e3,r.gcMode="content";var o=Object(P.readConfObject)(e,["sequenceAdapter","type"]),i=null===a||void 0===a?void 0:a(Object(P.readConfObject)(e,"sequenceAdapter")).dataAdapter;if(!(i instanceof H.BaseFeatureDataAdapter))throw new Error("Feature adapters cannot use sequence adapters of type '".concat(o,"'"));return r.sequenceAdapter=i,r}return Object(h.a)(n,[{key:"getRefNames",value:function(){return this.sequenceAdapter.getRefNames()}},{key:"getRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sequenceAdapter.getRegions());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e,t){var n=this;return this.windowSize=1e3,this.windowDelta=1e3,this.gcMode="content",Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o,i,s,l,d,p,m,g,h,b,v,y,w,O,j,k,C;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=1===n.windowSize?1:n.windowSize/2,i=1===n.windowSize,s=e.start,l=e.end,s=Math.max(0,s-o),!((l+=o)<0||s>l)){a.next=8;break}return r.complete(),a.abrupt("return");case 8:return d=n.sequenceAdapter.getFeatures(Object(u.a)(Object(u.a)({},e),{},{start:s,end:l}),t),a.next=11,d.pipe(Object(B.a)()).toPromise();case 11:for(p=a.sent,m=Object(f.a)(p,1),g=m[0],h=g.get("seq"),b=o;b<h.length-o;b+=n.windowDelta){for(v=i?h[b]:h.slice(b-o,b+o),y=0,w=0,O=0,j=0;j<v.length;j++)"c"===v[j]||"C"===v[j]?y++:"g"!==v[j]&&"G"!==v[j]||w++,"N"!==v[j]&&O++;k=s,C=void 0,"content"===n.gcMode?C=(w+y)/(O||1):"skew"===n.gcMode&&(C=(w-y)/(w+y||1)),r.next(new U.a({uniqueId:"".concat(n.id,"_").concat(k+b),start:k+b,end:k+b+n.windowDelta,score:C}))}r.complete();case 17:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter);Ag.capabilities=["hasLocalStats"];var Rg=function(e){return{configSchema:e.load(Ng),AdapterClass:Ag}};var Mg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"getExpandedRegion",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),n}(z.a),Pg=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="SequencePlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"TwoBitAdapter",configSchema:Tg,AdapterClass:Sg})})),e.addAdapterType((function(){return new y.a({name:"ChromSizesAdapter",configSchema:yg,AdapterClass:vg})})),e.addAdapterType((function(){return new y.a({name:"IndexedFastaAdapter",configSchema:Cg,AdapterClass:gg})})),e.addAdapterType((function(){return new y.a({name:"BgzipFastaAdapter",configSchema:bg,AdapterClass:hg})})),e.addAdapterType((function(){return new y.a(Object(u.a)({name:"GCContentAdapter"},e.load(Rg)))})),e.addTrackType((function(){var t=function(e){return Object(P.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:b.types.array(e.pluggableConfigSchemaType("display")),metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),a=new Set,r=n.displays,o=void 0===r?[]:r;"placeholderId"!==n.trackId&&(o.forEach((function(e){return e&&a.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){a.has(e.name)||o.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return Object(u.a)(Object(u.a)({},n),{},{displays:o})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var a=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(a)return a;var r=e.displays.push(t);return e.displays[r-1]}}}})}(e);return new w.a({name:"ReferenceSequenceTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})})),e.addDisplayType((function(){var e,t=(e=Eg,b.types.compose("LinearReferenceSequenceDisplay",St,b.types.model({type:b.types.literal("LinearReferenceSequenceDisplay"),configuration:Object(P.ConfigurationReference)(e),showForward:b.types.optional(b.types.boolean,!0),showReverse:b.types.optional(b.types.boolean,!0),showTranslation:b.types.optional(b.types.boolean,!0),height:180})).views((function(e){return{get renderProps(){var t=e.showForward,n=e.showReverse,a=e.showTranslation;return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(Ue.getParentRenderProps)(e)),{},{config:e.configuration.renderer,showForward:t,showReverse:n,showTranslation:a})},regionCannotBeRendered:function(){var t=Object(_.getContainingView)(e);if(t&&t.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation}}})).views((function(e){return{get trackMenuItems(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){e.toggleShowTranslation()}}]}}})));return{name:"LinearReferenceSequenceDisplay",configSchema:Eg,stateModel:t,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:dt}})),e.addRendererType((function(){return new Mg({name:"DivSequenceRenderer",ReactComponent:jg,configSchema:kg,pluginManager:e})}))}}]),n}(F.a),Fg=function(){function e(t,n,a,r,o,i){if(Object(g.a)(this,e),this.name=void 0,this.left=void 0,this.top=void 0,this.width=void 0,this.height=void 0,this.data=void 0,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,_.inDevelopment&&("string"!==typeof t||"number"!==typeof n||Number.isNaN(n)||"number"!==typeof a||Number.isNaN(a)||"number"!==typeof r||Number.isNaN(r)||"number"!==typeof o||Number.isNaN(o)))throw new TypeError("invalid SceneGraph arguments");this.name=t,this.left=n,this.top=a,this.width=r,this.height=o,this.data=i,this.children=new Map,this.absoluteCache={dirty:!0}}return Object(h.a)(e,[{key:"addChild",value:function(t,n,a,r,o,i){var c;if(!((c=t instanceof e?t:new e(t,n,a,r,o,i))instanceof e))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(c.name))throw new Error('child named "'.concat(c.name,'" already exists'));c.parent=this;var s=c.absolute,l=s.left,u=s.right,d=s.top,f=s.bottom;return void 0!==l&&void 0!==u&&void 0!==d&&void 0!==f&&(this.expand(l,u,d,f),this.children.set(c.name,c)),c}},{key:"getSubRecord",value:function(e){return this.children.get(e)}},{key:"expand",value:function(e,t,n,a){var r=this.absolute,o=r.left,i=r.right,c=r.top,s=r.bottom;if(void 0!==o&&e<o){var l=o-e;this.width+=l,this.left-=l}if(void 0!==i&&t>i&&(this.width+=t-i),void 0!==c&&n<c){var u=c-n;this.height+=u,this.top-=u}void 0!==s&&a>s&&(this.height+=a-s),this.parent&&this.parent.expand(e,t,n,a),this.absoluteCache.dirty=!0}},{key:"walkParents",value:function(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}},{key:"walkChildren",value:function(e){var t,n=Object(He.a)(this.children.values());try{for(n.s();!(t=n.n()).done;){var a=t.value;e(a),a.walkChildren(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"move",value:function(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((function(e){e.absoluteCache.dirty=!0}));var n=this.absolute,a=n.left,r=n.right,o=n.top,i=n.bottom;void 0!==a&&void 0!==r&&void 0!==o&&void 0!==i&&this.expand(a,r,o,i)}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}},{key:"absolute",get:function(){if(this.absoluteCache.dirty){var e=0,t=0;this.walkParents((function(n){e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}}]),e}();function Ig(e){var t=e.text,n=e.x,a=e.y,r=e.color,o=void 0===r?"black":r,i=e.fontHeight,c=void 0===i?13:i,s=e.featureWidth,l=e.reversed,u=e.allowedWidthExpansion,d=e.fontWidthScaleFactor,f=c*(void 0===d?.6:d),p=s&&u?s+u:1/0;return m.a.createElement("text",{x:l?n+(s||0)-f*t.length:n,y:a,style:{fontSize:c,fill:o,cursor:"default"},dominantBaseline:"hanging"},f*t.length>p?"".concat(t.slice(0,p/f),"..."):t)}function Bg(e){var t=e.feature,n=e.rootLayout,a=e.selected,r=e.config,o=e.name,i=e.shouldShowName,c=e.description,s=e.shouldShowDescription,l=e.fontHeight,u=e.allowedWidthExpansion,d=e.reversed,f=n.getSubRecord(String(t.id())),p=f.data.GlyphComponent,g=[m.a.createElement(p,Object.assign({key:"glyph-".concat(t.id())},e,{feature:t,featureLayout:f,selected:a}))];return i&&g.push(m.a.createElement(Ig,{key:"glyph-name-".concat(t.id()),text:o,x:n.getSubRecord("nameLabel").absolute.left,y:n.getSubRecord("nameLabel").absolute.top,color:Object(P.readConfObject)(r,["labels","nameColor"],{feature:t}),fontHeight:l,reversed:d,featureWidth:f.width,allowedWidthExpansion:u})),s&&g.push(m.a.createElement(Ig,{key:"glyph-description-".concat(t.id()),text:c,x:n.getSubRecord("descriptionLabel").absolute.left,y:n.getSubRecord("descriptionLabel").absolute.top,color:Object(P.readConfObject)(r,["labels","descriptionColor"],{feature:t}),fontHeight:l,featureWidth:f.width,reversed:d,allowedWidthExpansion:u})),m.a.createElement("g",null,g)}Bg.defaultProps={reversed:!1,selected:!1,name:"",shouldShowName:!1,description:"",shouldShowDescription:!1,fontHeight:void 0,allowedWidthExpansion:void 0};var Lg=Object(re.observer)(Bg);function Dg(e){var t=e.rect,n=e.region,a=e.bpPerPx,r=Object(d.a)(e,["rect","region","bpPerPx"]);if(!t)return null;var o=Object(f.a)(t,4),i=o[0],c=o[1],s=o[2],l=o[3],u=Object(_.bpSpanPx)(i,s,n,a),p=Object(f.a)(u,2),g=p[0],h=p[1],b=Math.round(c),v=(n.end-n.start)/a,y=Math.round(l-c),w=h-g;if(g+w<0)return null;var O=Math.max(g,0),j=O-g,k=Math.max(1,Math.min(w-j,v));return m.a.createElement("rect",Object.assign({x:O-2,y:b-2,width:k+4,height:y+4},r))}var Vg=Object(re.observer)((function(e){var t=e.displayModel,n=t.blockLayoutFeatures,a=t.selectedFeatureId,r=t.featureIdUnderMouse,o=t.contextMenuFeature,i=e.blockKey,c=e.region,s=e.bpPerPx,l=e.movedDuringLastMouseDown,u=Object(d.a)(e,["displayModel","blockKey","region","bpPerPx","movedDuringLastMouseDown"]),f=null===n||void 0===n?void 0:n.get(i);if(!f)return null;var p=r||(null===o||void 0===o?void 0:o.id());function g(e){var t=u.onFeatureMouseOut;if(t&&p)return t(e,p)}function h(e){var t=u.onFeatureMouseOver;if(t&&p)return t(e,p)}return m.a.createElement(m.a.Fragment,null,p?m.a.createElement(Dg,{rect:f.get(p),region:c,bpPerPx:s,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){var t=u.onFeatureMouseDown;if(t&&p)return t(e,p)},onMouseEnter:function(e){var t=u.onFeatureMouseEnter;if(t&&p)return t(e,p)},onMouseOut:g,onMouseOver:h,onMouseUp:function(e){var t=u.onFeatureMouseUp;if(t&&p)return t(e,p)},onMouseLeave:function(e){var t=u.onFeatureMouseLeave;if(t&&p)return t(e,p)},onMouseMove:function(e){var t=u.onFeatureMouseMove;if(t&&p)return t(e,p)},onClick:function(e){if(!l){var t=u.onFeatureClick;if(t&&p)return e.stopPropagation(),t(e,p)}},onContextMenu:function(e){var t=u.onFeatureContextMenu;if(t&&p)return e.stopPropagation(),t(e,p)},onFocus:h,onBlur:g,"data-testid":p}):null,a?m.a.createElement(Dg,{rect:f.get(a),region:c,bpPerPx:s,stroke:"#00b8ff",fill:"none"}):null)}));function Wg(e){var t,n=e.feature,a=e.region,r=e.config,o=e.featureLayout,i=e.selected,c=e.bpPerPx,s=(a.end-a.start)/c,l=Object(P.readConfObject)(r,"color1",{feature:n});try{t=Object(fm.emphasize)(l,.3)}catch(w){t=l}var u=Object(P.readConfObject)(r,"color2",{feature:n}),d=o.absolute,f=d.left,p=d.top,g=d.width,h=d.height;if(f+g<0)return null;var b=Math.max(f,0),v=b-f,y=Math.max(1,Math.min(g-v,s));return m.a.createElement("rect",{"data-testid":"box-".concat(n.id()),x:b,y:p,width:y,height:h,fill:i?t:l,stroke:i?u:void 0})}Wg.defaultProps={selected:!1};var qg=Object(re.observer)(Wg);function zg(e){var t=e.feature,n=e.bpPerPx,a=e.region,r=e.config,o=e.featureLayout,i=e.selected,c=e.reversed,s=(a.end-a.start)/n,l=Math.max(o.absolute.width,1),u=o.absolute.left,d=o.absolute,f=d.top,p=d.height;ah(t)&&(f+=.175*p,p*=.65);var g,h=t.get("strand")*(c?-1:1),b=ah(t)?Object(P.readConfObject)(r,"color3",{feature:t}):Object(P.readConfObject)(r,"color1",{feature:t});try{g=Object(fm.emphasize)(b,.3)}catch(j){g=b}var v=Object(P.readConfObject)(r,"color2",{feature:t});if(u+l<0)return null;var y=Math.max(u,0),w=y-u,O=Math.max(1,Math.min(l-w,s));return m.a.createElement(m.a.Fragment,null,m.a.createElement("rect",{"data-testid":t.id(),stroke:i?v:void 0,fill:i?g:b,x:y,y:f,width:O,height:p}),h<0&&0===w?m.a.createElement("polygon",{stroke:i?v:void 0,fill:i?g:b,points:[[u,f],[u-p/2,f+p/2],[u,f+p]]}):null,h>0&&y+O<s?m.a.createElement("polygon",{stroke:i?v:void 0,fill:i?g:b,points:[[y+O,f],[y+O+p/2,f+p/2],[y+O,f+p]]}):null)}zg.defaultProps={selected:!1,reversed:!1};var Hg=Object(re.observer)(zg);function _g(e){var t,n=e.feature,a=e.featureLayout,r=e.selected,o=e.config,i=e.reversed,c=e.subfeatures||n.get("subfeatures"),s=Object(P.readConfObject)(o,"color2",{feature:n});try{t=Object(fm.emphasize)(s,.3)}catch(b){t=s}var l=a.absolute,u=l.left,d=l.top,f=l.width,p=l.height,g=[[u,d+p/2],[u+f,d+p/2]],h=n.get("strand");return h&&g.push([u+f-p/4,d+p/4],[u+f-p/4,d+p/4*3],[u+f,d+p/2]),m.a.createElement(m.a.Fragment,null,m.a.createElement("polyline",{"data-testid":n.id(),transform:h&&(!i&&h<0||i&&h>0)?"rotate(180,".concat(u+f/2,",").concat(d+p/2,")"):void 0,points:g,stroke:r?t:s}),c.map((function(t){var n=String(t.id()),o=a.getSubRecord(n);if(!o)return null;var i=o.data.GlyphComponent;return m.a.createElement(i,Object.assign({key:"glyph-".concat(n)},e,{feature:t,featureLayout:o,selected:r}))})))}_g.defaultProps={selected:!1,reversed:!1};var Ug=Object(re.observer)(_g);function Gg(e){var t=Xg(e.feature,e.config);return m.a.createElement(Ug,Object.assign({},e,{subfeatures:t}))}function Jg(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=Object(P.readConfObject)(t,e);if("string"==typeof n&&(n=n.split(/\s*,\s*/)),Array.isArray(n)){var a=n.map((function(e){return e.toLowerCase()}));return function(e){return a.includes(e.get("type").toLowerCase())}}return"function"===typeof n?n:function(){return!0}}("subParts",t)(e)}function Qg(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function Xg(e,t){var n=e.get("subfeatures");if(!n||!n.length)return[];var a=!!n.find((function(e){return Qg(e)})),r=["mRNA","transcript"].includes(e.get("type"));return(!a&&r||Object(P.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){for(var n,a,r=Object(s.a)(t),o=1/0,i=-1/0,c=[],l=0;l<r.length;l++){var u=r[l].get("type");/^cds/i.test(u)?(o>r[l].get("start")&&(o=r[l].get("start")),i<r[l].get("end")&&(i=r[l].get("end"))):/exon/i.test(u)?c.push(r[l]):Qg(r[l])&&(n=r[l].get("start")===e.get("start"),a=r[l].get("end")===e.get("end"))}if(!(c.length&&o<1/0&&i>-1/0))return r;c.sort((function(e,t){return e.get("start")-t.get("start")}));var d,f,p=e.get("strand");if(!n)for(var m=0;m<c.length&&!((d=c[m].get("start"))>=o);m++){f=o>c[m].get("end")?c[m].get("end"):o;var g=p>=0?"five_prime_UTR":"three_prime_UTR";r.unshift(new U.a({parent:e,id:"".concat(e.id(),"_").concat(g,"_").concat(m),data:{start:d,end:f,strand:p,type:g}}))}if(!a)for(var h=c.length-1;h>=0&&!((f=c[h].get("end"))<=i);h--){d=i<c[h].get("start")?c[h].get("start"):i;var b=p>=0?"three_prime_UTR":"five_prime_UTR";r.push(new U.a({parent:e,id:"".concat(e.id(),"_").concat(b,"_").concat(h),data:{start:d,end:f,strand:p,type:b}}))}return r}(e,n)),n.filter((function(e){return Jg(e,t)}))}Gg.layOut=function(e){var t=e.layout,n=e.feature,a=e.bpPerPx,r=e.reversed,o=e.config,i=th({layout:t,feature:n,bpPerPx:a,reversed:r,config:o});return nh({layout:i,subfeatures:Xg(n,o),bpPerPx:a,reversed:r,config:o}),i};var Yg=Object(re.observer)(Gg);function Kg(e){var t=e.feature,n=e.featureLayout,a=e.selected;return m.a.createElement(m.a.Fragment,null,t.get("subfeatures").map((function(t){var r=String(t.id()),o=n.getSubRecord(r),i=o.data.GlyphComponent;return m.a.createElement(i,Object.assign({key:"glyph-".concat(r)},e,{feature:t,featureLayout:o,selected:a}))})))}Kg.defaultProps={selected:!1,reversed:!1},Kg.layOut=function(e){var t=e.layout,n=e.feature,a=e.bpPerPx,r=e.reversed,o=e.config,i=th({layout:t,feature:n,bpPerPx:a,reversed:r,config:o}),c=Object(P.readConfObject)(o,"displayMode");if("reducedRepresentation"!==c){var s=n.get("subfeatures")||[],l=0;s.forEach((function(e){var t=$g(e),n=Object(P.readConfObject)(o,"height",{feature:e});(t.layOut||eh)({layout:i,feature:e,bpPerPx:a,reversed:r,config:o}).move(0,l),l+="collapse"===c?0:("compact"===c?n/3:n)+2}))}return i};var Zg=Object(re.observer)(Kg);function $g(e){var t=e.get("type"),n=e.get("strand"),a=e.get("subfeatures");if(a){if(a.find((function(e){return!!e.get("subfeatures")})))return Zg;return["mRNA","transcript"].includes(t)&&a.find((function(e){return"CDS"===e.get("type")}))?Yg:Ug}return[1,-1].includes(n)?Hg:qg}function eh(e){var t=e.layout,n=e.feature,a=e.bpPerPx,r=e.reversed,o=e.config,i=Object(P.readConfObject)(o,"displayMode"),c=th({layout:t,feature:n,bpPerPx:a,reversed:r,config:o});return"reducedRepresentation"!==i&&nh({layout:c,subfeatures:n.get("subfeatures")||[],bpPerPx:a,reversed:r,config:o}),c}function th(e){var t=e.layout,n=e.feature,a=e.bpPerPx,r=e.reversed,o=e.config,i=Object(P.readConfObject)(o,"displayMode"),c="reducedRepresentation"===i?Hg:$g(n),s=n.parent(),l=0;s&&(l=r?(s.get("end")-n.get("end"))/a:(n.get("start")-s.get("start"))/a);var u=Object(P.readConfObject)(o,"height",{feature:n}),d=(n.get("end")-n.get("start"))/a,f=t.parent,p=f?f.top:0;return t.addChild(String(n.id()),l,"collapse"===i?0:p,d,"compact"===i?u/2:u,{GlyphComponent:c})}function nh(e){var t=e.layout,n=e.subfeatures,a=e.bpPerPx,r=e.reversed,o=e.config;n.forEach((function(e){($g(e).layOut||eh)({layout:t,feature:e,bpPerPx:a,reversed:r,config:o})}))}function ah(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}var rh={position:"relative"};function oh(e){var t,n,a,r,o,i,c=e.feature,s=e.bpPerPx,l=e.region,u=e.config,d=e.displayMode,f=e.layout,p=l.reversed,g=c.get(p?"end":"start"),h=Object(_.bpToPx)(g,l,s),b="compact"!==d&&"collapsed"!==d,v=new Fg("root",0,0,0,0),y=($g(c).layOut||eh)({layout:v,feature:c,bpPerPx:s,reversed:p,config:u});if(b){var w=Object(P.readConfObject)(u,"showLabels");o=Object(P.readConfObject)(u,["labels","fontSize"],{feature:c}),i=Object(P.readConfObject)(u,"maxFeatureGlyphExpansion")||0,a=Object(P.readConfObject)(u,["labels","name"],{feature:c})||"",t=/\S/.test(a)&&w,r=Object(P.readConfObject)(u,["labels","description"],{feature:c})||"",n=/\S/.test(r)&&w;var O=.6*o,j=0;t&&(j=Math.round(Math.min(String(a).length*O,v.width+i)),v.addChild("nameLabel",0,y.bottom+2,j,o));var k=0;if(n){var C=t?v.getSubRecord("nameLabel"):y;k=Math.round(Math.min(String(r).length*O,v.width+i)),v.addChild("descriptionLabel",0,C.bottom+2,k,o)}}var E=f.addRect(c.id(),c.get("start"),c.get("start")+v.width*s,v.height);return null===E?null:(v.move(h,E),m.a.createElement(Lg,Object.assign({key:"svg-feature-".concat(c.id()),feature:c,layout:f,rootLayout:v,bpPerPx:s,config:u,name:String(a),shouldShowName:t,description:String(r),shouldShowDescription:n,fontHeight:o,allowedWidthExpansion:i,reversed:l.reversed},e)))}var ih=Object(re.observer)((function(e){var t,n=e.features,a=[],r=Object(He.a)(n.values());try{for(r.s();!(t=r.n()).done;){var o=t.value;a.push(m.a.createElement(oh,Object.assign({key:o.id(),feature:o},e)))}}catch(i){r.e(i)}finally{r.f()}return m.a.createElement(m.a.Fragment,null,a)}));function ch(e){var t=e.layout,n=e.blockKey,a=e.regions,r=e.bpPerPx,o=e.features,i=e.config,c=e.displayModel,s=a||[],l=Object(f.a)(s,1)[0],u=(l.end-l.start)/r,d=Object(P.readConfObject)(i,"displayMode"),g=Object(p.useRef)(),h=Object(p.useState)(!1),b=Object(f.a)(h,2),v=b[0],y=b[1],w=Object(p.useState)(!1),O=Object(f.a)(w,2),j=O[0],k=O[1],C=Object(p.useState)(0),E=Object(f.a)(C,2),x=E[0],S=E[1],T=e.onMouseOut,N=e.onMouseDown,A=e.onMouseLeave,R=e.onMouseEnter,M=e.onMouseOver,F=e.onMouseMove,I=e.onMouseUp,B=e.onClick,L=e.onContextMenu,D=Object(p.useCallback)((function(e){y(!0),k(!1);if(N)return N(e)}),[N]),V=Object(p.useCallback)((function(e){y(!1);if(I)return I(e)}),[I]),W=Object(p.useCallback)((function(e){if(R)return R(e)}),[R]),q=Object(p.useCallback)((function(e){if(A)return A(e)}),[A]),z=Object(p.useCallback)((function(e){if(M)return M(e)}),[M]),H=Object(p.useCallback)((function(e){if(T)return T(e)}),[T]),_=Object(p.useCallback)((function(e){v&&k(!0);var t=0,a=0;g.current&&(t=g.current.getBoundingClientRect().left,a=g.current.getBoundingClientRect().top),t=e.clientX-t,a=e.clientY-a;var o=l.reversed?u-t:t,i=l.start+r*o,s=c.getFeatureOverlapping(n,i,a),d=s.length?s[0].name:void 0;F&&F(e,d)}),[n,r,v,F,l.reversed,l.start,c,u]),U=Object(p.useCallback)((function(e){j||B&&B(e)}),[j,B]),G=Object(p.useCallback)((function(e){j||L&&L(e)}),[j,L]);return Object(p.useEffect)((function(){S(t.getTotalHeight())}),[t]),m.a.createElement("div",{style:rh},m.a.createElement("svg",{ref:g,className:"SvgFeatureRendering",width:"".concat(u,"px"),height:"".concat(x,"px"),onMouseDown:D,onMouseUp:V,onMouseEnter:W,onMouseLeave:q,onMouseOver:z,onMouseOut:H,onMouseMove:_,onFocus:W,onBlur:q,onClick:U,onContextMenu:G,style:{display:"block"}},m.a.createElement(ih,Object.assign({features:o,displayMode:d},e,{region:l,movedDuringLastMouseDown:j})),m.a.createElement(Vg,Object.assign({},e,{region:l}))))}ih.propTypes={features:uf.a.oneOfType([uf.a.instanceOf(Map),uf.a.arrayOf(uf.a.shape())]),layout:uf.a.shape({addRect:uf.a.func.isRequired,getTotalHeight:uf.a.func.isRequired}).isRequired},ih.defaultProps={features:[]},ch.defaultProps={displayModel:{},features:new Map,blockKey:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onMouseMove:void 0,onClick:void 0,onContextMenu:void 0,onFeatureClick:void 0,onFeatureContextMenu:void 0};var sh=Object(re.observer)(ch),lh=Object(P.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"black",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},labels:Object(P.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"black",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:b.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0}),uh=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="SVGPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new gi.b({name:"SvgFeatureRenderer",ReactComponent:sh,configSchema:lh,pluginManager:e})}))}}]),n}(F.a),dh=Object(P.ConfigurationSchema)("TheTrackHubRegistryConnection",{trackDbId:{type:"string",defaultValue:"",description:"id of the trackDb in The Track Hub Registry"}},{baseConfiguration:Fe.baseConnectionConfig});function fh(e,t,n){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.members?Object.values(t.members).map((function(a){return e(a,t.shortLabel?n.concat([t.shortLabel]):n)})).flat():(t.categories=n,[t])}({members:e._source.configuration}).map((function(a){var r=function(e,t,n){var a=e.type.split(" ")[0].toLowerCase();"bam"===a&&e.bigDataUrl.toLowerCase().endsWith("cram")&&(a="cram");var r,o=e.bigDataUrl,i={uri:new URL(o,t).href},c=e.categories;switch(a){case"bam":return r=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href}:e.bigDataIndex?{localPath:e.bigDataIndex}:{localPath:"".concat(e.bigDataUrl,".bai")},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BamAdapter",bamLocation:i,index:{location:r}}};case"bed":case"bed5floatscore":case"bedgraph":case"bedrnaelements":case"bigbarchart":return Object(Ue.generateUnsupportedTrackConf)(e.shortLabel,a,c);case"bigbed":return{type:"FeatureTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigBedAdapter",bigBedLocation:i}};case"bigchain":case"biginteract":case"bigmaf":case"bigpsl":return Object(Ue.generateUnsupportedTrackConf)(e.shortLabel,a,c);case"bigwig":return{type:"QuantitativeTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigWigAdapter",bigWigLocation:i}};case"broadpeak":case"coloredexon":return Object(Ue.generateUnsupportedTrackConf)(e.shortLabel,a,c);case"cram":return r=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href}:e.bigDataIndex?{localPath:e.bigDataIndex}:{localPath:"".concat(e.bigDataUrl,".bai")},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"CramAdapter",bamLocation:i,index:{location:r},sequenceAdapter:n}};case"gvf":case"ld2":case"narrowpeak":case"peptidemapping":case"vcftabix":case"wig":case"wigmaf":return Object(Ue.generateUnsupportedTrackConf)(e.shortLabel,a,c);default:throw new Error("Unsupported track type: ".concat(a))}}(a,e._source.hub.url,n);return r.trackId="trackhub-registry-".concat(xl()(r)),r.assemblyNames=[t],r}))}var ph=function(e){return b.types.compose("TheTrackHubRegistryConnection",Object(Fe.BaseConnectionModelFactory)(e),b.types.model({type:b.types.literal("TheTrackHubRegistryConnection"),configuration:Object(P.ConfigurationReference)(dh)}).actions((function(e){return{connect:function(t){e.clear();var n=Object(P.readConfObject)(t,"trackDbId");fetch("https://www.trackhubregistry.org/api/search/trackdb/".concat(n)).then((function(e){return e.json()})).then((function(t){var n=Object(P.readConfObject)(e.configuration,"assemblyName"),a=Object(_.getSession)(e).assemblies.find((function(e){return Object(P.readConfObject)(e,"name")===n})),r=Object(P.readConfObject)(a,["sequence","adapter"]);e.setTrackConfs(fh(t,n,r))})).catch((function(e){console.error(e)}))}}})))},mh=n(1039),gh=n(2513),hh=n(2420),bh=n.n(hh),vh=n(990),yh=n.n(vh);var wh=function(e){var t=Object(p.useState)(null),n=Object(f.a)(t,2),a=n[0],r=n[1],o=Object(p.useState)(null),i=Object(f.a)(o,2),s=i[0],u=i[1],d=e.hub,g=d.url,h=d.longLabel,b=d.shortLabel;return Object(p.useEffect)((function(){function e(){return(e=Object(l.a)(c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Object(oe.openLocation)({uri:g}),e.next=4,n.readFile("utf8");case 4:t=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),u(m.a.createElement("span",null,m.a.createElement("strong",null,"Error retrieving hub")," ",e.t0.message," ",m.a.createElement("br",null),g)),e.abrupt("return");case 11:try{a=new Sl.HubFile(t),r(a)}catch(o){u(m.a.createElement("span",null,m.a.createElement("strong",null,"Could not parse genomes file:")," ",m.a.createElement("br",null),o.message," ",m.a.createElement("br",null),g))}case 12:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[g]),s?m.a.createElement(ns.a,null,m.a.createElement(as.a,null,m.a.createElement(Je.a,{color:"error"},s))):a?m.a.createElement(ns.a,null,m.a.createElement(rs.a,{title:b}),m.a.createElement(as.a,null,m.a.createElement("div",{__dangerouslySetInnerHTML:yh.a.sanitize(h)})),m.a.createElement(gh.a,null,m.a.createElement(Qt.a,{href:"mailto:".concat(a.get("email")),rel:"noopener noreferrer",target:"_blank",color:"secondary"},m.a.createElement(bh.a,null)),a.get("descriptionUrl")?m.a.createElement(Qt.a,{href:new URL(a.get("descriptionUrl"),new URL(g)).href,rel:"noopener noreferrer",target:"_blank"},m.a.createElement(Kl.a,{color:"secondary"})):null)):m.a.createElement(yn.a,{variant:"query"})},Oh=n(2549),jh=Object(Ze.a)((function(e){return{formControl:{minWidth:192,marginLeft:e.spacing(2),marginRight:e.spacing(2)}}}));var kh=function(e){var t=e.selectList,n=e.selectedItem,a=e.handleSelect,r=e.label,o=e.helpText,i=jh();return m.a.createElement(os.a,{className:i.formControl},m.a.createElement(cs.a,null,r),m.a.createElement(Oh.a,{value:n,onChange:a},t.map((function(e){var t,n;return e.name&&(t=e.name,n="".concat(e.name," (").concat(e.synonyms.join(" "),")")),m.a.createElement(va.a,{key:n||e,value:t||e},n||e)}))),m.a.createElement(is.a,null,n?"":o))};function Ch(e){var t=e.status;return m.a.createElement(m.a.Fragment,null,m.a.createElement(yn.a,{variant:"query"}),m.a.createElement(Je.a,null,t))}function Eh(e){return(0,e.children)(Object(d.a)(e,["children"]))}var xh=Object(Ze.a)((function(e){return{hubList:{maxHeight:400,overflowY:"auto"},genomeSelector:{marginTop:e.spacing(1)}}}));var Sh=function(e){var t=e.model,n=e.setModelReady,a=Object(p.useState)(null),r=Object(f.a)(a,2),o=r[0],i=r[1],s=Object(p.useState)(null),u=Object(f.a)(s,2),d=u[0],g=u[1],h=Object(p.useState)(""),b=Object(f.a)(h,2),v=b[0],y=b[1],w=Object(p.useState)(""),O=Object(f.a)(w,2),j=O[0],k=O[1],C=Object(p.useState)(new Map),E=Object(f.a)(C,2),x=E[0],S=E[1],T=Object(p.useState)(!1),N=Object(f.a)(T,2),A=N[0],R=N[1],M=Object(p.useState)(""),P=Object(f.a)(M,2),F=P[0],I=P[1],B=xh();function L(e){return D.apply(this,arguments)}function D(){return(D=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 10,n=t?new Map:new Map(x),a=Math.floor(x.size/10)+1,e.next=5,q("https://www.trackhubregistry.org/api/search",{assembly:j},{page:a,entries_per_page:10});case 5:if(!(r=e.sent)){e.next=38;break}o=Object(He.a)(r.items),e.prev=8,o.s();case 10:if((i=o.n()).done){e.next=28;break}if(!(s=i.value).hub.url.startsWith("ftp://")){e.next=16;break}s.error="JBrowse cannot add connections from FTP sources",e.next=25;break;case 16:return l=Object(oe.openLocation)({uri:s.hub.url}),e.prev=17,e.next=20,l.stat();case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(17),s.error=e.t0.message;case 25:n.set(s.id,s);case 26:e.next=10;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(8),o.e(e.t1);case 33:return e.prev=33,o.f(),e.finish(33);case 36:S(n),n.size===r.total_entries&&R(!0);case 38:case"end":return e.stop()}}),e,null,[[8,30,33,36],[17,22]])})))).apply(this,arguments)}function V(e){return W.apply(this,arguments)}function W(){return(W=Object(l.a)(c.a.mark((function e(t){var n,a,r,o=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=Object.keys(n).map((function(e){return"".concat(e,"=").concat(n[e])})).join(";"),e.prev=2,e.next=5,fetch("".concat(t).concat(r?"?".concat(r):""));case 5:a=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),i(m.a.createElement("span",null,m.a.createElement("strong",null,"Network connection error.")," ",m.a.createElement("br",null),e.t0.message," ",m.a.createElement("br",null),t)),e.abrupt("return",null);case 12:if(a.ok){e.next=15;break}return i(m.a.createElement("span",null,m.a.createElement("strong",null,"Error connecting to the URL.")," ",m.a.createElement("br",null),a.status,": ",a.statusText," ",m.a.createElement("br",null),t)),e.abrupt("return",null);case 15:return e.abrupt("return",a.json());case 16:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function q(e){return z.apply(this,arguments)}function z(){return(z=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,s=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},a=s.length>2&&void 0!==s[2]?s[2]:{},o=Object.keys(a).map((function(e){return"".concat(e,"=").concat(a[e])})).join(";"),e.prev=3,e.next=6,fetch("".concat(t).concat(o?"?".concat(o):""),{method:"POST",body:JSON.stringify(n)});case 6:r=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),i(m.a.createElement("span",null,m.a.createElement("strong",null,"Network connection error.")," ",m.a.createElement("br",null),e.t0.message," ",m.a.createElement("br",null),t)),e.abrupt("return",null);case 13:if(r.ok){e.next=16;break}return i(m.a.createElement("span",null,m.a.createElement("strong",null,"Error connecting to the URL.")," ",m.a.createElement("br",null),r.status,": ",r.statusText," ",m.a.createElement("br",null),t)),e.abrupt("return",null);case 16:return e.abrupt("return",r.json());case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}Object(p.useEffect)((function(){n(!!F)}),[F,n]),Object(p.useEffect)((function(){function e(){return(e=Object(l.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V("https://www.trackhubregistry.org/api/info/ping");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(1===t.ping){e.next=8;break}return i("Registry is not available"),e.abrupt("return");case 8:return e.next=10,V("https://www.trackhubregistry.org/api/info/assemblies");case 10:(n=e.sent)&&g(n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(p.useEffect)((function(){o||(j&&!x.size?L(!0):x.size&&!A&&L())}));var H=[m.a.createElement(Je.a,{key:"heading",variant:"h6"},"The Track Hub Registry")];if(o)return H.push(m.a.createElement(Je.a,{key:"errorMessage",color:"error"},o)),m.a.createElement("div",null,H);if(!d)return H.push(m.a.createElement(Ch,{key:"queryStatus",status:"Connecting to registry..."})),m.a.createElement("div",null,H);var _=Object.keys(d).sort().filter((function(e){return e.toLowerCase().includes("sapiens")}));if(H.push(m.a.createElement(kh,{key:"speciesSelect",selectList:_,selectedItem:v,handleSelect:function(e){y(e.target.value),k(""),S(new Map),I(""),R(!1)},label:"Species",helpText:"Select a species"})),v){var U=d[v].filter((function(e){return!("GRCh37"===e.name&&"hg38"===e.synonyms[0])}));H.push(m.a.createElement(kh,{key:"assemblySelect",selectList:U,selectedItem:j,handleSelect:function(e){k(e.target.value),S(new Map),I(""),R(!1)},label:"Assembly",helpText:"Select an assembly"}))}return j&&(H.push(m.a.createElement("div",{key:"hubSelect"},m.a.createElement(os.a,null,m.a.createElement($c.a,null,"Hubs:"),m.a.createElement("div",{className:B.hubList},m.a.createElement(mh.a,{value:F,onChange:function(e){var n=e.target.value;I(n),t.target.name.set(x.get(n).hub.shortLabel),t.target.trackDbId.set(n)}},Array.from(x.values()).filter((function(e){return e.assembly.name===j||e.assembly.synonyms.includes(j)})).map((function(e){var t=e.error,n=e.id,a=e.hub,r=a.shortLabel,o=a.longLabel;return m.a.createElement(Eh,{key:n,value:n},(function(e){return m.a.createElement(et.a,{title:t||m.a.createElement(Aa.a,{html:o}),placement:"left",interactive:!0},m.a.createElement(ei.a,Object.assign({key:n,value:n,label:m.a.createElement(Aa.a,{html:r}),disabled:Boolean(t),control:m.a.createElement(ed.a,null)},e)))}))}))))))),A||H.push(m.a.createElement(Ch,{key:"hubStatus",status:"Retrieving hubs"}))),F&&H.push(m.a.createElement(wh,{key:"hubDetails",hub:x.get(F).hub})),m.a.createElement(m.a.Fragment,null,H)},Th=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="TrackHubRegistryPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addConnectionType((function(){return new S({name:"TheTrackHubRegistryConnection",configSchema:dh,configEditorComponent:Sh,stateModel:ph(e),displayName:"The Track Hub Registry",description:"A hub from The Track Hub Registry",url:"//trackhubregistry.org/"})}))}}]),n}(F.a),Nh=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a=t("@jbrowse/core/configuration"),r=a.ConfigurationSchema,o=a.ConfigurationReference,i=t("@jbrowse/core/util").getContainingView,c=t("@jbrowse/core/util/tracks").getParentRenderProps,s=r("ChordVariantDisplay",{renderer:n.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:Kc,explicitlyTyped:!0});return{stateModel:n.compose("ChordVariantDisplay",Yc,n.model({type:n.literal("ChordVariantDisplay"),configuration:o(s)})).views((function(e){return{get rendererTypeName(){return e.configuration.renderer.type},get renderProps(){var t=i(e);return Object(u.a)(Object(u.a)({},c(e)),{},{displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick})}}})),configSchema:s}},Ah=function(e){var t=e.lib,n=e.load,a=t["@jbrowse/core/pluggableElementTypes/DisplayType"],r=n(Nh),o=r.stateModel;return new a({name:"ChordVariantDisplay",configSchema:r.configSchema,stateModel:o,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:Jc(e)})};var Rh=function(e){return b.types.compose("LinearVariantDisplay",ar(e),b.types.model({type:b.types.literal("LinearVariantDisplay"),configuration:Object(P.ConfigurationReference)(e)})).actions((function(e){return{selectFeature:function(t){var n=Object(_.getSession)(e);if(Object(_.isSessionModelWithWidgets)(n)){var a=n.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:Object(_.getContainingView)(e)});n.showWidget(a)}n.setSelection(t)}}}))},Mh=function(e){var t=e.jbrequire,n=t("react"),a=t("react").useMemo,r=t("mobx-react"),o=r.observer,i=(r.PropTypes,t("@jbrowse/core/util").polarToCartesian),c=t("@jbrowse/core/configuration").readConfObject;t("@jbrowse/core/util/types/mst").PropTypes,t("prop-types");function l(e,t){var n=e.region.elided?0:e.region.start,a=e.region.elided?0:e.region.end;return(e.flipped?a-t:t-n)/e.bpPerRadian+e.startRadians}var u=o((function(e){var t,a,r,o=e.feature,u=e.blocksForRefs,d=e.radius,p=e.config,m=e.bezierRadius,g=e.selected,h=e.onClick,b=u[o.get("refName")];if(!b)return null;if(o.get("INFO")){var v=o.get("INFO").SVTYPE||[];t=Object(f.a)(v,1)[0]}else o.get("mate")&&(t="mate");if("BND"===t){var y=(o.get("ALT")||[])[0].MatePosition.split(":");a=parseInt(y[1],10),r=u[y[0]]}else if("TRA"===t){var w=((o.get("INFO")||{}).CHR2||[])[0],O=((o.get("INFO")||{}).END||[])[0];a=parseInt(O,10),r=u[w]}else if("mate"===t){var j=o.get("mate"),k=j.refName;a=j.start,r=u[k]}if(r){var C,E=o.get("start"),x=l(b,E),S=l(r,a),T=i(d,x),N=i(d,S),A=i(m,(S+x)/2);C=c(p,g?"strokeColorSelected":"strokeColor",{feature:o});var R=c(p,"strokeColorHover",{feature:o});return n.createElement("path",{"data-testid":"chord-".concat(o.id()),d:["M"].concat(Object(s.a)(T),["Q"],Object(s.a)(A),Object(s.a)(N)).join(" "),style:{stroke:C},onClick:function(e){return h(o,b.region,r.region,e)},onMouseOver:function(e){g||(e.target.style.stroke=R)},onMouseOut:function(e){g||(e.target.style.stroke=C)}})}return null}));function d(e){var t,r=e.features,o=e.config,i=e.displayModel,c=e.blockDefinitions,s=e.radius,l=e.bezierRadius,d=e.displayModel.selectedFeatureId,p=e.onChordClick,m=a((function(){var e={};return c.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(n){e[n.refName]=t}))})),e}),[c]),g=[],h=Object(He.a)(r);try{for(h.s();!(t=h.n()).done;){var b=Object(f.a)(t.value,2),v=b[0],y=b[1],w=String(d)===String(y.id());g.push(n.createElement(u,{key:v,feature:y,config:o,displayModel:i,radius:s,bezierRadius:l,blocksForRefs:m,selected:w,onClick:p}))}}catch(j){h.e(j)}finally{h.f()}var O="chords-".concat(i.id);return n.createElement("g",{id:O,"data-testid":"structuralVariantChordRenderer"},n.createElement("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(O," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),g)}return d.defaultProps={displayModel:void 0,selectedFeatureId:"",onChordClick:void 0},o(d)},Ph=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType"),a=t("@jbrowse/core/configuration").ConfigurationSchema;return new n({name:"StructuralVariantChordRenderer",ReactComponent:t(Mh),configSchema:a("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0}),pluginManager:e})},Fh=n(980),Ih=n(2421),Bh=n.n(Ih),Lh=Object(Ze.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},block:{display:"block"}}})),Dh=Object(re.observer)((function(e){var t=e.model,n=e.handleClose,a=e.feature,r=e.viewType,o=Lh(),i=Object(p.useState)(!0),c=Object(f.a)(i,2),s=c[0],l=c[1],u=Object(p.useState)(!0),d=Object(f.a)(u,2),g=d[0],h=d[1];return m.a.createElement(Gt.a,{open:!0,onClose:n},m.a.createElement(Jt.a,null,"Breakpoint split view options",n?m.a.createElement(Qt.a,{className:o.closeButton,onClick:function(){n()}},m.a.createElement(Bh.a,null)):null),m.a.createElement(Xt.a,null),m.a.createElement(Yt.a,null,m.a.createElement(ei.a,{className:o.block,control:m.a.createElement(ti.a,{checked:s,onChange:function(){return l((function(e){return!e}))}}),label:"Copy tracks into the new view"}),m.a.createElement(ei.a,{className:o.block,control:m.a.createElement(ti.a,{checked:g,onChange:function(){return h((function(e){return!e}))}}),label:"Mirror tracks vertically in vertically stacked view"})),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){var e=t.view,o=Object(_.getSession)(t),i=r.snapshotFromBreakendFeature(a,e);i.views[0].offsetPx-=e.width/2+100,i.views[1].offsetPx-=e.width/2+100,i.featureData=a;var c=Object(b.getSnapshot)(e.tracks);i.views[0].tracks=c,i.views[1].tracks=g?c.slice().reverse():c,o.addView("BreakpointSplitView",i),n()},variant:"contained",color:"primary",autoFocus:!0},"OK"),m.a.createElement(Ge.a,{onClick:function(){n()},color:"secondary",variant:"contained",autoFocus:!0},"Cancel")))}));function Vh(e){var t=Object(p.useState)({}),n=Object(f.a)(t,2),a=n[0],r=n[1],o=Object(p.useState)(!1),i=Object(f.a)(o,2),c=i[0],l=i[1],d=e.feature.samples,g=void 0===d?{}:d,h=Object.entries(g);if(!h.length)return null;var b,v=["sample"].concat(Object(s.a)(Object.keys(h[0][1]))).map((function(e){return{field:e}})),y=[],w=Object.keys(a);try{y=h.map((function(e){return Object(u.a)(Object(u.a)({},Object.fromEntries(Object.entries(e[1]).map((function(e){return[e[0],String(e[1])]})))),{},{sample:e[0],id:e[0]})})).filter((function(e){return!w.length||w.every((function(t){var n=e[t],r=a[t];return!r||n.match(r)}))}))}catch(O){b=O}return m.a.createElement(Be.BaseCard,Object.assign({},e,{title:"Samples"}),b?m.a.createElement(Je.a,{color:"error"},"".concat(b)):null,m.a.createElement(ei.a,{control:m.a.createElement(ti.a,{checked:c,onChange:function(){return l((function(e){return!e}))}}),label:"Show sample filters"}),c?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,null,"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"),v.map((function(e){var t=e.field;return m.a.createElement(dn.a,{key:"filter-".concat(t),placeholder:"Filter ".concat(t),value:a[t]||"",onChange:function(e){return r(Object(u.a)(Object(u.a)({},a),{},Object(Mf.a)({},t,e.target.value)))}})}))):null,m.a.createElement("div",{style:{height:600,width:"100%",overflow:"auto"}},m.a.createElement(Fh.a,{rows:y,columns:v,rowHeight:20,headerHeight:25,disableSelectionOnClick:!0,disableColumnMenu:!0})))}function Wh(e){var t,n=e.model,a=e.locStrings,r=e.feature,o=Object(_.getSession)(n),i=Object(b.getEnv)(o).pluginManager,c=Object(p.useState)(!1),s=Object(f.a)(c,2),l=s[0],u=s[1];try{t=i.getViewType("BreakpointSplitView")}catch(g){}var d=new U.a(r);return m.a.createElement(Be.BaseCard,Object.assign({},e,{title:"Breakends"}),m.a.createElement(Je.a,null,"Link to linear view of breakend endpoints"),m.a.createElement("ul",null,a.map((function(e,t){return m.a.createElement("li",{key:"".concat(JSON.stringify(e),"-").concat(t)},m.a.createElement(no.a,{href:"#",onClick:function(){var t,a=n.view;a?null===(t=a.navToLocString)||void 0===t||t.call(a,e):o.notify("No view associated with this feature detail panel anymore","warning")}},"LGV - ".concat(e)))}))),t?m.a.createElement(m.a.Fragment,null,m.a.createElement(Je.a,null,"Launch split views with breakend source and target"),m.a.createElement("ul",null,a.map((function(e,t){return m.a.createElement("li",{key:"".concat(JSON.stringify(e),"-").concat(t)},m.a.createElement(no.a,{href:"#",onClick:function(){u(!0)}},"".concat(r.refName,":").concat(r.start," // ").concat(e," (split view)")))}))),l?m.a.createElement(Dh,{model:n,feature:d,viewType:t,handleClose:function(){u(!1)}}):null):null)}var qh=Object(re.observer)((function(e){var t=e.model,n=JSON.parse(JSON.stringify(t.featureData)),a=(n.samples,Object(d.a)(n,["samples"]));return m.a.createElement(nn.a,{"data-testid":"variant-side-drawer"},m.a.createElement(Be.FeatureDetails,Object.assign({feature:a,descriptions:{CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:" alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"}},e)),m.a.createElement(Xt.a,null),"breakend"===n.type?m.a.createElement(Wh,{feature:n,locStrings:n.ALT.map((function(e){return e.MatePosition})),model:t}):null,"translocation"===n.type?m.a.createElement(Wh,{feature:n,model:t,locStrings:["".concat(n.INFO.CHR2[0],":").concat(n.INFO.END)]}):null,m.a.createElement(Vh,Object.assign({feature:n},e)))})),zh=Object(P.ConfigurationSchema)("VariantFeatureWidget",{});function Hh(e){return b.types.model("VariantFeatureWidget",{id:Ie.ElementId,type:b.types.literal("VariantFeatureWidget"),featureData:b.types.frozen(),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var _h=n(1321),Uh=n.n(_h),Gh=function(){function e(t){Object(g.a)(this,e),this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}return Object(h.a)(e,[{key:"get",value:function(e){return"samples"===e?this.variant.SAMPLES:this.variant[e]||this.data[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat(Object(s.a)(Object.keys(this.data)),Object(s.a)(Object.keys(this.variant)),["samples"])}},{key:"id",value:function(){return this._id}},{key:"dataFromVariant",value:function(e){var t=e.POS-1,n=this._getSOTermAndDescription(e.REF,e.ALT),a=Object(f.a)(n,2),r=a[0],o=a[1],i=e.ALT&&e.ALT.some((function(e){return"<TRA>"===e})),c=e.ALT&&e.ALT.some((function(e){return"string"===typeof e&&-1!==e.indexOf("<")}));return{refName:e.CHROM,start:t,end:c&&e.INFO.END&&!i?Number(e.INFO.END[0]):t+e.REF.length,description:o,type:r,name:e.ID?e.ID[0]:void 0,aliases:e.ID&&e.ID.length>1?e.ID.slice(1):void 0}}},{key:"_getSOTermAndDescription",value:function(e,t){var n=this;if(!t||t===[])return["remark","no alternative alleles"];var a=new Set,r=new Set;if(t.forEach((function(t){var o=n._getSOAndDescFromAltDefs(e,t),i=Object(f.a)(o,2),c=i[0],s=i[1];if(!c){var l=n._getSOAndDescByExamination(e,t),u=Object(f.a)(l,2);c=u[0],s=u[1]}c&&s&&(a.add(c),r.add(s))})),r.size>1){var o=new Set;r.forEach((function(e){var t=/(\w+? \w+? -> )(?:<)\w+(?:>)/.exec(e);t&&t[1]?o.add(t[1]):o.add(e)}));var i=[];Object(s.a)(o).forEach((function(e){var t=[];Object(s.a)(r).forEach((function(n){n.startsWith(e)&&t.push(n.slice(e.length))})),i.push(e+t.join(","))})),r=new Set(i)}return a.size?[Object(s.a)(a).join(","),Object(s.a)(r).join(",")]:[void 0,void 0]}},{key:"_getSOAndDescFromAltDefs",value:function(t,n){if("object"===typeof n)return["breakend","A VCF breakend defines one end of a point of structural variation"];if("string"===typeof n&&!n.startsWith("<"))return[void 0,void 0];n=n.replace(/^<|>$/g,"");var a=e._altTypeToSO[n];if(!a&&this.parser.getMetadata("ALT",n)&&(a="sequence_variant"),a)return[a,this.parser.getMetadata("ALT",n,"Description")?"".concat(n," - ").concat(this.parser.getMetadata("ALT",n,"Description")):this._makeDescriptionString(a,t,n)];var r=n.split(":");return r.length>1?this._getSOAndDescFromAltDefs(t,"<".concat(r.slice(0,r.length-1).join(":"),">")):[void 0,void 0]}},{key:"_getSOAndDescByExamination",value:function(e,t){return"object"===typeof t?["breakend",this._makeDescriptionString("breakend",e,t)]:1===e.length&&1===t.length?["SNV",this._makeDescriptionString("SNV",e,t)]:e.length===t.length?e.split("").reverse().join("")===t?["inversion",this._makeDescriptionString("inversion",e,t)]:["substitution",this._makeDescriptionString("substitution",e,t)]:e.length<=t.length?["insertion",this._makeDescriptionString("insertion",e,t)]:e.length>t.length?["deletion",this._makeDescriptionString("deletion",e,t)]:["indel",this._makeDescriptionString("indel",e,t)]}},{key:"_makeDescriptionString",value:function(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}},{key:"toJSON",value:function(){return Object(u.a)(Object(u.a)(Object(u.a)({uniqueId:this._id},this.data),this.variant),{},{samples:this.variant.SAMPLES})}}]),e}();Gh._altTypeToSO={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};var Jh=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this,e)).vcf=void 0,a.filehandle=void 0,a.parser=void 0;var r=Object(P.readConfObject)(e,"vcfGzLocation"),o=Object(P.readConfObject)(e,["index","location"]),i=Object(P.readConfObject)(e,["index","indexType"]);return a.filehandle=Object(oe.openLocation)(r),a.vcf=new Bi.TabixIndexedFile({filehandle:a.filehandle,csiFilehandle:"CSI"===i?Object(oe.openLocation)(o):void 0,tbiFilehandle:"CSI"!==i?Object(oe.openLocation)(o):void 0,chunkCacheSize:50*Math.pow(2,20),chunkSizeLimit:1e9}),a.parser=a.vcf.getHeader().then((function(e){return new Uh.a({header:e})})),a}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",this.vcf.getReferenceSequenceNames(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.vcf.getHeader());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parser;case 2:return t=e.sent,e.abrupt("return",t.getMetadata());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(ur.ObservableCreate)(function(){var a=Object(l.a)(c.a.mark((function a(r){var o;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.parser;case 2:return o=a.sent,a.next=5,t.vcf.getLines(e.refName,e.start,e.end,{lineCallback:function(e,n){var a=o.parseLine(e),i=new Gh({variant:a,parser:o,id:"".concat(t.id,"-vcf-").concat(n)});r.next(i)},signal:n.signal});case 5:r.complete();case 6:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),n.signal)}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object(Yr.a)(Object(Kr.a)(n.prototype),"getFeaturesInMultipleRegions",this);return Object(ur.ObservableCreate)(function(){var n=Object(l.a)(c.a.mark((function n(o){var i,s,l;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.bytesForRegions(e);case 2:return i=n.sent,n.next=5,t.filehandle.stat();case 5:s=n.sent,(l=Math.round(i/s.size*100))>100&&(l=100),l>60&&console.warn("getFeaturesInMultipleRegions fetching ".concat(l,"% of VCF file, but whole-file streaming not yet implemented")),r.call(t,e,a).subscribe(o);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"bytesForRegions",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r.vcf.index.blocksForRange(e.refName,e.start,e.end)})));case 2:return n=e.sent,a=[],n.forEach((function(e){e.forEach((function(e){var t=e.minv.blockPosition,n=e.maxv.blockPosition+64e3;a.find((function(e){return e.start<=n&&e.end>=t&&(e.start=Math.min(e.start,t),e.end=Math.max(e.end,n),!0)}))||a.push({start:t,end:n})}))})),e.abrupt("return",a.reduce((function(e,t){return e+t.end-t.start+1}),0));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(H.BaseFeatureDataAdapter),Qh=Object(P.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz"}},index:Object(P.ConfigurationSchema)("VcfIndex",{indexType:{model:b.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi"}}})},{explicitlyTyped:!0}),Xh=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="VariantsPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"VcfTabixAdapter",configSchema:Qh,AdapterClass:Jh})})),e.addRendererType((function(){return e.jbrequire(Ph)})),e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e)});return new w.a({name:"VariantTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"VariantTrack",t)})})),e.addDisplayType((function(){return e.jbrequire(Ah)})),e.addDisplayType((function(){var t=function(e){var t=rr(e);return Object(P.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new O.a({name:"LinearVariantDisplay",configSchema:t,stateModel:Rh(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addWidgetType((function(){return new k.a({name:"VariantFeatureWidget",heading:"Feature details",configSchema:zh,stateModel:Hh(e),ReactComponent:qh})}))}}]),n}(F.a),Yh=n(2430),Kh=n.n(Yh),Zh=function(e){var t=e.jbrequire,n=t("mobx-react").observer,a=t("react"),r=a.useState,o=a.useEffect,i=t("@jbrowse/core/ui").FileSelector,c=t("@jbrowse/core/configuration").readConfObject,s=t("@material-ui/core/styles").makeStyles,l=t("@material-ui/core/Card"),u=t("@material-ui/core/CardContent"),d=t("@material-ui/core/FormControl"),p=t("@material-ui/core/FormGroup"),m=t("@material-ui/core/FormLabel"),g=t("@material-ui/core/FormControlLabel"),h=t("@material-ui/core/Checkbox"),b=t("@material-ui/core/RadioGroup"),v=t("@material-ui/core/Radio"),y=t("@material-ui/core/Container"),w=t("@material-ui/core/Button"),O=t("@material-ui/core/Grid"),j=t("@material-ui/core/Typography"),k=t("@material-ui/core/TextField"),C=t("@material-ui/core/MenuItem"),E=t("@material-ui/core/Select"),x=s((function(e){return{root:{position:"relative",padding:e.spacing(1),background:"white"},errorCard:{width:"50%",margin:[[e.spacing(2),"auto"]],border:[["2px","solid",e.palette.error.main]]},buttonContainer:{marginTop:e.spacing(1)}}})),S=n((function(e){var t=e.model,n=e.disabled,i=e.modelPropName,c=e.modelSetterName,s=r(t[i]),l=Object(f.a)(s,2),u=l[0],d=l[1];return o((function(){var e=parseInt(u,10);Number.isNaN(e)||(e>0?t[c](e):d(1))}),[t,c,u]),a.createElement(k,{value:u,disabled:n,type:"number",onChange:function(e){return d(e.target.value)},style:{width:"2rem",verticalAlign:"baseline"}})})),T=n((function(e){var t=e.model,n=x(),r="CSV"===t.fileType||"TSV"===t.fileType,o=t.selectedAssemblyIdx,s=t.setSelectedAssemblyIdx,l=t.fileType,u=t.fileTypes,f=t.setFileType,j=t.hasColumnNameLine,k=t.toggleHasColumnNameLine,T=t.assemblyChoices;return a.createElement(y,null,a.createElement(O,{style:{width:"25rem",margin:"0 auto"},container:!0,spacing:1,direction:"column",alignItems:"flex-start"},a.createElement(O,{item:!0},a.createElement(d,{component:"fieldset"},a.createElement(m,{component:"legend"},"Tabular file"),a.createElement(p,null,a.createElement(i,{location:t.fileSource,setLocation:t.setFileSource,localFileAllowed:!0})))),a.createElement(O,{item:!0},a.createElement(d,{component:"fieldset",className:n.formControl},a.createElement(m,{component:"legend"},"File Type"),a.createElement(b,{"aria-label":"file type",name:"type",value:l},a.createElement(O,{container:!0,spacing:1,direction:"row"},u.map((function(e){return a.createElement(O,{item:!0,key:e},a.createElement(g,{checked:l===e,value:e,onClick:function(){return f(e)},control:a.createElement(v,null),label:e}))})))))),r?a.createElement(O,{item:!0},a.createElement(d,{component:"fieldset",className:n.formControl},a.createElement(m,{component:"legend"},"Column Names"),a.createElement("div",null,a.createElement(g,{disabled:!r,label:"has column names on line",labelPlacement:"end",control:a.createElement(h,{checked:j,onClick:k})}),a.createElement(S,{model:t,disabled:!r||!j,modelPropName:"columnNameLineNumber",modelSetterName:"setColumnNameLineNumber"})))):null,a.createElement(O,{item:!0},a.createElement(d,{fullWidth:!0},a.createElement(m,{component:"legend"},"Associated with assembly"),a.createElement(E,{value:o,onChange:function(e){return s(e.target.value)}},T.map((function(e,t){var n=c(e,"name");return a.createElement(C,{key:n,value:t},n)}))))),a.createElement(O,{item:!0,className:n.buttonContainer},t.canCancel?a.createElement(w,{variant:"contained",color:"default",onClick:t.cancelButton,disabled:!t.canCancel},"Cancel"):null," ",a.createElement(w,{disabled:!t.isReadyToOpen,variant:"contained",color:"primary",onClick:t.import},"Open"))))})),N=n((function(e){var t=e.errorMessage,n=x();return a.createElement(l,{className:n.errorCard},a.createElement(u,null,a.createElement(j,{variant:"h6",color:"error"},String(t))))}));return n((function(e){var t=e.model,n=x();return a.createElement(a.Fragment,null,t.error?a.createElement(y,{className:n.errorContainer},a.createElement(N,{errorMessage:"".concat(t.error)})):null,a.createElement(T,{model:t}))}))},$h=n(2427),eb=n.n($h),tb=n(1e3),nb=n.n(tb),ab=n(2426),rb=n.n(ab),ob=n(844),ib=n.n(ob),cb=n(2425),sb=n.n(cb),lb=function(e){var t=e.jbrequire,n=t("mobx-react").observer,a=t("react"),r=t("@jbrowse/core/util").iterMap,o=t("@jbrowse/core/ui").Menu;return n((function(e){var t=e.viewModel,n=e.spreadsheetModel,i=e.currentColumnMenu,c=e.setColumnMenu,s=function(){c(null)};var l=i&&i.colNumber,u=function(e){n.setSortColumns([{columnNumber:l,descending:e}])},d=n.dataTypeChoices,p=new Map;d.forEach((function(e){var t=e.displayName,n=e.categoryName;n?(p.has(n)||p.set(n,{isCategory:!0,subMenuItems:[]}),p.get(n).subMenuItems.push(e)):p.set(t,e)}));var m=i&&n.columns[l].dataType,g=m&&m.type||"",h=i&&n.columns[l].dataType.displayName||"",b=Boolean(n.sortColumns.length&&i&&n.sortColumns.find((function(e){return e.columnNumber===i.colNumber&&!e.descending}))),v=Boolean(n.sortColumns.length&&i&&n.sortColumns.find((function(e){return e.columnNumber===i.colNumber&&e.descending})));function y(){s(),n.setSortColumns([])}var w=[{label:"Sort ascending",icon:Wo.a,type:"radio",checked:b,onClick:b?y:u.bind(null,!1)},{label:"Sort descending",icon:Wo.a,type:"radio",checked:v,onClick:v?y:u.bind(null,!0)},{label:"Type: ".concat(h),icon:sb.a,subMenu:r(p.entries(),(function(e){var t=Object(f.a)(e,2),a=t[0],r=t[1],o=r.subMenuItems,i=r.typeName;if(i){var c={label:a||i,onClick:function(){n.setColumnType(l,i)}};return g===i&&(c.icon=rb.a),c}return o?{label:a,icon:o.find((function(e){return e.typeName===g}))?rb.a:void 0,subMenu:o.map((function(e){var t=e.typeName;return{label:e.displayName,icon:t===g?rb.a:void 0,onClick:function(){n.setColumnType(l,t)}}}))}:null})).filter(Boolean)}];return m&&m.hasFilter&&w.push({label:"Create filter",icon:ib.a,onClick:function(){t.filterControls.addBlankColumnFilter(l)}.bind(null,!0)}),a.createElement(o,{anchorEl:i&&i.anchorEl,open:Boolean(i),onMenuItemClick:function(e,t){t(),s()},onClose:s,menuItems:w,anchorOrigin:{vertical:"bottom",horizontal:"right"}})}))},ub=function(e){var t=e.lib,n=t["mobx-react"].observer,a=t.react;return n((function(e){var t,n=e.viewModel,r=e.spreadsheetModel,o=r.rowMenuPosition,i=r.setRowMenuPosition,c=function(){i(null)},s=null===(t=r.rowMenuPosition)||void 0===t?void 0:t.rowNumber;if(void 0===s)return null;var l=r.rowSet.rows[s-1];var d=n.rowMenuItems.map((function(e){if("function"===typeof e.disabled){var t=e.disabled(n,r,s,l);return Object(u.a)(Object(u.a)({},e),{},{disabled:t})}return e}));return a.createElement(ue.Menu,{anchorEl:o&&o.anchorEl,open:Boolean(o),onMenuItemClick:function(e,t){t(n,r,s,l),c()},onClose:c,menuItems:d,anchorOrigin:{vertical:"bottom",horizontal:"right"}})}))};var db=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("react")),o=r.useState,i=(t("prop-types"),t("mobx-state-tree").getParent),c=t("@material-ui/core/styles").makeStyles,s=t("@material-ui/core/colors"),l=s.grey,u=s.indigo,d=t("@material-ui/core/Checkbox"),p=t("@material-ui/core/IconButton"),m=t("@material-ui/core/Tooltip"),g=t("@material-ui/core/FormControlLabel"),h=t(lb),b=t(ub),v=c((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),background:l[500],overflow:"auto"},dataTable:{borderCollapse:"collapse",borderSpacing:0,boxSizing:"border-box","& td":{border:"1px solid ".concat(l[300]),padding:"0.2rem",maxWidth:"50em",overflow:"hidden",textOverflow:"ellipsis"}},dataTableBody:{background:"white"},rowNumCell:{background:l[200],textAlign:"left",border:"1px solid ".concat(l[300]),position:"relative",padding:"0 2px 0 0",whiteSpace:"nowrap",userSelect:"none"},rowNumber:{fontWeight:"normal",display:"inline-block",flex:"none",paddingRight:"20px",margin:0,whiteSpace:"nowrap"},rowMenuButton:{padding:0,margin:0,position:"absolute",right:0,display:"inline-block",whiteSpace:"nowrap",flex:"none"},rowMenuButtonIcon:{},rowSelector:{position:"relative",top:"-2px",margin:0,padding:"0 0.2rem"},columnHead:{fontWeight:"normal",background:l[200],border:"1px solid ".concat(l[300]),position:"sticky",top:"-1px",zIndex:2,whiteSpace:"nowrap",padding:[[0,e.spacing(1)]]},sortIndicator:{position:"relative",top:"0.2rem",fontSize:"1rem"},columnButtonContainer:{display:"none",position:"absolute",right:0,top:0,background:l[100],height:"100%",boxSizing:"border-box",borderLeft:"1px solid ".concat(l[300])},columnButton:{padding:0},topLeftCorner:{background:l[300],position:"sticky",top:"-1px",zIndex:2,minWidth:e.spacing(2),textAlign:"left"},dataRowSelected:{background:u[100],"& th":{background:u[100]}},emptyMessage:{captionSide:"bottom"}}})),y=a((function(e){var t=e.cell,n=e.spreadsheetModel,a=e.columnNumber,o=n.columns.get(a).dataType;return o.DataCellReactComponent?r.createElement(o.DataCellReactComponent,{cell:t,dataType:o,columnNumber:a,spreadsheet:n}):t.text})),w=a((function(e){var t=e.rowModel,n=e.rowNumber,a=e.spreadsheetModel,o=v(),i=a.hideRowSelection,c=a.columnDisplayOrder,s=o.dataRow;function l(e){t.toggleSelect(),e.stopPropagation(),e.preventDefault()}return t.isSelected&&(s+=" ".concat(o.dataRowSelected)),r.createElement("tr",{className:s},r.createElement("th",{className:o.rowNumCell,onClick:l},r.createElement(g,{className:o.rowNumber,control:i?null:r.createElement(d,{className:o.rowSelector,checked:t.isSelected,onClick:l}),label:t.id}),r.createElement(p,{className:o.rowMenuButton,onClick:function(e){a.setRowMenuPosition({anchorEl:e.currentTarget,rowNumber:n}),e.preventDefault(),e.stopPropagation()},color:"secondary"},r.createElement(nb.a,{className:o.rowMenuButtonIcon}))),c.map((function(e){return r.createElement("td",{key:e},r.createElement(y,{cell:t.cellsWithDerived[e],spreadsheetModel:a,columnNumber:e}))})))}));function O(e){var t=e.model,n=e.columnNumber,a=v(),o=t.sortColumns.find((function(e){return e.columnNumber===n}));return o?o.descending?r.createElement(Wd.a,{className:a.sortIndicator}):r.createElement(ja.a,{className:a.sortIndicator}):null}var j=a((function(e){var t=e.rows,n=e.spreadsheetModel,a=e.page,o=e.rowsPerPage,i=v();return r.createElement("tbody",{className:i.dataTableBody},t.slice(o*a,o*(a+1)).map((function(e){return r.createElement(w,{key:e.id,rowNumber:e.id,spreadsheetModel:n,rowModel:e})})))})),k=a((function(e){var t=e.model,n=e.page,a=e.rowsPerPage,c=t.columnDisplayOrder,s=t.columns,l=t.hasColumnNames,u=t.rowSet,d=v(),g=o(null),y=Object(f.a)(g,2),w=y[0],k=y[1];function C(e,t){k({colNumber:e,anchorEl:t.currentTarget})}var E=o(null),x=Object(f.a)(E,2),S=x[0],T=x[1];function N(e){T(e)}function A(){T(null)}var R=u.count,M=u.sortedFilteredRows;return r.createElement(r.Fragment,null,r.createElement(h,{viewModel:i(t),spreadsheetModel:t,currentColumnMenu:w,setColumnMenu:k}),r.createElement(b,{viewModel:i(t),spreadsheetModel:t}),r.createElement("table",{className:d.dataTable},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",{className:d.topLeftCorner},r.createElement(m,{title:"Unselect all",placement:"right"},r.createElement("span",null,r.createElement(p,{className:d.unselectAllButton,onClick:t.unselectAll,disabled:!t.rowSet.selectedCount,color:"secondary"},r.createElement(eb.a,{className:d.columnButtonIcon}))))),c.map((function(e){return r.createElement("th",{className:d.columnHead,key:e,onMouseOver:N.bind(null,e),onMouseOut:A.bind(null,e)},r.createElement(O,{model:t,columnNumber:e}),l&&s.get(e).name||function(e){function t(e){return String.fromCharCode(e+65)}if(e>=0){if(e<26)return t(e);if(e<702)return t(Math.floor(e/26-1))+t(e%26)}throw new RangeError("column number out of range")}(e),r.createElement("div",{className:d.columnButtonContainer,style:{display:S===e||w&&w.colNumber===e?"block":"none"}},r.createElement(p,{className:d.columnButton,onClick:C.bind(null,e),color:"secondary"},r.createElement(nb.a,{className:d.columnButtonIcon}))))})))),r.createElement(j,{rows:M,spreadsheetModel:t,page:n,rowsPerPage:a}),M.length?null:r.createElement("caption",{className:d.emptyMessage},R?"no rows match criteria":"no rows present")))}));function C(e){var t=e.model,n=e.height,a=e.page,o=e.rowsPerPage,i=v();return r.createElement("div",{className:i.root,style:{height:n}},t&&t.rowSet&&t.rowSet.isLoaded&&t.initialized?r.createElement(k,{model:t,page:a,rowsPerPage:o}):r.createElement("div",null,"Loading..."))}return C.defaultProps={model:void 0},a(C)},fb=function(e){var t=e.jbrequire,n=t("mobx-react").observer,a=t("react"),r=a.useEffect,o=a.useState,i=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/IconButton"),s=t("@material-ui/core/InputAdornment"),l=t("@jbrowse/core/util").useDebounce,u=t("@material-ui/core/TextField"),d=i((function(){return{textFilterControlEndAdornment:{marginRight:"-18px"}}})),p=n((function(e){var t=e.textFilter,n=d(),i=o(t.stringToFind),p=Object(f.a)(i,2),m=p[0],g=p[1],h=l(m,500);return r((function(){t.setString(h)}),[h,t]),a.createElement("div",{className:n.filterControls},a.createElement(u,{label:"text filter",value:m,onChange:function(e){return g(e.target.value)},className:n.textFilterControl,variant:"outlined",InputProps:{startAdornment:a.createElement(s,{className:n.textFilterControlStartAdornment,position:"start"},a.createElement(ib.a,null)),endAdornment:a.createElement(s,{className:n.textFilterControlEndAdornment,position:"end"},a.createElement(c,{"aria-label":"clear filter",onClick:function(){return g("")},color:"secondary"},a.createElement(du.a,null)))}}))}));return n((function(e){var t=e.model.filterControls.rowFullText;return a.createElement(p,{textFilter:t})}))},pb=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("mobx-state-tree").getParent),o=t("react"),i=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/Grid"),s=t("@material-ui/core/IconButton"),l=t("@material-ui/core/Typography"),u=i((function(e){return{columnName:{verticalAlign:"middle",paddingRight:"0.3em"},columnFilter:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",width:"100%",position:"relative"},filterIcon:{position:"relative",top:"12px"},filterIconBg:{background:e.palette.tertiary.main,color:"white",padding:[[0,e.spacing(1.5)]]}}}));function d(e){var t=e.filterModel;return t?o.createElement(t.ReactComponent,{filterModel:t}):null}return a((function(e){var t=e.viewModel,n=e.filterModel,a=e.columnNumber,i=e.height,f=u(),p=t.spreadsheet.columns[a];if(!p)throw new Error("no column definition! filters are probably out of date");return o.createElement(c,{container:!0,direction:"row",className:f.columnFilter,style:{height:i}},o.createElement(c,{item:!0,className:f.filterIconBg},o.createElement(ib.a,{className:f.filterIcon})),o.createElement(c,{item:!0},o.createElement(s,{onClick:function(){r(n,2).removeColumnFilter(n)},title:"remove filter",color:"secondary"},o.createElement($t.a,null)),o.createElement(l,{className:f.columnName,component:"span"},p.name)," ",o.createElement(d,{filterModel:n})))}))},mb=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("react")),o=t("@material-ui/core/IconButton"),i=t("@material-ui/core"),c=i.FormGroup,s=i.TablePagination,l=t("@material-ui/core/styles").makeStyles,u=t("@material-ui/core/Grid"),d=t("@jbrowse/core/ui").ResizeHandle,p=t(Zh),m=t(db),g=t(fb),h=t(pb),b=l((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),background:"white",overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,paddingLeft:e.spacing(1)},contentArea:{overflow:"auto"},columnFilter:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,paddingLeft:e.spacing(1)},viewControls:{margin:0},rowCount:{marginLeft:e.spacing(1)},statusBar:{position:"absolute",background:e.palette.background.light,left:0,bottom:0,height:40,width:"100%",boxSizing:"border-box",borderTop:"1px outset #b1b1b1",paddingLeft:e.spacing(1)},verticallyCenter:{display:"flex",justifyContent:"center",flexDirection:"column"},spacer:{flexGrow:1},textFilterControlAdornment:{marginRight:"-18px"}}})),v=a((function(e){var t=e.model,n=b();return r.createElement(u,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center"},r.createElement(u,{item:!0},r.createElement(o,{onClick:function(){return t.setImportMode()},className:n.iconButton,title:"open a tabular file","data-testid":"spreadsheet_view_open",color:"secondary"},r.createElement(zt.a,null))))})),y=a((function(e){var t=e.spreadsheet;if(t&&t.rowSet.isLoaded){var n,a=t.rowSet,r=a.passingFiltersCount,o=a.count,i=a.selectedCount,c=a.selectedAndPassingFiltersCount;if(r!==o){if(n="".concat(t.rowSet.passingFiltersCount," rows of ").concat(t.rowSet.count," total"),i){n+=", ".concat(c," selected");var s=i-c;s&&(n+=" (".concat(s," selected rows do not pass filters)"))}}else n="".concat(t.rowSet.count," rows"),i&&(n+=", ".concat(i," selected"));return n}return null}));return a((function(e){var t=e.model,n=b(),a=t.spreadsheet,o=t.filterControls.columnFilters.length,i=r.useState(0),l=Object(f.a)(i,2),w=l[0],O=l[1],j=r.useState(100),k=Object(f.a)(j,2),C=k[0],E=k[1];return r.createElement("div",{className:n.root,style:{height:t.height,width:t.width},"data-testid":t.id},r.createElement(u,{container:!0,direction:"row",className:n.header},t.hideViewControls?null:r.createElement(u,{item:!0},r.createElement(v,{model:t})),"display"!==t.mode||t.hideFilterControls?null:r.createElement(u,{item:!0},r.createElement(g,{model:t}))),"display"!==t.mode||t.hideFilterControls?null:t.filterControls.columnFilters.map((function(e,n){return r.createElement(h,{key:"".concat(e.columnNumber,"-").concat(n),viewModel:t,filterModel:e,columnNumber:e.columnNumber,height:46})})),r.createElement("div",{className:n.contentArea,style:{height:t.height-52}},"import"!==t.mode?null:r.createElement(p,{model:t.importWizard}),r.createElement("div",{style:{position:"relative",display:"display"===t.mode?void 0:"none"}},r.createElement(m,{page:w,rowsPerPage:C,model:a,height:t.height-52-46*o-40}))),r.createElement("div",{className:n.statusBar,style:{display:"display"===t.mode?void 0:"none"}},a?r.createElement(c,{row:!0},r.createElement("div",{className:n.verticallyCenter},r.createElement(y,{spreadsheet:a})),r.createElement("div",{className:n.spacer}),r.createElement(s,{rowsPerPageOptions:[10,25,100,1e3],count:a.rowSet.count,component:"div",rowsPerPage:C,page:w,onChangePage:function(e,t){O(t)},onChangeRowsPerPage:function(e){E(+e.target.value),O(0)}}),r.createElement("div",{className:n.spacer})):null),t.hideVerticalResizeHandle?null:r.createElement(d,{onDrag:t.resizeHeight,style:{height:t.dragHandleHeight,position:"absolute",bottom:0,left:0,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))}))},gb=n(2429),hb=n.n(gb),bb=function(e){var t=(0,e.jbrequire)("mobx-state-tree").types;return function(e,n){var a=n.DataCellReactComponent,r=void 0===a?null:a,o=n.FilterModelType,i=void 0===o?null:o,c=n.compare,s=n.displayName,l=void 0===s?void 0:s,u=n.categoryName,d=void 0===u?void 0:u;return t.model("ColumnDataType".concat(e),{type:t.literal(e)}).volatile((function(){return{DataCellReactComponent:r,FilterModelType:i,displayName:l||e,categoryName:d}})).views((function(){return{compare:c,get hasFilter(){return!!i}}}))}},vb=function(e){var t=e.jbrequire,n=t("mobx-state-tree"),a=n.types,r=n.getType,o=n.getParent,i=t("mobx-react").observer,s=t("react"),u=t("@jbrowse/core/util/mst-reflection"),d=u.getPropertyType,f=u.getEnumerationValues,p=u.getSubType,m=t("@jbrowse/core/util"),g=m.compareLocs,h=m.getSession,b=m.parseLocString,v=t(bb),y=t("@material-ui/core/styles").makeStyles,w=t("@material-ui/core/IconButton"),O=t("@material-ui/core/TextField"),j=t("@material-ui/core/MenuItem"),k=t("@material-ui/core/InputAdornment"),C=t("@material-ui/core/Select"),E=y((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),x=i((function(e){var t=e.filterModel,n=E(),a=f(p(d(r(t),"operation")));return s.createElement(s.Fragment,null,s.createElement(C,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},a.map((function(e){return s.createElement(j,{key:e,value:e},e)})))," ",s.createElement(O,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:function(e){return t.setLocString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:s.createElement(k,{className:n.textFilterControlAdornment,position:"end"},s.createElement(w,{"aria-label":"clear filter",onClick:function(){return t.setLocString("")},color:"secondary"},s.createElement(du.a,null)))}}))})),S=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],T={"overlaps with":function(e,t){return e.refName===t.refName&&Object(hi.a)(e.start,e.end,t.start,t.end)},"contained within":function(e,t){return e.refName===t.refName&&Object(hi.c)(e.start,e.end,t.start,t.end)},"fully contains":function(e,t){return e.refName===t.refName&&Object(hi.c)(t.start,t.end,e.start,e.end)},"does not overlap":function(e,t){return!T["overlaps with"](e,t)},"not contained within":function(e,t){return!T["contained within"](e,t)},"does not contain":function(e,t){return!T["fully contains"](e,t)}};function N(){return(N=Object(l.a)(c.a.mark((function e(t,n,a){var r,i,s,l,u,d,f,p,m,g,v,y;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h(t),i=r.assemblyManager,s=t.assemblyName,l=o(t),u=l.id,e.next=6,i.waitForAssembly(s);case 6:if(d=e.sent,e.prev=7,f=b(a.text,(function(e){return i.isValidRefName(e,t.assemblyName)})),p=f.refName,m=d.getCanonicalRefName(p),g=d.regions.find((function(e){return e.refName===m})),v="".concat(u,"_").concat(s),y=r.views.find((function(e){return e.id===v}))){e.next=19;break}return(y=r.addView("LinearGenomeView",{displayName:s,id:v})).setDisplayedRegions([JSON.parse(JSON.stringify(g))]),e.next=19,Object(_.when)((function(){return y.initialized}));case 19:y.navToLocString(a.text),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),r.notify("".concat(e.t0),"error");case 25:case"end":return e.stop()}}),e,null,[[7,22]])})))).apply(this,arguments)}return v("LocString",{categoryName:"Location",displayName:"Full location",compare:function(e,t){return g(e.extendedData,t.extendedData)},FilterModelType:a.model("ColumnLocStringFilter",{type:a.literal("LocString"),columnNumber:a.integer,locString:"",operation:a.optional(a.enumeration(S),S[0])}).views((function(e){return{get locStringIsInvalid(){if(e.locString){var t=e.parsedLocString;return!t||""===t.refName||"number"!==typeof t.start||"number"!==typeof t.end||t.start>t.end}return!1},get parsedLocString(){var t=h(e),n=o(e,3).spreadsheet.assemblyName;try{return b(e.locString,(function(e){return t.assemblyManager.isValidRefName(e,n)}))}catch(a){return}},get predicate(){if(!e.locString||e.locStringIsInvalid)return function(){return!0};var t=e.parsedLocString,n=e.operation,a=e.columnNumber;return function(e,r){var o=r.cellsWithDerived[a];if(!o||!o.text||!o.extendedData)return!1;var i=o.extendedData;if(!i.refName)return!1;var c=T[n];if(!c)throw new Error('"'.concat(n,'" not implemented in location filter'));return c(i,t)}}}})).actions((function(e){return{setLocString:function(t){e.locString=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:x}})),DataCellReactComponent:i((function(e){var t=e.cell,n=e.columnNumber,a=e.spreadsheet;return s.createElement("a",{onClick:function(e){e.preventDefault(),function(e,t,n){N.apply(this,arguments)}(a,n,t)},title:"open a new linear genome view here",href:"#link"},t.text)}))})},yb=function(e){var t=e.jbrequire,n=t("mobx-state-tree"),a=n.types,r=n.getType,o=t("mobx-react").observer,i=t("react"),c=t("@jbrowse/core/util/mst-reflection"),s=c.getPropertyType,l=c.getEnumerationValues,u=c.getSubType,d=t(bb),f=["equals","contains","does not contain","does not equal","starts with","ends with"],p={contains:function(e,t){return-1!==e.toLowerCase().indexOf(t)},equals:function(e,t){return e.toLowerCase()===t},"starts with":function(e,t){return 0===e.toLowerCase().indexOf(t)},"ends with":function(e,t){var n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":function(e,t){return!p.contains(e,t)},"does not equal":function(e,t){return!p.equals(e,t)}},m=t("@material-ui/core/styles").makeStyles,g=t("@material-ui/core/IconButton"),h=t("@material-ui/core/TextField"),b=t("@material-ui/core/MenuItem"),v=t("@material-ui/core/InputAdornment"),y=t("@material-ui/core/Select"),w=m((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),O=o((function(e){var t=e.filterModel,n=w(),a=l(u(s(r(t),"operation")));return i.createElement(i.Fragment,null,i.createElement(y,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},a.map((function(e){return i.createElement(b,{key:e,value:e},e)})))," ",i.createElement(h,{label:"text",value:t.stringToFind,onChange:function(e){return t.setString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:i.createElement(v,{className:n.textFilterControlAdornment,position:"end"},i.createElement(g,{"aria-label":"clear filter",onClick:function(){return t.setString("")},color:"secondary"},i.createElement(du.a,null)))}}))})),j=a.model("ColumnTextFilter",{type:a.literal("Text"),columnNumber:a.integer,stringToFind:"",operation:a.optional(a.enumeration(f),f[0])}).views((function(e){return{get predicate(){var t=e.stringToFind,n=e.columnNumber,a=e.operation;if(!t)return function(){return!0};var r=t.toLowerCase();return function(e,t){var o=t.cellsWithDerived[n];if(!o||!o.text)return!1;var i=p[a];if(!i)throw new Error('"'.concat(a,'" not implemented in location filter'));return i(o.text,r)}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:O}}));return{TextColumn:d("Text",{compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:j}),FilterModelType:j}},wb=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a=t(bb),r=t(yb).FilterModelType;return a("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:n.compose(r,n.model({type:n.literal("LocRef")}))})},Ob=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a=t("mobx-react").observer,r=t("react"),o=t(bb),i=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/TextField"),s=t("@material-ui/core/MenuItem"),l=t("@material-ui/core/Select"),u=["equals","greater than","less than","between","not between"],d={equals:function(e,t){return e===t},"greater than":function(e,t){return e>t},"less than":function(e,t){return e<t},between:function(e,t,n){return e>t&&e<n},"not between":function(e,t,n){return!d.between(e,t,n)}},f=i((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),p=a((function(e){var t=e.filterModel,n=f(),a=u;return r.createElement(r.Fragment,null,r.createElement(l,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},a.map((function(e){return r.createElement(s,{key:e,value:e},e)})))," ",r.createElement(c,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:function(e){t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:r.createElement(r.Fragment,null," and ",r.createElement(c,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:function(e){return t.setSecondNumber(parseFloat(e.target.value))},className:n.textFilterControl})))})),m=n.model("ColumnNumberFilter",{type:n.literal("Number"),columnNumber:n.integer,firstNumber:n.maybe(n.number),secondNumber:n.maybe(n.number),operation:n.optional(n.enumeration(u),u[0])}).views((function(e){return{get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};var t=e.firstNumber,n=e.secondNumber,a=e.operation,r=e.columnNumber;return function(e,o){var i=o.cellsWithDerived[r];if(!i||!i.text)return!1;var c=parseFloat(i.text);if("number"!==typeof c)return!1;var s=d[a];if(!s)throw new Error('"'.concat(a,'" not implemented in location filter'));return s(c,t,n)}}}})).actions((function(e){return{setFirstNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.firstNumber=void 0:e.firstNumber=t},setSecondNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.secondNumber=void 0:e.secondNumber=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:p}}));return{NumberColumn:o("Number",{compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:m}),FilterModelType:m}},jb=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a=t(bb),r=t(Ob).FilterModelType;return a("LocStart",{categoryName:"Location",displayName:"Start",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:n.compose(r,n.model({type:n.literal("LocStart")}))})},kb=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a=t(bb),r=t(Ob).FilterModelType;return a("LocEnd",{categoryName:"Location",displayName:"End",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:n.compose(r,n.model({type:n.literal("LocEnd")}))})},Cb=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,a={Number:t(Ob).NumberColumn,Text:t(yb).TextColumn,LocString:t(vb),LocRef:t(wb),LocStart:t(jb),LocEnd:t(kb)},r=Object.values(a),o=n.union.apply(n,Object(s.a)(r));return Object.freeze({ColumnTypes:a,AnyColumnType:o,AnyFilterModelType:n.union.apply(n,Object(s.a)(r.map((function(e){return e.create({type:e.properties.type.value}).FilterModelType})).filter((function(e){return!!e}))))})},Eb=function(e){var t=e.lib["mobx-state-tree"],n=t.types,a=t.getParent,r=n.model("SpreadsheetCell",{text:n.string,extendedData:n.maybe(n.frozen())});return n.model("SpreadsheetRow",{id:n.identifier,cells:n.array(r),extendedData:n.maybe(n.frozen()),isSelected:!1}).actions((function(e){return{toggleSelect:function(){e.isSelected=!e.isSelected},unSelect:function(){e.isSelected=!1},select:function(){e.isSelected=!0},setExtendedData:function(t){e.extendedData=t}}})).views((function(e){return{get cellsWithDerived(){var t=a(e,3).columns,n=0;return t.map((function(t){return t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]}))}}}))},xb=function(e){var t=e.lib,n=e.load,a=t["mobx-state-tree"],r=a.types,o=a.getParent,i=n(Eb);return r.model("StaticRowSet",{isLoaded:r.literal(!0),rows:r.array(i)}).views((function(e){return{get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){var t=o(e);return e.rows.slice().sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((function(e){return e.isSelected}))},get selectedFilteredRows(){var t=o(e),n=o(t).filterControls;return this.selectedRows.filter((function(e){return n.rowPassesFilters(t,e)}))},get sortedFilteredRows(){var t=o(e),n=o(t).filterControls;return e.rows.filter((function(e){return n.rowPassesFilters(t,e)})).sort(t.rowSortingComparisonFunction)}}})).actions((function(e){return{unselectAll:function(){e.rows.forEach((function(e){return e.unSelect()}))}}}))},Sb=function(e){var t=e.lib,n=e.load,a=t["mobx-state-tree"],r=a.types,o=a.getParent,i=n(Cb),s=i.ColumnTypes,u=i.AnyColumnType,d=n(xb),f=r.model("ColumnDefinition",{name:r.maybe(r.string),dataType:r.optional(u,(function(){return{type:"Text"}})),isDerived:!1,derivationFunctionText:r.maybe(r.string)}).views((function(t){return{get expr(){if(t.isDerived)return Object(hs.a)(String(t.derivationFunctionText),e.jexl)}}}));return r.model("Spreadsheet",{rowSet:r.optional(d,(function(){return d.create()})),columns:r.array(f),columnDisplayOrder:r.array(r.number),hasColumnNames:!1,sortColumns:r.array(r.model("SortColumns",{columnNumber:r.number,descending:!1}).actions((function(e){return{switchDirection:function(){e.descending=!e.descending}}}))),assemblyName:r.maybe(r.string)}).volatile((function(){return{defaultDataType:s.Text,rowMenuPosition:null,isLoaded:!1}})).views((function(e){return{get initialized(){var t=Object(_.getSession)(e),n=e.assemblyName;if(n){var a=t.assemblyManager.get(n);return a&&a.initialized}return!0},get hideRowSelection(){return o(e).hideRowSelection},get dataTypeChoices(){return Object.keys(s).map((function(e){var t=s[e].create({type:e});return{typeName:e,displayName:t.displayName,categoryName:t.categoryName}}))},rowSortingComparisonFunction:function(t,n){for(var a=0;a<e.sortColumns.length;a+=1){var r=e.sortColumns[a],o=r.columnNumber,i=r.descending,c=e.columns[o].dataType.compare(t.cellsWithDerived[o],n.cellsWithDerived[o]);if(c)return i?-c:c}return 0}}})).actions((function(e){return{afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(le.autorun)(Object(l.a)(c.a.mark((function n(){var a,r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Object(_.getSession)(e),r=a.assemblyManager,n.prev=2,!e.assemblyName){n.next=7;break}return n.next=6,r.waitForAssembly(e.assemblyName);case 6:t.setLoaded(!0);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),a.notify("failed to load assembly ".concat(e.assemblyName," ").concat(n.t0),"error");case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))))},setLoaded:function(t){e.isLoaded=t},setRowMenuPosition:function(t){e.rowMenuPosition=t},setSortColumns:function(t){t&&(e.sortColumns=t)},setColumnType:function(t,n){e.columns[t].dataType={type:n}},unselectAll:function(){return e.rowSet.unselectAll()}}}))},Tb=n(289),Nb=n(2428),Ab=n.n(Nb);function Rb(e){return new TextDecoder("utf-8",{fatal:!0}).decode(e)}function Mb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ab()(Object(u.a)({noheader:!0,output:"csv"},t)).fromString(Rb(e))}function Pb(e,t,n){var a,r=e.rows[0].cells[t].text||"",o="Text";try{a=Object(_.parseLocString)(r,n)}catch(i){}return a&&a.refName&&"number"===typeof a.start?o="LocString":/^\d+(\.\d+)?$/.test(r)&&(o="Number"),o}function Fb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{hasColumnNameLine:!1,columnNameLineNumber:1,isValidRefName:function(){return!1}},n=0,a={isLoaded:!0,rows:e.map((function(e,a){var r=a+(t.hasColumnNameLine?0:1);return e.length>n&&(n=e.length),{id:String(r),cells:e.map((function(e,t){return{columnNumber:t,text:e}}))}}))},r={};if(t.hasColumnNameLine&&void 0!==t.columnNameLineNumber){var o=a.rows.splice(t.columnNameLineNumber-1,1),i=Object(f.a)(o,1),c=i[0];c&&c.cells.forEach((function(e,t){r[t]=e.text||""}))}for(var s=[],l=[],u=function(e){l.push(e);var n=Pb(a,e,t.isValidRefName);"LocString"===n&&a.rows.forEach((function(n){var a=n.cells[e];a.extendedData=Object(_.parseLocString)(a.text,t.isValidRefName)})),s[e]={name:r[e],dataType:{type:n}}},d=0;d<n;d+=1)u(d);return{rowSet:a,columnDisplayOrder:l,hasColumnNames:!!t.hasColumnNameLine,columns:s,assemblyName:t.selectedAssemblyName}}function Ib(e){return Bb.apply(this,arguments)}function Bb(){return(Bb=Object(l.a)(c.a.mark((function e(t){var n,a,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{hasColumnNameLine:!1,columnNameLineNumber:1,isValidRefName:function(){return!1}},e.next=3,Mb(t);case 3:return a=e.sent,e.abrupt("return",Fb(a,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lb(e){return Db.apply(this,arguments)}function Db(){return(Db=Object(l.a)(c.a.mark((function e(t){var n,a,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{hasColumnNameLine:!1,columnNameLineNumber:1,isValidRefName:function(){return!1}},e.next=3,Mb(t,{delimiter:"\t"});case 3:return a=e.sent,e.abrupt("return",Fb(a,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Vb=[{name:"CHROM",type:"Text"},{name:"POS",type:"Number"},{name:"ID",type:"Text"},{name:"REF",type:"Text"},{name:"ALT",type:"Text"},{name:"QUAL",type:"Number"},{name:"FILTER",type:"Text"},{name:"INFO",type:"Text"},{name:"FORMAT",type:"Text"}];function Wb(e,t,n){var a=e.parseLine(t),r=new Gh({variant:a,parser:e,id:"vcf-".concat(n)}),o=t.split("\t").map((function(e){return"."===e?"":e}));return 8===o.length&&o.push(""),{id:String(n+1),extendedData:{vcfFeature:r.toJSON()},cells:o.map((function(e,t){return{columnNumber:t,text:e}}))}}function qb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{hasColumnNameLine:!1,columnNameLineNumber:0,isValidRefName:function(){return!1}},n=zb(Rb(e)),a=n.header,r=n.body,o=[],i=new Uh.a({header:a});a="",r.split("\n").forEach((function(e,t){/\S/.test(e)&&o.push(Wb(i,e,t))})),r="";for(var c={isLoaded:!0,rows:o},s=[],l=[],u=0;u<Vb.length;u+=1)s.push(u),l[u]={name:Vb[u].name,dataType:{type:Vb[u].type}};for(var d=0;d<i.samples.length;d+=1){var f=Vb.length+d;s.push(f),l[f]={name:i.samples[d],dataType:{type:"Text"}}}return s.push(s.length),l.unshift({name:"Location",dataType:{type:"LocString"},isDerived:!0,derivationFunctionText:"jexl:{text:row.extendedData.vcfFeature.refName+':'\n\n    +row.extendedData.vcfFeature.start+'..'+row.extendedData.vcfFeature.end, extendedData:\n\n    {refName:row.extendedData.vcfFeature.refName,start:row.extendedData.vcfFeature.start,end:row.extendedData.vcfFeature.end}}"}),{rowSet:c,columnDisplayOrder:s,hasColumnNames:!0,columns:l,assemblyName:t.selectedAssemblyName}}function zb(e){for(var t,n=0;n<e.length;n+=1){var a=e[n];if("\n"===t&&"#"!==a)break;t=a}return{header:e.substr(0,n),body:e.substr(n)}}var Hb="browser ".split("").map((function(e){return e.charCodeAt(0)})),_b="track ".split("").map((function(e){return e.charCodeAt(0)})),Ub="#".split("").map((function(e){return e.charCodeAt(0)}));function Gb(e,t,n){for(var a=0;a<n.length;a+=1)if(t[e+a]!==n[a])return!1;return!0}function Jb(e){for(var t=0;t<e.length&&(Gb(t,e,Hb)||Gb(t,e,_b)||Gb(t,e,Ub));t+=1)do{t+=1}while(10!==e[t]);return t?e.slice(t):e}function Qb(e,t){return Xb.apply(this,arguments)}function Xb(){return(Xb=Object(l.a)(c.a.mark((function e(t,n){var a,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Jb(t),e.next=3,Lb(a);case 3:return r=e.sent,o=[{name:"chrom",dataType:{type:"LocRef"}},{name:"chromStart",dataType:{type:"LocStart"}},{name:"chromEnd",dataType:{type:"LocEnd"}},{name:"name",dataType:{type:"Text"}},{name:"score",dataType:{type:"Number"}},{name:"strand",dataType:{type:"Text"}}],r.columns.forEach((function(e,t){var n=o[t];n&&(e.name=n.name,e.dataType=n.dataType)})),r.hasColumnNames=!0,r.assemblyName=n.selectedAssemblyName,r.columnDisplayOrder.push(r.columnDisplayOrder.length),r.columns.unshift({name:"Location",dataType:{type:"LocString"},isDerived:!0,derivationFunctionText:"jexl:{text:row.cells.ref.text+':'+row.cells.start.text+'..'+row.cells.end.text,\n\n    extendedData: {refName: row.cells.ref.text, start: +row.cells.start.text, end: +row.cells.end.text}}"}),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yb(e,t){return Kb.apply(this,arguments)}function Kb(){return(Kb=Object(l.a)(c.a.mark((function e(t,n){var a,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Jb(t),e.next=3,Lb(a);case 3:return r=e.sent,o=[{name:"chrom1",dataType:{type:"Text"},featureField:["refName"]},{name:"start1",dataType:{type:"Number"},featureField:["start"]},{name:"end1",dataType:{type:"Number"},featureField:["end"]},{name:"chrom2",dataType:{type:"Text"},featureField:["mate","refName"]},{name:"start2",dataType:{type:"Number"},featureField:["mate","start"]},{name:"end2",dataType:{type:"Number"},featureField:["mate","end"]},{name:"name",dataType:{type:"Text"},featureField:["name"]},{name:"score",dataType:{type:"Number"},featureField:["score"]},{name:"strand1",dataType:{type:"Text"},featureField:["strand"]},{name:"strand2",dataType:{type:"Text"},featureField:["mate","strand"]}],r.columns.forEach((function(e,t){var n=o[t];n&&(e.name=n.name,e.dataType=n.dataType)})),r.hasColumnNames=!0,r.rowSet.rows.forEach((function(e,t){var n={};e.cells.forEach((function(e,t){var a=e.text,r=o[t],i=r&&"Number"===r.dataType.type&&a?parseFloat(a):a;r?2===r.featureField.length?(n[r.featureField[0]]||(n[r.featureField[0]]={}),n[r.featureField[0]][r.featureField[1]]=i):n[r.featureField[0]]=i:n["column".concat(t+1)]=i})),n.uniqueId="bedpe-".concat(t),e.extendedData={feature:n}})),r.assemblyName=n.selectedAssemblyName,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zb(e){var t=e.split(":");return{refName:t[0],pos:parseInt(t[1],10),strand:"-"===t[2]?-1:1}}var $b={SpanningFragCount:!0,FFPM:!0,LeftBreakEntropy:!0,RightBreakEntropy:!0,JunctionReadCount:!0};function ev(e,t){return tv.apply(this,arguments)}function tv(){return(tv=Object(l.a)(c.a.mark((function e(t,n){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lb(t,{hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:n.selectedAssemblyName,isValidRefName:function(){return!1}});case 2:return(a=e.sent).columns[0].name=a.columns[0].name.replace("#",""),a.columns.forEach((function(e){$b[e.name]&&(e.dataType={type:"Number"})})),a.rowSet.rows.forEach((function(e,t){var n={};e.cells.forEach((function(e,t){var r=e.text,o=a.columns[t];if("LeftBreakpoint"===o.name&&r){var i=Zb(r),c=i.refName,s=i.pos,l=i.strand;n.refName=c,n.start=s,n.end=s,n.strand=l}else if("RightBreakpoint"===o.name&&r){var u=Zb(r),d=u.refName,f=u.pos,p=u.strand;n.mate={refName:d,start:f,end:f,strand:p}}else r&&$b[o.name]?n[o.name]=parseFloat(r):n[o.name]=r})),n.uniqueId="sf-".concat(t+1),e.extendedData={feature:n}})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nv=function(e){var t=e.lib,n=t["mobx-state-tree"],a=n.types,r=n.getParent,o=n.getRoot,i=t["@jbrowse/core/util/io"].openLocation,c=t["@jbrowse/core/configuration"].readConfObject,s=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],l={CSV:Ib,TSV:Lb,VCF:qb,BED:Qb,BEDPE:Yb,"STAR-Fusion":ev},u=new RegExp("\\.(".concat(s.join("|"),")(\\.gz)?$"),"i");return a.model("SpreadsheetImportWizard",{fileType:a.optional(a.enumeration(s),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyIdx:0}).volatile((function(){return{fileTypes:s,fileSource:void 0,error:void 0,loading:!1}})).views((function(e){return{get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blob||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return r(e).readyToDisplay},get assemblyChoices(){return o(e).jbrowse.assemblies},get selectedAssemblyName(){var t=o(e).jbrowse.assemblies[e.selectedAssemblyIdx];if(t)return c(t,"name")},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blob&&e.fileSource.blob.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName:function(t,n){return Object(_.getSession)(e).assemblyManager.isValidRefName(t,n)}}})).actions((function(e){return{setFileSource:function(t){if(e.fileSource=t,e.error=void 0,e.fileSource){var n=e.fileName;if(n){var a=u.exec(n);a&&a[1]&&("tsv"===a[1]&&n.includes("star-fusion")?e.fileType="STAR-Fusion":e.fileType=a[1].toUpperCase())}}},setSelectedAssemblyIdx:function(t){e.selectedAssemblyIdx=t},toggleHasColumnNameLine:function(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber:function(t){t>0&&(e.columnNameLineNumber=t)},setFileType:function(t){e.fileType=t},setError:function(t){console.error(t),e.loading=!1,e.error=t},setLoaded:function(){e.loading=!1,e.error=void 0},cancelButton:function(){e.error=void 0,r(e).setDisplayMode()},import:function(){var t=this;try{if(!e.fileSource)return;var n=l[e.fileType];if(!n)throw new Error("cannot open files of type '".concat(e.fileType,"'"));if(e.loading)throw new Error("cannot import, load already in progress");e.loading=!0;var a=i(e.fileSource);a.stat().then((function(e){if(e.size>3e7)throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."))})).then((function(){return a.readFile()})).then((function(t){return e.requiresUnzip?Object(Tb.unzip)(t):t})).then((function(t){return n(t,e)})).then((function(n){t.setLoaded(),r(e).displaySpreadsheet(n)})).catch(this.setError)}catch(o){this.setError(o)}}}}))},av=function(e){var t=e.lib,n=e.load,a=t["mobx-state-tree"],r=a.types,o=a.getParent,i=n(Cb).AnyFilterModelType,c=r.model("RowFullTextFilter",{type:r.literal("RowFullText"),stringToFind:""}).views((function(e){return{get predicate(){var t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){for(var a=n.cellsWithDerived,r=0;r<a.length;r+=1){var o=a[r];if(o.text&&o.text.toLowerCase().includes(t))return!0}return!1}):function(){return!0}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},clear:function(){e.stringToFind=""}}}));return r.model("SpreadsheetFilterControls",{rowFullText:r.optional(c,(function(){return{type:"RowFullText",stringToFind:""}})),columnFilters:r.array(i)}).views((function(e){return{get filters(){return[e.rowFullText].concat(Object(s.a)(e.columnFilters)).filter((function(e){return!!e}))},setRowFullTextFilter:function(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters:function(e,t){for(var n=0;n<this.filters.length;n+=1)if(!this.filters[n].predicate(e,t))return!1;return!0}}})).actions((function(e){return{addBlankColumnFilter:function(t){var n=o(e).spreadsheet.columns[t].dataType;e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:function(t){return e.columnFilters.remove(t)},clearAllFilters:function(){e.columnFilters.clear(),e.rowFullText.clear()}}}))},rv=[{label:"Toggle select",icon:hb.a,onClick:function(e,t){var n,a=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==a&&t.rowSet.rows[a-1].toggleSelect()}}],ov=function(e){var t=e.lib,n=e.load,a=t.mobx,r=t["mobx-state-tree"],o=r.types,i=r.getParent,c=r.getEnv,s=t["@jbrowse/core/pluggableElementTypes/models"].BaseViewModel,l=n(Sb),u=n(nv),d=n(av),f=o.model("SpreadsheetView",{type:o.literal("SpreadsheetView"),offsetPx:0,height:o.optional(o.refinement("SpreadsheetViewHeight",o.number,(function(e){return e>=40})),440),hideViewControls:!1,hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:o.optional(d,(function(){return d.create({})})),mode:o.optional(o.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:o.optional(u,(function(){return u.create()})),spreadsheet:o.maybe(l)}).volatile((function(){return{width:400,rowMenuItems:a.observable(rv)}})).views((function(e){return{get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!c(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){var t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){if(e.spreadsheet&&e.spreadsheet.assemblyName){var t=(Object(_.getSession)(e).assemblies||[]).find((function(t){var n;return Object(P.readConfObject)(t,"name")===(null===(n=e.spreadsheet)||void 0===n?void 0:n.assemblyName)}));if(t)return t}}}})).actions((function(e){return{setRowMenuItems:function(t){e.rowMenuItems.replace(t)},setWidth:function(t){return e.width=t,e.width},setHeight:function(t){return e.height=t>40?t:40,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},resizeWidth:function(t){var n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet:function(t){e.filterControls.clearAllFilters(),e.spreadsheet=t,e.mode="display"},setImportMode:function(){e.mode="import"},setDisplayMode:function(){e.readyToDisplay&&(e.mode="display")},closeView:function(){i(e,2).removeView(e)}}}));return o.compose(s,f)},iv=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/ViewType"),a=t(mb);return new n({name:"SpreadsheetView",stateModel:t(ov),ReactComponent:a})},cv=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="SpreadsheetViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(iv)}))}},{key:"configure",value:function(e){Object(_.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Spreadsheet view",icon:Kh.a,onClick:function(e){e.addView("SpreadsheetView",{})}})}}]),n}(F.a),sv=n(419),lv=n(2431),uv=n.n(lv),dv=function(e){var t=e.jbrequire,n=t("mobx-react"),a=n.observer,r=(n.PropTypes,t("react")),o=t("@material-ui/core/IconButton"),i=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/Grid"),s=t("@material-ui/core/FormControlLabel"),l=t("@material-ui/core/Checkbox"),u=t("@jbrowse/core/ui").ResizeHandle,d=t("@material-ui/core/colors").grey,f={width:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"},p=i((function(e){return{root:{marginBottom:e.spacing(1),background:"white",overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,background:d[200]},viewControls:{margin:0},viewsContainer:{display:"flex"},spreadsheetViewContainer:{borderRight:[["1px","solid",d[400]]],overflow:"hidden"},circularViewOptions:{padding:e.spacing(1),background:d[200]}}})),m=a((function(e){var t=e.model,n=p();return r.createElement(c,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center"},r.createElement(c,{item:!0},r.createElement(o,{onClick:function(){return t.setImportMode()},className:n.iconButton,title:"open a tabular file","data-testid":"sv_inspector_view_open",color:"secondary"},r.createElement(zt.a,null))))})),g=a((function(e){var t=e.svInspector,n=p();return r.createElement(c,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight}},r.createElement(c,{item:!0},r.createElement(s,{control:r.createElement(l,{className:n.rowSelector,checked:t.onlyDisplayRelevantRegionsInCircularView,onClick:function(e){return t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}}),label:"show only regions with data"})))}));return a((function(e){var t=e.model,n=p(),a=t.resizeHeight,o=t.dragHandleHeight,i=t.SpreadsheetViewReactComponent,s=t.CircularViewReactComponent,l=t.showCircularView;return r.createElement("div",{className:n.root,"data-testid":t.id},r.createElement(c,{container:!0,direction:"row",className:n.header},r.createElement(c,{item:!0},r.createElement(m,{model:t}))),r.createElement("div",{className:n.viewsContainer},r.createElement("div",{className:n.spreadsheetViewContainer},r.createElement(i,{model:t.spreadsheetView})),l?r.createElement(r.Fragment,null,r.createElement(u,{onDrag:function(e){var n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,style:f}),r.createElement("div",{className:n.circularViewContainer,style:{width:t.circularView.width}},r.createElement(g,{svInspector:t}),r.createElement(s,{model:t.circularView}))):null),r.createElement(u,{onDrag:a,style:{height:o,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))}))},fv=function(e){var t=(0,e.jbrequire)("@jbrowse/core/util").parseLocString;function n(e,t,n,a,r,o){var i={};return e.forEach((function(e,a){if(!t.includes(a)){var r=n.cells[a].text;"Number"===e.dataType.type&&(r=parseFloat(r)),i[e.name]=r}})),Object(u.a)(Object(u.a)({},i),{},{uniqueId:"sv-inspector-adhoc-".concat(o),refName:a.refName,start:a.start,end:a.end,mate:{refName:r.refName,start:r.start,end:r.end}})}function a(e,a,r,o,i){var c=t(r.cells[a[0]].text,i),s=t(r.cells[a[1]].text,i);return n(e,[a[0],a[1]],r,c,s,o)}function r(e,t,a,r,o,i){var c=function(e){return o.cells[e].text},s={refName:c(t[0]),start:parseInt(c(a[0]),10)-1,end:parseInt(c(r[0]),10)},l={refName:c(t[1]),start:parseInt(c(a[1]),10)-1,end:parseInt(c(r[1]),10)};return n(e,[t[0],a[0],r[0],t[1],a[1],r[1]],o,s,l,i)}return{makeAdHocSvFeature:function(e,t,n,o){var i=e.columns,c=e.columnDisplayOrder,s={};c.forEach((function(e){var t=i[e];s[t.dataType.type]||(s[t.dataType.type]=[]),s[t.dataType.type].push(e)}));var l=s.LocString||[],u=s.LocStart||[],d=s.LocEnd||[],f=s.LocRef||[];return l.length>=2?a(i,l,n,t,o):f.length>=2&&u.length>=2&&d.length>=2?r(i,f,u,d,n,t):void 0},makeAdHocSvFeatureFromTwoLocations:a,makeAdHocSvFeatureFromTwoRefStartEndSets:r}},pv=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util").getSession,a=t(fv).makeAdHocSvFeature;function r(e,t,n,r){if(n.extendedData){if(n.extendedData.vcfFeature)return n.extendedData.vcfFeature;if(n.extendedData.feature)return n.extendedData.feature}var o=a(t.spreadsheet,r,n,e.assemblyManager.isValidRefName);if(o)return o}function o(t,a,o,i,c){var s=n(a),l=r(s,o,i,c);if(l){var u=new U.a(l);s.setSelection(u);var d=e.getViewType("BreakpointSplitView"),f=t.circularView;return d.snapshotFromBreakendFeature(u,f)}}return{getSerializedFeatureForRow:r,breakpointSplitViewSnapshotFromTableRow:o,canOpenBreakpointSplitViewFromTableRow:function(e,t,n,a,r){try{var i=o(e,t,n,a,r);return Boolean(i)}catch(c){return!1}},openBreakpointSplitViewFromTableRow:function(e,t,a,r,i){var c=o(e,t,a,r,i);if(c){var s=e.circularView;c.views[0].offsetPx-=s.width/2+100,c.views[1].offsetPx-=s.width/2+100,n(t).addView("BreakpointSplitView",c)}}}};function mv(e,t,n){var a=(0,n.jbrequire)("@jbrowse/core/util"),r=a.getContainingView,o=(0,a.getSession)(t);o.setSelection(e);var i=r(t),c=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,i);c.views[0].offsetPx-=i.width/2+100,c.views[1].offsetPx-=i.width/2+100,c.featureData=e.data,o.addView("BreakpointSplitView",c)}var gv=function(e){var t=e.jbrequire,n=e.lib.mobx,a=n.autorun,r=n.reaction,o=e.lib["mobx-state-tree"],i=o.types,c=o.getParent,s=o.addDisposer,l=o.getSnapshot,u=t("@jbrowse/core/pluggableElementTypes/models").BaseViewModel,d=t("@jbrowse/core/util").getSession,f=t("@jbrowse/core/configuration").readConfObject,p=e.getViewType("SpreadsheetView"),m=e.getViewType("CircularView"),g=t(pv),h=g.canOpenBreakpointSplitViewFromTableRow,b=g.openBreakpointSplitViewFromTableRow,v=g.getSerializedFeatureForRow,y=i.model("SvInspectorView",{type:i.literal("SvInspectorView"),dragHandleHeight:4,height:i.optional(i.refinement("SvInspectorViewHeight",i.number,(function(e){return e>=400})),500),onlyDisplayRelevantRegionsInCircularView:!1,mode:i.optional(i.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:i.optional(p.stateModel,(function(){return p.stateModel.create({type:"SpreadsheetView",hideViewControls:!0,hideVerticalResizeHandle:!0})})),circularView:i.optional(m.stateModel,(function(){return m.stateModel.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})}))}).volatile((function(){return{width:800}})).views((function(t){return{get selectedRows(){return t.spreadsheetView.rowSet.selectedRows},get assemblyName(){var e=t.spreadsheetView.assembly;if(e)return f(e,"name")},get showCircularView(){return"display"===t.spreadsheetView.mode},get featuresAdapterConfigSnapshot(){var e=d(t);return{type:"FromConfigAdapter",features:(t.spreadsheetView.outputRows||[]).map((function(n,a){return v(e,t.spreadsheetView,n,a)})).filter((function(e){return Boolean(e)}))}},get featuresRefNamesP(){return new(0,e.getAdapterType("FromConfigAdapter").AdapterClass)(t.featuresAdapterConfigSnapshot).getRefNames()},get featuresCircularTrackConfiguration(){return e.jexl.addFunction("defaultOnChordClick",mv),{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(t.id),name:"features from tabular data",adapter:t.featuresAdapterConfigSnapshot,assemblyNames:[t.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(t.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}})).volatile((function(){return{SpreadsheetViewReactComponent:p.ReactComponent,CircularViewReactComponent:m.ReactComponent,circularViewOptionsBarHeight:52}})).actions((function(e){return{afterAttach:function(){s(e,a((function(){if(e.showCircularView){var t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),s(e,a((function(){e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),s(e,a((function(){var t=e.assemblyName,n=e.onlyDisplayRelevantRegionsInCircularView,a=e.circularView,r=e.featuresRefNamesP,o=a.tracks,i=d(e);if(t){var c=i.assemblyManager.get(t);if(c){var s=c.regions;if(s=s?l(s):[],n){if(1===o.length){var u=i.assemblyManager.get(t).getCanonicalRefName;r.then((function(e){var t=new Set(e.map((function(e){return u(e)||e}))),n=s.filter((function(e){return t.has(e.refName)}));a.setDisplayedRegions(JSON.parse(JSON.stringify(n)))})).catch((function(e){return a.setError(e)}))}}else a.setDisplayedRegions(s)}else a.setDisplayedRegions([])}}),{name:"SvInspectorView displayed regions bind"})),s(e,r((function(){return{generatedTrackConf:e&&e.featuresCircularTrackConfiguration,assemblyName:e&&e.assemblyName}}),(function(t){if(t){var n=t.assemblyName,a=t.generatedTrackConf;e.circularView.tracks.length&&e.circularView.tracks.forEach((function(t){e.circularView.hideTrack(t.configuration.trackId)})),n&&a&&e.circularView.addTrackConf(a,{assemblyName:n})}}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),s(e,a((function(){e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:Kl.a,disabled:function(t,n,a,r){return!h(e,t,n,r,a)},onClick:function(t,n,a,r){b(e,t,n,r,a)}}])})))},setWidth:function(t){e.width=t},setHeight:function(t){return e.height=t>400?t:400,e.height},resizeHeight:function(t){var n=e.height;return e.setHeight(e.height+t)-n},setImportMode:function(){e.spreadsheetView.setImportMode()},setDisplayMode:function(){e.spreadsheetView.setDisplayMode()},closeView:function(){c(e,2).removeView(e)},setDisplayedRegions:function(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView:function(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}}));return{stateModel:i.compose(u,y)}},hv=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/ViewType"),a=t(dv);return new n({name:"SvInspectorView",stateModel:t(gv).stateModel,ReactComponent:a})},bv=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="SvInspectorViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(hv)}))}},{key:"configure",value:function(e){Object(sv.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"SV inspector",icon:uv.a,onClick:function(e){e.addView("SvInspectorView",{})}})}}]),n}(F.a),vv=Object(P.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic"}}},{explicitlyTyped:!0}),yv=n(2432),wv=function(){return{configSchema:vv,AdapterClass:yv.a}};var Ov=Object(re.observer)((function(e){var t=e.width,n=e.height,a=Math.ceil(t);return m.a.createElement("div",{className:"PileupRendering",style:{position:"relative",width:a,height:n}},m.a.createElement(ue.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})))})),jv=Object(P.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:baseColor|alpha(min(1,count/(maxScore/20)))|hsl|colorString",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0}),kv=n(2436),Cv=n.n(kv),Ev=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"makeImageData",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s,l,u,d,p,m,g,h,b,v,y,w,O,j,k,C,E,x,S,T,N,A,R,M,F,I,B,L;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.features,a=t.config,r=t.regions,o=t.bpPerPx,i=t.highResolutionScaling,s=void 0===i?1:i,l=t.dataAdapter,u=t.signal,d=Object(f.a)(r,1),p=d[0],m=(p.end-p.start)/o,g=Object(P.readConfObject)(a,"maxHeight"),e.next=6,l.getResolution(o);case 6:if(h=e.sent,m>0&&g>0){e.next=9;break}return e.abrupt("return",{height:0,width:0,maxHeightReached:!1});case 9:if(b=Object(ir.b)(Math.ceil(m*s),g*s),v=h/(o*Math.sqrt(2)),(y=b.getContext("2d")).scale(s,s),w=Cv()(Object(P.readConfObject)(a,"baseColor")),!n.length){e.next=38;break}return O=n[0].bin1,j=0,k=0,C=0,e.next=21,Object(_.abortBreakPoint)(u);case 21:for(E=0;E<n.length;E++)x=n[E],S=x.bin1,T=x.bin2,N=x.counts,j=Math.max(N,j),k=Math.min(Math.min(S,T),k),C=Math.max(Math.max(S,T),C);return e.next=24,Object(_.abortBreakPoint)(u);case 24:y.rotate(-Math.PI/4),A=Date.now(),R=0;case 27:if(!(R<n.length)){e.next=38;break}if(M=n[R],F=M.bin1,I=M.bin2,B=M.counts,y.fillStyle=Object(P.readConfObject)(a,"color",{count:B,maxScore:j,baseColor:w}),y.fillRect((F-O)*v,(I-O)*v,v,v),!(+Date.now()-A>400)){e.next=35;break}return e.next=34,Object(_.abortBreakPoint)(u);case 34:A=+Date.now();case 35:R++,e.next=27;break;case 38:return e.next=40,Object(ir.c)(b);case 40:return L=e.sent,e.abrupt("return",{imageData:L,height:g,width:m});case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeImageData(t);case 2:return n=e.sent,a=n.height,r=n.width,o=n.imageData,i=n.maxHeightReached,s=m.a.createElement(this.ReactComponent,Object(u.a)(Object(u.a)({},t),{},{region:t.regions[0],height:a,width:r,imageData:o}),null),e.abrupt("return",{element:s,imageData:o,height:a,width:r,maxHeightReached:i});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var n,a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataAdapter,a=t.signal,r=t.bpPerPx,o=t.regions,e.next=3,n.getFeatures(o[0],{signal:a,bpPerPx:r}).pipe(Object(B.a)()).toPromise();case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeResultsInWorker",value:function(e){return Object(u.a)({},e)}},{key:"deserializeResultsInClient",value:function(e,t){var n=Object(u.a)({},e),a=new Map;return n.features=a,n.blockKey=t.blockKey,n}}]),n}(z.a),xv=function(e){var t=e.getRendererType("HicRenderer").configSchema;return Object(P.ConfigurationSchema)("LinearHicDisplay",{renderer:t},{baseConfiguration:ze,explicitlyTyped:!0})},Sv=function(e){return b.types.compose("LinearHicDisplay",St,b.types.model({type:b.types.literal("LinearHicDisplay"),configuration:Object(P.ConfigurationReference)(e)})).views((function(e){return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},get renderProps(){var t=e.rendererType.configSchema.create(Object(P.getConf)(e,"renderer")||{});return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(Ue.getParentRenderProps)(e)),{},{config:t,displayModel:e})}}}))},Tv=[uh,or,Ai,Vi,Zc,yl,id,of,bf,jf,cp,um,xm,sg,pg,Pg,Th,Xh,to,cv,bv,kc,function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="HicPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a(Object(u.a)({name:"HicAdapter"},e.jbrequire(wv)))})),e.addRendererType((function(){return new Ev({name:"HicRenderer",ReactComponent:Ov,configSchema:jv,pluginManager:e})})),e.addTrackType((function(){var t=Object(P.ConfigurationSchema)("HicTrack",{},{baseConfiguration:Object(Fe.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new w.a({name:"HicTrack",configSchema:t,stateModel:Object(Fe.createBaseTrackModel)(e,"HicTrack",t)})})),e.addDisplayType((function(){var t=xv(e);return new O.a({name:"LinearHicDisplay",configSchema:t,stateModel:Sv(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:dt})}))}},{key:"configure",value:function(e){e.jexl.addTransform("alpha",(function(e,t){return e.alpha(t)})),e.jexl.addTransform("hsl",(function(e){return e.hsl()})),e.jexl.addTransform("colorString",(function(e){return e.string()}))}}]),n}(F.a)],Nv=n(2515),Av=n(2439),Rv=n.n(Av),Mv=n(2438),Pv=n.n(Mv),Fv=n(433),Iv=n.n(Fv),Bv=Object(Ze.a)((function(e){return{shareDiv:{textAlign:"center",paddingLeft:"2px"},shareButton:{"&:hover":{backgroundColor:Object(an.fade)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Lv(e){var t=Bv(),n=e.onClose,a=e.open,r=e.currentSetting,o=Object(p.useState)(r),i=Object(f.a)(o,2),c=i[0],s=i[1],l=Object(p.useState)(!1),u=Object(f.a)(l,2),d=u[0],g=u[1],h=function(){localStorage.setItem("jbrowse-shareURL",c),n(c)};return m.a.createElement(m.a.Fragment,null,m.a.createElement(Gt.a,{onClose:h,open:a},m.a.createElement(Jt.a,null,"Configure session sharing",h?m.a.createElement(Qt.a,{className:t.closeButton,onClick:h},m.a.createElement($t.a,null)):null),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,null,"Select between generating long or short URLs for the session sharing",m.a.createElement(Qt.a,{onClick:function(){return g(!0)}},m.a.createElement(Pv.a,null))),m.a.createElement(os.a,{component:"fieldset"},m.a.createElement(mh.a,{value:c,onChange:function(e){var t=e.target.value;s(t)}},m.a.createElement(ei.a,{value:"short",control:m.a.createElement(ed.a,null),label:"Short URL"}),m.a.createElement(ei.a,{value:"long",control:m.a.createElement(ed.a,null),label:"Long URL"}))))),m.a.createElement(Dv,{open:d,onClose:function(){g(!1)}}))}function Dv(e){var t=Bv(),n=e.onClose,a=e.open,r=function(){n()};return m.a.createElement(Gt.a,{onClose:r,open:a},m.a.createElement(Jt.a,{id:"simple-dialog-title"},"Info about session URLs",n?m.a.createElement(Qt.a,{className:t.closeButton,onClick:r},m.a.createElement($t.a,null)):null),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,null,"Because everything about the JBrowse session is encoded in the URL (e.g. state of the tracks, views, features selected, etc.) the sessions can get very long. Therefore, we created a URL shortener, both as a convenience and because long URLs can break some programs. Note that both the long and short URLs encode the same data, but due to long URLs causing problems with some programs, we recommend sharing short URLs."),m.a.createElement(ru.a,null,'We generate the short URLs in a secure manner which involves encrypting the session on the client side with a random password string and uploading them to a central database. Then the random password is added to the URL but is not uploaded to the central database, making these short URLs effectively "end-to-end encrypted"'),m.a.createElement(ru.a,null,"Only users with a share link can read the session.")))}var Vv=Object(re.observer)((function(e){var t=e.handleClose,n=e.session,a=Bv(),r=Object(p.useState)(""),o=Object(f.a)(r,2),i=o[0],s=o[1],u=Object(p.useState)(!0),d=Object(f.a)(u,2),g=d[0],h=d[1],v=Object(p.useState)(),y=Object(f.a)(v,2),w=y[0],O=y[1],j=Object(p.useState)(!1),k=Object(f.a)(j,2),C=k[0],E=k[1],x=n.shareURL,S=localStorage.getItem("jbrowse-shareURL")||"short",T=Object(b.getSnapshot)(n);Object(p.useEffect)((function(){var e=!1;return Object(l.a)(c.a.mark((function t(){var n,a,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("short"!==S){t.next=14;break}return t.prev=1,h(!0),n=new URL(window.location.href),t.next=6,Ne(T,x,n.href);case 6:a=t.sent,e||(h(!1),(r=new URLSearchParams(n.search)).set("session","share-".concat(a.json.sessionId)),r.set("password",a.password),n.search=r.toString(),s(n.href)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),h(!1),O(t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))(),function(){e=!0}}),[S,x,T]);var N="".concat(Object(_.toUrlSafeB64)(JSON.stringify(Object(b.getSnapshot)(n)))),A=new URL(window.location.href),R=new URLSearchParams(A.search);return R.set("session","encoded-".concat(N)),A.search=R.toString(),m.a.createElement(m.a.Fragment,null,m.a.createElement(Gt.a,{maxWidth:"xl",open:!0,onClose:t,"data-testid":"share-dialog"},m.a.createElement(Jt.a,null,"JBrowse Shareable Link",t?m.a.createElement(Qt.a,{className:a.closeButton,onClick:t},m.a.createElement($t.a,null)):null),m.a.createElement(Xt.a,null),m.a.createElement(m.a.Fragment,null,m.a.createElement(Yt.a,null,m.a.createElement(ru.a,null,"Copy the URL below to share your current JBrowse session.",m.a.createElement(Qt.a,{onClick:function(){return E(!0)}},m.a.createElement(Iv.a,null)))),m.a.createElement(Yt.a,null,"short"===S?w?m.a.createElement(Je.a,{color:"error"},"".concat(w)):g?m.a.createElement(Je.a,null,"Generating short URL..."):m.a.createElement(dn.a,{label:"URL",value:i,InputProps:{readOnly:!0},inputProps:{"data-testid":"share-url-text"},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()},"data-testid":"share-url-field"}):m.a.createElement(dn.a,{label:"URL",value:A.toString(),InputProps:{readOnly:!0},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()}}))),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){Wa()(i||A.toString()),n.notify("Copied to clipboard","success")},color:"primary",startIcon:m.a.createElement(Pt,null),disabled:"short"===S&&g},"Copy URL to Clipboard"),m.a.createElement(Ge.a,{onClick:t,color:"primary",autoFocus:!0},"Close"))),m.a.createElement(Lv,{open:C,onClose:function(){E(!1)},currentSetting:S}))})),Wv=Object(re.observer)((function(e){var t=Object(p.useState)(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],o=e.session,i=Bv();return m.a.createElement("div",{className:i.shareDiv},m.a.createElement(Ge.a,{"data-testid":"share_button",onClick:Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(!0);case 1:case"end":return e.stop()}}),e)}))),size:"small",color:"inherit",startIcon:m.a.createElement(Rv.a,null),classes:{root:i.shareButton}},"Share"),a?m.a.createElement(Vv,{handleClose:function(){r(!1)},session:o}):null)}));function qv(e){if("object"===typeof e)for(var t=0,n=Object.keys(e);t<n.length;t++){var a=n[t];"object"===typeof e[a]?qv(e[a]):"uri"===a&&delete e.baseUri}}var zv=Object(re.observer)((function(e){var t=e.pluginManager,n=Object(se.c)("adminKey",se.b),a=Object(f.a)(n,1)[0],r=Object(se.c)("adminServer",se.b),o=Object(f.a)(r,1)[0],i=Object(se.c)("session",se.b),s=Object(f.a)(i,2)[1],u=t.rootModel,d=u||{},g=d.error,h=d.jbrowse,v=d.session,y=v.id;if(Object(p.useEffect)((function(){s("local-".concat(y)),window.JBrowseRootModel=u,window.JBrowseSession=v}),[y,u,v,s]),Object(p.useEffect)((function(){Object(b.onSnapshot)(h,function(){var e=Object(l.a)(c.a.mark((function e(t){var n,r,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=12;break}return qv(n=JSON.parse(JSON.stringify(t))),r={adminKey:a,config:n},e.next=6,fetch(o||"/updateConfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 6:if((i=e.sent).ok){e.next=12;break}return e.next=10,i.text();case 10:s=e.sent,v.notify("Admin server error: ".concat(i.status," (").concat(i.statusText,") ").concat(s||""));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[h,v,a,o]),g)throw g;var w=Object(P.getConf)(u.jbrowse,"theme"),O=t.getPlugin("DataManagementPlugin").exports,j=O.AssemblyManager,k=O.SetDefaultSession;return m.a.createElement(mt.a,{theme:Object(ue.createJBrowseTheme)(w)},m.a.createElement(Nv.a,null),m.a.createElement(ue.App,{session:v,HeaderButtons:m.a.createElement(Wv,{session:v})}),a?m.a.createElement(m.a.Fragment,null,m.a.createElement(j,{rootModel:u,open:u.isAssemblyEditing,onClose:function(){u.setAssemblyEditing(!1)}}),m.a.createElement(k,{rootModel:u,open:u.isDefaultSessionEditing,onClose:function(){u.setDefaultSessionEditing(!1)},currentDefault:u.jbrowse.defaultSession.name})):null)})),Hv=["rgb(153, 102, 0)","rgb(102, 102, 0)","rgb(153, 153, 30)","rgb(204, 0, 0)","rgb(255, 0, 0)","rgb(255, 0, 204)","rgb(165, 132, 132)","rgb(204, 122, 0)","rgb(178, 142, 0)","rgb(153, 153, 0)","rgb(122, 153, 0)","rgb(0, 165, 0)","rgb(53, 128, 0)","rgb(0, 0, 204)","rgb(96, 145, 242)","rgb(107, 142, 178)","rgb(0, 165, 165)","rgb(122, 153, 153)","rgb(153, 0, 204)","rgb(204, 51, 255)","rgb(173, 130, 216)","rgb(102, 102, 102)","rgb(145, 145, 145)","rgb(142, 142, 142)","rgb(142, 142, 107)","rgb(96, 163, 48)"];function _v(e,t,n,a){return Uv.apply(this,arguments)}function Uv(){return(Uv=Object(l.a)(c.a.mark((function e(t,n,a,r){var o,i,s,l,d,p,m,g,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.sessionId,e.next=3,Object(_.when)((function(){return Boolean(t.regions&&t.refNameAliases)}),{signal:r,name:"when assembly ready"});case 3:return e.next=5,t.rpcManager.call(o,"CoreGetRefNames",Object(u.a)({adapterConfig:n,signal:r},a),{timeout:1e6});case 5:if(i=e.sent,s={},t.refNameAliases){e.next=10;break}throw new Error("error loading assembly ".concat(t.name,"'s refNameAliases"));case 10:for(i.forEach((function(e){Gv(e);var n=t.getCanonicalRefName(e);n&&(s[n]=e)})),l={},d=0,p=Object.entries(s);d<p.length;d++)m=Object(f.a)(p[d],2),g=m[0],h=m[1],l[h]=g;return e.abrupt("return",{forwardMap:s,reverseMap:l});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gv(e){if(!e.match(/[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*/))throw new Error('Encountered invalid refName: "'.concat(e,'"'))}function Jv(e,t){var n=new Pd.a({cache:new Fd({maxSize:1e3}),fill:function(e,t,n){return Object(l.a)(c.a.mark((function a(){var r,o,i;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r=e.adapterConf,o=e.self,i=e.options,a.abrupt("return",_v(o,r,Object(u.a)(Object(u.a)({},i),{},{statusCallback:n}),t));case 2:case"end":return a.stop()}}),a)})))()}});return b.types.model({configuration:b.types.safeReference(e),regions:b.types.maybe(b.types.array(Ie.Region)),refNameAliases:b.types.maybe(b.types.map(b.types.string))}).views((function(e){return{get initialized(){return Boolean(e.refNameAliases)},get name(){return Object(P.readConfObject)(e.configuration,"name")},get aliases(){return Object(P.readConfObject)(e.configuration,"aliases")},hasName:function(e){return this.name===e||this.aliases.includes(e)},get allAliases(){return[this.name].concat(Object(s.a)(this.aliases))},get refNames(){return e.regions&&e.regions.map((function(e){return e.refName}))},get allRefNames(){if(e.refNameAliases)return Array.from(e.refNameAliases.keys())},get rpcManager(){return Object(b.getParent)(e,2).rpcManager},get refNameColors(){var t=Object(P.readConfObject)(e.configuration,"refNameColors");return 0===t.length?Hv:t}}})).views((function(e){return{getCanonicalRefName:function(t){if(!e.refNameAliases)throw new Error("aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called");return e.refNameAliases.get(t)},getRefNameColor:function(t){var n,a=null===(n=e.refNames)||void 0===n?void 0:n.findIndex((function(e){return e===t}));if(void 0!==a&&-1!==a)return e.refNameColors[a%e.refNameColors.length]},isValidRefName:function(t){if(!e.refNameAliases)throw new Error("isValidRefName cannot be called yet, the assembly has not finished loading");return!!this.getCanonicalRefName(t)}}})).actions((function(e){return{setLoading:function(){},setLoaded:function(e){var t=e.adapterRegionsWithAssembly,n=e.refNameAliases;this.setRegions(t),this.setRefNameAliases(n)},setError:function(t){Object(b.getParent)(e,3).isAssemblyEditing||Object(b.getParent)(e,3).setError(t)},setRegions:function(t){e.regions=Object(b.cast)(t)},setRefNameAliases:function(t){e.refNameAliases=Object(b.cast)(t)},afterAttach:function(){Object(_.makeAbortableReaction)(e,function(e){return function(t){if(t.configuration){var n,a=t.configuration.sequence.adapter,r=null===(n=t.configuration.refNameAliases)||void 0===n?void 0:n.adapter;return{sequenceAdapterConfig:a,assemblyName:t.name,refNameAliasesAdapterConfig:r,pluginManager:e}}}}(t),Qv,{name:"".concat(e.name," assembly loading"),fireImmediately:!0},this.setLoading,this.setLoaded,this.setError)}}})).views((function(e){return{getAdapterMapEntry:function(t,a){var r=a.signal,o=a.statusCallback,i=Object(d.a)(a,["signal","statusCallback"]);if(!a.sessionId)throw new Error("sessionId is required");var c=function(e){return D()(e)}(t);return n.get(c,{adapterConf:t,self:e,options:i},r,o)},getRefNameMapForAdapter:function(e,t){var n=this;return Object(l.a)(c.a.mark((function a(){var r;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t&&t.sessionId){a.next=2;break}throw new Error("sessionId is required");case 2:return a.next=4,n.getAdapterMapEntry(e,t);case 4:return r=a.sent,a.abrupt("return",r.forwardMap);case 6:case"end":return a.stop()}}),a)})))()},getReverseRefNameMapForAdapter:function(e,t){var n=this;return Object(l.a)(c.a.mark((function a(){var r;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.getAdapterMapEntry(e,t);case 2:return r=a.sent,a.abrupt("return",r.reverseMap);case 4:case"end":return a.stop()}}),a)})))()}}}))}function Qv(e,t){return Xv.apply(this,arguments)}function Xv(){return(Xv=Object(l.a)(c.a.mark((function e(t,n){var a,r,o,i,s,l,d,f,p,m,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return a=t.sequenceAdapterConfig,r=t.assemblyName,o=t.refNameAliasesAdapterConfig,i=t.pluginManager,s=i.getAdapterType(a.type),l=new s.AdapterClass(a),e.next=7,l.getRegions({signal:n});case 7:if(d=e.sent,f=d.map((function(e){return Gv(e.refName),Object(u.a)(Object(u.a)({},e),{},{assemblyName:r})})),p={},!o){e.next=17;break}return m=i.getAdapterType(o.type),g=new m.AdapterClass(o),e.next=15,g.getRefNameAliases({signal:n});case 15:e.sent.forEach((function(e){var t=e.refName;e.aliases.forEach((function(e){Gv(e),p[e]=t}))}));case 17:return f.forEach((function(e){p[e.refName]=e.refName})),e.abrupt("return",{adapterRegionsWithAssembly:f,refNameAliases:p});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yv(e,t){var n=Jv(e,t);return b.types.model({assemblies:b.types.array(n)}).views((function(e){return{get:function(t){return e.assemblies.find((function(e){return e.hasName(t)}))},get assemblyList(){return[].concat(Object(s.a)(Object(b.getParent)(e).jbrowse.assemblies),Object(s.a)(Object(b.getParent)(e).session.sessionAssemblies||[]))},get rpcManager(){return Object(b.getParent)(e).rpcManager},get pluginManager(){return Object(b.getParent)(e).pluginManager},get allPossibleRefNames(){var t,n=[],a=Object(He.a)(e.assemblies);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!r.allRefNames)return;n=n.concat(r.allRefNames)}}catch(o){a.e(o)}finally{a.f()}return n}}})).views((function(e){return{waitForAssembly:function(t){return Object(l.a)(c.a.mark((function n(){var a;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("no assembly name supplied to waitForAssembly");case 2:if(!(a=e.get(t))){n.next=7;break}return n.next=6,Object(_.when)((function(){return Boolean(a.regions&&a.refNameAliases)}));case 6:return n.abrupt("return",a);case 7:return n.abrupt("return",void 0);case 8:case"end":return n.stop()}}),n)})))()},getRefNameMapForAdapter:function(t,n,a){return Object(l.a)(c.a.mark((function r(){var o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(_.when)((function(){return Boolean(e.get(n))}),{signal:a.signal,name:"when assembly ready"});case 2:if(!(o=e.get(n))){r.next=5;break}return r.abrupt("return",o.getRefNameMapForAdapter(t,a));case 5:return r.abrupt("return",void 0);case 6:case"end":return r.stop()}}),r)})))()},getReverseRefNameMapForAdapter:function(t,n,a){return Object(l.a)(c.a.mark((function r(){var o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(_.when)((function(){return Boolean(e.get(n))}),{signal:a.signal,name:"when assembly ready"});case 2:if(!(o=e.get(n))){r.next=5;break}return r.abrupt("return",o.getReverseRefNameMapForAdapter(t,a));case 5:return r.abrupt("return",void 0);case 6:case"end":return r.stop()}}),r)})))()},isValidRefName:function(t,n){if(n){var a=e.get(n);if(a)return a.isValidRefName(t);throw new Error("isValidRefName for ".concat(n," failed, assembly does not exist"))}if(!e.allPossibleRefNames)throw new Error("isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument");return e.allPossibleRefNames.includes(t)}}})).actions((function(e){return{removeAssembly:function(t){e.assemblies.remove(t)},afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(le.reaction)((function(){return e.assemblyList}),(function(n){e.assemblies.forEach((function(e){e.configuration||t.removeAssembly(e)})),n.forEach((function(n){-1===e.assemblies.findIndex((function(e){return e.name===Object(P.readConfObject)(n,"name")}))&&t.addAssembly(n)}))}),{fireImmediately:!0,name:"assemblyManagerAfterAttach"}))},addAssembly:function(t){e.assemblies.push({configuration:t})},replaceAssembly:function(t,n){e.assemblies[t]=Object(b.cast)({configuration:n})}}}))}var Kv=function(e){var t=Object(P.ConfigurationSchema)("BaseAssembly",{aliases:{type:"stringArray",defaultValue:[],description:"Other possible names for the assembly"},sequence:e.getTrackType("ReferenceSequenceTrack").configSchema,refNameColors:{type:"stringArray",defaultValue:[],description:"Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence."}},{explicitIdentifier:"name"}),n=Object(P.ConfigurationSchema)("Assembly",{refNameAliases:Object(P.ConfigurationSchema)("RefNameAliases",{adapter:e.pluggableConfigSchemaType("adapter")})},{baseConfiguration:t});return{assemblyConfigSchemas:[n,t],dispatcher:function(e){return e&&e.refNameAliases?n:t}}},Zv=Object(P.ConfigurationSchema)("RpcOptions",{defaultDriver:{type:"string",description:"the RPC backend to use for tracks and tasks that are not configured to use a specific RPC backend",defaultValue:"WebWorkerRpcDriver"}}),$v=n(2440);function ey(e){return"function"!==typeof e&&!(e instanceof Error)}function ty(){return(ty=Object(l.a)(c.a.mark((function e(t,n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.call("ping",[],{timeout:1e8});case 2:return e.abrupt("return",new Promise((function(e,a){!function e(){setTimeout(Object(l.a)(c.a.mark((function r(){return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.call("ping",[],{timeout:2*n});case 3:e(),r.next=9;break;case 6:r.prev=6,r.t0=r.catch(0),a(r.t0);case 9:case"end":return r.stop()}}),r,null,[[0,6]])}))),n)}()})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ny=function(){function e(t){Object(g.a)(this,e),this.worker=void 0,this.driver=void 0,this.driver=t}return Object(h.a)(e,[{key:"getWorker",value:function(e){var t=this;if(!this.worker){var n=this.driver.makeWorker(e);(function(e,t){return ty.apply(this,arguments)})(n,this.driver.maxPingTime).catch((function(e){t.worker&&(console.warn("worker did not respond, killing and generating new one ".concat(e)),t.worker.destroy(),t.worker.status="killed",t.worker.error=e,t.worker=void 0)})),this.worker=n}return this.worker}}]),e}(),ay=function(){function e(){Object(g.a)(this,e),this.lastWorkerAssignment=-1,this.workerAssignments=new Map,this.workerCount=0,this.workerPool=void 0,this.maxPingTime=3e4,this.workerCheckFrequency=5e3}return Object(h.a)(e,[{key:"filterArgs",value:function(e,t,n){var a=this;if(Array.isArray(e))return e.filter(ey).map((function(e){return a.filterArgs(e,t,n)}));if("object"===typeof e&&null!==e){if(e instanceof AbortSignal)return function(e,t){var n=N.get(e);return n||(T+=1,N.set(e,T),n=T,e.addEventListener("abort",(function(){var n=N.get(e);void 0!==n&&t("signalAbort",n)}))),{abortSignalId:n}}(e,this.remoteAbort.bind(this,t,n));if(Object(b.isStateTreeNode)(e)&&!Object(b.isAlive)(e))throw new Error("dead state tree node passed to RPC call");return Object(_.objectFromEntries)(Object.entries(e).filter((function(e){return ey(e[1])})).map((function(e){var r=Object(f.a)(e,2),o=r[0],i=r[1];return[o,a.filterArgs(i,t,n)]})))}return e}},{key:"remoteAbort",value:function(e,t,n,a){this.getWorker(t,e).call(n,{signalId:a},{timeout:1e6})}},{key:"createWorkerPool",value:function(){var e=this,t=function(){var e="undefined"!==typeof window,t=e&&"hardwareConcurrency"in window.navigator;return e&&t?window.navigator.hardwareConcurrency:1}(),n=this.workerCount||Math.max(1,Math.ceil((t-2)/3));return Object(s.a)(new Array(n)).map((function(){return new ny(e)}))}},{key:"getWorkerPool",value:function(){if(!this.workerPool){var e=this.createWorkerPool();return this.workerPool=e,e}return this.workerPool}},{key:"getWorker",value:function(e,t){var n=this.getWorkerPool(),a=this.workerAssignments.get(e);if(void 0===a){var r=(this.lastWorkerAssignment+1)%n.length;this.workerAssignments.set(e,r),this.lastWorkerAssignment=r,a=r}var o=n[a].getWorker(t);if(!o)throw new Error("no web workers registered for RPC");return o}},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n,a,r){var o,i,s,l,d,f,p,m,g,h=this,b=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=b.length>4&&void 0!==b[4]?b[4]:{},n){e.next=3;break}throw new TypeError("sessionId is required");case 3:return i=this.getWorker(n,t),s=t.getRpcMethodType(a),e.next=7,s.serializeArguments(r);case 7:return l=e.sent,d=this.filterArgs(l,t,n),f=i.call(a,d,Object(u.a)({timeout:3e5,statusCallback:r.statusCallback},o)),m=new Promise((function(e,t){p=setInterval((function(){"killed"===i.status&&t(new Error("operation timed out, worker process stopped responding, ".concat(i.error)))}),h.workerCheckFrequency)})).finally((function(){clearInterval(p)})),g=Promise.race([f,m]),e.t0=s,e.next=15,g;case 15:return e.t1=e.sent,e.abrupt("return",e.t0.deserializeReturn.call(e.t0,e.t1));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),e}(),ry=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"destroy",value:function(){this.workers[0].terminate()}},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,r){var o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="message-".concat(me.a.generate()),i=function(e){r.statusCallback&&r.statusCallback(e)},this.on(o,i),e.next=5,Object(Yr.a)(Object(Kr.a)(n.prototype),"call",this).call(this,t,Object(u.a)(Object(u.a)({},a),{},{channel:o}),r);case 5:return s=e.sent,this.off(o,i),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),n}($v.a.Client),oy=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r,o=e.WorkerClass;return Object(g.a)(this,n),(r=t.call(this)).WorkerClass=void 0,r.workerBootConfiguration=void 0,r.WorkerClass=o,r.workerBootConfiguration=a,r}return Object(h.a)(n,[{key:"makeWorker",value:function(){var e=new ry({workers:[new this.WorkerClass]});return e.workers[0].postMessage(this.workerBootConfiguration),e}}]),n}(ay);var iy=function(){function e(){Object(g.a)(this,e)}return Object(h.a)(e,[{key:"destroy",value:function(){}},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",void 0);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),cy=function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this)).makeWorker=void 0,a.makeWorker=function(){return new iy},a}return Object(h.a)(n,[{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n,a,r){var o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new TypeError("sessionId is required");case 2:return o=t.getRpcMethodType(a),e.next=5,o.serializeArguments(r);case 5:return i=e.sent,s=this.filterArgs(i,t,n),e.next=9,o.execute(s);case 9:return l=e.sent,e.abrupt("return",o.deserializeReturn(l));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),n}(ay),sy="undefined"!==typeof window?window:{},ly=sy.electronBetterIpc,uy=void 0===ly?{}:ly,dy=sy.electron;function fy(e){return py.apply(this,arguments)}function py(){return(py=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var my=function(){function e(t,n,a){Object(g.a)(this,e),this.ipcRenderer=void 0,this.window=void 0,this.config=void 0,this.ready=!1,this.ipcRenderer=t,this.window=n,this.config=a}return Object(h.a)(e,[{key:"destroy",value:function(){this.window.destroy()}},{key:"setup",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ready){e.next=16;break}t=!1;case 2:if(t){e.next=10;break}return e.next=5,fy(1e3);case 5:return e.next=7,this.ipcRenderer.callRenderer(this.window,"ready_for_configuration");case 7:t=!!e.sent,e.next=2;break;case 10:return e.next=12,this.ipcRenderer.callRenderer(this.window,"configure",this.config);case 12:if(e.sent){e.next=15;break}throw new Error("failed to configure worker");case 15:this.ready=!0;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var a,r,o,i,s,l=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:{},e.next=3,this.setup();case 3:return a.statusCallback,r=Object(d.a)(a,["statusCallback"]),o="message-".concat(me.a.generate()),i=function(e,t){a.statusCallback&&a.statusCallback(t)},this.ipcRenderer.on(o,i),e.next=9,this.ipcRenderer.callRenderer(this.window,"call",t,Object(u.a)(Object(u.a)({},n),{},{channel:o}),r);case 9:return s=e.sent,this.ipcRenderer.removeListener(o,i),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),gy={WebWorkerRpcDriver:oy,MainThreadRpcDriver:cy,ElectronRpcDriver:function(e){Object(C.a)(n,e);var t=Object(E.a)(n);function n(e,a){var r,o=e.workerCreationChannel;return Object(g.a)(this,n),(r=t.call(this)).config=void 0,r.channel=void 0,r.config=a,r.channel=o,r}return Object(h.a)(n,[{key:"makeWorker",value:function(){var e=uy.ipcRenderer;if(!e)throw new Error("Cannot use ElectronRpcDriver without ipcRenderer from electron-better-ipc-extra");if(!dy)throw new Error("Cannot use ElectronRpcDriver without electron available globally");var t=dy.remote,n=e.sendSync(this.channel),a=t.BrowserWindow.fromId(n);return new my(e,a,this.config)}},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a,r,o){var i,s,l,u=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>4&&void 0!==u[4]?u[4]:{},e.next=3,Object(Yr.a)(Object(Kr.a)(n.prototype),"call",this).call(this,t,a,r,o,i);case 3:return"object"===typeof(s=e.sent)&&null!==s&&"imageData"in s&&((l=new Image).src=s.imageData.dataURL,s.imageData=l),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()}]),n}(ay)},hy=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(Object(g.a)(this,e),this.driverObjects=void 0,this.pluginManager=void 0,this.mainConfiguration=void 0,this.backendConfigurations=void 0,this.runtimePluginDefinitions=void 0,!a)throw new Error("RpcManager requires at least a main configuration");this.pluginManager=t,this.runtimePluginDefinitions=n,this.mainConfiguration=a,this.backendConfigurations=r,this.driverObjects=new Map}return Object(h.a)(e,[{key:"getDriver",value:function(e){var t=this.driverObjects.get(e);if(t)return t;var n=this.backendConfigurations[e],a=gy[e];if(!a)throw new Error('requested RPC driver "'.concat(e,'" is not installed'));if(!n)throw new Error('requested RPC driver "'.concat(e,'" is missing config'));var r=new a(n,{plugins:this.runtimePluginDefinitions});return this.driverObjects.set(e,r),r}},{key:"getDriverForCall",value:function(e,t,n){var a=Object(P.readConfObject)(this.mainConfiguration,"defaultDriver");return this.getDriver(a)}},{key:"call",value:function(){var e=Object(l.a)(c.a.mark((function e(t,n,a){var r,o=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>3&&void 0!==o[3]?o[3]:{},t){e.next=3;break}throw new Error("sessionId is required");case 3:return e.abrupt("return",this.getDriverForCall(t,n,a).call(this.pluginManager,t,n,a,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();hy.configSchema=Zv;var by=n(2442),vy=n.n(by);n(2443);function yy(e,t,n){var a=b.types.model("JBrowseWeb",{configuration:Object(P.ConfigurationSchema)("Root",Object(u.a)({rpc:hy.configSchema,highResolutionScaling:{type:"number",defaultValue:2},shareURL:{type:"string",defaultValue:"https://g5um1mrb0i.execute-api.us-east-1.amazonaws.com/api/v1/"},featureDetails:Object(P.ConfigurationSchema)("FeatureDetails",{sequenceTypes:{type:"stringArray",defaultValue:["mRNA","transcript"]}}),disableAnalytics:{type:"boolean",defaultValue:!1},theme:{type:"frozen",defaultValue:{}}},e.pluginConfigurationSchemas())),plugins:b.types.frozen(),assemblies:b.types.array(n),tracks:b.types.array(e.pluggableConfigSchemaType("track")),connections:b.types.array(e.pluggableConfigSchemaType("connection")),defaultSession:b.types.optional(b.types.frozen(t),{name:"New session"})}).actions((function(e){return{afterCreate:function(){var t=[];e.assemblyNames.forEach((function(e){if(!e)throw new Error('Encountered an assembly with no "name" defined');if(t.includes(e))throw new Error("Found two assemblies with the same name: ".concat(e));t.push(e)}))},addAssemblyConf:function(t){var n=t.name;if(!n)throw new Error('Can\'t add assembly with no "name"');var a=e.assemblies.find((function(e){return e.name===n}));if(a)return a;var r=e.assemblies.push(Object(u.a)(Object(u.a)({},t),{},{sequence:Object(u.a)({type:"ReferenceSequenceTrack",trackId:"".concat(n,"-").concat(Date.now())},t.sequence||{})}));return e.assemblies[r-1]},removeAssemblyConf:function(t){var n=e.assemblies.find((function(e){return e.name===t}));n&&e.assemblies.remove(n)},addTrackConf:function(t){var n=t.type;if(!n)throw new Error("unknown track type ".concat(n));var a=e.tracks.find((function(e){return e.trackId===t.trackId}));if(a)return a;var r=e.tracks.push(t);return e.tracks[r-1]},addDisplayConf:function(t,n){var a=n.type;if(!a)throw new Error("unknown display type ".concat(a));var r=e.tracks.find((function(e){return e.trackId===t}));if(!r)throw new Error("could not find track with id ".concat(t));return r.addDisplayConf(n)},addConnectionConf:function(t){var n=t.type;if(!n)throw new Error("unknown connection type ".concat(n));var a=e.connections.push(t);return e.connections[a-1]},deleteConnectionConf:function(t){var n=e.connections.findIndex((function(e){return e.id===t.id}));if(-1!==n)return e.connections.splice(n,1)},deleteTrackConf:function(t){var n=t.trackId,a=e.tracks.findIndex((function(e){return e.trackId===n}));if(-1!==a)return e.tracks.splice(a,1)},setDefaultSessionConf:function(t){var n,a=(n=Object(b.getParent)(e).session.name===t.name?Object(b.getSnapshot)(t):Object(le.toJS)(t)).name;if(!a)throw new Error("unable to set default session to ".concat(a));e.defaultSession=n}}})).views((function(e){return{get assemblyNames(){return e.assemblies.map((function(e){return Object(P.readConfObject)(e,"name")}))},get rpcManager(){return Object(b.getParent)(e).rpcManager}}}));return b.types.snapshotProcessor(a,{postProcessor:function(e){return function e(t,n){for(var a in t)a===n?delete t[a]:"object"===typeof t[a]&&e(t[a])}(e,"baseUri"),e}})}window.getSnapshot=b.getSnapshot,window.resolveIdentifier=b.resolveIdentifier;var wy=n(2441),Oy=n.n(wy);function jy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.types.frozen(),n=128;return b.types.model("JBrowseWebSessionModel",{id:b.types.optional(b.types.identifier,me()()),name:b.types.string,margin:0,drawerWidth:b.types.optional(b.types.refinement(b.types.integer,(function(e){return e>=n})),384),views:b.types.array(e.pluggableMstType("view","stateModel")),widgets:b.types.map(e.pluggableMstType("widget","stateModel")),activeWidgets:b.types.map(b.types.safeReference(e.pluggableMstType("widget","stateModel"))),connectionInstances:b.types.map(b.types.array(e.pluggableMstType("connection","stateModel"))),sessionTracks:b.types.array(e.pluggableConfigSchemaType("track")),sessionConnections:b.types.array(e.pluggableConfigSchemaType("connection")),sessionAssemblies:b.types.array(t),minimized:b.types.optional(b.types.boolean,!1)}).volatile((function(){return{selection:void 0,task:void 0}})).views((function(e){return{get shareURL(){return Object(P.getConf)(Object(b.getParent)(e).jbrowse,"shareURL")},get rpcManager(){return Object(b.getParent)(e).jbrowse.rpcManager},get configuration(){return Object(b.getParent)(e).jbrowse.configuration},get assemblies(){return Object(b.getParent)(e).jbrowse.assemblies},get assemblyNames(){return Object(b.getParent)(e).jbrowse.assemblyNames},get tracks(){return[].concat(Object(s.a)(e.sessionTracks),Object(s.a)(Object(b.getParent)(e).jbrowse.tracks))},get connections(){return[].concat(Object(s.a)(e.sessionConnections),Object(s.a)(Object(b.getParent)(e).jbrowse.connections))},get adminMode(){return Object(b.getParent)(e).adminMode},get savedSessions(){return Object(b.getParent)(e).savedSessions},get previousAutosaveId(){return Object(b.getParent)(e).previousAutosaveId},get savedSessionNames(){return Object(b.getParent)(e).savedSessionNames},get history(){return Object(b.getParent)(e).history},get menus(){return Object(b.getParent)(e).menus},get assemblyManager(){return Object(b.getParent)(e).assemblyManager},get version(){return Object(b.getParent)(e).version},get renderProps(){return{theme:Object(P.readConfObject)(this.configuration,"theme")}},get visibleWidget(){if(Object(b.isAlive)(e))return Array.from(e.activeWidgets.values())[e.activeWidgets.size-1]},getReferring:function(t){var n=[];return Object(b.walk)(Object(b.getParent)(e),(function(e){if(Object(b.isModelType)(Object(b.getType)(e))){var a=Object(b.getMembers)(e);Object.entries(a.properties).forEach((function(a){var r=Object(f.a)(a,2),o=r[0],i=r[1];Object(b.isReferenceType)(i)&&e[o]===t&&n.push({node:e,key:o})}))}})),n}}})).actions((function(t){return{setName:function(e){t.name=e},addAssembly:function(e){t.sessionAssemblies.push(e)},removeAssembly:function(e){var n=t.sessionAssemblies.findIndex((function(t){return t.name===e}));-1!==n&&t.sessionAssemblies.splice(n,1)},makeConnection:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.type;if(!r)throw new Error("track configuration has no `type` listed");var o=Object(P.readConfObject)(n,"name"),i=e.getConnectionType(r);if(!i)throw new Error("unknown connection type ".concat(r));var c=Object(P.readConfObject)(n,"assemblyName"),s=Object(u.a)(Object(u.a)({},a),{},{name:o,type:r,configuration:n});t.connectionInstances.has(c)||t.connectionInstances.set(c,[]);var l=t.connectionInstances.get(c);if(!l)throw new Error("assembly ".concat(c," not found"));var d=l.push(s);return l[d-1]},removeReferring:function(e,n,a,r){var o=this;e.forEach((function(e){var i=e.node,c=!1;try{var s="open track(s)",l=Object(_.getContainingView)(i);a.push((function(){return l.hideTrack(n.trackId)})),c=!0,r[s]||(r[s]=0),r[s]+=1}catch(d){}if(t.widgets.has(i.id)){var u="configuration editor widget(s)";a.push((function(){return o.hideWidget(i)})),c=!0,r[u]||(r[u]=0),r[u]+=1}if(!c)throw new Error("Error when closing this connection, the following node is still referring to a track configuration: ".concat(JSON.stringify(Object(b.getSnapshot)(i))))}))},prepareToBreakConnection:function(e){var n=this,a=[],r={},o=Object(P.readConfObject)(e,"name"),i=Object(P.readConfObject)(e,"assemblyName"),c=(t.connectionInstances.get(i)||[]).find((function(e){return e.name===o}));if(c){c.tracks.forEach((function(e){var o=t.getReferring(e);n.removeReferring(o,e,a,r)}));return[function(){a.forEach((function(e){return e()})),n.breakConnection(e)},r]}},breakConnection:function(e){var n=Object(P.readConfObject)(e,"name"),a=Object(P.readConfObject)(e,"assemblyName"),r=t.connectionInstances.get(a);if(!r)throw new Error("connections for ".concat(a," not found"));var o=r.find((function(e){return e.name===n}));r.remove(o)},deleteConnection:function(e){var n;if(t.adminMode&&(n=Object(b.getParent)(t).jbrowse.deleteConnectionConf(e)),!n){var a=e.connectionId,r=t.sessionConnections.findIndex((function(e){return e.connectionId===a}));if(-1===r)return;return t.sessionConnections.splice(r,1)}return n},updateDrawerWidth:function(e){if(e===t.drawerWidth)return t.drawerWidth;var a=e;return a<n&&(a=n),t.drawerWidth=a,a},resizeDrawer:function(e){var n=t.drawerWidth;return n-this.updateDrawerWidth(n-e)},addView:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.getElementType("view",n);if(!r)throw new Error("unknown view type ".concat(n));var o=t.views.push(Object(u.a)(Object(u.a)({},a),{},{type:n}));return t.views[o-1]},removeView:function(e){var n,a=Object(He.a)(t.activeWidgets);try{for(a.s();!(n=a.n()).done;){var r=Object(f.a)(n.value,2)[1];r.view&&r.view.id===e.id&&this.hideWidget(r)}}catch(o){a.e(o)}finally{a.f()}t.views.remove(e)},addAssemblyConf:function(e){return Object(b.getParent)(t).jbrowse.addAssemblyConf(e)},addTrackConf:function(e){if(t.adminMode)return Object(b.getParent)(t).jbrowse.addTrackConf(e);var n=e.trackId,a=e.type;if(!a)throw new Error("unknown track type ".concat(a));var r=t.sessionTracks.find((function(e){return e.trackId===n}));if(r)return r;var o=t.sessionTracks.push(e);return t.sessionTracks[o-1]},deleteTrackConf:function(e){var n=[],a=t.getReferring(e);if(this.removeReferring(a,e,n,{}),n.forEach((function(e){return e()})),t.adminMode)return Object(b.getParent)(t).jbrowse.deleteTrackConf(e);var r=e.trackId,o=t.sessionTracks.findIndex((function(e){return e.trackId===r}));return-1!==o?t.sessionTracks.splice(o,1):void 0},addConnectionConf:function(e){if(t.adminMode)return Object(b.getParent)(t).jbrowse.addConnectionConf(e);var n=e.connectionId,a=e.type;if(!a)throw new Error("unknown connection type ".concat(a));var r=t.sessionTracks.find((function(e){return e.connectionId===n}));if(r)return r;var o=t.sessionConnections.push(e);return t.sessionConnections[o-1]},addLinearGenomeViewOfAssembly:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addViewOfAssembly("LinearGenomeView",e,t)},addViewOfAssembly:function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.assemblies.find((function(e){return Object(P.readConfObject)(e,"name")===n}));if(!r)throw new Error('Could not add view of assembly "'.concat(n,'", assembly name not found'));return a.displayRegionsFromAssemblyName=Object(P.readConfObject)(r,"name"),this.addView(e,a)},addViewFromAnotherView:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=Object(u.a)({},n);return a.displayedRegions=Object(b.getSnapshot)(t.displayedRegions),this.addView(e,a)},addWidget:function(n,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{type:n},i=e.getElementType("widget",n);if(!i)throw new Error("unknown widget type ".concat(n));var c=Object(u.a)(Object(u.a)({},r),{},{id:a,type:n,configuration:o});return t.widgets.set(a,c),t.widgets.get(a)},showWidget:function(e){t.activeWidgets.has(e.id)&&t.activeWidgets.delete(e.id),t.activeWidgets.set(e.id,e),t.minimized=!1},hasWidget:function(e){return t.activeWidgets.has(e.id)},hideWidget:function(e){t.activeWidgets.delete(e.id)},minimizeWidgetDrawer:function(){t.minimized=!0},showWidgetDrawer:function(){t.minimized=!1},hideAllWidgets:function(){t.activeWidgets.clear()},setSelection:function(e){t.selection=e},clearSelection:function(){t.selection=void 0},clearConnections:function(){t.connectionInstances.clear(),t.sessionConnections.clear()},addSavedSession:function(e){return Object(b.getParent)(t).addSavedSession(e)},removeSavedSession:function(e){return Object(b.getParent)(t).removeSavedSession(e)},renameCurrentSession:function(e){return Object(b.getParent)(t).renameCurrentSession(e)},duplicateCurrentSession:function(){return Object(b.getParent)(t).duplicateCurrentSession()},activateSession:function(e){return Object(b.getParent)(t).activateSession(e)},setDefaultSession:function(){return Object(b.getParent)(t).setDefaultSession()},saveSessionToLocalStorage:function(){return Object(b.getParent)(t).saveSessionToLocalStorage()},loadAutosaveSession:function(){return Object(b.getParent)(t).loadAutosaveSession()},setSession:function(e){return Object(b.getParent)(t).setSession(e)}}})).extend((function(){var e=le.observable.array();return{views:{get snackbarMessages(){return e}},actions:{notify:function(e,t){return this.pushSnackbarMessage(e,t)},pushSnackbarMessage:function(t,n){return e.push([t,n])},popSnackbarMessage:function(){return e.pop()}}}})).actions((function(e){return{editConfiguration:function(t){if(!Object(P.isConfigurationModel)(t))throw new Error("must pass a configuration model to editConfiguration");var n=e,a=n.addWidget("ConfigurationEditorWidget","configEditor",{target:t});n.showWidget(a)},editTrackConfiguration:function(t){if(!e.adminMode&&-1===e.sessionTracks.indexOf(t))throw new Error("Can't edit the configuration of a non-session track");this.editConfiguration(t)}}})).views((function(e){return{getTrackActionMenuItems:function(t){var n=e,a=n.adminMode||n.sessionTracks.find((function(e){return e.trackId===t.trackId})),r="ReferenceSequenceTrack"===Object(P.readConfObject)(t,"type");return[{label:"Settings",disabled:!a,onClick:function(){n.editTrackConfiguration(t)},icon:Iv.a},{label:"Delete track",disabled:!a||r,onClick:function(){n.deleteTrackConf(t)},icon:ds.a},{label:"Copy track",disabled:r,onClick:function(){var e=JSON.parse(JSON.stringify(Object(b.getSnapshot)(t))),a=Date.now();e.trackId+="-".concat(a),e.displays.forEach((function(e){e.displayId+="-".concat(a)})),n.adminMode||(e.trackId+="-sessionTrack",e.category=void 0),e.name+=" (copy)",n.addTrackConf(e)},icon:Tm.a}]}}}))}function ky(e,t){if(void 0!==e)if(Object(b.isArrayType)(t))!function(){var t=e,n=Object(b.getChildType)(e);if(Object(b.isReferenceType)(n))for(var a=function(e){Object(b.isValidReference)((function(){return t[e]}))?e+=1:t.splice(e,1),r=e},r=0;r<t.length;)a(r);t.forEach((function(e){ky(e,n)}))}();else if(Object(b.isMapType)(t))!function(){var t=e,n=Object(b.getChildType)(t);if(Object(b.isReferenceType)(n)){var a=function(e){Object(b.isValidReference)((function(){return t.get(e)}))||t.delete(e)};for(var r in t.keys())a(r)}t.forEach((function(e){ky(e,n)}))}();else if(Object(b.isModelType)(t)){var n=Object(b.getPropertyMembers)(e).properties;Object.entries(n).forEach((function(t){var n=Object(f.a)(t,2),a=n[0],r=n[1];ky(e[a],r)}))}}function Cy(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Kv(e),a=n.assemblyConfigSchemas,r=n.dispatcher,o=b.types.union.apply(b.types,[{dispatcher:r}].concat(Object(s.a)(a))),i=jy(e,o),c=Yv(o,e);return b.types.model("Root",{jbrowse:yy(e,i,o),configPath:b.types.maybe(b.types.string),session:b.types.maybe(i),assemblyManager:c,version:b.types.maybe(b.types.string),isAssemblyEditing:!1,isDefaultSessionEditing:!1}).volatile((function(){return{savedSessionsVolatile:le.observable.map({}),pluginManager:e,error:void 0}})).views((function(e){return{get savedSessions(){return Array.from(e.savedSessionsVolatile.values())},localStorageId:function(t){return"localSaved-".concat(t,"-").concat(e.configPath)},get autosaveId(){return"autosave-".concat(e.configPath)},get previousAutosaveId(){return"previousAutosave-".concat(e.configPath)}}})).views((function(e){return{get savedSessionNames(){return e.savedSessions.map((function(e){return e.name}))},get currentSessionId(){var e,t=new URL(window.location.href),n=new URLSearchParams(t.search);return null===n||void 0===n||null===(e=n.get("session"))||void 0===e?void 0:e.split("local-")[1]}}})).actions((function(e){return{afterCreate:function(){Object.entries(localStorage).filter((function(e){var t=Object(f.a)(e,2),n=t[0];t[1];return n.startsWith("localSaved-")})).filter((function(t){var n=Object(f.a)(t,2),a=n[0];n[1];return-1!==a.indexOf(e.configPath||"undefined")})).forEach((function(t){var n=Object(f.a)(t,2),a=n[0],r=n[1];try{var o=JSON.parse(r).session;e.savedSessionsVolatile.set(a,o)}catch(i){console.error("bad session encountered",a,r)}})),Object(b.addDisposer)(e,Object(le.autorun)((function(){var t,n=Object(He.a)(e.savedSessionsVolatile.entries());try{for(n.s();!(t=n.n()).done;){var a=Object(f.a)(t.value,2),r=(a[0],a[1]);try{var o=e.localStorageId(r.name);localStorage.setItem(o,JSON.stringify({session:r}))}catch(i){"22"!==i.code&&"1024"!==i.code||alert('Local storage is full! Please use the "Open sessions" panel to remove old sessions')}}}catch(c){n.e(c)}finally{n.f()}}))),Object(b.addDisposer)(e,Object(le.autorun)((function(){if(e.session){var t=Object(b.getSnapshot)(e.session)||{name:"empty"};sessionStorage.setItem("current",JSON.stringify({session:t})),localStorage.setItem("autosave-".concat(e.configPath),JSON.stringify({session:Object(u.a)(Object(u.a)({},t),{},{name:"".concat(t.name,"-autosaved")})}))}}),{delay:400}))},setSession:function(t){var n=e.session;if(e.session=Object(b.cast)(t),e.session)try{ky(e.session,Object(b.getType)(e.session))}catch(a){throw e.session=n,a}},setAssemblyEditing:function(t){e.isAssemblyEditing=t},setDefaultSessionEditing:function(t){e.isDefaultSessionEditing=t},setDefaultSession:function(){var t=e.jbrowse.defaultSession,n=Object(u.a)(Object(u.a)({},t),{},{name:"".concat(t.name," ").concat((new Date).toLocaleString())});this.setSession(n)},renameCurrentSession:function(t){if(e.session){var n=JSON.parse(JSON.stringify(Object(b.getSnapshot)(e.session)));n.name=t,this.setSession(n)}},addSavedSession:function(t){var n=e.localStorageId(t.name);e.savedSessionsVolatile.set(n,t)},removeSavedSession:function(t){var n=e.localStorageId(t.name);localStorage.removeItem(n),e.savedSessionsVolatile.delete(n)},duplicateCurrentSession:function(){if(e.session){var t=JSON.parse(JSON.stringify(Object(b.getSnapshot)(e.session))),n="".concat(e.session.name," (copy)");if(e.savedSessionNames.includes(n)){var a=2;do{n="".concat(e.session.name," (copy ").concat(a,")"),a+=1}while(e.savedSessionNames.includes(n))}t.name=n,this.setSession(t)}},activateSession:function(t){var n=e.localStorageId(t),a=localStorage.getItem(n);if(!a)throw new Error("Can't activate session ".concat(t,", it is not in the savedSessions"));this.setSession(JSON.parse(a).session)},saveSessionToLocalStorage:function(){if(e.session){var t=e.localStorageId(e.session.name);e.savedSessionsVolatile.set(t,Object(b.getSnapshot)(e.session))}},loadAutosaveSession:function(){var t=localStorage.getItem(e.previousAutosaveId),n=t?JSON.parse(t).session:{},a=n.name;n.name="".concat(a.replace("-autosaved",""),"-restored"),this.setSession(n)},setError:function(t){e.error=t}}})).volatile((function(n){return{history:{},menus:[{label:"File",menuItems:[{label:"New session",icon:ps.a,onClick:function(e){var t=localStorage.getItem(n.autosaveId);t&&localStorage.setItem(n.previousAutosaveId,t),e.setDefaultSession()}},{label:"Return to splash screen",icon:vy.a,onClick:function(){n.setSession(void 0)}}]}].concat(Object(s.a)(t?[{label:"Admin",menuItems:[{label:"Open assembly manager",icon:Iv.a,onClick:function(e){Object(b.getParent)(e).setAssemblyEditing(!0)}},{label:"Set default session",icon:Iv.a,onClick:function(e){Object(b.getParent)(e).setDefaultSessionEditing(!0)}}]}]:[])),rpcManager:new hy(e,n.jbrowse.plugins,n.jbrowse.configuration.rpc,{WebWorkerRpcDriver:{WorkerClass:Oy.a},MainThreadRpcDriver:{}}),adminMode:t}})).actions((function(e){return{setHistory:function(t){e.history=t},setMenus:function(t){e.menus=t},appendMenu:function(t){return e.menus.push({label:t,menuItems:[]})},insertMenu:function(t,n){var a=n<0?e.menus.length+n:n;return e.menus.splice(a,0,{label:t,menuItems:[]}),e.menus.length},appendToMenu:function(t,n){var a=e.menus.find((function(e){return e.label===t}));return a?a.menuItems.push(n):(e.menus.push({label:t,menuItems:[n]}),1)},insertInMenu:function(t,n,a){var r=e.menus.find((function(e){return e.label===t}));if(!r)return e.menus.push({label:t,menuItems:[n]}),1;var o=a<0?r.menuItems.length+a:a;return r.menuItems.splice(o,0,n),r.menuItems.length},appendToSubMenu:function(t,n){var a=e.menus.find((function(e){return e.label===t[0]}));if(!a){var r=this.appendMenu(t[0]);a=e.menus[r-1]}var o=a.menuItems,i=[t[0]];return t.slice(1).forEach((function(e){i.push(e);var t=o.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=o.push({label:e,subMenu:[]});t=o[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(i,'" is not a subMenu'));o=t.subMenu})),o.push(n)},insertInSubMenu:function(t,n,a){var r=e.menus.find((function(e){return e.label===t[0]}));if(!r){var o=this.appendMenu(t[0]);r=e.menus[o-1]}var i=r.menuItems,c=[t[0]];return t.slice(1).forEach((function(e){c.push(e);var t=i.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=i.push({label:e,subMenu:[]});t=i[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(c,'" is not a subMenu'));i=t.subMenu})),i.splice(a,0,n),i.length}}}))}var Ey=n(2444);function xy(){return Sy.apply(this,arguments)}function Sy(){return(Sy=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location=window.location.pathname;case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ty=n(533),Ny=n.n(Ty),Ay=n(1002),Ry=Object(Ze.a)({menu:{left:"65%"}});var My=function(e){var t=e.sessionName,n=e.onClick,a=e.onDelete,r=Ry(),o=Object(p.useState)(!1),i=Object(f.a)(o,2),c=i[0],s=i[1],l=Object(p.useState)(null),u=Object(f.a)(l,2),d=u[0],g=u[1],h=function(e){if(g(null),"delete"===e)return a(t)};return m.a.createElement(m.a.Fragment,null,m.a.createElement(ls.a,{onMouseOver:function(){return s(!0)},onMouseOut:function(){return s(!1)},onClick:function(){return n(t)},raised:Boolean(c),button:!0},m.a.createElement(et.a,{title:t,enterDelay:300},m.a.createElement(Je.a,{variant:"body2",noWrap:!0,style:{width:250}},t)),m.a.createElement(Qt.a,{className:r.menu,onClick:function(e){e.stopPropagation(),g(e.currentTarget)}},m.a.createElement(_n.a,{color:"secondary"}))),m.a.createElement(iu.a,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:h},m.a.createElement(va.a,{onClick:function(){return h("delete")}},m.a.createElement(Ku.a,null,m.a.createElement(ds.a,{color:"secondary"})),m.a.createElement(Je.a,{variant:"inherit"},"Delete"))))},Py=Object(Ze.a)((function(e){return{newSession:{backgroundColor:e.palette.grey[300],padding:e.spacing(2),marginTop:e.spacing(6)},header:{margin:e.spacing(2)},settings:{float:"right"}}})),Fy=function(e){var t=e.sessionToDelete,n=e.onClose,a=e.root,r=Object(p.useState)(!1),o=Object(f.a)(r,2),i=o[0],s=o[1];return Object(p.useEffect)((function(){Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{i&&(s(!1),a.removeSavedSession({name:t}),n(!0))}catch(r){s((function(){throw r}))}case 1:case"end":return e.stop()}}),e)})))()}),[i,n,a,t]),m.a.createElement(Gt.a,{open:!!t,onClose:function(){return n(!1)}},m.a.createElement(Jt.a,{id:"alert-dialog-title"},'Delete session "'.concat(t,'"?')),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,{id:"alert-dialog-description"},"This action cannot be undone")),m.a.createElement(Kt.a,null,m.a.createElement(Ge.a,{onClick:function(){return n(!1)},color:"primary"},"Cancel"),m.a.createElement(Ge.a,{onClick:function(){s(!0)},color:"primary",variant:"contained",autoFocus:!0},"Delete")))};function Iy(e){var t=e.root,n=e.onFactoryReset,a=Py(),r=Object(p.useState)(),o=Object(f.a)(r,2),i=o[0],s=o[1],u=Object(p.useState)(),d=Object(f.a)(u,2),g=d[0],h=d[1],b=Object(p.useState)(),v=Object(f.a)(b,2),y=v[0],w=v[1],O=Object(p.useState)(!0),j=Object(f.a)(O,2),k=j[0],C=j[1],E=Object(p.useState)(null),x=Object(f.a)(E,2),S=x[0],T=x[1],N=Object(p.useState)(!1),A=Object(f.a)(N,2),R=A[0],M=A[1],P=void 0!==i?i:[];return Object(p.useEffect)((function(){Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{y&&t.activateSession(y)}catch(n){s((function(){throw n}))}case 1:case"end":return e.stop()}}),e)})))()}),[t,y]),Object(p.useEffect)((function(){Object(l.a)(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{k&&(C(!1),n=t.savedSessions.map((function(e){var t;return null===(t=JSON.parse(JSON.stringify(e)))||void 0===t?void 0:t.name})),s(n))}catch(a){s((function(){throw a}))}case 1:case"end":return e.stop()}}),e)})))()}),[t.savedSessions,k]),i?m.a.createElement(m.a.Fragment,null,m.a.createElement(ue.FactoryResetDialog,{open:R,onFactoryReset:n,onClose:function(){M(!1)}}),m.a.createElement(Fy,{root:t,sessionToDelete:g,onClose:function(e){h(void 0),C(e)}}),m.a.createElement(Qt.a,{className:a.settings,onClick:function(e){e.stopPropagation(),T(e.currentTarget)}},m.a.createElement(Iv.a,null)),m.a.createElement(ha.a,{maxWidth:"md"},m.a.createElement(ue.LogoFull,null),m.a.createElement("div",{className:a.newSession},m.a.createElement(Je.a,{variant:"h5",className:a.header},"Start a new session"),m.a.createElement(ba.a,{container:!0,spacing:4},m.a.createElement(ba.a,{item:!0,"data-testid":"emptySession"},m.a.createElement(Ay.f,{root:t})),m.a.createElement(ba.a,{item:!0,"data-testid":"emptyLGVSession"},m.a.createElement(Ay.a,{root:t})),m.a.createElement(ba.a,{item:!0,"data-testid":"emptySVSession"},m.a.createElement(Ay.b,{root:t})))),m.a.createElement("div",null,m.a.createElement(Je.a,{variant:"h5",className:a.header},"Recent sessions"),m.a.createElement(ss.a,{style:{overflow:"auto",maxHeight:200}},P?P.map((function(e){return m.a.createElement(My,{key:e,sessionName:e,onClick:function(){w(e)},onDelete:function(){h(e)}})})):null))),m.a.createElement(iu.a,{id:"simple-menu",anchorEl:S,keepMounted:!0,open:Boolean(S),onClose:function(){T(null)}},m.a.createElement($u.a,null,"Advanced Settings"),m.a.createElement(va.a,{onClick:function(){M(!0),T(null)}},m.a.createElement(Ku.a,null,m.a.createElement(Ny.a,null)),m.a.createElement(Je.a,{variant:"inherit"},"Reset")))):m.a.createElement(un.a,{style:{position:"fixed",top:"50%",left:"50%",marginTop:-25,marginLeft:-25},size:50})}var By=Object(Ze.a)((function(e){return{main:{textAlign:"center",margin:e.spacing(2),padding:e.spacing(2),borderWidth:2,borderRadius:2},buttons:{margin:e.spacing(2),color:e.palette.text.primary}}}));function Ly(e){var t=e.onConfirm,n=e.onCancel,a=By();return m.a.createElement(Gt.a,{open:!0,maxWidth:"xl","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description","data-testid":"session-warning-modal",className:a.main},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Warning"),m.a.createElement(Xt.a,null),m.a.createElement("div",null,m.a.createElement(Ny.a,{fontSize:"large"}),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,null,"This link contains an external session, which may contain dangerous code."),m.a.createElement(ru.a,null,"Please ensure you trust the source of this session.")),m.a.createElement("div",{className:a.buttons},m.a.createElement(Ge.a,{color:"primary",variant:"contained",style:{marginRight:5},onClick:Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t();case 1:case"end":return e.stop()}}),e)})))},"Yes, I trust it"),m.a.createElement(Ge.a,{variant:"contained",onClick:function(){n()}},"Cancel"))))}var Dy=Object(Ze.a)((function(e){return{main:{textAlign:"center",margin:e.spacing(2),padding:e.spacing(2),borderWidth:2,borderRadius:2},buttons:{margin:e.spacing(2),color:e.palette.text.primary}}}));function Vy(e){var t=e.onConfirm,n=e.onCancel,a=Dy();return m.a.createElement(Gt.a,{open:!0,maxWidth:"xl","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description","data-testid":"session-warning-modal",className:a.main},m.a.createElement(Jt.a,{id:"alert-dialog-title"},"Warning"),m.a.createElement(Xt.a,null),m.a.createElement("div",null,m.a.createElement(Ny.a,{fontSize:"large"}),m.a.createElement(Yt.a,null,m.a.createElement(ru.a,null,"This link contains a cross origin config that loads a configuration from an external site."),m.a.createElement(ru.a,null,"Please ensure you trust the source of this link.")),m.a.createElement("div",{className:a.buttons},m.a.createElement(Ge.a,{color:"primary",variant:"contained",style:{marginRight:5},onClick:Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t();case 1:case"end":return e.stop()}}),e)})))},"Yes, I trust it"),m.a.createElement(Ge.a,{variant:"contained",onClick:Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n();case 1:case"end":return e.stop()}}),e)})))},"Cancel"))))}function Wy(){return m.a.createElement("div",null,m.a.createElement("h4",null,"Configuration not found. You may have arrived here if you requested a config that does not exist or you have not set up your JBrowse yet."),m.a.createElement("p",null,"If you want to complete your setup, visit our"," ",m.a.createElement("a",{href:"https://jbrowse.org/jb2/docs/quickstart_web"},"Quick start guide")),_.inDevelopment?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",null,"Sample JBrowse configs:"),m.a.createElement("ul",null,[["test_data/volvox/config.json","Volvox sample data"],["test_data/config.json","Human basic"],["test_data/config_demo.json","Human sample data"],["test_data/tomato/config.json","Tomato SVs"],["test_data/breakpoint/config.json","Breakpoint"],["test_data/config_dotplot.json","Grape/Peach dotplot"],["test_data/config_synteny_grape_peach.json","Grape/Peach synteny"],["test_data/yeast_synteny/config.json","Yeast synteny"],["test_data/config_many_contigs.json","Many contigs"],["test_data/config_honeybee.json","Honeybee"],["test_data/config_wormbase.json","Wormbase"]].map((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1],r=window.location,o=r.href,i=r.search,c=fe.a.parse(i),s=(c.config,Object(d.a)(c,["config"])),l=o.split("?")[0],p=fe.a.stringify(Object(u.a)(Object(u.a)({},s),{},{config:n}));return m.a.createElement("li",{key:a},m.a.createElement("a",{href:"".concat(l,"?").concat(p)},a))})))):m.a.createElement(m.a.Fragment,null,m.a.createElement("div",null,"Sample JBrowse config:"),m.a.createElement("ul",null,m.a.createElement("li",null,m.a.createElement("a",{href:"?config=test_data/volvox/config.json"},"Volvox sample data")))))}var qy=b.types.model({configPath:b.types.maybe(b.types.string),sessionQuery:b.types.maybe(b.types.string),password:b.types.maybe(b.types.string),adminKey:b.types.maybe(b.types.string)}).volatile((function(){return{blankSession:!1,sessionTriaged:void 0,shareWarningOpen:!1,configSnapshot:void 0,sessionSnapshot:void 0,runtimePlugins:[],sessionError:void 0,configError:void 0,bc1:window.BroadcastChannel&&new window.BroadcastChannel("jb_request_session"),bc2:window.BroadcastChannel&&new window.BroadcastChannel("jb_respond_session")}})).views((function(e){return{get sharedSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("share-")},get encodedSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("encoded-")},get jsonSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("json-")},get localSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("local-")},get ready(){return this.sessionLoaded&&!e.configError},get error(){return e.configError||e.sessionError},get sessionLoaded(){return!!e.sessionError||!!e.sessionSnapshot||!!e.blankSession},get configLoaded(){return!!e.configError||!!e.configSnapshot}}})).actions((function(e){return{setSessionQuery:function(t){e.sessionQuery=t},setConfigError:function(t){e.configError=t},setSessionError:function(t){e.sessionError=t},setRuntimePlugins:function(t){e.runtimePlugins=t},setConfigSnapshot:function(t){e.configSnapshot=t},setSessionSnapshot:function(t){e.sessionSnapshot=t,sessionStorage.setItem("current",JSON.stringify(t))},setBlankSession:function(t){e.blankSession=t},setSessionTriaged:function(t){e.sessionTriaged=t}}})).actions((function(e){return{fetchPlugins:function(t){return Object(l.a)(c.a.mark((function n(){var a,r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(a=new ae.a(t.plugins)).installGlobalReExports(window),n.next=5,a.load();case 5:r=n.sent,e.setRuntimePlugins(Object(s.a)(r)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},fetchConfig:function(){var t=this;return Object(l.a)(c.a.mark((function n(){var a,r,o,i,s;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a={uri:e.configPath||"config.json"},r=Object(oe.openLocation)(a),n.next=5,r.readFile("utf8");case 5:if(o=n.sent,i=JSON.parse(o),s=new URL(a.uri,window.location.href),_y(i,s),s.hostname===window.location.hostname){n.next=13;break}e.setSessionTriaged({snap:i,origin:"config"}),n.next=16;break;case 13:return n.next=15,t.fetchPlugins(i);case 15:e.setConfigSnapshot(i);case 16:n.next=22;break;case 18:n.prev=18,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 22:case"end":return n.stop()}}),n,null,[[0,18]])})))()},fetchSessionStorageSession:function(){return Object(l.a)(c.a.mark((function t(){var n,a,r,o,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=sessionStorage.getItem("current"),a=e.sessionQuery.replace("local-",""),!n){t.next=7;break}if(r=JSON.parse(n).session||{},a!==r.id){t.next=7;break}return e.setSessionSnapshot(r),t.abrupt("return");case 7:if(!e.bc1){t.next=20;break}return e.bc1.postMessage(a),o=new Promise((function(t,n){e.bc2&&(e.bc2.onmessage=function(e){t(e.data)}),setTimeout((function(){return n()}),1e3)})),t.prev=10,t.next=13,o;case 13:return i=t.sent,e.setSessionSnapshot(Object(u.a)(Object(u.a)({},i),{},{id:me()()})),t.abrupt("return");case 18:t.prev=18,t.t0=t.catch(10);case 20:e.setSessionError(new Error("Local storage session not found"));case 21:case"end":return t.stop()}}),t,null,[[10,18]])})))()},fetchSharedSession:function(){return Object(l.a)(c.a.mark((function t(){var n,a,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(e,t,n){return(e.configuration||{})[t]||n},"https://g5um1mrb0i.execute-api.us-east-1.amazonaws.com/api/v1/",t.next=4,Re("".concat(n(e.configSnapshot,"shareURL","https://g5um1mrb0i.execute-api.us-east-1.amazonaws.com/api/v1/"),"load"),e.sessionQuery||"",e.password||"");case 4:a=t.sent,r=JSON.parse(Object(_.fromUrlSafeB64)(a)),e.setSessionSnapshot(Object(u.a)(Object(u.a)({},r),{},{id:me()()}));case 7:case"end":return t.stop()}}),t)})))()},decodeEncodedUrlSession:function(){return Object(l.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=JSON.parse(Object(_.fromUrlSafeB64)(e.sessionQuery.replace("encoded-",""))),e.setSessionSnapshot(Object(u.a)(Object(u.a)({},n),{},{id:me()()}));case 2:case"end":return t.stop()}}),t)})))()},decodeJsonUrlSession:function(){return Object(l.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(e.sessionQuery.replace("json-","")),t.next=3,xe(n);case 3:t.sent?e.setSessionTriaged({snap:n,origin:"share"}):e.setSessionSnapshot(Object(u.a)(Object(u.a)({},n),{},{id:me()()}));case 5:case"end":return t.stop()}}),t)})))()},afterCreate:function(){var t=this;return Object(l.a)(c.a.mark((function n(){var a,r,o,i,s,u;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.localSession,r=e.encodedSession,o=e.sharedSession,i=e.jsonSession,s=e.configPath,(u=localStorage.getItem("autosave-".concat(s)))&&localStorage.setItem("previousAutosave-".concat(s),u),n.prev=3,n.next=6,t.fetchConfig();case 6:n.next=12;break;case 8:return n.prev=8,n.t0=n.catch(3),e.setConfigError(n.t0),n.abrupt("return");case 12:Object(b.addDisposer)(e,Object(le.autorun)(Object(l.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e.configSnapshot){n.next=28;break}if(!o){n.next=7;break}return n.next=5,t.fetchSharedSession();case 5:n.next=27;break;case 7:if(!r){n.next=12;break}return n.next=10,t.decodeEncodedUrlSession();case 10:n.next=27;break;case 12:if(!i){n.next=17;break}return n.next=15,t.decodeJsonUrlSession();case 15:n.next=27;break;case 17:if(!a){n.next=22;break}return n.next=20,t.fetchSessionStorageSession();case 20:n.next=27;break;case 22:if(!e.sessionQuery){n.next=26;break}throw new Error("unrecognized session format");case 26:e.setBlankSession(!0);case 27:e.bc1&&(e.bc1.onmessage=function(t){var n=JSON.parse(sessionStorage.getItem("current")||"{}").session||{};n.id===t.data&&e.bc2&&e.bc2.postMessage(n)});case 28:n.next=34;break;case 30:n.prev=30,n.t0=n.catch(0),console.error(n.t0),e.setSessionError(n.t0);case 34:case"end":return n.stop()}}),n,null,[[0,30]])})))));case 13:case"end":return n.stop()}}),n,null,[[3,8]])})))()}}}));function zy(e){var t=e.initialTimestamp,n=function(e){return null===e?void 0:e},a=Object(se.c)("config",se.b),r=Object(f.a)(a,1)[0],o=Object(se.c)("session",se.b),i=Object(f.a)(o,1)[0],c=Object(se.c)("password",se.b),s=Object(f.a)(c,1)[0],l=Object(se.c)("adminKey",se.b),u=Object(f.a)(l,1)[0],d=qy.create({configPath:n(r),sessionQuery:n(i),password:n(s),adminKey:n(u)});return m.a.createElement(Hy,{loader:d,initialTimestamp:t,initialSessionQuery:i})}var Hy=Object(re.observer)((function(e){var t=e.loader,n=e.initialTimestamp,a=e.initialSessionQuery,r=Object(se.c)("password",se.b),o=Object(f.a)(r,2)[1],i=t.sessionError,d=t.configError,g=t.ready,h=t.shareWarningOpen,b=Object(p.useState)(),v=Object(f.a)(b,2),y=v[0],w=v[1],O=Object(p.useState)(""),j=Object(f.a)(O,2),k=j[0],C=j[1],E=Object(p.useState)(""),x=Object(f.a)(E,2),S=x[0],T=x[1];Object(p.useEffect)((function(){try{var e=t.runtimePlugins,r=t.adminKey,c=t.configSnapshot,l=t.sessionSnapshot,u=t.configPath;if(g){var d=new ne([].concat(Object(s.a)(Tv.map((function(e){return{plugin:new e,metadata:{isCore:!0}}}))),Object(s.a)(e.map((function(e){return new e})))));d.createPluggableElements();var f=Cy(d,!!r);if(t.configSnapshot){var p=f.create({jbrowse:c,assemblyManager:{},version:Ey.version,configPath:u},{pluginManager:d});if(i)p.setDefaultSession(),p.session&&p.session.notify("Error loading session: ".concat(i.message,'. If you\n                received this URL from another user, request that they send you\n                a session generated with the "Share" button instead of copying\n                and pasting their URL'));else if(l&&!h)try{p.setSession(t.sessionSnapshot)}catch(A){var m;console.error(A),p.setDefaultSession();var b=(A.message||"").replace("[mobx-state-tree] ","").replace(/\(.+/,"");null===(m=p.session)||void 0===m||m.notify("Session could not be loaded. ".concat(b.length>1e3?"".concat(b.slice(0,1e3),"...see more in console"):b))}else{var v=p.jbrowse.defaultSession;(null===v||void 0===v?void 0:v.views)&&v.views.length>0&&p.setDefaultSession()}p&&!Object(P.readConfObject)(p.jbrowse.configuration,"disableAnalytics")&&(function(e,t,n){ge.apply(this,arguments)}(p,n,a),function(e,t){he.apply(this,arguments)}(p,n)),d.setRootModel(p),d.configure(),w(d),o(void 0)}}}catch(O){var y=O.message.match(/.*at path "(.*)" snapshot `(.*)` is not assignable/);y?(C("Failed to load element at ".concat(y[1])),T(y[2])):C(O.message.slice(0,1e4)),console.error(O)}}),[t,h,g,i,o,n,a]);var N,A=d||k;if(A)return m.a.createElement("div",null,m.a.createElement(Wy,null),A?m.a.createElement("div",{style:{border:"1px solid black",overflow:"auto",maxHeight:200,padding:2,margin:2,backgroundColor:"#ff8888"}},"".concat(A),S?m.a.createElement(m.a.Fragment,null," ","... Failed element had snapshot:",m.a.createElement("pre",{style:{background:"lightgrey",border:"1px solid black",margin:20}},JSON.stringify(JSON.parse(S),null,2))):null):null);if(t.sessionTriaged){var R=function(){t.setSessionTriaged(void 0)};return"session"===t.sessionTriaged.origin?m.a.createElement(Ly,{onConfirm:function(){var e=JSON.parse(JSON.stringify(t.sessionTriaged.snap));t.setSessionSnapshot(Object(u.a)(Object(u.a)({},e),{},{id:me()()})),R()},onCancel:function(){t.setBlankSession(!0),R()}}):m.a.createElement(Vy,{onConfirm:Object(l.a)(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(JSON.stringify(t.sessionTriaged.snap)),e.next=3,t.fetchPlugins(n);case 3:t.setConfigSnapshot(Object(u.a)(Object(u.a)({},n),{},{id:me()()})),R();case 5:case"end":return e.stop()}}),e)}))),onCancel:function(){xy(),R()}})}return y?(null===(N=y.rootModel)||void 0===N?void 0:N.session)?m.a.createElement(zv,{pluginManager:y}):m.a.createElement(Iy,{root:y.rootModel,onFactoryReset:xy}):m.a.createElement(Pe.a,null)}));function _y(e,t){if("object"===typeof e)for(var n=0,a=Object.keys(e);n<a.length;n++){var r=a[n];"object"===typeof e[r]?_y(e[r],t):"uri"===r&&(e.baseUri=t.href)}}var Uy=function(e){return m.a.createElement(ue.FatalErrorDialog,Object.assign({resetButtonText:"Reset Session",onFactoryReset:xy},e))};t.default=function(e){var t=e.initialTimestamp;return m.a.createElement(ce.a,{FallbackComponent:Uy},m.a.createElement(se.a,null,m.a.createElement(zy,{initialTimestamp:t})))}},272:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(84),r=function e(t){var n=t.name;Object(a.a)(this,e),this.name="",this.name=n}},312:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var a=n(91),r=n.n(a),o=n(93),i=n(89),c=n(84),s=n(88),l=n(94),u=n(95),d=n(2455),f=n(996),p=n(1),m=n.n(p),g=n(1003),h=n(315),b=n(1004),v=n(87),y=n(85),w=n(139),O=n(666),j=n(997),k=n(126),C=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"serializeArgsInClient",value:function(e){var t=e.displayModel;return t&&(e=Object(i.a)(Object(i.a)({},e),{},{displayModel:{id:t.id,selectedFeatureId:t.selectedFeatureId}})),Object(i.a)(Object(i.a)({},e),{},{config:Object(v.isStateTreeNode)(e.config)?Object(v.getSnapshot)(e.config):e.config,regions:JSON.parse(JSON.stringify(e.regions))})}},{key:"deserializeResultsInClient",value:function(e,t){var n=Object(i.a)({},e),a=new Map;return e.features.forEach((function(e){var t=w.a.fromJSON(e);a.set(String(t.id()),t)})),n.features=a,n.blockKey=t.blockKey,n}},{key:"deserializeArgsInWorker",value:function(e){var t=Object(i.a)({},e),n=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager});return t.config=n,t.filters=new j.a({filters:e.filters}),t}},{key:"serializeResultsInWorker",value:function(e,t,n){var a=Object(i.a)({},e);return a.features=Object(y.iterMap)(t.values(),(function(e){return e.toJSON()})),a}},{key:"renderInClient",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n){var a,o,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.serializeArgsInClient(n),e.next=3,t.call(n.sessionId,"CoreRender",a);case 3:return o=e.sent,i=this.deserializeResultsInClient(o,n),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getExpandedRegion",value:function(e,t){return e}},{key:"getFeatures",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o,c,s,l,u,d=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dataAdapter,a=t.signal,o=t.regions,c=new Map,o&&0!==o.length){e.next=4;break}return e.abrupt("return",c);case 4:return s=o.map((function(e){var t=Object(i.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),l=s[0],u=1===s.length?n.getFeatures(this.getExpandedRegion(l,t),t):n.getFeaturesInMultipleRegions(s,t),e.next=9,u.pipe(Object(g.a)((function(){return Object(y.checkAbortSignal)(a)})),Object(h.a)((function(e){return d.featurePassesFilters(t,e)})),Object(g.a)((function(e){var t=e.id();if(!t)throw new Error('invalid feature id "'.concat(t,'"'));c.set(t,e)})),Object(b.a)()).toPromise();case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"renderInWorker",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,a,o,c,s,l,u,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,a=t.statusCallback,o=void 0===a?function(){}:a,Object(y.checkAbortSignal)(n),c=this.deserializeArgsInWorker(t),e.next=5,this.getFeatures(c);case 5:return s=e.sent,Object(y.checkAbortSignal)(n),o("Rendering plot"),e.next=10,this.render(Object(i.a)(Object(i.a)({},c),{},{features:s}));case 10:return l=e.sent,Object(y.checkAbortSignal)(n),u=Object(f.renderToString)(m.a.createElement(d.a,{theme:Object(k.createJBrowseTheme)(t.theme)},l.element)),delete l.element,o("Serializing results"),p=this.serializeResultsInWorker(Object(i.a)(Object(i.a)({},l),{},{html:u}),s,c),o(""),e.abrupt("return",p);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(e,t){var n=this.serializeArgsInClient(t);return e.call(t.sessionId,"CoreFreeResources",n)}},{key:"freeResources",value:function(){return 0}}]),n}(O.a)},314:function(e,t,n){"use strict";var a=n(160),r=n(89),o=n(82),i=n(51),c=n(2468),s=n(2491),l=n(2494),u=n(2482),d=n(2475),f=n(2495),p=n(2464),m=n(2467),g=n(2463),h=n(1610),b=n.n(h),v=n(1611),y=n.n(v),w=n(1612),O=n.n(w),j=n(1613),k=n.n(j),C=n(999),E=n.n(C),x=n(1),S=n.n(x),T=n(85),N=Object(i.a)({paper:{position:"fixed",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",top:0,left:0,outline:0},menuItemEndDecoration:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",padding:2,marginRight:-12,display:"inline-flex"}});function A(e){var t,n,a,r=N(),o=e.type;if("checked"in e&&(t=e.checked,n=e.disabled),"subMenu"===o)a=S.a.createElement(b.a,{color:"action"});else if("checkbox"===o)if(t){var i=n?"inherit":"secondary";a=S.a.createElement(y.a,{color:i})}else a=S.a.createElement(O.a,{color:"action"});else if("radio"===o)if(t){var c=n?"inherit":"secondary";a=S.a.createElement(k.a,{color:c})}else a=S.a.createElement(E.a,{color:"action"});return S.a.createElement("div",{className:r.menuItemEndDecoration},a)}var R=S.a.forwardRef((function(e,t){var n=Object(x.useState)(null),a=Object(o.a)(n,2),i=a[0],g=a[1],h=Object(x.useState)(null),b=Object(o.a)(h,2),v=b[0],y=b[1],w=Object(x.useState)(!1),O=Object(o.a)(w,2),j=O[0],k=O[1],C=Object(x.useState)(null),E=Object(o.a)(C,2),M=E[0],P=E[1],F=Object(x.useState)(null),I=Object(o.a)(F,2),B=I[0],L=I[1],D=Object(x.useRef)(null),V=N(),W=e.menuItems,q=e.onMenuItemClick,z=e.open,H=e.onClose,_=e.anchorEl,U=e.top,G=void 0!==U&&U;Object(x.useEffect)((function(){z||(g(null),y(null))}),[z]),Object(x.useEffect)((function(){var e,t=z&&Boolean(i);return t&&!j?e=setTimeout((function(){k(!0)}),300):!t&&j&&(e=setTimeout((function(){k(!1)}),300)),function(){clearTimeout(e)}}),[j,z,i]),Object(x.useEffect)((function(){if(_){var e=_.getBoundingClientRect();B&&e.top===B.top&&e.left+e.width===B.left||L({top:e.top,left:e.left+e.width})}else B||L({})}),[B,_]);var J=W.some((function(e){return"subMenu"in e||"checkbox"===e.type||"radio"===e.type})),Q=W.some((function(e){return"icon"in e&&e.icon})),X={};J&&(X.paddingRight=48);var Y=S.a.createElement(S.a.Fragment,null,S.a.createElement(c.a,{autoFocusItem:z&&!j},W.sort((function(e,t){return(t.priority||0)-(e.priority||0)})).map((function(e,t){if("divider"===e.type)return S.a.createElement(s.a,{key:"divider-".concat(t),component:"li"});if("subHeader"===e.type)return S.a.createElement(l.a,{key:"subHeader-".concat(e.label,"-").concat(t)},e.label);var n=null,a=null;if(e.icon){var r=e.icon;n=S.a.createElement(u.a,null,S.a.createElement(r,null))}"subMenu"in e?a=S.a.createElement(A,{type:"subMenu"}):"checkbox"!==e.type&&"radio"!==e.type||(a=S.a.createElement(A,{type:e.type,checked:e.checked,disabled:e.disabled}));var o,i="onClick"in e?(o=e.onClick,function(e){q(e,o)}):void 0;return S.a.createElement(d.a,{key:e.label,style:X,selected:t===M,onClick:i,onMouseMove:function(n){n.currentTarget!==document.activeElement&&(n.currentTarget.focus(),P(t)),"subMenu"in e?v!==t&&(g(n.currentTarget),y(t)):(g(null),y(null))},onKeyDown:function(n){if("ArrowLeft"===n.key||"Escape"===n.key)H&&H(n,"escapeKeyDown");else if("ArrowUp"===n.key)P(function(e,t){return Object(T.findLastIndex)(e.slice(0,t),(function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}))}(W,t));else if("ArrowDown"===n.key){var a=function(e,t){var n=e.slice(t+1).findIndex((function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}));return-1===n?n:t+1+n}(W,t);P(a)}else"subMenu"in e&&("ArrowRight"!==n.key&&"Enter"!==n.key||(g(n.currentTarget),y(t),k(!0)))},disabled:Boolean(e.disabled)},n,S.a.createElement(f.a,{primary:e.label,secondary:e.subLabel,inset:Q&&!e.icon}),a)}))),W.map((function(e,t){var n=null;return"subMenu"in e&&(n=S.a.createElement(R,{key:e.label,anchorEl:i,open:j&&v===t,onClose:function(){k(!1),g(null)},onMenuItemClick:q,menuItems:e.subMenu})),n})));return G?Y:S.a.createElement(p.a,{in:z,style:{transformOrigin:"0 0 0"},ref:t},S.a.createElement(m.a,{elevation:8,ref:D,className:V.paper,style:Object(r.a)({},B)},Y))}));t.a=function(e){var t=e.open,n=e.onClose,r=e.menuItems,o=e.onMenuItemClick,i=Object(a.a)(e,["open","onClose","menuItems","onMenuItemClick"]);return S.a.createElement(g.a,Object.assign({transitionDuration:0,open:t,onClose:n,BackdropProps:{invisible:!0}},i),S.a.createElement(R,{open:t,onClose:n,menuItems:r,onMenuItemClick:o,top:!0}))}},342:function(e,t,n){"use strict";n.r(t),n.d(t,"getSubType",(function(){return r})),n.d(t,"getUnionSubTypes",(function(){return o})),n.d(t,"getPropertyType",(function(){return i})),n.d(t,"getDefaultValue",(function(){return c})),n.d(t,"getEnumerationValues",(function(){return s})),n.d(t,"resolveLateType",(function(){return l}));var a=n(87);function r(e){var t;if(Object(a.isOptionalType)(e))t=e._subtype||e.type;else{if(!Object(a.isArrayType)(e)&&!Object(a.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!Object(a.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||r(e)._types||r(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function c(e){if(!Object(a.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function s(e){return o(e).map((function(e){return e.value}))}function l(e){return Object(a.isUnionType)(e)||Object(a.isArrayType)(e)||!Object(a.isLateType)(e)?e:e.getSubType()}},353:function(e,t,n){"use strict";function a(e,t,n,a){return t>n&&e<a&&a-n&&t-e?e>n?t<a?[e,t]:[e,a]:t<a?[n,t]:[n,a]:[]}function r(e,t,n,a){return t>n&&e<a}function o(e,t,n,a){return n<=e&&a>=t}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o}))},354:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return f}));var a=n(94),r=n(95),o=n(89),i=n(84),c=n(88),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(i.a)(this,e),this.blocks=[],this.blocks=t}return Object(c.a)(e,[{key:"push",value:function(e){if(e instanceof d&&this.blocks.length){var t=this.blocks[this.blocks.length-1];if(t instanceof d)return void t.push(e)}this.blocks.push(e)}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRegions",value:function(){return this.blocks.map((function(e){return e.toRegion()}))}},{key:"map",value:function(e,t){return this.blocks.map(e,t)}},{key:"forEach",value:function(e,t){return this.blocks.forEach(e,t)}},{key:"length",get:function(){return this.blocks.length}},{key:"totalWidthPx",get:function(){return this.blocks.length?this.blocks.map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"totalWidthPxWithoutBorders",get:function(){return this.blocks.length?this.blocks.filter((function(e){return"boundary"!==e.variant})).map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"offsetPx",get:function(){return this.blocks.length?this.blocks[0].offsetPx:0}},{key:"contentBlocks",get:function(){return this.blocks.filter((function(e){return e instanceof u}))}},{key:"totalBp",get:function(){return this.contentBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}]),e}(),l=function(){function e(t){Object(i.a)(this,e),this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key}return Object(c.a)(e,[{key:"renameReference",value:function(e){return this.refName&&e!==this.refName?new this.constructor(Object(o.a)(Object(o.a)({},this),{},{refName:e})):this}},{key:"toRegion",value:function(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}]),e}(),u=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return n}(l),d=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).widthPx=void 0,a.widthPx=e.widthPx,a}return Object(c.a)(n,[{key:"push",value:function(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}]),n}(l),f=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return n}(l)},385:function(e,t,n){"use strict";n.r(t),n.d(t,"useStyles",(function(){return _})),n.d(t,"BaseCard",(function(){return U})),n.d(t,"BaseCoreDetails",(function(){return K})),n.d(t,"Attributes",(function(){return Z})),n.d(t,"BaseAttributes",(function(){return $})),n.d(t,"BaseFeatureDetails",(function(){return ee})),n.d(t,"FeatureDetails",(function(){return te}));var a=n(160),r=n(82),o=n(102),i=n(89),c=n(1),s=n.n(c),l=n(978),u=n.n(l),d=n(2487),f=n(2489),p=n(2479),m=n(2490),g=n(2473),h=n(2491),b=n(692),v=n.n(b),y=n(51),w=n(980),O=n(86),j=n(26),k=n(691),C=n.n(k),E=n(81),x=n(85),S=n(429),T=n(91),N=n.n(T),A=n(93),R=n(2549),M=n(2475),P=n(1607);function F(e,t){return e.map((function(e){return t.slice(e.start,e.end)})).join("")}function I(e){return"".concat(e.start,"-").concat(e.end)}function B(e){return e.filter((function(e,t,n){return!t||I(e)!==I(n[t-1])}))}function L(e,t){return e.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{start:t-e.end,end:t-e.start})})).sort((function(e,t){return e.start-t.start}))}function D(e){var t=e.cds,n=e.sequence;return s.a.createElement("div",{style:{display:"inline",backgroundColor:"rgba(150,150,0,0.3)"}},F(t,n))}function V(e){for(var t=e.cds,n=e.sequence,a=e.codonTable,r=F(t,n),o="",i=0;i<r.length;i+=3)o+=a[r.slice(i,i+3)]||"&";return s.a.createElement("div",{style:{display:"inline",backgroundColor:"rgba(150,0,150,0.3)"}},o)}function W(e){var t=e.utr,n=e.cds,a=e.exons,r=e.sequence,i=e.upstream,c=e.downstream,l=e.includeIntrons,u=e.collapseIntron,d=n.length?[].concat(Object(o.a)(n),Object(o.a)(t)).sort((function(e,t){return e.start-t.start})):a;return s.a.createElement(s.a.Fragment,null,i?s.a.createElement("div",{style:{display:"inline",backgroundColor:"rgba(120,0,0,0.3)"}},i):null,d.map((function(e,t){var n,a=r.slice(e.end,null===(n=d[t+1])||void 0===n?void 0:n.start);return s.a.createElement(s.a.Fragment,{key:JSON.stringify(e)},s.a.createElement("div",{style:{display:"inline",backgroundColor:"CDS"===e.type?"rgba(150,150,0,0.3)":"rgba(0,150,150,0.3)"}},r.slice(e.start,e.end)),l?s.a.createElement("div",{style:{display:"inline",backgroundColor:"rgba(200,200,200,0.3)"}},u&&a.length>20?"".concat(a.slice(0,10),"...").concat(a.slice(-10)):a):null)})),c?s.a.createElement("div",{style:{display:"inline",backgroundColor:"rgba(120,0,0,0.3)"}},c):null)}function q(e){var t=e.feature,n=e.mode,a=e.sequence,r=a.seq,c=a.upstream,l=void 0===c?"":c,u=a.downstream,d=void 0===u?"":u,f=t.subfeatures,p=Object(x.generateCodonTable)(x.defaultCodonTable);if(!f)return null;var m=f.sort((function(e,t){return e.start-t.start})).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{start:e.start-t.start,end:e.end-t.start})})),g=B(m.filter((function(e){return"CDS"===e.type}))),h=B(m.filter((function(e){return e.type.match(/utr/i)}))),b=B(m.filter((function(e){return"exon"===e.type})));if(!h.length&&g.length&&(h=function(e,t){var n=e[0],a=e[e.length-1],r=t.findIndex((function(e){return e.end>=n.start&&e.start<=n.start})),c=t.findIndex((function(e){return e.end>=a.end&&e.start<=a.end})),s=t[c],l=t[r],u=[].concat(Object(o.a)(t.slice(0,r)),[{start:l.start,end:n.start}]).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{type:"five_prime_UTR"})})),d=[{start:a.end,end:s.end}].concat(Object(o.a)(t.slice(c))).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{type:"three_prime_UTR"})}));return[].concat(Object(o.a)(u),Object(o.a)(d))}(g,b)),-1===t.strand){var v=[Object(x.revcom)(r),Object(x.revcom)(d),Object(x.revcom)(l)];l=v[1],d=v[2],g=L(g,(r=v[0]).length),b=L(b,r.length),h=L(h,r.length)}return s.a.createElement("div",{"data-testid":"sequence_panel"},"cds"===n?s.a.createElement(D,{cds:g,sequence:r}):"cdna"===n?s.a.createElement(W,{exons:b,cds:g,utr:h,sequence:r}):"protein"===n?s.a.createElement(V,{cds:g,codonTable:p,sequence:r}):"gene"===n?s.a.createElement(W,{exons:b,cds:g,utr:h,sequence:r,includeIntrons:!0}):"gene_collapsed_intron"===n?s.a.createElement(W,{exons:b,cds:g,sequence:r,utr:h,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===n?s.a.createElement(W,{exons:b,cds:g,sequence:r,utr:h,upstream:l,downstream:d,includeIntrons:!0}):s.a.createElement("div",null,"Unknown type"))}function z(e){var t=e.model,n=e.feature,a=n,o=a.subfeatures,i=null===o||void 0===o?void 0:o.find((function(e){return"CDS"===e.type})),l=Object(P.a)(),u=l.ref,d=l.inView,f=Object(c.useState)(),m=Object(r.a)(f,2),g=m[0],h=m[1],b=Object(c.useState)(),v=Object(r.a)(b,2),y=v[0],w=v[1],O=Object(c.useState)(i?"cds":"cdna"),j=Object(r.a)(O,2),k=j[0],C=j[1];Object(c.useEffect)((function(){var e=!1;if(!t||!d)return function(){};var a=Object(x.getSession)(t),o=a.assemblyManager,i=a.rpcManager,c=(t.view||{assemblyNames:[]}).assemblyNames,s=Object(r.a)(c,1)[0];function l(e,t,n){return u.apply(this,arguments)}function u(){return(u=Object(A.a)(N.a.mark((function e(t,n,a){var c,l,u,d,f,p;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.waitForAssembly(s);case 2:if(c=e.sent){e.next=5;break}throw new Error("assembly not found");case 5:return l=Object(E.getConf)(c,["sequence","adapter"]),"getSequence",e.next=9,i.call("getSequence","CoreGetFeatures",{adapterConfig:l,sessionId:"getSequence",region:{start:t,end:n,refName:null===c||void 0===c?void 0:c.getCanonicalRefName(a)}});case 9:if(u=e.sent,d=u,f=Object(r.a)(d,1),p=f[0]){e.next=13;break}throw new Error("sequence not found");case 13:return e.abrupt("return",p.get("seq"));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(A.a)(N.a.mark((function t(){var a,r,o,i,c,s,u;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=(a=n).start,o=a.end,i=a.refName,t.next=4,l(r,o,i);case 4:return c=t.sent,t.next=7,l(Math.max(0,r-500),r,i);case 7:return s=t.sent,t.next=10,l(o,o+500,i);case 10:u=t.sent,e||h({seq:c,upstream:s,downstream:u}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),w(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))(),function(){e=!0}}),[n,d,t]);var S=!g;return s.a.createElement("div",{ref:u},s.a.createElement(R.a,{value:k,onChange:function(e){return C(e.target.value)}},i?s.a.createElement(M.a,{value:"cds"},"CDS"):null,i?s.a.createElement(M.a,{value:"protein"},"Protein"):null,s.a.createElement(M.a,{value:"gene"},"Gene w/ introns"),s.a.createElement(M.a,{value:"gene_collapsed_intron"},"Gene w/ 10bp of intron"),s.a.createElement(M.a,{value:"gene_updownstream"},"Gene w/ 500bp up+down stream"),s.a.createElement(M.a,{value:"cdna"},"cDNA")),s.a.createElement("div",{"data-testid":"feature_sequence",style:{display:"inline"}},y?s.a.createElement(p.a,{color:"error"},y):S?s.a.createElement("div",null,"Loading gene sequence..."):g?s.a.createElement("div",{style:{fontFamily:"monospace",wordWrap:"break-word"}},s.a.createElement(q,{feature:a,mode:k,sequence:g})):s.a.createElement("div",null,"No sequence found")))}var H=["name","start","end","strand","refName","type","length","position","subfeatures","uniqueId","exonFrames","parentId","thickStart","thickEnd"],_=Object(y.a)((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},paperRoot:{background:e.palette.grey[100]},field:{display:"flex",flexWrap:"wrap"},fieldDescription:{"&:hover":{background:"yellow"}},fieldName:{wordBreak:"break-all",minWidth:"90px",maxWidth:"150px",borderBottom:"1px solid #0003",background:e.palette.grey[200],marginRight:e.spacing(1),padding:e.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),background:e.palette.grey[100],border:"1px solid ".concat(e.palette.grey[300]),boxSizing:"border-box",overflow:"auto"},accordionBorder:{marginTop:"4px",border:"1px solid #444"}}}));function U(e){var t=e.children,n=e.title,a=e.defaultExpanded,r=void 0===a||a,o=_();return s.a.createElement(d.a,{className:o.accordionBorder,defaultExpanded:r,TransitionProps:{unmountOnExit:!0}},s.a.createElement(f.a,{expandIcon:s.a.createElement(v.a,{className:o.expandIcon})},s.a.createElement(p.a,{variant:"button"}," ",n)),s.a.createElement(m.a,{className:o.expansionPanelDetails},t))}var G=function(e){var t=e.description,n=e.name,a=e.prefix,r=_(),o=(a?"".concat(a,"."):"")+n;return t?s.a.createElement(g.a,{title:t,placement:"left"},s.a.createElement("div",{className:Object(j.a)(r.fieldDescription,r.fieldName)},o)):s.a.createElement("div",{className:r.fieldName},o)},J=function(e){var t=e.value,n=_();return s.a.createElement("div",{className:n.fieldValue},s.a.isValidElement(t)?t:s.a.createElement(S.a,{html:C()(t)?JSON.stringify(t):String(t)}))},Q=function(e){var t=e.name,n=e.value,a=e.description,r=e.prefix,o=_();return n?s.a.createElement("div",{className:o.field},s.a.createElement(G,{prefix:r,description:a,name:t}),s.a.createElement(J,{value:n})):null},X=function(e){var t=e.name,n=e.value,a=e.description,r=e.prefix,o=_();return s.a.createElement("div",{className:o.field},s.a.createElement(G,{prefix:r,description:a,name:t}),1===n.length?s.a.createElement(J,{value:n[0]}):n.map((function(e,n){return s.a.createElement("div",{key:"".concat(t,"-").concat(n),className:o.fieldSubvalue},s.a.createElement(J,{value:e}))})))};function Y(e){var t=e.feature,n=t,a=n.refName,r=n.start,o=n.end,c=n.strand,l={"-1":"-",0:"",1:"+"},u=l[c]?"(".concat(l[c],")"):"",d=(r+1).toLocaleString("en-US"),f=o.toLocaleString("en-US"),p=a?"".concat(a,":"):"",m=Object(i.a)(Object(i.a)({},t),{},{length:(o-r).toLocaleString("en-US"),position:"".concat(p).concat(d,"..").concat(f," ").concat(u)});return s.a.createElement(s.a.Fragment,null,["Position","Description","Name","Length","Type"].map((function(e){var t=m[e.toLowerCase()];return null!==t&&void 0!==t?s.a.createElement(Q,{key:e,name:e,value:t}):null})))}var K=function(e){return s.a.createElement(U,Object.assign({},e,{title:"Primary data"}),s.a.createElement(Y,e))},Z=function e(t){var n=t.attributes,c=t.omit,l=void 0===c?[]:c,u=t.descriptions,d=t.formatter,f=void 0===d?function(e){return e}:d,p=t.prefix,m=void 0===p?"":p,g=[].concat(Object(o.a)(l),H);return s.a.createElement(s.a.Fragment,null,Object.entries(n).filter((function(e){var t=Object(r.a)(e,2),n=t[0];return void 0!==t[1]&&!g.includes(n)})).map((function(t){var n=Object(r.a)(t,2),c=n[0],l=n[1];if(Array.isArray(l)&&l.length&&l.length>2&&l.every((function(e){return C()(e)}))){var d=Object.keys(l[0]).sort(),p=new Set(d);if(l.forEach((function(e){return Object.keys(e).forEach((function(e){return p.add(e)}))})),p.size<d.length+5){var g,h=Object.entries(l).map((function(e){var t=Object(r.a)(e,2),n=t[0],o=t[1],c=o.id,s=Object(a.a)(o,["id"]);return Object(i.a)({id:n,identifier:c},s)}));p.has("id")?(p.delete("id"),g=["identifier"].concat(Object(o.a)(p))):g=Object(o.a)(p);var b=g.map((function(e){return{field:e,width:Math.max.apply(Math,Object(o.a)(h.map((function(t){var n=String(t[e]);return Math.min(Math.max(Object(x.measureText)(n,14)+50,80),1e3)}))))}}));return s.a.createElement(s.a.Fragment,{key:c},s.a.createElement(G,{prefix:m,name:c}),s.a.createElement("div",{key:c,style:{height:20*Math.min(h.length,100)+50+(h.length<100?0:50),width:"100%"}},s.a.createElement(w.a,{disableSelectionOnClick:!0,rowHeight:20,headerHeight:25,rows:h,rowsPerPageOptions:[],hideFooterRowCount:!0,hideFooterSelectedRowCount:!0,columns:b,hideFooter:h.length<100})))}}var v=u&&u[c];return Array.isArray(l)?1===l.length?s.a.createElement(Q,{key:c,name:c,value:l[0],description:v}):s.a.createElement(X,{key:c,name:c,value:l,description:v,prefix:m}):C()(l)?s.a.createElement(e,{key:c,attributes:l,descriptions:u,prefix:c}):s.a.createElement(Q,{key:c,name:c,value:f(l,c),description:v,prefix:m})})))},$=function(e){var t=e.feature;return s.a.createElement(U,Object.assign({},e,{title:"Attributes"}),s.a.createElement(Z,Object.assign({},e,{attributes:t})))};var ee=Object(O.observer)((function(e){var t=e.model,n=t.featureData;if(!n)return null;var a,r=JSON.parse(JSON.stringify(n));return a=r,0===Object.keys(a).length?null:s.a.createElement(te,{model:t,feature:r})})),te=function e(t){var n=t.model,a=t.feature,r=t.depth,o=void 0===r?0:r,i=a.name,c=a.id,l=a.type,d=a.subfeatures,f=i||c,m=f&&f.length>20?"":f,g=Object(x.getSession)(n),b=Object(E.getConf)(g,["featureDetails","sequenceTypes"])||["mRNA","transcript"];return s.a.createElement(U,{title:m?"".concat(m," - ").concat(l):"".concat(l||"")},s.a.createElement("div",null,"Core details"),s.a.createElement(Y,t),s.a.createElement(h.a,null),s.a.createElement("div",null,"Attributes"),s.a.createElement(Z,Object.assign({attributes:a},t)),b.includes(a.type)?s.a.createElement(u.a,{FallbackComponent:function(e){var t=e.error;return s.a.createElement(p.a,{color:"error"},"Failed to fetch sequence for feature: ","".concat(t))}},s.a.createElement(z,t)):null,d&&d.length?s.a.createElement(U,{title:"Subfeatures",defaultExpanded:!b.includes(a.type)},d.map((function(t){return s.a.createElement(e,{key:JSON.stringify(t),feature:t,model:n,depth:o+1})}))):null)}},386:function(e,t,n){"use strict";n.r(t),n.d(t,"namedColorToHex",(function(){return o})),n.d(t,"isNamedColor",(function(){return i})),n.d(t,"contrastingTextColor",(function(){return c})),n.d(t,"emphasize",(function(){return l})),n.d(t,"makeContrasting",(function(){return u}));var a=n(209),r={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return r[e]}function i(e){return!!r[e]}function c(e){return s(e)>.5?"black":"white"}function s(e){var t=o(e);return Object(a.getLuminance)(t||e)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15,n=o(e);return Object(a.emphasize)(n||e,t)}function u(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=o(e)||e,i=o(t)||t,c=s(i),l=Object(a.getContrastRatio)(r,i),u=r,d=.05;l<n;)r=c>.5?Object(a.darken)(u,d):Object(a.lighten)(u,d),d+=.05,l=Object(a.getContrastRatio)(r,i);return r}},387:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return v}));var a=n(414),r=n(82),o=n(89),i=n(87),c=n(114),s=n(520);var l={stringArray:i.types.array(i.types.string),stringArrayMap:i.types.map(i.types.array(i.types.string)),numberMap:i.types.map(i.types.number),boolean:i.types.boolean,color:i.types.refinement("Color",i.types.string,(function(){return!0})),integer:i.types.integer,number:i.types.number,string:i.types.string,text:i.types.string,fileLocation:c.FileLocation,frozen:i.types.frozen()},u={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt"},frozen:{}},d=function(e){return{views:{get valueJSON(){return e.value}}}},f=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},p={fileLocation:f,number:d,integer:d,boolean:d,frozen:f,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,n){e.value[t]=n}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)},addToKey:function(t,n){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a.push(n)},removeAtKeyIndex:function(t,n){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a.splice(n,1)},setAtKeyIndex:function(t,n,a){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r[n]=a}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)}}}}},m=i.types.refinement("JexlString",i.types.string,(function(e){return e.startsWith("jexl:")}));var g=n(668);function h(e,t,n){var d,f={};if(n.explicitlyTyped&&(f.type=i.types.optional(i.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(f[n.explicitIdentifier]=i.types.identifier,d=n.explicitIdentifier):(f.id=i.types.identifier,d="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(f[n.implicitIdentifier]=c.ElementId,d=n.implicitIdentifier):(f.id=c.ElementId,d="id"));var h={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((function(t){var n=Object(r.a)(t,2),a=n[0],o=n[1];if(Object(i.isType)(o)&&Object(i.isLateType)(o)||Object(g.e)(o))f[a]=o;else if("string"===typeof o||"number"===typeof o)h[a]=o;else{if("object"!==typeof o)throw new Error('invalid configuration schema definition, "'.concat(a,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!o.type)throw new Error("no type set for config slot ".concat(e,".").concat(a));try{f[a]=function(e,t){var n=t.description,a=void 0===n?"":n,r=t.model,o=t.type,c=t.defaultValue,d=t.contextVariable,f=void 0===d?[]:d;if(!o)throw new Error("type name required");if(r||(r=l[o]),!r)throw new Error('no builtin config slot type "'.concat(o,"\", and no 'model' param provided"));if(void 0===c)throw new Error("no 'defaultValue' provided");var g="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),h=i.types.model(g,{name:i.types.literal(e),description:i.types.literal(a),type:i.types.literal(o),value:i.types.optional(i.types.union(m,r),c)}).volatile((function(){return{contextVariable:f}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){var t;return e.isCallback?Object(s.a)(String(e.value),null===(t=Object(i.getEnv)(e).pluginManager)||void 0===t?void 0:t.jexl):{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===typeof t&&t.name===e?t:{name:e,description:a,type:o,value:t}})).postProcessSnapshot((function(e){return"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=c},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(n){}if(e.value=c,e.isCallback){if(!(o in u))throw new Error("no fallbackDefault defined for type ".concat(o));e.value=u[o]}}}}}));p[o]&&(h=h.extend(p[o]));var b=i.types.optional(h,{name:e,type:o,description:a,value:c});return Object.defineProperty(b,"isJBrowseConfigurationSlot",{value:!0}),b}(a,o)}catch(c){throw new Error("invalid config slot definition for ".concat(e,".").concat(a,": ").concat(c.message))}}}));var b=i.types.model("".concat(e,"ConfigurationSchema"),f).actions((function(e){return{setSubschema:function(t,n){if(!Object(g.e)(f[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var a=Object(i.isStateTreeNode)(n)?n:f[t].create(n);return e[t]=a,a}}}));Object.keys(h).length&&(b=b.volatile((function(){return h}))),n.actions&&(b=b.actions(n.actions)),n.views&&(b=b.views(n.views)),n.extend&&(b=b.extend(n.extend)),b=b.postProcessSnapshot((function(e){var t={};return Object.entries(e).forEach((function(e){var n,a=Object(r.a)(e,2),o=a[0],i=a[1];void 0!==i&&void 0===h[o]&&("object"!==typeof(n=i)||Array.isArray(n)||null===n||0!==Object.keys(n).length)&&!function(e){return Array.isArray(e)&&0===e.length}(i)&&(t[o]=i)})),t})),n.preProcessSnapshot&&(b=b.preProcessSnapshot(n.preProcessSnapshot));var v=d?Object(a.a)({},d,"placeholderId"):{};return i.types.optional(b,n.explicitlyTyped?Object(o.a)({type:e},v):v)}function b(e,t,n){var a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var a=t,r=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(a=Object(o.a)(Object(o.a)({},n.baseConfiguration.jbrowseSchemaDefinition),a),delete(r=Object(o.a)(Object(o.a)({},n.baseConfiguration.jbrowseSchemaOptions||{}),n)).baseConfiguration),{schemaDefinition:a,options:r}}(e,t,n),r=a.schemaDefinition,i=a.options,c=h(e,r,i);return c.isJBrowseConfigurationSchema=!0,c.jbrowseSchemaDefinition=r,c.jbrowseSchemaOptions=i,c}function v(e){return i.types.union(i.types.reference(e),e)}},419:function(e,t,n){"use strict";n.r(t),n.d(t,"isViewContainer",(function(){return i})),n.d(t,"isSessionModel",(function(){return c})),n.d(t,"isSessionModelWithConfigEditing",(function(){return s})),n.d(t,"isSessionModelWithWidgets",(function(){return l})),n.d(t,"isSelectionContainer",(function(){return u})),n.d(t,"isViewModel",(function(){return d})),n.d(t,"isTrackModel",(function(){return f})),n.d(t,"isDisplayModel",(function(){return p})),n.d(t,"isTrackViewModel",(function(){return m})),n.d(t,"isAbstractMenuManager",(function(){return g}));var a=n(87),r=n(969);for(var o in r)["isViewContainer","isSessionModel","isSessionModelWithConfigEditing","isSessionModelWithWidgets","isSelectionContainer","isViewModel","isTrackModel","isDisplayModel","isTrackViewModel","isAbstractMenuManager","default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);function i(e){return Object(a.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function c(e){return"object"===typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return c(e)&&"editConfiguration"in e}function l(e){return c(e)&&"widgets"in e}function u(e){return"object"===typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function d(e){return"object"===typeof e&&null!==e&&"width"in e&&"setWidth"in e}function f(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function p(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function m(e){return"object"===typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function g(e){return"object"===typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}},429:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1),r=n.n(a),o=n(1606),i=n.n(o),c=n(990),s=n.n(c),l=new RegExp(["a","b","br","code","div","em","h1","h2","h3","h4","h5","h6","i","img","li","p","pre","span","small","strong","table","tbody","td","tfoot","th","thead","tr","u","ul"].map((function(e){return"<".concat(e,"\\b[^>]*>")})).join("|"),"i");function u(e){var t,n=e.html,a=(t=n,l.test(t)?n:i()(n));return r.a.createElement("div",{dangerouslySetInnerHTML:{__html:s.a.sanitize(a)}})}},430:function(e,t,n){"use strict";var a=n(89),r=n(87),o=n(85),i=n(114),c=n(693),s=n(994),l=r.types.model("Base1DView",{displayedRegions:r.types.array(i.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:r.types.optional(r.types.number,0),minimumBlockWidth:r.types.optional(r.types.number,0)}).volatile((function(){return{features:void 0,volatileWidth:0}})).actions((function(e){return{setDisplayedRegions:function(t){e.displayedRegions=Object(r.cast)(t)},setBpPerPx:function(t){e.bpPerPx=t},setVolatileWidth:function(t){e.volatileWidth=t}}})).views((function(e){return{get width(){return e.volatileWidth},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},bpToPx:function(t){var n=t.refName,a=t.coord,r=t.regionNumber,o=0,i=e.interRegionPaddingWidth*e.bpPerPx,c=e.displayedRegions.findIndex((function(e,t){return n===e.refName&&a>=e.start&&a<=e.end&&(!r||r===t)?(o+=e.reversed?e.end-a:a-e.start,!0):(o+=e.end-e.start+i,!1)}));if(e.displayedRegions[c])return Math.round(o/e.bpPerPx)},pxToBp:function(t){var n=0,o=(e.offsetPx+t)*e.bpPerPx,i=e.displayedRegions.length;if(o<0){var c=e.displayedRegions[0],s=o;return Object(a.a)(Object(a.a)({},Object(r.getSnapshot)(c)),{},{oob:!0,coord:c.reversed?Math.floor(c.end-s)+1:Math.floor(c.start+s)+1,offset:s,index:0})}for(var l=e.interRegionPaddingWidth*e.bpPerPx,u=e.minimumBlockWidth*e.bpPerPx,d=0;d<e.displayedRegions.length;d+=1){var f=e.displayedRegions[d],p=f.end-f.start,m=o-n;if(p+n>o&&n<=o)return Object(a.a)(Object(a.a)({},Object(r.getSnapshot)(f)),{},{oob:!1,offset:m,coord:f.reversed?Math.floor(f.end-m)+1:Math.floor(f.start+m)+1,index:d});f.end-f.start>u&&m/e.bpPerPx>0&&m/e.bpPerPx<this.width?n+=p+l:n+=p}if(o>=n){var g=e.displayedRegions[i-1],h=o-n+(g.end-g.start);return Object(a.a)(Object(a.a)({},Object(r.getSnapshot)(g)),{},{oob:!0,offset:h,coord:g.reversed?Math.floor(g.end-h)+1:Math.floor(g.start+h)+1,index:i-1})}return{coord:0,index:0,start:0,refName:"",oob:!0,assemblyName:"",offset:0,reversed:!1}}}})).views((function(e){return{get dynamicBlocks(){return Object(c.a)(e)},get staticBlocks(){return Object(s.a)(e)},get currBp(){return this.dynamicBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}})).actions((function(e){return{setFeatures:function(t){e.features=t},zoomToDisplayedRegions:function(e,t){if(void 0!==e&&void 0!==t){if(e.refName===t.refName&&e.index===t.index&&t.offset<e.offset||e.index>t.index){var n=[t,e];e=n[0],t=n[1]}var a={start:e.start,end:e.end,index:e.index,offset:e.offset},r={start:t.start,end:t.end,index:t.index,offset:t.offset};if(!a||!r)throw new Error("regions not found");this.moveTo(a,r)}},showAllRegions:function(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},moveTo:function(t,n){var a=0;if(t.index===n.index)a+=n.offset-t.offset;else{var r=e.displayedRegions[t.index];if(a+=r.end-r.start-t.offset,n.index-t.index>=2)for(var o=t.index+1;o<n.index;o+=1)a+=e.displayedRegions[o].end-e.displayedRegions[o].start;a+=n.offset}this.zoomTo(a/(e.width-e.interRegionPaddingWidth*(n.index-t.index)));for(var i=0,c=0;c<e.displayedRegions.length;c+=1){var s=e.displayedRegions[c];if(t.index===c){i+=t.offset;break}i+=s.end-s.start}e.offsetPx=Math.round(i/e.bpPerPx)+e.interRegionPaddingWidth*t.index},zoomOut:function(){this.zoomTo(2*e.bpPerPx)},zoomIn:function(){this.zoomTo(e.bpPerPx/2)},zoomTo:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2,a=t;if(a!==e.bpPerPx){var r=e.bpPerPx;e.bpPerPx=a,e.offsetPx=Object(o.clamp)(Math.round((e.offsetPx+n)*r/a-n),e.minOffset,e.maxOffset)}},scroll:function(t){var n=e.offsetPx,a=Object(o.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=a,a-n}}}));t.a=l},432:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var a,r,o,i=n(91),c=n.n(i),s=n(93),l=n(84),u=n(88),d="undefined"!==typeof window&&Boolean(window.electron),f="function"===typeof OffscreenCanvas,p=!1,m=function(){function e(){Object(l.a)(this,e),this.commands=[],this.currentFont="12px Courier New, monospace"}return Object(u.a)(e,[{key:"arc",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arc",args:t})}},{key:"arcTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arcTo",args:t})}},{key:"beginPath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"beginPath",args:t})}},{key:"clearRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clearRect",args:t})}},{key:"clip",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clip",args:t})}},{key:"closePath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"closePath",args:t})}},{key:"createLinearGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createLinearGradient",args:t})}},{key:"createPattern",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createPattern",args:t})}},{key:"createRadialGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createRadialGradient",args:t})}},{key:"drawFocusIfNeeded",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawFocusIfNeeded",args:t})}},{key:"drawImage",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawImage",args:t})}},{key:"ellipse",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"ellipse",args:t})}},{key:"fill",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fill",args:t})}},{key:"fillRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fillRect",args:t})}},{key:"fillText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fillText",args:t})}},{key:"lineTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"lineTo",args:t})}},{key:"measureText",value:function(e){var t=+this.currentFont.match(/\d+/)[0];return{width:t/2*e.length,height:t}}},{key:"moveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"moveTo",args:t})}},{key:"quadraticCurveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"quadraticCurveTo",args:t})}},{key:"rect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rect",args:t})}},{key:"restore",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"restore",args:t})}},{key:"rotate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rotate",args:t})}},{key:"save",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"save",args:t})}},{key:"setLineDash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setLineDash",args:t})}},{key:"setTransform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setTransform",args:t})}},{key:"scale",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"scale",args:t})}},{key:"stroke",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"stroke",args:t})}},{key:"strokeRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeRect",args:t})}},{key:"strokeText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeText",args:t})}},{key:"transform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"transform",args:t})}},{key:"translate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"translate",args:t})}},{key:"strokeStyle",set:function(e){e!==this.currentStrokeStyle&&(this.commands.push({type:"strokeStyle",style:e}),this.currentStrokeStyle=e)}},{key:"fillStyle",set:function(e){e!==this.currentFillStyle&&(this.commands.push({type:"fillStyle",style:e}),this.currentFillStyle=e)}},{key:"font",set:function(e){this.currentFont=e,this.commands.push({type:"font",style:e})}}]),e}(),g=function(){function e(t,n){Object(l.a)(this,e),this.width=t,this.height=n}return Object(u.a)(e,[{key:"getContext",value:function(e){if("2d"!==e)throw new Error("unknown type ".concat(e));return this.context=new m,this.context}}]),e}();if(d)a=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},r=function(){var e=Object(s.a)(c.a.mark((function e(t){var n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length<=1||!(n.length-1)){e.next=2;break}throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");case 2:return e.abrupt("return",{dataURL:t.toDataURL()});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=Image;else if(f)a=function(e,t){return new OffscreenCanvas(e,t)},r=window.createImageBitmap||self.createImageBitmap,o=window.ImageBitmap||self.ImageBitmap;else if(p){var h=n(1617),b=h.createCanvas,v=h.Image;a=b,r=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,a,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.length<=1||!(r.length-1)){e.next=2;break}throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");case 2:return n=t.toDataURL(),a=new v,e.abrupt("return",new Promise((function(e,t){a.onload=function(){return e(a)},a.onerror=t,a.src=n})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=v}else a=function(e,t){return new g(e,t)},r=function(e){return e.context},o="string"},479:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return k}));var a=n(82),r=n(89),o=n(334),i=n(232),c=n(94),s=n(95),l=n(84),u=n(88),d=n(1623),f=n.n(d),p=n(104),m=n(85);function g(e,t,n,a){return t>=n&&a>=e}var h=function(){function e(){Object(l.a)(this,e),this.padding=void 0,this.allFilled=void 0,this.widthLimit=void 0,this.rowState=void 0,this.padding=1,this.widthLimit=1e6}return Object(u.a)(e,[{key:"setAllFilled",value:function(e){this.allFilled=e}},{key:"getItemAt",value:function(e){if(this.allFilled)return this.allFilled;if(this.rowState&&void 0!==this.rowState.min&&!(e<this.rowState.min)&&!(e>=this.rowState.max)){var t=e-this.rowState.offset;return this.rowState.bits[t]}}},{key:"isRangeClear",value:function(e,t){if(this.allFilled)return!1;if(!this.rowState)return!0;var n=this.rowState,a=n.min,r=n.max;if(t<=a||e>=r)return!0;for(var o=Math.min(r,t),i=Math.max(a,e);i<t&&i<o;i+=1)if(this.getItemAt(i))return!1;return!0}},{key:"initialize",value:function(e,t){var n=t-e;return{offset:e-n,min:e,max:t,bits:new Array(3*n)}}},{key:"addRect",value:function(e,t){var n=e.l,a=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,a));var r=n-this.rowState.offset,o=a-this.rowState.offset,i=this.rowState.bits.length;if(o>=this.rowState.bits.length){var c=o+1;this.rowState.bits.length+c>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,a)):c>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(c)))}if(n<this.rowState.offset){var s=Math.min(i-r,this.rowState.offset);this.rowState.bits.length+s>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,a)):(this.rowState.bits=new Array(s).concat(this.rowState.bits),this.rowState.offset-=s)}(o=a-this.rowState.offset)-(r=n-this.rowState.offset)>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(o-r," bits in a single row."),e,t);for(var l=r;l<o;l+=1)this.rowState.bits[l]=t;n<this.rowState.min&&(this.rowState.min=n),a>this.rowState.max&&(this.rowState.max=a)}},{key:"discardRange",value:function(e,t){if(!this.allFilled&&this.rowState&&!(t<=this.rowState.min||e>=this.rowState.max))if(e<=this.rowState.min&&t>=this.rowState.max)this.rowState=void 0;else{if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-1e4&&this.rowState.bits.length>this.rowState.max+1e4-this.rowState.offset){var n=this.rowState.min-this.rowState.offset,a=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(n,this.rowState.bits.length-a),this.rowState.offset+=n}else if(this.rowState.offset<this.rowState.min-1e4){var r=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,r),this.rowState.offset+=r}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+1e4){var o=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=o}for(var i=Math.max(this.rowState.min,e)-this.rowState.offset,c=Math.min(t,this.rowState.max)-this.rowState.offset,s=i;s>=0&&s<c;s+=1)this.rowState.bits[s]=void 0}}}]),e}(),b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pitchX,a=void 0===n?10:n,r=t.pitchY,o=void 0===r?10:r,i=t.maxHeight,c=void 0===i?1e4:i,s=t.hardRowLimit,u=void 0===s?3e3:s,d=t.displayMode,f=void 0===d?"normal":d;Object(l.a)(this,e),this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=a,this.pitchY=o,this.hardRowLimit=u,this.maxHeightReached=!1,this.displayMode=f,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(c/this.pitchY),this.pTotalHeight=0}return Object(u.a)(e,[{key:"addRect",value:function(e,t,n,a,r){var o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);var i=Math.floor(t/this.pitchX),c=Math.floor(n/this.pitchX),s=Math.ceil(a/this.pitchY),l={id:e,l:i,r:c,top:null,h:s,originalHeight:a,data:r},u=this.maxHeight-s,d=0;if("collapse"!==this.displayMode){for(;d<=u&&this.collides(l,d);d+=1);if(d>u)return l.top=null,this.rectangles.set(e,l),this.maxHeightReached=!0,null}return l.top=d,this.addRectToBitmap(l),this.rectangles.set(e,l),this.pTotalHeight=Math.max(this.pTotalHeight||0,d+s),d*this.pitchY}},{key:"collides",value:function(e,t){for(var n=this.bitmap,a=t+e.h,r=t;r<a;r+=1){var o=n[r];if(o&&!o.isRangeClear(e.l,e.r))return!0}return!1}},{key:"autovivifyRow",value:function(e,t){var n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new h,e[t]=n}return n}},{key:"addRectToBitmap",value:function(e){if(null!==e.top){var t=e.data||!0,n=this.bitmap,a=e.top+e.h;if(e.r-e.l>2e4)for(var r=e.top;r<a;r+=1)this.autovivifyRow(n,r).setAllFilled(t);else for(var o=e.top;o<a;o+=1)this.autovivifyRow(n,o).addRect(e,t)}}},{key:"discardRange",value:function(e,t){for(var n=Math.floor(e/this.pitchX),a=Math.floor(t/this.pitchX),r=this.bitmap,o=0;o<r.length;o+=1){var i=r[o];i&&i.discardRange(n,a)}}},{key:"hasSeen",value:function(e){return this.rectangles.has(e)}},{key:"getByCoord",value:function(e,t){var n=Math.floor(t/this.pitchY),a=this.bitmap[n];if(a){var r=Math.floor(e/this.pitchX);return a.getItemAt(r)}}},{key:"getByID",value:function(e){var t=this.rectangles.get(e);if(t)return t.data||!0}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}},{key:"getRectangles",value:function(){var e=this;return new Map(Array.from(this.rectangles.entries()).map((function(t){var n=Object(a.a)(t,2),r=n[0],o=n[1],i=o.l,c=o.r,s=o.originalHeight,l=(o.top||0)*e.pitchY,u=l+s;return[r,[i*e.pitchX,l,c*e.pitchX,u]]})))}},{key:"serializeRegion",value:function(e){var t,n={},r=!1,o=Object(p.a)(this.rectangles.entries());try{for(o.s();!(t=o.n()).done;){var i=Object(a.a)(t.value,2),c=i[0],s=i[1],l=s.l,u=s.r,d=s.originalHeight,f=s.top;if(null===s.top)r=!0;else{var m=(f||0)*this.pitchY,h=m+d,b=l*this.pitchX,v=u*this.pitchX;g(e.start,e.end,b-this.pitchX,v+this.pitchX)&&(n[c]=[b,m,v,h])}}}catch(y){o.e(y)}finally{o.f()}return{rectangles:n,totalHeight:this.getTotalHeight(),maxHeightReached:r}}},{key:"toJSON",value:function(){return{rectangles:Object(m.objectFromEntries)(this.getRectangles()),totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}]),e}(),v=n(1012),y=function(){function e(t){var n=t.rectangles,a=t.totalHeight,r=t.maxHeightReached;Object(l.a)(this,e),this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rectangles=new Map(Object.entries(n)),this.totalHeight=a,this.maxHeightReached=r}return Object(u.a)(e,[{key:"addRect",value:function(e){var t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}},{key:"getRectangles",value:function(){return this.rectangles}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"collides",value:function(e,t){throw new Error("Method not implemented.")}},{key:"addRectToBitmap",value:function(e,t){throw new Error("Method not implemented.")}},{key:"discardRange",value:function(e,t){throw new Error("Method not implemented.")}},{key:"serializeRegion",value:function(e){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{rectangles:Object(m.objectFromEntries)(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1}}}]),e}(),w=n(312),O=n(81),j=function(){function e(t){if(Object(l.a)(this,e),this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=t.config,!Object(O.isConfigurationModel)(this.config))throw new Error("configuration required");this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}return Object(u.a)(e,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"makeLayout",value:function(){return new v.a(b,{maxHeight:Object(O.readConfObject)(this.config,"maxHeight"),displayMode:Object(O.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:Object(O.readConfObject)(this.config,"noSpacing")?1:3})}},{key:"cachedLayoutIsValid",value:function(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&f()(Object(O.readConfObject)(this.config),e.config)&&f()(this.filters,e.filters)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(O.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}]),e}(),k=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).sessions={},e}return Object(u.a)(n,[{key:"getWorkerSession",value:function(e){var t=e.sessionId;this.sessions[t]||(this.sessions[t]=this.createSession(e));var n=this.sessions[t];return n.update(e),n}},{key:"getExpandedRegion",value:function(e,t){if(!e)return e;var n=t.bpPerPx,a=t.config,o=void 0===a?0:Object(O.readConfObject)(a,"maxFeatureGlyphExpansion");if(!o)return e;var i=Math.round(o*n);return Object(r.a)(Object(r.a)({},e),{},{start:Math.floor(Math.max(e.start-i,0)),end:Math.ceil(e.end+i)})}},{key:"createSession",value:function(e){return new j(e)}},{key:"freeResourcesInWorker",value:function(e){var t=e.sessionId,n=e.regions,a=this.sessions[t];return!n&&a?(delete this.sessions[t],1):(a&&n&&a.layout.discardRange(n[0].refName,n[0].start,n[0].end),0)}},{key:"deserializeLayoutInClient",value:function(e){return new y(e)}},{key:"deserializeResultsInClient",value:function(e,t){var a=Object(o.a)(Object(i.a)(n.prototype),"deserializeResultsInClient",this).call(this,e,t);return a.layout=this.deserializeLayoutInClient(e.layout),a}},{key:"deserializeLayoutInWorker",value:function(e){var t=e.regions;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}},{key:"deserializeArgsInWorker",value:function(e){var t=Object(o.a)(Object(i.a)(n.prototype),"deserializeArgsInWorker",this).call(this,e);return t.layout=this.deserializeLayoutInWorker(t),t}},{key:"serializeResultsInWorker",value:function(e,t,r){var c=Object(o.a)(Object(i.a)(n.prototype),"serializeResultsInWorker",this).call(this,e,t,r),s=Object(a.a)(r.regions,1)[0];return c.layout=r.layout.serializeRegion(this.getExpandedRegion(s,r)),c.layout.rectangles&&(c.features=c.features.filter((function(e){return Boolean(c.layout.rectangles[e.uniqueId])}))),c.maxHeightReached=c.layout.maxHeightReached,c}}]),n}(w.a)},518:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(84),r=n(88),o=n(94),i=n(95),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.stateModel=void 0,r.displayTypes=[],r.ReactComponent=e.ReactComponent,r.stateModel=e.stateModel,!r.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for view ".concat(r.name));return r}return Object(r.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(n(272).a)},520:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(948),r={};function o(e,t){var n="nosig|".concat(e);if(!r[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var o=e.split("jexl:")[1],i=t?t.compile("".concat(o)):Object(a.a)().compile("".concat(o));r[n]=i}return r[n]}},525:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return g})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return v})),n.d(t,"c",(function(){return y}));var a=n(91),r=n.n(a),o=n(93),i=n(84),c=n(94),s=n(95),l=n(1326),u=n(112),d=n(972),f=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).code=void 0,e}return n}(Object(l.a)(Error));function p(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw b()}}function m(e){return new Promise((function(t){return setTimeout(t,e)}))}function g(e){return h.apply(this,arguments)}function h(){return(h=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(1);case 2:p(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){if("undefined"!==typeof DOMException)return new DOMException("aborted","AbortError");var e=new f("aborted");return e.code="ERR_ABORTED",e}function v(e){return e?Object(d.a)(e,"abort"):u.a.create()}function y(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||!!e.message.match(/\b(aborted|AbortError)\b/i)}},532:function(e,t,n){"use strict";var a=n(87),r=n(114),o=a.types.model("BaseView",{id:r.ElementId,displayName:a.types.maybe(a.types.string)}).volatile((function(){return{width:800}})).views((function(){return{get menuItems(){return[]}}})).actions((function(e){return{setDisplayName:function(t){e.displayName=t},setWidth:function(t){e.width=t}}}));t.a=o},666:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(91),r=n.n(a),o=n(93),i=n(84),c=n(88),s=n(94),l=n(95),u=n(1),d=n.n(u),f=n(342),p=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;if(Object(i.a)(this,n),(a=t.call(this,e)).ReactComponent=void 0,a.configSchema=void 0,a.pluginManager=void 0,a.ReactComponent=e.ReactComponent,a.configSchema=e.configSchema,a.pluginManager=e.pluginManager,!a.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(a.name));if(!Object(f.getDefaultValue)(a.configSchema).type)throw new Error("".concat(a.name," config schema ").concat(a.configSchema.name," is not explicitlyTyped"));if(!a.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(a.name));return a}return Object(c.a)(n,[{key:"render",value:function(){var e=Object(o.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{element:d.a.createElement(this.ReactComponent,t,null)});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){return 0}}]),n}(n(272).a)},668:function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return f}));var a=n(102),r=n(87),o=n(342);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return Object(r.getSnapshot)(e);if("string"===typeof t){var a=e[t];if(!a&&Object(r.isStateTreeNode)(e)&&Object(r.isMapType)(Object(r.getType)(e))&&(a=e.get(t)),!a)return;if(a.expr){var o=a.expr.evalSync(n);return Object(r.isStateTreeNode)(o)?Object(r.getSnapshot)(o):o}return Object(r.isStateTreeNode)(a)?Object(r.getSnapshot)(a):a}var c=t[0];if(t.length>1){var s=t.slice(1),l=e[c];if(!l&&Object(r.isStateTreeNode)(e)&&Object(r.isMapType)(Object(r.getType)(e))&&(l=e.get(c)),!l)return;return i(l,s,n)}return i(e,c,n)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var a=e,r=a.configuration;if(d(r))return i(r,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if(Object(r.isType)(e)&&(e=Object(o.resolveLateType)(e),Object(r.isUnionType)(e))){var t=[];return Object(o.getUnionSubTypes)(e).forEach((function(e){var n=s(e=Object(o.resolveLateType)(e));n.length||(n=[Object(o.getDefaultValue)(e).type]);if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push.apply(t,Object(a.a)(n))})),t}return[]}function l(e){if(Object(r.isType)(e)){if(Object(r.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if(Object(r.isLateType)(e))return!0}return!1}function u(e){return!!Object(r.isType)(e)&&(!!l(e)||(Object(r.isUnionType)(e)?Object(o.getUnionSubTypes)(e).every((function(e){return u(e)||"undefined"===e.name})):!(!Object(r.isOptionalType)(e)||!u(Object(o.getSubType)(e)))||(!(!Object(r.isArrayType)(e)||!u(Object(o.getSubType)(e)))||!(!Object(r.isMapType)(e)||!u(Object(o.getSubType)(e))))))}function d(e){return Object(r.isStateTreeNode)(e)&&u(Object(r.getType)(e))}function f(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},684:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return f}));var a=n(91),r=n.n(a),o=n(93),i=n(89),c=n(423);function s(e,t,n){var a,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0===n?0:(r?a=t/n-e*e/(n*n):(a=t-e*e/n,n>1&&(a/=n-1)),a<0?0:Math.sqrt(a))}function l(e){return Object(i.a)(Object(i.a)({},e),{},{scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:s(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered})}function u(e,t){return d.apply(this,arguments)}function d(){return(d=Object(o.a)(r.a.mark((function e(t,n){var a,o,i,s,u,d,f,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.start,o=t.end,e.next=3,n.pipe(Object(c.a)((function(e,t){var n=t.get("score");return e.scoreMax=Math.max(e.scoreMax,t.get("summary")?t.get("maxScore"):n),e.scoreMin=Math.min(e.scoreMin,t.get("summary")?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,e}),{scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0})).toPromise();case 3:return i=e.sent,s=i.scoreMin,u=i.scoreMax,d=i.scoreSum,f=i.scoreSumSquares,p=i.featureCount,e.abrupt("return",l({scoreMax:u,scoreMin:s,scoreSum:d,scoreSumSquares:f,featureCount:p,basesCovered:o-a+1}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},693:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(82),r=n(353),o=n(85),i=n(354);function c(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e.offsetPx,s=e.displayedRegions,l=e.bpPerPx,u=e.width,d=e.minimumBlockWidth,f=e.interRegionPaddingWidth;if(!u)throw new Error("view has no width, cannot calculate displayed blocks");var p=new i.a,m=0,g=c,h=g+u;return s.forEach((function(e,b){var v=e.assemblyName,y=e.refName,w=e.start,O=e.end,j=e.reversed,k=m+(O-w)/l,C=(O-w)/l;if(m<h&&k>g){var E,x,S,T,N,A=Object(r.b)(g,h,m,k),R=Object(a.a)(A,2),M=R[0],P=R[1];j?(E=Math.max(w,O-(P-m)*l),S=(x=O-(M-m)*l)===O,T=E===w,N=m+(O-x)/l):(S=(E=(M-m)*l+w)===w,T=(x=Math.min(O,(P-m)*l+w))===O,N=m+(E-w)/l);var F={assemblyName:v,refName:y,start:E,end:x,reversed:j,offsetPx:N,parentRegion:e,regionNumber:b,widthPx:(x-E)/l,isLeftEndOfDisplayedRegion:S,isRightEndOfDisplayedRegion:T,key:""};F.key="".concat(Object(o.assembleLocString)(F),"-").concat(b).concat(j?"-reversed":""),t&&0===p.length&&S&&p.push(new i.d({key:"".concat(F.key,"-beforeFirstRegion"),widthPx:-c,offsetPx:F.offsetPx+c,variant:"boundary"})),n&&C<d?p.push(new i.c(F)):p.push(new i.b(F)),t&&(C>=d&&F.isRightEndOfDisplayedRegion&&b<s.length-1&&(p.push(new i.d({key:"".concat(F.key,"-rightpad"),widthPx:f,offsetPx:F.offsetPx+F.widthPx})),m+=f),b===s.length-1&&F.isRightEndOfDisplayedRegion&&(N=F.offsetPx+F.widthPx,p.push(new i.d({key:"".concat(F.key,"-afterLastRegion"),widthPx:u-N+c,offsetPx:N,variant:"boundary"}))))}m+=(O-w)/l})),p}},694:function(e,t,n){"use strict";var a=n(82),r=n(2481),o=n(2470),i=n(2499),c=n(2461),s=n(2456),l=n(2479),u=n(2500),d=n(2551),f=n(86),p=n(1),m=n.n(p),g="undefined"!==typeof window&&Boolean(window.electron);function h(e){return"uri"in e}var b=Object(f.observer)((function(e){var t=e.location,n=e.name,r=e.description,s=e.localFileAllowed,l=void 0===s?g:s,f=t&&h(t)||!l?"url":"file",b=Object(p.useState)(f),w=Object(a.a)(b,2),O=w[0],j=w[1];return m.a.createElement(m.a.Fragment,null,m.a.createElement(c.a,{shrink:!0,htmlFor:"callback-editor"},n),m.a.createElement(i.a,{container:!0,spacing:1,direction:"row",alignItems:"center"},m.a.createElement(i.a,{item:!0},m.a.createElement(d.a,{value:O,exclusive:!0,onChange:function(e,t){"url"===t?j("url"):l&&j("file")},"aria-label":"file or url picker"},l?m.a.createElement(u.a,{value:"file","aria-label":"local file"},"File"):null,m.a.createElement(u.a,{value:"url","aria-label":"url"},"Url"))),m.a.createElement(i.a,{item:!0},"url"===O?m.a.createElement(v,e):m.a.createElement(y,e))),m.a.createElement(o.a,null,r))})),v=function(e){var t=e.location,n=e.setLocation;return m.a.createElement(s.a,{fullWidth:!0,inputProps:{"data-testid":"urlInput"},defaultValue:t&&h(t)?t.uri:"",onChange:function(e){n({uri:e.target.value})}})},y=Object(f.observer)((function(e){var t=e.location,n=e.setLocation,a=t&&(function(e){return"blob"in e}(t)&&t.blob.name||function(e){return"localPath"in e}(t)&&t.localPath);return m.a.createElement("div",{style:{position:"relative"}},m.a.createElement(r.a,{variant:"outlined",component:"label"},"Choose File",m.a.createElement("input",{type:"file",style:{position:"absolute",top:0,left:0,width:"100%",opacity:0},onChange:function(e){var t=e.target,a=t&&t.files&&t.files[0];a&&n(g?{localPath:a.path}:{blob:a})}})),a?m.a.createElement(l.a,{style:{marginLeft:"0.4rem"},variant:"body1",component:"span"},a):null)}));t.a=b},81:function(e,t,n){"use strict";n.r(t);var a=n(387);n.d(t,"ConfigurationSchema",(function(){return a.b})),n.d(t,"ConfigurationReference",(function(){return a.a}));var r=n(668);n.d(t,"readConfObject",(function(){return r.g})),n.d(t,"getConf",(function(){return r.a})),n.d(t,"getTypeNamesFromExplicitlyTypedUnion",(function(){return r.b})),n.d(t,"isBareConfigurationSchemaType",(function(){return r.c})),n.d(t,"isConfigurationSchemaType",(function(){return r.e})),n.d(t,"isConfigurationModel",(function(){return r.d})),n.d(t,"isConfigurationSlotType",(function(){return r.f}))},85:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"inDevelopment",(function(){return k})),n.d(t,"inProduction",(function(){return C})),n.d(t,"toUrlSafeB64",(function(){return E})),n.d(t,"fromUrlSafeB64",(function(){return x})),n.d(t,"useDebounce",(function(){return S})),n.d(t,"useDebouncedCallback",(function(){return T})),n.d(t,"findParentThat",(function(){return N})),n.d(t,"springAnimate",(function(){return A})),n.d(t,"findParentThatIs",(function(){return R})),n.d(t,"getSession",(function(){return M})),n.d(t,"getContainingView",(function(){return P})),n.d(t,"getContainingTrack",(function(){return F})),n.d(t,"getContainingDisplay",(function(){return I})),n.d(t,"assembleLocString",(function(){return B})),n.d(t,"parseLocStringOneBased",(function(){return L})),n.d(t,"parseLocString",(function(){return D})),n.d(t,"compareLocs",(function(){return V})),n.d(t,"compareLocStrings",(function(){return W})),n.d(t,"clamp",(function(){return q})),n.d(t,"bpToPx",(function(){return H})),n.d(t,"radToDeg",(function(){return G})),n.d(t,"degToRad",(function(){return J})),n.d(t,"polarToCartesian",(function(){return Q})),n.d(t,"cartesianToPolar",(function(){return X})),n.d(t,"featureSpanPx",(function(){return Y})),n.d(t,"bpSpanPx",(function(){return K})),n.d(t,"objectFromEntries",(function(){return Z})),n.d(t,"iterMap",(function(){return $})),n.d(t,"mergeConfigs",(function(){return ee})),n.d(t,"findLastIndex",(function(){return te})),n.d(t,"makeAbortableReaction",(function(){return ne})),n.d(t,"renameRegionIfNeeded",(function(){return ae})),n.d(t,"renameRegionsIfNeeded",(function(){return re})),n.d(t,"minmax",(function(){return ie})),n.d(t,"stringify",(function(){return ce})),n.d(t,"isElectron",(function(){return se})),n.d(t,"revcom",(function(){return le})),n.d(t,"complement",(function(){return ue})),n.d(t,"rIC",(function(){return de})),n.d(t,"measureText",(function(){return fe})),n.d(t,"defaultStarts",(function(){return pe})),n.d(t,"defaultStops",(function(){return me})),n.d(t,"defaultCodonTable",(function(){return ge})),n.d(t,"generateCodonTable",(function(){return he}));var a=n(89),r=n(91),o=n.n(r),i=n(93),c=n(104),s=n(102),l=n(82),u=n(951),d=n(87),f=n(115),p=n(952),m=n(1564),g=n.n(m),h=n(1),b=n(968),v=n.n(b),y=n(419),w=n(525);for(var O in y)["inDevelopment","inProduction","toUrlSafeB64","fromUrlSafeB64","useDebounce","useDebouncedCallback","findParentThat","springAnimate","findParentThatIs","getSession","getContainingView","getContainingTrack","getContainingDisplay","assembleLocString","parseLocStringOneBased","parseLocString","compareLocs","compareLocStrings","clamp","bpToPx","radToDeg","degToRad","polarToCartesian","cartesianToPolar","featureSpanPx","bpSpanPx","objectFromEntries","iterMap","mergeConfigs","findLastIndex","makeAbortableReaction","renameRegionIfNeeded","renameRegionsIfNeeded","minmax","stringify","isElectron","revcom","complement","rIC","measureText","defaultStarts","defaultStops","defaultCodonTable","generateCodonTable","default"].indexOf(O)<0&&function(e){n.d(t,e,(function(){return y[e]}))}(O);n.d(t,"checkAbortSignal",(function(){return w.b})),n.d(t,"abortBreakPoint",(function(){return w.a})),n.d(t,"makeAbortError",(function(){return w.d})),n.d(t,"observeAbortSignal",(function(){return w.e})),n.d(t,"isAbortException",(function(){return w.c}));var j=n(973);n.d(t,"when",(function(){return j.a})),n.d(t,"whenPresent",(function(){return j.b})),Object.fromEntries||g.a.shim();var k="object"===typeof e&&Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})&&!1,C=!k;function E(e){var t=(new TextEncoder).encode(e),n=Object(p.deflate)(t),a=Object(u.fromByteArray)(n),r=a.indexOf("=");return r>0?a.slice(0,r).replace(/\+/g,"-").replace(/\//g,"_"):a.replace(/\+/g,"-").replace(/\//g,"_")}function x(e){var t=function(e){var t=0;switch(e.length%4){case 3:t=1;break;case 2:t=2;break;case 0:t=0;break;default:throw new Error("base64 not a valid length")}return e+"=".repeat(t)}(e.replace(/-/g,"+").replace(/_/g,"/")),n=Object(u.toByteArray)(t),a=Object(p.inflate)(n);return(new TextDecoder).decode(a)}function S(e,t){var n=Object(h.useState)(e),a=Object(l.a)(n,2),r=a[0],o=a[1];return Object(h.useEffect)((function(){var n=setTimeout((function(){o(e)}),t);return function(){clearTimeout(n)}}),[e,t]),r}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=Object(h.useRef)(),a=Object(h.useRef)();function r(){a.current&&clearTimeout(a.current)}return Object(h.useEffect)((function(){return r}),[]),function(){for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];n.current=i,r(),a.current=setTimeout((function(){n.current&&e.apply(void 0,Object(s.a)(n.current))}),t)}}function N(e,t){for(var n=e;n&&Object(d.isAlive)(n);){if(t(n))return n;if(!Object(d.hasParent)(n))break;n=Object(d.getParent)(n)}throw new Error("no matching node found")}function A(e,t,n){var a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:170,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:26,s=1;function l(e){var u=Date.now(),d=e.lastPosition,f=e.lastTime||u,p=e.lastVelocity||0;u>f+64&&(f=u);for(var m=Math.floor(u-f),g=0;g<m;++g){d+=1*(p+=1*((-i*(d-t)+-c*p)/s)/1e3)/1e3}var h=Math.abs(p)<=o,b=0===i||Math.abs(t-d)<=o;h&&b?(n(t),r()):(n(d),a=requestAnimationFrame((function(){return l({lastPosition:d,lastTime:u,lastVelocity:p})})))}return o||(o=Math.abs(t-e)/1e3),[function(){return l({lastPosition:e})},function(){return cancelAnimationFrame(a)}]}function R(e,t){return N(e,t)}function M(e){try{return R(e,y.isSessionModel)}catch(t){throw new Error("no session model found!")}}function P(e){try{return R(e,y.isViewModel)}catch(t){throw new Error("no containing view found")}}function F(e){try{return R(e,y.isTrackModel)}catch(t){throw new Error("no containing track found")}}function I(e){try{return R(e,y.isDisplayModel)}catch(t){throw new Error("no containing display found")}}function B(e){var t,n,a=e.assemblyName,r=e.refName,o=e.start,i=e.end,c=a?"{".concat(a,"}"):"";return t=void 0!==o?":".concat((o+1).toLocaleString("en-US")):void 0!==i?":1":"",n=void 0!==i?void 0!==o&&o+1===i?"":"..".concat(i.toLocaleString("en-US")):void 0!==o?"..":"","".concat(c).concat(r).concat(t).concat(n)}function L(e,t){if(!e)throw new Error("no location string provided, could not parse");var n=(e=e.replace(/\s/,"")).match(/(\{(.+)\})?(.+)/);if(!n)throw new Error('invalid location string: "'.concat(e,'"'));var a=Object(l.a)(n,4),r=a[2],o=a[3],i=o.lastIndexOf(":");if(-1===i){if(t(o,r))return{assemblyName:r,refName:o};throw new Error('Unknown reference sequence "'.concat(o,'"'))}var c=o.slice(0,i),s=o.slice(i+1);if(t(c,r)&&t(o,r))throw new Error('ambiguous location string: "'.concat(e,'"'));if(t(c,r)){if(!s)return{assemblyName:r,refName:c};var u=s.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)(-?(\d+|\d{1,3}(,\d{3})*))$/),d=s.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)?$/);if(u){var f=Object(l.a)(u,6),p=f[1],m=f[5];if(void 0!==p&&void 0!==m)return{assemblyName:r,refName:c,start:+p.replace(/,/g,""),end:+m.replace(/,/g,"")}}else{if(!d)throw new Error('could not parse range "'.concat(s,'" on location "').concat(e,'"'));var g=Object(l.a)(d,5),h=g[1],b=g[4];if(void 0!==h)return b?{assemblyName:r,refName:c,start:+h.replace(/,/g,"")}:{assemblyName:r,refName:c,start:+h.replace(/,/g,""),end:+h.replace(/,/g,"")}}}else if(t(o,r))return{assemblyName:r,refName:o};throw new Error('unknown reference sequence name in location "'.concat(e,'"'))}function D(e,t){var n=L(e,t);return"number"===typeof n.start&&(n.start-=1),n}function V(e,t){var n=e.assemblyName||t.assemblyName?(e.assemblyName||"").localeCompare(t.assemblyName||""):0;if(n)return n;var a=e.refName||t.refName?(e.refName||"").localeCompare(t.refName||""):0;if(a)return a;if(void 0!==e.start&&void 0!==t.start){var r=e.start-t.start;if(r)return r}if(void 0!==e.end&&void 0!==t.end){var o=e.end-t.end;if(o)return o}return 0}function W(e,t,n){return V(D(e,n),D(t,n))}function q(e,t,n){return e<t?t:e>n?n:e}function z(e){return Math.round(10*e)/10}function H(e,t,n){return t.reversed?z((t.end-e)/n):z((e-t.start)/n)}var _=180/Math.PI,U=Math.PI/180;function G(e){return e*_%360}function J(e){return e*U%(2*Math.PI)}function Q(e,t){return[e*Math.cos(t),e*Math.sin(t)]}function X(e,t){return[Math.sqrt(e*e+t*t),Math.atan(t/e)]}function Y(e,t,n){return K(e.get("start"),e.get("end"),t,n)}function K(e,t,n,a){var r=H(e,n,a),o=H(t,n,a);return n.reversed?[o,r]:[r,o]}var Z=Object.fromEntries.bind(Object);function $(e,t,n){var a,r=n?new Array(n):[],o=0,i=Object(c.a)(e);try{for(i.s();!(a=i.n()).done;){var s=a.value;r[o]=t(s),o+=1}}catch(l){i.e(l)}finally{i.f()}return r}function ee(e,t){var n=v()(e,t);return t.defaultSession?n.defaultSession=t.defaultSession:e.defaultSession&&(n.defaultSession=e.defaultSession),n}function te(e,t){for(var n=e.length;n--;)if(t(e[n],n,e))return n;return-1}function ne(e,t,n,a,r,c,s){var l;function u(t){Object(w.c)(t)||(Object(d.isAlive)(e)?s(t):console.error(t))}var p=Object(f.reaction)((function(){try{return t(e)}catch(n){return void u(n)}}),function(){var t=Object(i.a)(o.a.mark((function t(a,i){var s,f;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l&&!l.signal.aborted&&l.abort(),Object(d.isAlive)(e)){t.next=3;break}return t.abrupt("return");case 3:return l=new AbortController,r(s=l),t.prev=6,t.next=9,n(a,s.signal,e,i);case 9:f=t.sent,Object(w.b)(s.signal),Object(d.isAlive)(e)&&c(f),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(6),s&&!s.signal.aborted&&s.abort(),u(t.t0);case 18:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,n){return t.apply(this,arguments)}}(),a);Object(d.addDisposer)(e,p),Object(d.addDisposer)(e,(function(){l&&!l.signal.aborted&&l.abort()}))}function ae(e,t){if(Object(d.isStateTreeNode)(t)&&!Object(d.isAlive)(t))return t;if(t&&e&&e[t.refName]){var n=e[(t=Object(d.isStateTreeNode)(t)?Object(a.a)({},Object(d.getSnapshot)(t)):Object(a.a)({},t)).refName];if(n)return Object(a.a)(Object(a.a)({},t),{},{refName:n,originalRefName:t.refName})}return t}function re(e,t){return oe.apply(this,arguments)}function oe(){return(oe=Object(i.a)(o.a.mark((function e(t,n){var r,i,c,l,u,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.assemblyName,i=n.regions,c=n.adapterConfig,n.sessionId){e.next=3;break}throw new Error("sessionId is required");case 3:if(l=Object(a.a)(Object(a.a)({},n),{},{regions:Object(s.a)(n.regions||[])}),!r){e.next=9;break}return e.next=7,t.getRefNameMapForAdapter(c,r,l);case 7:if((u=e.sent)&&i&&l.regions)for(d=0;d<i.length;d+=1)l.regions[d]=ae(u,i[d]);case 9:return e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e,t){return[Math.min(e,t),Math.max(e,t)]}function ce(e){var t=e.refName,n=e.coord,a=e.oob;return"".concat(t,":").concat(n.toLocaleString("en-US")).concat(a?" (out of bounds)":"")}var se="undefined"!==typeof window&&Boolean(window.electron);function le(e){return ue(e).split("").reverse().join("")}var ue=function(){var e=/[ACGT]/gi,t={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};return function(n){return n.replace(e,(function(e){return t[e]||""}))}}(),de="undefined"===typeof jest?"undefined"!==typeof window?window.requestIdleCallback:function(e){return setTimeout((function(){return e()}),1)}:function(e){return e()};function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625],a=.5279276315789471;return e.split("").map((function(e){return e.charCodeAt(0)<n.length?n[e.charCodeAt(0)]:a})).reduce((function(e,t){return t+e}),0)*t}var pe=["ATG"],me=["TAA","TAG","TGA"],ge={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function he(e){var t={};return Object.keys(e).forEach((function(n){for(var a=e[n],r=[],o=0;o<3;o++){var i=n.charAt(o);r[o]=[],r[o][0]=i.toUpperCase(),r[o][1]=i.toLowerCase()}for(var c=0;c<2;c++)for(var s=r[0][c],l=0;l<2;l++)for(var u=r[1][l],d=0;d<2;d++){var f=r[2][d];t[s+u+f]=a}})),t}}.call(this,n(169))},948:function(e,t,n){"use strict";var a=n(1543),r=n.n(a);t.a=function(){var e=new r.a.Jexl;return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("endsWith",(function(e,t,n){return e.endsWith(t,n)})),e.addFunction("padEnd",(function(e,t,n){return e.padEnd(t,n)})),e.addFunction("padStart",(function(e,t,n){return e.padStart(t,n)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,n){return e.replace(t,n)})),e.addFunction("replaceAll",(function(e,t,n){return e.replaceAll(t,n)})),e.addFunction("slice",(function(e,t,n){return e.slice(t,n)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("substring",(function(e,t,n){return e.substring(t,n)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e}},969:function(e,t){},973:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n(91),r=n.n(a),o=n(93),i=n(115),c=n(525);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timeout,a=t.signal,r=t.name;return new Promise((function(t,o){var s,l=!1,u=Object(i.when)(e),d=function(){};n&&(s=setTimeout((function(){l||(l=!0,u.cancel(),o(new Error("timed out waiting for ".concat(r||"whenPresent"))))}),n),d=function(){return s&&clearTimeout(s)}),a&&a.addEventListener("abort",(function(){l||(l=!0,u.cancel(),d(),o(Object(c.d)()))})),u.then((function(){l||(l=!0,d(),t())})).catch((function(e){l||(l=!0,d(),o(e))}))}))}function l(e){return u.apply(this,arguments)}function u(){return(u=Object(o.a)(r.a.mark((function e(t){var n,a=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,s((function(){var e=t();return void 0!==e&&null!==e}),n);case 3:return e.abrupt("return",t());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},994:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(85),r=n(354);function o(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"undefined"!==typeof window&&window.innerWidth||e.width,c=e.offsetPx,s=e.displayedRegions,l=e.bpPerPx,u=e.minimumBlockWidth,d=e.interRegionPaddingWidth,f=c*l,p=(c+i)*l,m=i,g=Math.ceil(m*l),h=0,b=new r.a;return s.forEach((function(e,c){var m=e.assemblyName,v=e.refName,y=e.start,w=e.end,O=e.reversed,j=Math.ceil((w-y)/g),k=Math.floor((p-h)/g)+o;k>=j&&(k=j-1);var C=Math.floor((f-h)/g)-o;C<0&&(C=0);for(var E=(w-y)/l,x=C;x<=k;x+=1){var S=void 0,T=void 0,N=void 0,A=void 0;O?(S=Math.max(y,w-(x+1)*g),N=(T=w-x*g)===w,A=S===y):(N=(S=y+x*g)===y,A=(T=Math.min(w,y+(x+1)*g))===w);var R={assemblyName:m,refName:v,start:S,end:T,reversed:O,offsetPx:(h+x*g)/l,parentRegion:e,regionNumber:c,widthPx:(T-S)/l,isLeftEndOfDisplayedRegion:N,isRightEndOfDisplayedRegion:A,key:""};R.key="".concat(Object(a.assembleLocString)(R),"-").concat(c).concat(O?"-reversed":""),t&&0===c&&0===x&&b.push(new r.d({key:"".concat(R.key,"-beforeFirstRegion"),widthPx:i,offsetPx:R.offsetPx-i,variant:"boundary"})),n&&E<u?b.push(new r.c(R)):b.push(new r.b(R)),t&&(E>=u&&R.isRightEndOfDisplayedRegion&&c<s.length-1&&(h+=d*l,b.push(new r.d({key:"".concat(R.key,"-rightpad"),widthPx:d,offsetPx:R.offsetPx+R.widthPx}))),c===s.length-1&&R.isRightEndOfDisplayedRegion&&(h+=d*l,b.push(new r.d({key:"".concat(R.key,"-afterLastRegion"),widthPx:i,offsetPx:R.offsetPx+R.widthPx,variant:"boundary"}))))}h+=w-y})),b}},997:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(84),r=n(88),o=n(520),i=function(){function e(t){var n=t.filters,r=void 0===n?[]:n;Object(a.a)(this,e),this.filterChain=void 0,this.filterChain=r.map((function(e){if("string"===typeof e)return{expr:Object(o.a)(e),string:e};throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}return Object(r.a)(e,[{key:"passes",value:function(){for(var e=0;e<this.filterChain.length;e+=1)if(!this.filterChain[e].expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}},{key:"toJSON",value:function(){return{filters:this.filterChain.map((function(e){return e.string}))}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()}}]);
//# sourceMappingURL=4.03962cf0.chunk.js.map